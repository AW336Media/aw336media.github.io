function waitForWebfonts(e,r){for(var t=0,a=0,s=e.length;s>a;++a)(function(a){function s(){return n&&n.offsetWidth!=i&&(++t,n.parentNode.removeChild(n),n=null),t>=e.length&&(o&&clearInterval(o),t==e.length&&r)?(r(),r=null,!0):void 0}var i,o,n=document.createElement("span");n.innerHTML="giItT1WQy@!-/#",n.style.position="absolute",n.style.left="-10000px",n.style.top="-10000px",n.style.fontSize="300px",n.style.fontVariant="normal",n.style.fontStyle="normal",n.style.fontWeight="normal",n.style.letterSpacing="0",document.body.appendChild(n),i=n.offsetWidth,n.style.fontFamily=a,s()||(o=setInterval(s,50))})(e[a])}function addSprite(e){0==e?layerSprites.sprites.push({type:0,backgroundmode:0,posx:.5*fullImgWidth,posy:.5*fullImgHeight,rot:0,scalex:70,toggleborder:!1,toggleshadow:!1,border:[0,getBytecolor("rgba(0, 0, 0, 1)")],borderthickness:1,shadowoffsetx:0,shadowoffsety:0,shadowcolor:getBytecolor("rgba(0, 0, 0, 1)"),shadowblur:10,image:null,text:"panzoid",color:[0,getBytecolor("rgba(255, 255, 255, 1)")],colorangle:0,borderangle:0,font:"Arial",width:0,height:0}):1==e&&layerSprites.sprites.push({type:1,posx:.5*fullImgWidth,posy:.5*fullImgHeight,rot:0,scalex:1,scaley:1,toggleborder:!1,toggleshadow:!1,border:[0,getBytecolor("rgba(0, 0, 0, 1)")],borderthickness:1,shadowoffsetx:0,shadowoffsety:0,shadowcolor:getBytecolor("rgba(0, 0, 0, 1)"),shadowblur:10,image:null,borderangle:0,generator:0,color:[0,getBytecolor("rgba(0, 0, 0, 1)")],colorangle:0,width:0,height:0}),redrawElement(redrawSprites),$("#spriteList").append('<li id="sprite_'+(layerSprites.sprites.length-1)+'">Sprite '+layerSprites.sprites.length+'<img title="delete" class="delimg" src="/legacy/img/delete.png" onclick="deleteSprite(this);" /><img title="duplicate" class="delimg" src="/legacy/img/duplicate.png" onclick="duplicateSprite(this);" /></li>'),$("#sprite_"+(layerSprites.sprites.length-1)).click(function(){$(this).toggleClass("sselected").siblings().removeClass("sselected"),setselSprite()})}function setselSprite(){selSprite=-1,$.each($(".sselected"),function(e,r){selSprite=parseInt($(r).attr("id").replace("sprite_",""))});var e=$("#spriteproperties");presetImgSelector.detach(),fontSelector.detach(),e.children().remove(),-1!=selSprite&&(0==layerSprites.sprites[selSprite].type?(generateTextInput(e,layerSprites.sprites[selSprite].text,function(e){layerSprites.sprites[selSprite].text=e,redrawSelSprites()}),generateFontPicker(e,layerSprites.sprites[selSprite].font,function(e){layerSprites.sprites[selSprite].font=e,redrawSelSprites()}),generateSpacer(e),generateGradientPicker(e,"Color",layerSprites.sprites[selSprite].color,function(e){layerSprites.sprites[selSprite].color=e,redrawSelSprites()}),generateInput(e,"Gradient angle",layerSprites.sprites[selSprite].colorangle,function(e){layerSprites.sprites[selSprite].colorangle=e,redrawSelSprites()},360,0,1),generateDualInput(e,"Position","X:","Y:",layerSprites.sprites[selSprite].posx,function(e){layerSprites.sprites[selSprite].posx=e,redrawSelSprites()},layerSprites.sprites[selSprite].posy,function(e){layerSprites.sprites[selSprite].posy=e,redrawSelSprites()},2500,-2500,1,"ssposx","ssposy",!0),generateInput(e,"Rotation",layerSprites.sprites[selSprite].rot,function(e){layerSprites.sprites[selSprite].rot=e,redrawSelSprites()},360,0,1),generateInput(e,"Font size",layerSprites.sprites[selSprite].scalex,function(e){layerSprites.sprites[selSprite].scalex=e,redrawSelSprites()},500,1,1),generateSpacer(e),generateDropdown(e,"Text border",layerSprites.sprites[selSprite].toggleborder+1,function(e){switch(layerSprites.sprites[selSprite].toggleborder=e-1,redrawSelSprites(),e){case 1:$("#spriteproperties_11,#spriteproperties_12,#spriteproperties_13").hide("blind",500);break;case 2:$("#spriteproperties_11,#spriteproperties_12,#spriteproperties_13").show("blind",500)}},"off;on"),generateGradientPicker(e,"Color",layerSprites.sprites[selSprite].border,function(e){layerSprites.sprites[selSprite].border=e,redrawSelSprites()}).toggle(1==layerSprites.sprites[selSprite].toggleborder),generateInput(e,"Gradient angle",layerSprites.sprites[selSprite].borderangle,function(e){layerSprites.sprites[selSprite].borderangle=e,redrawSelSprites()},360,0,1).toggle(1==layerSprites.sprites[selSprite].toggleborder),generateInput(e,"Thickness",layerSprites.sprites[selSprite].borderthickness,function(e){layerSprites.sprites[selSprite].borderthickness=e,redrawSelSprites()},500,1,1).toggle(1==layerSprites.sprites[selSprite].toggleborder),generateSpacer(e),generateDropdown(e,"Text shadow",layerSprites.sprites[selSprite].toggleshadow+1,function(e){switch(layerSprites.sprites[selSprite].toggleshadow=e-1,redrawSelSprites(),e){case 1:$("#spriteproperties_16,#spriteproperties_17,#spriteproperties_18").hide("blind",500);break;case 2:$("#spriteproperties_16,#spriteproperties_17,#spriteproperties_18").show("blind",500)}},"off;on"),generateColorPicker(e,"Color",layerSprites.sprites[selSprite].shadowcolor,!0,function(e){layerSprites.sprites[selSprite].shadowcolor=e},function(){redrawSelSprites()}).toggle(1==layerSprites.sprites[selSprite].toggleshadow),generateDualInput(e,"Offset","X:","Y:",layerSprites.sprites[selSprite].shadowoffsetx,function(e){layerSprites.sprites[selSprite].shadowoffsetx=e,redrawSelSprites()},layerSprites.sprites[selSprite].shadowoffsety,function(e){layerSprites.sprites[selSprite].shadowoffsety=e,redrawSelSprites()},2500,-2500,1).toggle(1==layerSprites.sprites[selSprite].toggleshadow),generateInput(e,"Blur",layerSprites.sprites[selSprite].shadowblur,function(e){layerSprites.sprites[selSprite].shadowblur=e,redrawSelSprites()},250,0,1).toggle(1==layerSprites.sprites[selSprite].toggleshadow)):1==layerSprites.sprites[selSprite].type&&(generateFileUpload(e,"File",layerSprites.sprites[selSprite],function(){redrawSelSprites()}),generateDualInput(e,"Position","X:","Y:",layerSprites.sprites[selSprite].posx,function(e){layerSprites.sprites[selSprite].posx=e,redrawSelSprites()},layerSprites.sprites[selSprite].posy,function(e){layerSprites.sprites[selSprite].posy=e,redrawSelSprites()},2500,-2500,1,"ssposx","ssposy",!0),generateInput(e,"Rotation",layerSprites.sprites[selSprite].rot,function(e){layerSprites.sprites[selSprite].rot=e,redrawSelSprites()},360,0,1),generateDualInput(e,"Scale","X:","Y:",layerSprites.sprites[selSprite].scalex,function(e){layerSprites.sprites[selSprite].scalex=e,redrawSelSprites()},layerSprites.sprites[selSprite].scaley,function(e){layerSprites.sprites[selSprite].scaley=e,redrawSelSprites()},2500,-2500,1),generateSpacer(e),generateDropdown(e,"Image border",layerSprites.sprites[selSprite].toggleborder+1,function(e){switch(layerSprites.sprites[selSprite].toggleborder=e-1,redrawSelSprites(),e){case 1:$("#spriteproperties_7,#spriteproperties_8,#spriteproperties_9").hide("blind",500);break;case 2:$("#spriteproperties_7,#spriteproperties_8,#spriteproperties_9").show("blind",500)}},"off;on"),generateGradientPicker(e,"Color",layerSprites.sprites[selSprite].border,function(e){layerSprites.sprites[selSprite].border=e,redrawSelSprites()}).toggle(1==layerSprites.sprites[selSprite].toggleborder),generateInput(e,"Gradient angle",layerSprites.sprites[selSprite].borderangle,function(e){layerSprites.sprites[selSprite].borderangle=e,redrawSelSprites()},360,0,1).toggle(1==layerSprites.sprites[selSprite].toggleborder),generateInput(e,"Thickness",layerSprites.sprites[selSprite].borderthickness,function(e){layerSprites.sprites[selSprite].borderthickness=e,redrawSelSprites()},500,1,1).toggle(1==layerSprites.sprites[selSprite].toggleborder),generateSpacer(e),generateDropdown(e,"Image shadow",layerSprites.sprites[selSprite].toggleshadow+1,function(e){switch(layerSprites.sprites[selSprite].toggleshadow=e-1,redrawSelSprites(),e){case 1:$("#spriteproperties_12,#spriteproperties_13,#spriteproperties_14").hide("blind",500);break;case 2:$("#spriteproperties_12,#spriteproperties_13,#spriteproperties_14").show("blind",500)}},"off;on"),generateColorPicker(e,"Color",layerSprites.sprites[selSprite].shadowcolor,!0,function(e){layerSprites.sprites[selSprite].shadowcolor=e},function(){redrawSelSprites()}).toggle(1==layerSprites.sprites[selSprite].toggleshadow),generateDualInput(e,"Offset","X:","Y:",layerSprites.sprites[selSprite].shadowoffsetx,function(e){layerSprites.sprites[selSprite].shadowoffsetx=e,redrawSelSprites()},layerSprites.sprites[selSprite].shadowoffsety,function(e){layerSprites.sprites[selSprite].shadowoffsety=e,redrawSelSprites()},2500,-2500,1).toggle(1==layerSprites.sprites[selSprite].toggleshadow),generateInput(e,"Blur",layerSprites.sprites[selSprite].shadowblur,function(e){layerSprites.sprites[selSprite].shadowblur=e,redrawSelSprites()},250,0,1).toggle(1==layerSprites.sprites[selSprite].toggleshadow)))}function deleteSprite(e){var r=parseInt($(e).parent().attr("id").replace("sprite_",""));$(e).parent().remove(),layerSprites.sprites.splice(r,1),$("#spriteList").each(function(){$(this).find("li").each(function(e){$(this).attr("id","sprite_"+e)})}),redrawElement(redrawSprites),setselSprite()}function duplicateSprite(e){var r=parseInt($(e).parent().attr("id").replace("sprite_","")),t=layerSprites.sprites[r];layerSprites.sprites.push($.extend(!0,{},t)),redrawElement(redrawSprites),$("#spriteList").append('<li id="sprite_'+(layerSprites.sprites.length-1)+'">Sprite '+layerSprites.sprites.length+'<img title="delete" class="delimg" src="/legacy/img/delete.png" onclick="deleteSprite(this);" /><img title="duplicate" class="delimg" src="/legacy/img/duplicate.png" onclick="duplicateSprite(this);" /></li>'),$("#sprite_"+(layerSprites.sprites.length-1)).click(function(){$(this).toggleClass("sselected").siblings().removeClass("sselected"),setselSprite()})}function sortSprites(e){var r=[];for(t=0;t<e.length;t++)r[t]=layerSprites.sprites[parseInt(e[t].replace("sprite_",""))];layerSprites.sprites=r,$("#spriteList").each(function(){$(this).find("li").each(function(e){$(this).attr("id","sprite_"+e)})}),redrawElement(redrawSprites)}function generateRandomColor(){return 255|Math.floor(16777215*Math.random())<<8}function getHTMLcolor(e){var r="rgba(";return r+=(e>>24&255)+", "+(e>>16&255)+", "+(e>>8&255)+", "+(255&e)/255,r+")"}function getBytecolor(e){m=/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(e);var r;return m&&(r=Math.floor(255*m[4])|m[3]<<8|m[2]<<16|m[1]<<24),r}function fileupload(e,r,t){if(e.files&&e.files[0]){var a=new FileReader;a.onload=function(e){r.image=new Image,r.image.onload=t,r.image.src=e.target.result},a.readAsDataURL(e.files[0])}}function redrawBG(e){e.buffer=renderToBuffer(fullImgWidth,fullImgHeight,renderBG,e)}function redrawOverlay(){layerOverlay.buffer=renderToBuffer(fullImgWidth,fullImgHeight,renderOverlay),layerOverlay.fadebuffer=renderToBuffer(fullImgWidth,fullImgHeight,renderFade)}function redrawSprites(){layerSprites.buffer=renderToBuffer(fullImgWidth,fullImgHeight,renderSprites)}function redrawPreview(){renderPreview(document.getElementById("c_backgrounder").getContext("2d"),previewImgWidth,previewImgHeight)}function renderBG(e,r,t,a){switch(a.type){case 1:case 2:if(!a.image)return;switch(a.imageProps[4]){case 1:if(0==a.image.width||0==a.image.height)return!1;var s=e.createPattern(a.image,"repeat");e.fillStyle=s,e.fillRect(0,0,r,t);break;case 2:e.drawImage(a.image,0,0,r,t);break;case 3:e.drawImage(a.image,a.imageProps[0],a.imageProps[1],a.image.width*a.imageProps[2],a.image.height*a.imageProps[3])}break;case 3:switch(a.generator){case 1:bgGradient(e,r,t,a);break;case 2:bgSunburst(e,r,t,a);break;case 3:bgLines(e,r,t,a);break;case 4:bgCheckers(e,r,t,a);break;case 5:bgScribble(e,r,t,a);break;case 6:bgWaves(e,r,t,a);break;case 7:bgTextDrapes(e,r,t,a);break;case 8:bgLightning(e,r,t,a);break;case 9:bgConcentricShapes(e,r,t,a);break;case 10:bgNoise(e,r,t,a);break;case 11:bgPerlinNoise(e,r,t,a);break;case 12:bgRandomShapes(e,r,t,a);break;case 13:bgSplatter(e,r,t,a)}}}function randomizeBG(e){var r,t,a,s,o,n,l,p,d,g;switch(e.generator){case 5:for(e.randPts1=[],d=0;d<e.scribbleProps[2];++d)e.randPts1[d]={},e.randPts1[d].x1=Math.floor(Math.random()*fullImgWidth),e.randPts1[d].y1=Math.floor(Math.random()*fullImgHeight),e.randPts1[d].x2=Math.floor(Math.random()*fullImgWidth),e.randPts1[d].y2=Math.floor(Math.random()*fullImgHeight),e.randPts1[d].x3=Math.floor(Math.random()*fullImgWidth),e.randPts1[d].y3=Math.floor(Math.random()*fullImgHeight);if(e.randPts2=[],2==e.scribbleProps[0]){for(l=document.createElement("canvas"),l.width=200,l.height=1,n=l.getContext("2d").createLinearGradient(0,0,200,1),l.getContext("2d").clearRect(0,0,200,1),l.getContext("2d").fillStyle=n,p=0;p<e.scribbleColor.length;p+=2)n.addColorStop(e.scribbleColor[p],getHTMLcolor(e.scribbleColor[p+1]));l.getContext("2d").fillRect(0,0,200,1)}for(r=.01*e.scribbleProps[6],d=0;d<e.scribbleProps[4];++d)e.randPts2[d]={},e.randPts2[d].x=Math.floor(Math.random()*fullImgWidth*r)-fullImgWidth*r*.5,e.randPts2[d].y=Math.floor(Math.random()*fullImgHeight*r)-fullImgHeight*r*.5,e.randPts2[d].alpha=Math.random(),1==e.scribbleProps[0]?e.randPts2[d].color=generateRandomColor():2==e.scribbleProps[0]?(g=l.getContext("2d").getImageData(Math.floor(200*Math.random()),0,1,1).data,e.randPts2[d].color=Math.floor(g[3])|g[2]<<8|g[1]<<16|g[0]<<24):e.randPts2[d].color="white";break;case 7:e.randPts1=[];var n,l,c=e.drapesProps[3],h=e.drapesProps[4],u=e.drapesProps[5],f=e.drapesProps[6],y=e.drapesProps[2],w=e.drapesProps[1];if(2==e.drapesProps[0]){for(l=document.createElement("canvas"),l.width=200,l.height=1,n=l.getContext("2d").createLinearGradient(0,0,200,1),l.getContext("2d").clearRect(0,0,200,1),l.getContext("2d").fillStyle=n,t=e.drapesColor.split(";"),i=0;i<t.length;++i)a=t[i].split(":"),n.addColorStop(a[0],a[1]);l.getContext("2d").fillRect(0,0,200,1)}for(d=0;d<e.drapesProps[9];++d){switch(e.randPts1[d]={},e.drapesProps[7]){case 0:e.randPts1[d].x=-Math.floor(Math.random()*(f-u))-u,e.randPts1[d].y=Math.floor(Math.random()*(h-c))+c;break;default:e.randPts1[d].x=Math.floor(Math.random()*(f-u))+u,e.randPts1[d].y=Math.floor(Math.random()*(h-c))+c}e.randPts1[d].size=Math.floor(Math.random()*(y-w))+w,1==e.drapesProps[0]?e.randPts1[d].color="rgb("+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+")":2==e.drapesProps[0]?(g=l.getContext("2d").getImageData(Math.floor(200*Math.random()),0,1,1).data,e.randPts1[d].color="rgba("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+")"):e.randPts1[d].color="white"}break;case 3:if(e.randPts1=[],e.linesProps[7]<2)return;if(s=lineDistance(0,0,fullImgWidth,fullImgHeight)/(e.linesProps[2]+e.linesProps[0]),2==e.linesProps[7]){for(l=document.createElement("canvas"),l.width=200,l.height=1,n=l.getContext("2d").createLinearGradient(0,0,200,1),l.getContext("2d").clearRect(0,0,200,1),l.getContext("2d").fillStyle=n,p=0;p<e.linesColor.length;p+=2)n.addColorStop(e.linesColor[p],getHTMLcolor(e.linesColor[p+1]));l.getContext("2d").fillRect(0,0,200,1)}for(d=0;s>d;++d)e.randPts1[d]={},3==e.linesProps[7]?e.randPts1[d].color=generateRandomColor():2==e.linesProps[7]&&(g=l.getContext("2d").getImageData(Math.floor(200*Math.random()),0,1,1).data,e.randPts1[d].color=Math.floor(g[3])|g[2]<<8|g[1]<<16|g[0]<<24);break;case 4:if(e.randPts1=[],e.checkersProps[2]<7)return;if(o=Math.ceil(fullImgHeight/(fullImgWidth/e.checkersProps[4]))*e.checkersProps[4],7==e.checkersProps[2]){for(l=document.createElement("canvas"),l.width=200,l.height=1,n=l.getContext("2d").createLinearGradient(0,0,200,1),l.getContext("2d").clearRect(0,0,200,1),l.getContext("2d").fillStyle=n,p=0;p<e.checkersColor.length;p+=2)n.addColorStop(e.checkersColor[p],getHTMLcolor(e.checkersColor[p+1]));l.getContext("2d").fillRect(0,0,200,1)}for(d=0;o>d;++d)e.randPts1[d]={},8==e.checkersProps[2]?e.randPts1[d].color=generateRandomColor():7==e.checkersProps[2]&&(g=l.getContext("2d").getImageData(Math.floor(200*Math.random()),0,1,1).data,e.randPts1[d].color=Math.floor(g[3])|g[2]<<8|g[1]<<16|g[0]<<24)}redrawBG(e),refreshPreview()}function bgGradient(e,r,t,a){var s,i,o,n,l=0,p=0;switch(a.gradientProps[2]){case 1:i=a.gradientProps[3]/180*Math.PI,o=Math.sqrt(Math.pow(r,2)+Math.pow(t,2)),Math.sin(i)<0&&(p=t),Math.cos(i)<0&&(l=r),s=e.createLinearGradient(l,p,Math.min(r,o*Math.cos(i))+l,Math.min(t,o*Math.sin(i))+p);break;case 2:var d=parseInt(a.gradientProps[0],10),g=parseInt(a.gradientProps[1],10),c=Math.max(lineDistance(0,0,d,g),lineDistance(0,t,d,g),lineDistance(r,0,d,g),lineDistance(r,t,d,g));s=e.createRadialGradient(d,g,0,d,g,c)}for(n=0;n<a.gradientColor.length;n+=2)s.addColorStop(a.gradientColor[n],getHTMLcolor(a.gradientColor[n+1]));e.fillStyle=s,e.fillRect(0,0,r,t)}function bgSunburst(e,r,t,a){for(var s,i=0,o=a.sunburstProps[2],n=a.sunburstProps[0],l=a.sunburstProps[1],p=Math.max(lineDistance(0,0,n,l),lineDistance(0,t,n,l),lineDistance(r,0,n,l),lineDistance(r,t,n,l)),d=2*Math.PI/o,g=e.createRadialGradient(n,l,0,n,l,p),c=e.createRadialGradient(n,l,0,n,l,p),h=0;h<a.sunburstColor1.length;h+=2)g.addColorStop(a.sunburstColor1[h],getHTMLcolor(a.sunburstColor1[h+1]));for(h=0;h<a.sunburstColor2.length;h+=2)c.addColorStop(a.sunburstColor2[h],getHTMLcolor(a.sunburstColor2[h+1]));for(e.strokeWidth=3,s=0;o>s;++s)0==i?(e.fillStyle=g,e.strokeStyle=g,e.beginPath(),e.moveTo(n,l),e.lineTo(n+Math.cos(s*d)*p,l+Math.sin(s*d)*p),e.arcTo(n,l,n+Math.cos((s+1)*d)*p,l+Math.sin((s+1)*d)*p,p),e.lineTo(n,l),e.fill(),e.stroke(),i=1):(e.fillStyle=c,e.strokeStyle=c,e.beginPath(),e.moveTo(n,l),e.lineTo(n+Math.cos(s*d)*p,l+Math.sin(s*d)*p),e.arcTo(n,l,n+Math.cos((s+1)*d)*p,l+Math.sin((s+1)*d)*p,p),e.lineTo(n,l),e.fill(),e.stroke(),i=0)}function bgLines(e,r,t,a){var s,i,o,n,l,p,d=0,g=0,c=a.linesProps[0],h=a.linesProps[4],u=0,f=a.linesProps[2],y=lineDistance(0,0,r,t);if(e.translate(r/2+.5,t/2+.5),e.rotate(a.linesProps[6]/180*Math.PI),a.randPts1.length||randomizeBG(a),1==a.linesProps[7]){for(s=a.linesProps[1]/180*Math.PI,i=Math.sqrt(Math.pow(y,2)+Math.pow(y,2)),Math.sin(s)<0&&(g=y),Math.cos(s)<0&&(d=y),o=e.createLinearGradient(-(y/2)+d,-(y/2)+g,-(y/2)+Math.min(y,i*Math.cos(s))+d,-(y/2)+Math.min(y,i*Math.sin(s))+g),l=0;l<a.linesColor.length;l+=2)o.addColorStop(a.linesColor[l],getHTMLcolor(a.linesColor[l+1]));e.strokeStyle=o}switch(n=a.linesProps[3],a.linesProps[5]){case 2:e.lineJoin="round";break;case 3:e.lineJoin="bevel";break;default:e.lineJoin="miter"}for(e.lineWidth=f,l=0;y>l;l=l+f+c){for(u=1,e.beginPath(),e.moveTo(-y/2,-y/2+l-h),1!=a.linesProps[7]&&(e.strokeStyle=getHTMLcolor(a.randPts1[l/(f+c)%a.randPts1.length].color)),p=1;n>=p;p++)0==u?(e.lineTo(-y/2+p/n*y,-y/2+l-h),u=1):(e.lineTo(-y/2+p/n*y,-y/2+l+h),u=0);e.stroke()}}function bgCheckers(e,r,t,a){var s,i,o,n,l,p,d,g,c=a.checkersProps[4],h=r/c,u=Math.ceil(t/h),f=a.checkersProps[6],y=f,w=a.checkersProps[5],b=0,m=0;switch(Math.sin(o)<0&&(m=t),Math.cos(o)<0&&(b=r),a.randPts1.length||randomizeBG(a),a.checkersProps[2]){case 1:o=a.checkersProps[3]/180*Math.PI,n=Math.sqrt(Math.pow(r,2)+Math.pow(t,2)),s=e.createLinearGradient(b,m,Math.min(r,n*Math.cos(o))+b,Math.min(t,n*Math.sin(o))+m),e.fillStyle=s;break;case 3:o=a.checkersProps[3]/180*Math.PI,n=Math.sqrt(Math.pow(r,2)+Math.pow(t,2)),i=document.createElement("canvas"),i.width=r,i.height=t,i.getContext("2d").clearRect(0,0,r,t),s=i.getContext("2d").createLinearGradient(b,m,Math.min(r,n*Math.cos(o))+b,Math.min(t,n*Math.sin(o))+m),i.getContext("2d").fillStyle=s;break;case 5:o=a.checkersProps[3]/180*Math.PI,n=Math.sqrt(Math.pow(h,2)+Math.pow(h,2)),s=e.createLinearGradient(b,m,Math.min(h,n*Math.cos(o))+b,Math.min(h,n*Math.sin(o))+m),e.fillStyle=s;break;case 2:var P=a.checkersProps[0],B=a.checkersProps[1],v=Math.max(lineDistance(0,0,P,B),lineDistance(0,t,P,B),lineDistance(r,0,P,B),lineDistance(r,t,P,B));s=e.createRadialGradient(P,B,0,P,B,v),e.fillStyle=s;break;case 4:var P=a.checkersProps[0],B=a.checkersProps[1],v=Math.max(lineDistance(0,0,P,B),lineDistance(0,t,P,B),lineDistance(r,0,P,B),lineDistance(r,t,P,B));i=document.createElement("canvas"),i.width=r,i.height=t,s=i.getContext("2d").createRadialGradient(P,B,0,P,B,v),i.getContext("2d").clearRect(0,0,r,t),i.getContext("2d").fillStyle=s;break;case 6:var P=a.checkersProps[0],B=a.checkersProps[1],v=Math.max(lineDistance(0,0,P,B),lineDistance(0,h,P,B),lineDistance(h,0,P,B),lineDistance(h,h,P,B));s=e.createRadialGradient(P,B,0,P,B,v),e.fillStyle=s}if(a.checkersProps[2]<7)for(l=0;l<a.checkersColor.length;l+=2)s.addColorStop(a.checkersColor[l],getHTMLcolor(a.checkersColor[l+1]));for(i&&i.getContext("2d").fillRect(0,0,r,t),p=.5;u>p;++p){for(d=.5;c>d;++d)2==f?f=1:(e.save(),a.checkersProps[2]>6&&(e.fillStyle=getHTMLcolor(a.randPts1[(p+.5)*(d+.5)%a.randPts1.length].color)),a.checkersProps[2]>=5&&(e.translate(d*h,p*h),e.fillRect(-h/2+w,-h/2+w,h-2*w,h-2*w),e.restore()),(3==a.checkersProps[2]||4==a.checkersProps[2])&&(g=i.getContext("2d").getImageData(d*h,p*h,1,1).data,e.fillStyle="rgba("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+")"),a.checkersProps[2]<=4&&e.fillRect(d*h+-h/2+w,p*h+-h/2+w,h-2*w,h-2*w),1==f&&(f=2));1==y?(f=2,y=2):2==y&&(f=1,y=1)}}function bgScribble(e,r,t,a){var s,o;switch(e.lineWidth=a.scribbleProps[3],e.shadowBlur=a.scribbleProps[5]*ratio,a.randPts1.length&&a.randPts2.length||randomizeBG(a),a.scribbleProps[7]){case 2:e.lineJoin="round";break;case 3:e.lineJoin="bevel";break;default:e.lineJoin="miter"}if(3==a.scribbleProps[0]){var n,l=0,p=0,d=a.scribbleProps[1]/180*Math.PI,g=Math.sqrt(Math.pow(r,2)+Math.pow(t,2));for(Math.sin(d)<0&&(p=t),Math.cos(d)<0&&(l=r),n=e.createLinearGradient(l,p,Math.min(r,g*Math.cos(d))+l,Math.min(t,g*Math.sin(d))+p),s=0;s<a.scribbleColor.length;s+=2)n.addColorStop(a.scribbleColor[s],getHTMLcolor(a.scribbleColor[s+1]));e.strokeStyle=n,e.shadowColor="black"}for(o=0;o<a.randPts2.length;++o){for(e.translate(a.randPts2[o].x,a.randPts2[o].y),e.beginPath(),e.moveTo(a.randPts1[0].x1,a.randPts1[0].y1),a.scribbleProps[8]&&(e.globalAlpha=a.randPts2[o].alpha),i=1;i<a.randPts1.length;++i)e.bezierCurveTo(a.randPts1[i].x1,a.randPts1[i].y1,a.randPts1[i].x2,a.randPts1[i].y2,a.randPts1[i].x3,a.randPts1[i].y3);3!=a.scribbleProps[0]&&(e.strokeStyle=getHTMLcolor(a.randPts2[o].color),e.shadowColor=e.strokeStyle),e.stroke()}}function bgWaves(e,r,t,a){var s,o=100,n=a.wavesProps[3],l=a.wavesProps[2],p=0,d=0,g=a.wavesProps[4],c=a.wavesProps[5],h=0,u=(a.wavesProps[1],a.wavesProps[6]);t-a.wavesProps[7];for(z=u;z>0;--z){for(e.beginPath(),e.moveTo(r,0),e.lineTo(0,0),e.shadowColor="#000000",e.shadowBlur=20,s=e.createLinearGradient(0,-n+t*(Math.max(z-1,0)/u),0,t*(z/u)+n),s.addColorStop(0,"rgb("+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+")"),s.addColorStop(1,"rgb("+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+")"),e.fillStyle=s,e.strokeStyle="black",e.lineWidth=10,d=Math.floor(Math.random()*(c-g))+g,h=Math.random()*Math.PI*2,p=Math.floor(Math.random()*(n-l))+l,i=0;i<=o;++i)e.lineTo(i/o*r,t*(z/u)+p*Math.sin(i/o*2*Math.PI*d+h));e.lineTo(r,0),e.stroke(),e.fill()}}function bgTextDrapes(e,r,t,a){var s,o,n=a.drapesText;switch(a.drapesProps[7]){case 0:e.rotate(.5*-Math.PI);break;case 2:e.translate(r,t);break;case 3:e.rotate(.5*Math.PI);break;case 4:e.rotate(.2*Math.PI);break;case 5:e.translate(r,t),e.rotate(.2*Math.PI)}if(3==a.drapesProps[0]){var l,p=0,d=0,g=a.drapesProps[10]/180*Math.PI,c=Math.sqrt(Math.pow(r,2)+Math.pow(t,2));for(Math.sin(g)<0&&(d=t),Math.cos(g)<0&&(p=r),l=e.createLinearGradient(p,d,Math.min(r,c*Math.cos(g))+p,Math.min(t,c*Math.sin(g))+d),s=a.drapesColor.split(";"),i=0;i<s.length;++i)o=s[i].split(":"),l.addColorStop(o[0],o[1]);e.fillStyle=l,e.shadowColor="black"}for(i=0;i<a.randPts1.length;++i)switch(e.font=a.randPts1[i].size+"px "+a.drapesFont,3!=a.drapesProps[0]&&(e.fillStyle=a.randPts1[i].color,e.shadowColor=e.fillStyle),e.shadowBlur=a.drapesProps[8]*ratio,a.drapesProps[7]){case 0:e.fillText(n,a.randPts1[i].x-e.measureText(n).width,a.randPts1[i].y);break;case 2:case 5:e.fillText(n,a.randPts1[i].x-e.measureText(n).width,a.randPts1[i].y-t);break;case 3:e.fillText(n,a.randPts1[i].x,a.randPts1[i].y-r);break;case 6:for(e.textBaseline="top",w=0;w<n.length;++w)e.fillText(n.charAt(w),a.randPts1[i].y,a.randPts1[i].x+w*a.randPts1[i].size*.9);break;default:e.fillText(n,a.randPts1[i].x,a.randPts1[i].y)}}function bgLightning(e,r,t,a){switch(e.shadowColor=getHTMLcolor(a.lightningGlowColor),e.shadowBlur=a.lightningProps[9],e.strokeStyle=getHTMLcolor(a.lightningLightColor),a.lightningProps[0]){case 1:for(i=0;i<a.lightningProps[7];++i)for(e.lineWidth=Math.floor(Math.random()*(a.lightningProps[6]-a.lightningProps[5]))+a.lightningProps[5],e.beginPath(),Math.random()>.5?drawLightning(e,a.lightningProps[1],a.lightningProps[2],r*Math.round(Math.random()),t*Math.random(),a.lightningProps[8]):drawLightning(e,a.lightningProps[1],a.lightningProps[2],r*Math.random(),t*Math.round(Math.random()),a.lightningProps[8]),x=0;x<a.lightningProps[10];++x)e.stroke();break;case 2:for(i=0;i<a.lightningProps[7];++i)for(e.lineWidth=Math.floor(Math.random()*(a.lightningProps[6]-a.lightningProps[5]))+a.lightningProps[5],e.beginPath(),drawLightning(e,a.lightningProps[1],a.lightningProps[2],a.lightningProps[3],a.lightningProps[4],a.lightningProps[8]),x=0;x<a.lightningProps[10];++x)e.stroke();break;case 3:for(i=0;i<a.lightningProps[7];++i)for(e.lineWidth=Math.floor(Math.random()*(a.lightningProps[6]-a.lightningProps[5]))+a.lightningProps[5],e.beginPath(),drawLightning(e,0,t*Math.random(),r,t*Math.random(),a.lightningProps[8]),x=0;x<a.lightningProps[10];++x)e.stroke();break;case 4:for(i=0;i<a.lightningProps[7];++i)for(e.lineWidth=Math.floor(Math.random()*(a.lightningProps[6]-a.lightningProps[5]))+a.lightningProps[5],e.beginPath(),drawLightning(e,r*Math.random(),0,r*Math.random(),t,a.lightningProps[8]),x=0;x<a.lightningProps[10];++x)e.stroke()}}function bgConcentricShapes(e,r,t){var a,s=r/2,o=t/2,n=r/2;for(i=20;i>=0;--i)e.fillStyle="rgb("+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+")",a=n*(i/20),e.fillRect(s-a,o-a,2*a,2*a)}function bgNoise(e,r,t,a){drawNoise(e,0,0,r*ratio,t*ratio,255*a.noiseProps[0]),e.globalCompositeOperation="lighter",e.fillStyle=getHTMLcolor(a.noiseColor),e.fillRect(0,0,r,t)}function bgPerlinNoise(e,r,t,a){var s,i,o,n,l,p,d=r*ratio,g=t*ratio,c=document.createElement("canvas");for(c.width=d,c.height=g,drawNoise(c.getContext("2d"),0,0,d,g,255),e.save(),s=g/d,i=4;d>=i;i*=2)o=Math.random()*(d-i)|0,n=Math.random()*(g-i*s)|0,e.globalAlpha=4/i,e.drawImage(c,o,n,i,i*s,0,0,r,t);for(e.restore(),c.width=256,c.height=1,c.getContext("2d").clearRect(0,0,256,1),l=c.getContext("2d").createLinearGradient(0,0,256,1),c.getContext("2d").fillStyle=l,p=0;p<a.perlinNoiseColor.length;p+=2)l.addColorStop(a.perlinNoiseColor[p],getHTMLcolor(a.perlinNoiseColor[p+1]));c.getContext("2d").fillRect(0,0,256,1);for(var h=e.getImageData(0,0,d,g),u=c.getContext("2d").getImageData(0,0,256,1).data,f=h.data,y=f.length,w=0,b=0;y>w;)b=4*f[w],f[w++]=u[b],f[w++]=u[b+1],f[w++]=u[b+2],f[w++]=u[b+3];e.putImageData(h,0,0)}function bgRandomShapes(){}function bgSplatter(){}function drawBox(e,r,t,a,s){e.rect(r-.5*a,t-.5*s,a,s)}function drawCircle(e,r,t,a,s,i){e.arc(r,t,a,s/180*Math.PI,i/180*Math.PI)}function drawHeart(e){e.beginPath(),e.moveTo(75,40),e.bezierCurveTo(75,37,70,25,50,25),e.bezierCurveTo(20,25,20,62.5,20,62.5),e.bezierCurveTo(20,80,40,102,75,120),e.bezierCurveTo(110,102,130,80,130,62.5),e.bezierCurveTo(130,62.5,130,25,100,25),e.bezierCurveTo(85,25,75,37,75,40),e.fill()}function drawStar(){}function drawHexagon(){}function drawOctagon(){}function drawTriangle(){}function drawNoise(e,r,t,a,s,i){r=r||0,t=t||0,i=i||255;for(var o=e.getImageData(r,t,a,s),n=Math.random,l=o.data,p=l.length,d=0;p>d;)l[d++]=l[d++]=l[d++]=256*n()|0,l[d++]=i;return e.putImageData(o,r,t),e}function drawLightning(e,r,t,a,s,i){var o,n;1>i?(e.moveTo(r,t),e.lineTo(a,s)):(o=(a+r)/2,n=(s+t)/2,o+=(Math.random()-.5)*i,n+=(Math.random()-.5)*i,drawLightning(e,r,t,o,n,i/2),drawLightning(e,a,s,o,n,i/2))}function lineDistance(e,r,t,a){var s=0,i=0;return s=t-e,s*=s,i=a-r,i*=i,Math.sqrt(s+i)}function renderFade(e,r,t){var a,s;switch(layerOverlay.fademode){case 2:a=layerOverlay.fadeheight,s=e.createLinearGradient(0,t-a,0,t),s.addColorStop(0,"rgba(1, 1, 1, 0)"),s.addColorStop(layerOverlay.fadestop,"rgba(1, 1, 1, 1)"),e.fillStyle=s,e.fillRect(0,t-a,r,a);break;case 3:a=layerOverlay.fadeheight,s=e.createRadialGradient(r/2,0,t-a,r/2,0,t),s.addColorStop(0,"rgba(1, 1, 1, 0)"),s.addColorStop(layerOverlay.fadestop,"rgba(1, 1, 1, 1)"),e.fillStyle=s,e.fillRect(0,0,r,t);break;case 4:var a=layerOverlay.fadeheight,i=lineDistance(r/2,t/2,r,t),s=e.createRadialGradient(r/2,t/2,i-a,r/2,t/2,i);s.addColorStop(0,"rgba(1, 1, 1, 0)"),s.addColorStop(layerOverlay.fadestop,"rgba(1, 1, 1, 1)"),e.fillStyle=s,e.fillRect(0,0,r,t)}}function renderOverlay(e){if(layerOverlay.toggleshadow&&(e.shadowColor=getHTMLcolor(layerOverlay.shadowcolor),e.shadowBlur=layerOverlay.shadowblur*ratio,e.shadowOffsetX=layerOverlay.shadowoffsetx,e.shadowOffsetY=layerOverlay.shadowoffsety),layerOverlay.channelblank||layerOverlay.toggleshadow){var r,t,a,s;switch(layerPreview.preview){case 4:r=526,t=0,a=866,s=1440;break;default:return}e.rect(r,t,a,s-layerOverlay.shadowcutoff),e.closePath(),e.fillStyle=getHTMLcolor(layerPreview.bgcolor),e.fill(),layerOverlay.channelblank||e.clearRect(r,t,a,s-layerOverlay.shadowcutoff)}}function renderSprites(e){for(var r,t,a,s,i,o,n,l,p=layerSprites.sprites.length-1;p>=0;--p){if(e.save(),0==layerSprites.sprites[p].type){for(r=layerSprites.sprites[p].height=layerSprites.sprites[p].scalex,e.font=r+"px "+layerSprites.sprites[p].font,e.translate(layerSprites.sprites[p].posx,layerSprites.sprites[p].posy),e.rotate(-(layerSprites.sprites[p].rot/180)*Math.PI),layerSprites.sprites[p].width=e.measureText(layerSprites.sprites[p].text).width,o=layerSprites.sprites[p].colorangle/180*Math.PI,n=Math.sqrt(Math.pow(layerSprites.sprites[p].width/2,2)+Math.pow(r/2,2)),s=e.createLinearGradient(-Math.min(layerSprites.sprites[p].width/2,n*Math.cos(o)),-Math.min(r/2,n*Math.sin(o)),Math.min(layerSprites.sprites[p].width/2,n*Math.cos(o)),Math.min(r/2,n*Math.sin(o))),o=layerSprites.sprites[p].borderangle/180*Math.PI,i=e.createLinearGradient(-Math.min(layerSprites.sprites[p].width/2,n*Math.cos(o)),-Math.min(r/2,n*Math.sin(o)),Math.min(layerSprites.sprites[p].width/2,n*Math.cos(o)),Math.min(r/2,n*Math.sin(o))),l=0;l<layerSprites.sprites[p].color.length;l+=2)s.addColorStop(layerSprites.sprites[p].color[l],getHTMLcolor(layerSprites.sprites[p].color[l+1]));for(l=0;l<layerSprites.sprites[p].border.length;l+=2)i.addColorStop(layerSprites.sprites[p].border[l],getHTMLcolor(layerSprites.sprites[p].border[l+1]));e.fillStyle=s,e.strokeStyle=i,1==layerSprites.sprites[p].toggleshadow&&(e.shadowColor=getHTMLcolor(layerSprites.sprites[p].shadowcolor),e.shadowBlur=layerSprites.sprites[p].shadowblur*ratio,e.shadowOffsetX=layerSprites.sprites[p].shadowoffsetx,e.shadowOffsetY=layerSprites.sprites[p].shadowoffsety),e.textBaseline="bottom",e.fillText(layerSprites.sprites[p].text,-(layerSprites.sprites[p].width/2),r/2),e.shadowColor="rgba(0, 0, 0, 0)",1==layerSprites.sprites[p].toggleborder&&(e.lineWidth=layerSprites.sprites[p].borderthickness,e.strokeText(layerSprites.sprites[p].text,-(layerSprites.sprites[p].width/2),r/2))}else if(1==layerSprites.sprites[p].type){if(!layerSprites.sprites[p].image)continue;for(t=layerSprites.sprites[p].width=layerSprites.sprites[p].image.width*layerSprites.sprites[p].scaley,a=layerSprites.sprites[p].height=layerSprites.sprites[p].image.height*layerSprites.sprites[p].scalex,e.translate(layerSprites.sprites[p].posx,layerSprites.sprites[p].posy),e.rotate(-(layerSprites.sprites[p].rot/180)*Math.PI),o=layerSprites.sprites[p].colorangle/180*Math.PI,n=Math.sqrt(Math.pow(t,2)+Math.pow(a/2,2)),s=e.createLinearGradient(-Math.min(t/2,n*Math.cos(o)),-Math.min(a/2,n*Math.sin(o)),Math.min(t/2,n*Math.cos(o)),Math.min(a/2,n*Math.sin(o))),o=layerSprites.sprites[p].borderangle/180*Math.PI,i=e.createLinearGradient(-Math.min(t/2,n*Math.cos(o)),-Math.min(a/2,n*Math.sin(o)),Math.min(t/2,n*Math.cos(o)),Math.min(a/2,n*Math.sin(o))),
l=0;l<layerSprites.sprites[p].color.length;l+=2)s.addColorStop(layerSprites.sprites[p].color[l],getHTMLcolor(layerSprites.sprites[p].color[l+1]));for(l=0;l<layerSprites.sprites[p].border.length;l+=2)i.addColorStop(layerSprites.sprites[p].border[l],getHTMLcolor(layerSprites.sprites[p].border[l+1]));switch(e.fillStyle=s,e.strokeStyle=i,1==layerSprites.sprites[p].toggleshadow&&(e.shadowColor=getHTMLcolor(layerSprites.sprites[p].shadowcolor),e.shadowBlur=layerSprites.sprites[p].shadowblur*ratio,e.shadowOffsetX=layerSprites.sprites[p].shadowoffsetx,e.shadowOffsetY=layerSprites.sprites[p].shadowoffsety),layerSprites.sprites[p].generator){case 0:e.drawImage(layerSprites.sprites[p].image,-(t/2),-(a/2),t,a)}e.shadowColor="rgba(0, 0, 0, 0)",1==layerSprites.sprites[p].toggleborder&&(e.lineWidth=layerSprites.sprites[p].borderthickness,e.strokeRect(-(t/2),-(a/2),t,a))}e.restore()}}function renderPreview(){switch(layerPreview.watermark=new Image,layerPreview.watermark.onload=function(){redrawBG(BGlayers[0]),redrawBG(BGlayers[1]),redrawOverlay(),redrawSprites(),refreshPreview()},layerPreview.preview){case 4:previewOffsetY=40,previewOffsetX=0,fullImgWidth=1920,fullImgHeight=1440,previewImgWidth=1920,previewImgHeight=1520,resizeViewport(),layerPreview.watermark.src="/legacy/img/tw.png";break;case 1:previewOffsetY=0,previewOffsetX=0,fullImgWidth=2560,fullImgHeight=1440,previewImgWidth=2560,previewImgHeight=1440,resizeViewport(),layerPreview.watermark.src="/legacy/img/one.png";break;case 2:previewOffsetY=0,previewOffsetX=0,fullImgWidth=800,fullImgHeight=800,previewImgWidth=800,previewImgHeight=800,resizeViewport(),layerPreview.watermark.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";break;case 3:previewOffsetY=0,previewOffsetX=0,fullImgWidth=1920,fullImgHeight=1080,previewImgWidth=1920,previewImgHeight=1080,resizeViewport(),layerPreview.watermark.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";break;case 5:previewOffsetY=38,previewOffsetX=7,fullImgWidth=851,fullImgHeight=315,previewImgWidth=863,previewImgHeight=528,resizeViewport(),layerPreview.watermark.src="/legacy/img/fbc.png";break;case 6:previewOffsetY=0,previewOffsetX=0,fullImgWidth=1920,fullImgHeight=1080,previewImgWidth=1920,previewImgHeight=1080,resizeViewport(),layerPreview.watermark.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";break;case 7:previewOffsetY=0,previewOffsetX=0,fullImgWidth=1280,fullImgHeight=720,previewImgWidth=1280,previewImgHeight=720,resizeViewport(),layerPreview.watermark.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";break;default:previewOffsetY=0,previewOffsetX=0,fullImgWidth=1920,fullImgHeight=1440,previewImgWidth=1920,previewImgHeight=1520,resizeViewport(),layerPreview.watermark.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}}function renderToCanvas(){if(canvas.getContext){var e=canvas.getContext("2d");e.save();try{for(e.scale(ratio,ratio),e.clearRect(0,0,previewImgWidth,previewImgHeight),i=0;i<BGlayers.length;i++)e.save(),e.globalAlpha=BGlayers[i].opacity,e.drawImage(BGlayers[i].buffer,previewOffsetX,previewOffsetY,fullImgWidth,fullImgHeight),e.restore();e.drawImage(layerOverlay.buffer,previewOffsetX,previewOffsetY,fullImgWidth,fullImgHeight),e.drawImage(layerSprites.buffer,previewOffsetX,previewOffsetY,fullImgWidth,fullImgHeight),e.save(),e.globalCompositeOperation="destination-out",e.drawImage(layerOverlay.fadebuffer,previewOffsetX,previewOffsetY,fullImgWidth,fullImgHeight),e.restore(),e.save(),e.globalCompositeOperation="destination-over",e.fillStyle=getHTMLcolor(layerPreview.bgcolor),e.fillRect(0,0,previewImgWidth,previewImgHeight),e.restore(),e.save(),e.globalAlpha=1,layerPreview.watermark&&2!=layerPreview.preview&&3!=layerPreview.preview&&e.drawImage(layerPreview.watermark,0,0,previewImgWidth,previewImgHeight),e.restore()}finally{e.restore()}}}function refreshPreview(){renderToCanvas(canvas.width,canvas.height)}function redrawElement(e,r){e(),r&&r(),refreshPreview()}function redrawBGnum(e){redrawBG(BGlayers[e]),refreshPreview()}function redrawSelSprites(){redrawSprites(),refreshPreview()}function generateInput(e,r,t,a,s,i,o,n){var l,p=$("<div>",{"class":"proprow",id:e.attr("id")+"_"+(e.children().length+1)});return p.append($("<span>",{"class":"proplabel"}).append(r)),l=$("<input>",{"class":"jspinner",id:n}).val(t),p.append($("<div>",{"class":"editbox"}).append(l)),l.spinner({stop:function(){a(Number(this.value))},max:s,min:i,step:o}),p.append($("<div>",{style:"clear:both;"})),e.append(p),p}function generateGradientPicker(e,r,t,a){var s,o,n,l=$("<div>",{"class":"proprow",id:e.attr("id")+"_"+(e.children().length+1)});for(l.append($("<span>",{"class":"proplabel"}).append(r)),s=$("<div>",{"class":"gradpicker"}),l.append($("<div>",{"class":"editbox"}).append(s)),l.append($("<div>",{style:"clear:both;"})),e.append(l),o=[],x=0;x<t.length;x+=2)n={},n.position=t[x],n.color=getHTMLcolor(t[x+1]),o.push(n);return s.gradientPicker({change:function(e){var r=[];for(i=0;i<e.length;++i)r.push(e[i].position),r.push(getBytecolor(e[i].color));a(r)},generateStyles:"false",controlPoints:o}),l}function generateTitle(e,r,t,a){var s,i=$("<div>",{"class":"proprow"});return i.append($("<span>",{"class":"proplabel"}).append(r).css("font-size","18px").css("font-weight","bold")).css("background-color","#FAFAFA").css("height","30px"),t&&(s=$("<a>",{style:"cursor:pointer;margin:0;background-image:url(/legacy/img/dice.png);width:30px;height:30px;background-repeat:no-repeat;background-position:center;float:right;",title:"regenerate"}).on("click",function(){randomizeBG(a)}),i.append(s),i.append($("<div>",{style:"clear:both;"}))),e.append(i),i}function generateFileUpload(e,r,t,a){var s,i,o=$("<div>",{"class":"proprow",id:e.attr("id")+"_"+(e.children().length+1)});return o.append($("<span>",{"class":"proplabel"}).append(r)),s=$("<input>",{type:"file",style:"height:0px;width:0px;overflow:hidden;"}).change(function(){fileupload(this,t,a)}),i=$("<a>").append("Select").on("click",function(){s.trigger("click")}),o.append(s),o.append($("<div>",{"class":"editbox"}).append(i)),i.button(),o.append($("<div>",{style:"clear:both;"})),e.append(o),o}function generateDualInput(e,r,t,a,s,i,o,n,l,p,d,g,c,h){var u,f,y=$("<div>",{"class":"proprow",id:e.attr("id")+"_"+(e.children().length+1)});return y.append($("<span>",{"class":"proplabel"}).append(r)),u=$("<input>",{"class":"jspinner",id:g}).val(s),f=$("<input>",{"class":"jspinner",id:c}).val(o),h&&(y.append($("<a>",{"class":"positionButton pointerButton",title:"position with cursor"}).click(function(){null!==draggingObject&&(draggingObject=null),$("#c_backgrounder").css("cursor","crosshair"),positioningCrosshair=!0,positioningFunction=function(e,r){u.val(e),f.val(r),i(e),n(r),positioningCrosshair=!1,$("#c_backgrounder").css("cursor","default")}})),y.append($("<a>",{"class":"positionButton centerButton",title:"move to center"}).click(function(){null!==draggingObject&&(draggingObject=null),positioningCrosshair=!1,u.val(Math.floor(.5*fullImgWidth)),f.val(Math.floor(.5*fullImgHeight)),i(Math.floor(.5*fullImgWidth)),n(Math.floor(.5*fullImgHeight))}))),y.append($("<div>",{"class":"editbox",style:"color:#3D3D3D;"}).append(t+" ").append(u)),y.append($("<div>",{style:"clear:both; margin-bottom:3px;"})),y.append($("<div>",{"class":"editbox",style:"color:#3D3D3D;"}).append(a+" ").append(f)),u.spinner({stop:function(){i(Number(this.value))},max:l,min:p,step:d}),f.spinner({stop:function(){n(Number(this.value))},max:l,min:p,step:d}),y.append($("<div>",{style:"clear:both;"})),e.append(y),y}function generateDropdown(e,r,t,a,s){var i,o=$("<div>",{"class":"proprow",id:e.attr("id")+"_"+(e.children().length+1)});for(o.append($("<span>",{"class":"proplabel"}).append(r)),i=$("<select>",{style:"margin-right:0;"}).val(t).change(function(){a(parseInt(this.value))}),points=s.split(";"),x=0;x<points.length;++x)i.append($("<option>",{value:x+1}).append(points[x]));return i.val(t),o.append($("<div>",{"class":"editbox"}).append(i)),o.append($("<div>",{style:"clear:both;"})),e.append(o),o}function generateRegenerate(e,r){var t=$("<div>",{"class":"proprow"}),a=$("<a>",{"class":"icontile",style:"cursor:pointer;margin:0;width:240px;background-image:url(/legacy/img/regenerate.png);padding-right:10px;background-repeat:no-repeat;background-position:left 80px center;padding-left:40px;"}).append("Regenerate").on("click",function(){randomizeBG(BGlayers[r])});return t.append(a),a.button(),e.append(t),t}function generateImagePicker(e,r,t){var a=$("<div>",{"class":"proprow",id:e.attr("id")+"_"+(e.children().length+1)});return a.append(presetImgSelector.show()),e.append(a),r&&$('img[data-original="'+r.src.substring(r.src.lastIndexOf("/")+1)+'"]').parent().addClass("pselected").siblings().removeClass("pselected"),$("li.presetimgs").unbind("click").click(function(){$(this).addClass("pselected").siblings().removeClass("pselected"),$.each($(".pselected"),function(e,r){t($($(r).children()[0]).attr("data-original"))})}),a}function generateFontPicker(e,r,t){var a=$("<div>",{"class":"proprow",id:e.attr("id")+"_"+(e.children().length+1)});return a.append(fontSelector.show()),e.append(a),$('span[font="'+r+'"]').parent().addClass("fselected").siblings().removeClass("fselected"),$("li.presetfonts").unbind("click").click(function(){$(this).addClass("fselected").siblings().removeClass("fselected"),$.each($(".fselected"),function(e,r){t($($(r).children()[0]).attr("font"))})}),a}function generateTextInput(e,r,t){var a=$("<div>",{"class":"proprow",id:e.attr("id")+"_"+(e.children().length+1)}),s=$("<input>",{style:"border: 1px solid #aaaaaa;padding: 5px;width: 280px;display:block;width:95%;margin:auto;"}).val(r).on("change",function(){t(this.value)});return a.append(s),e.append(a),a}function generateColorPicker(e,r,t,a,s,i){var o,n=$("<div>",{"class":"proprow",id:e.attr("id")+"_"+(e.children().length+1)});return n.append($("<span>",{"class":"proplabel"}).append(r)),o=$("<div>",{style:"display: inline-block;"}),n.append($("<div>",{"class":"editbox"}).append(o)),o.colorpicker({parts:"popup",showOn:"button",buttonColorize:!0,close:function(){i()},colorFormat:"RGBA",buttonImage:"/legacy/img/select2.png",buttonColorize:!0,buttonImageOnly:!0,color:"rgba(0, 0, 0, 1)",alpha:a,select:function(e,r){s(getBytecolor(r.formatted))}}),n.append($("<div>",{style:"clear:both;"})),e.append(n),o.colorpicker("setColor",getHTMLcolor(t)),n}function generateSpacer(e){var r=$("<div>",{"class":"proprow",style:"background-color: #FAFAFA; padding-top:10px;"});return e.append(r),r}function switchBG(e){$("#bg"+(e+1)+"_page1, #bg"+(e+1)+"_page2, #bg"+(e+1)+"_page3").hide();var r="#bg"+(e+1)+"properties",t=$(r);switch(presetImgSelector.detach(),fontSelector.detach(),t.children().remove(),BGlayers[e].type){case 0:$("#bg"+(e+1)+"_page1").show();break;case 1:$("#bg"+(e+1)+"_page3").show(),generateTitle(t,"Upload a Background Image"),generateFileUpload(t,"File",BGlayers[e],function(){redrawBGnum(e)}),generateDropdown(t,"Image style",BGlayers[e].imageProps[4],function(t){switch(BGlayers[e].imageProps[4]=t,redrawBGnum(e),t){case 3:$(r+"_4").show("blind",500),$(r+"_5").show("blind",500);break;default:$(r+"_4").hide("blind",500),$(r+"_5").hide("blind",500)}},"tile;fill;custom"),generateDualInput(t,"Position","X:","Y:",BGlayers[e].imageProps[0],function(r){BGlayers[e].imageProps[0]=r,redrawBGnum(e)},BGlayers[e].imageProps[1],function(r){BGlayers[e].imageProps[1]=r,redrawBGnum(e)},2500,-2500,1,null,null,!0).toggle(3==BGlayers[e].imageProps[4]),generateDualInput(t,"Scale","X:","Y:",BGlayers[e].imageProps[2],function(r){BGlayers[e].imageProps[2]=r,redrawBGnum(e)},BGlayers[e].imageProps[3],function(r){BGlayers[e].imageProps[3]=r,redrawBGnum(e)},250,0,1).toggle(3==BGlayers[e].imageProps[4]),-generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1);break;case 2:$("#bg"+(e+1)+"_page3").show(),generateTitle(t,"Use a Preset Background Image"),generateDropdown(t,"Image style",BGlayers[e].imageProps[4],function(t){switch(BGlayers[e].imageProps[4]=t,redrawBGnum(e),t){case 3:$(r+"_3").show("blind",500),$(r+"_4").show("blind",500);break;default:$(r+"_3").hide("blind",500),$(r+"_4").hide("blind",500)}},"tile;fill;custom"),generateDualInput(t,"Position","X:","Y:",BGlayers[e].imageProps[0],function(r){BGlayers[e].imageProps[0]=r,redrawBGnum(e)},BGlayers[e].imageProps[1],function(r){BGlayers[e].imageProps[1]=r,redrawBGnum(e)},2500,-2500,1,null,null,!0).toggle(3==BGlayers[e].imageProps[4]),generateDualInput(t,"Scale","X:","Y:",BGlayers[e].imageProps[2],function(r){BGlayers[e].imageProps[2]=r,redrawBGnum(e)},BGlayers[e].imageProps[3],function(r){BGlayers[e].imageProps[3]=r,redrawBGnum(e)},250,0,1).toggle(3==BGlayers[e].imageProps[4]),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1),generateImagePicker(t,BGlayers[e].image,function(r){BGlayers[e].image=new Image,BGlayers[e].image.onload=function(){redrawBGnum(e)},BGlayers[e].image.src="/legacy/bg/preset_bg/"+r});break;case 3:switch(0==BGlayers[e].generator?$("#bg"+(e+1)+"_page2").show():$("#bg"+(e+1)+"_page3").show(),BGlayers[e].generator){case 1:generateTitle(t,"Gradient"),generateDropdown(t,"Gradient type",BGlayers[e].gradientProps[2],function(t){switch(BGlayers[e].gradientProps[2]=t,redrawBGnum(e),t){case 1:$(r+"_4").hide("blind",500),$(r+"_5").show("blind",500);break;case 2:$(r+"_4").show("blind",500),$(r+"_5").hide("blind",500)}},"linear;radial"),generateGradientPicker(t,"Color",BGlayers[e].gradientColor,function(r){BGlayers[e].gradientColor=r,redrawBGnum(e)}),generateDualInput(t,"Position","X:","Y:",BGlayers[e].gradientProps[0],function(r){BGlayers[e].gradientProps[0]=r,redrawBGnum(e)},BGlayers[e].gradientProps[1],function(r){BGlayers[e].gradientProps[1]=r,redrawBGnum(e)},2500,-2500,1,null,null,!0).toggle(2==BGlayers[e].gradientProps[2]),generateInput(t,"Gradient angle",BGlayers[e].gradientProps[3],function(r){BGlayers[e].gradientProps[3]=r,redrawBGnum(e)},360,0,1).toggle(1==BGlayers[e].gradientProps[2]),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1);break;case 2:generateTitle(t,"Sunburst"),generateGradientPicker(t,"Color 1",BGlayers[e].sunburstColor1,function(r){BGlayers[e].sunburstColor1=r,redrawBGnum(e)}),generateGradientPicker(t,"Color 2",BGlayers[e].sunburstColor2,function(r){BGlayers[e].sunburstColor2=r,redrawBGnum(e)}),generateDualInput(t,"Position","X:","Y:",BGlayers[e].sunburstProps[0],function(r){BGlayers[e].sunburstProps[0]=r,redrawBGnum(e)},BGlayers[e].sunburstProps[1],function(r){BGlayers[e].sunburstProps[1]=r,redrawBGnum(e)},2500,-2500,1,null,null,!0),generateInput(t,"Radiations",BGlayers[e].sunburstProps[2],function(r){BGlayers[e].sunburstProps[2]=r,redrawBGnum(e)},180,2,2),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1);break;case 3:generateTitle(t,"Lines",!0,BGlayers[e]),generateDropdown(t,"Color mode",BGlayers[e].linesProps[7],function(t){switch(BGlayers[e].linesProps[7]=t,redrawBGnum(e),t){case 1:$(r+"_3").show("blind",500),$(r+"_4").show("blind",500);break;case 2:$(r+"_3").show("blind",500),$(r+"_4").hide("blind",500);break;case 3:$(r+"_3").hide("blind",500),$(r+"_4").hide("blind",500)}},"linear gradient;color palette;random"),generateGradientPicker(t,"Color",BGlayers[e].linesColor,function(r){BGlayers[e].linesColor=r,redrawBGnum(e)}).toggle(3!=BGlayers[e].linesProps[7]),generateInput(t,"Gradient angle",BGlayers[e].linesProps[1],function(r){BGlayers[e].linesProps[1]=r,redrawBGnum(e)},360,0,1).toggle(1==BGlayers[e].linesProps[7]),generateSpacer(t),generateInput(t,"Separation",BGlayers[e].linesProps[0],function(r){BGlayers[e].linesProps[0]=r,redrawBGnum(e)},500,0,1),generateInput(t,"Line thickness",BGlayers[e].linesProps[2],function(r){BGlayers[e].linesProps[2]=r,redrawBGnum(e)},500,0,1),generateInput(t,"Jagged segments",BGlayers[e].linesProps[3],function(r){BGlayers[e].linesProps[3]=r,redrawBGnum(e)},500,1,1),generateInput(t,"Jagged height",BGlayers[e].linesProps[4],function(r){BGlayers[e].linesProps[4]=r,redrawBGnum(e)},1e3,0,1),generateDropdown(t,"Edge style",BGlayers[e].linesProps[5],function(r){BGlayers[e].linesProps[5]=r,redrawBGnum(e)},"miter;round;bevel"),generateInput(t,"Rotation",BGlayers[e].linesProps[6],function(r){BGlayers[e].linesProps[6]=r,redrawBGnum(e)},360,0,1),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1);break;case 4:generateTitle(t,"Checkers",!0,BGlayers[e]),generateDropdown(t,"Color mode",BGlayers[e].checkersProps[2],function(t){switch(BGlayers[e].checkersProps[2]=t,redrawBGnum(e),t){case 1:case 3:case 5:$(r+"_3").show("blind",500),$(r+"_4").show("blind",500),$(r+"_5").hide("blind",500);break;case 2:case 4:case 6:$(r+"_3").show("blind",500),$(r+"_4").hide("blind",500),$(r+"_5").show("blind",500);break;case 7:$(r+"_3").show("blind",500),$(r+"_4").hide("blind",500),$(r+"_5").hide("blind",500);break;case 8:$(r+"_3").hide("blind",500),$(r+"_4").hide("blind",500),$(r+"_5").hide("blind",500)}},"linear gradient;radial gradient;linear lock to box;radial lock to box;linear per box;radial per box;color palette;random"),generateGradientPicker(t,"Color",BGlayers[e].checkersColor,function(r){BGlayers[e].checkersColor=r,redrawBGnum(e)}).toggle(8!=BGlayers[e].checkersProps[2]),generateInput(t,"Gradient angle",BGlayers[e].checkersProps[3],function(r){BGlayers[e].checkersProps[3]=r,redrawBGnum(e)},360,0,1).toggle(1==BGlayers[e].checkersProps[2]||3==BGlayers[e].checkersProps[2]||5==BGlayers[e].checkersProps[2]),generateDualInput(t,"Gradient position","X:","Y:",BGlayers[e].checkersProps[0],function(r){BGlayers[e].checkersProps[0]=r,redrawBGnum(e)},BGlayers[e].checkersProps[1],function(r){BGlayers[e].checkersProps[1]=r,redrawBGnum(e)},2500,-2500,1,null,null,!0).toggle(2==BGlayers[e].checkersProps[2]||4==BGlayers[e].checkersProps[2]||6==BGlayers[e].checkersProps[2]),generateSpacer(t),generateInput(t,"Box count",BGlayers[e].checkersProps[4],function(r){BGlayers[e].checkersProps[4]=r,redrawBGnum(e)},150,1,1),generateInput(t,"Box padding",BGlayers[e].checkersProps[5],function(r){BGlayers[e].checkersProps[5]=r,redrawBGnum(e)},750,0,1),generateDropdown(t,"Checkered",BGlayers[e].checkersProps[6]+1,function(r){BGlayers[e].checkersProps[6]=r-1,redrawBGnum(e)},"off;on"),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1);break;case 5:generateTitle(t,"Scribble",!0,BGlayers[e]),generateDropdown(t,"Color mode",BGlayers[e].scribbleProps[0],function(t){switch(BGlayers[e].scribbleProps[0]=t,redrawBGnum(e),t){case 1:$(r+"_3").hide("blind",500),$(r+"_4").hide("blind",500);break;case 2:$(r+"_3").show("blind",500),$(r+"_4").hide("blind",500);break;case 3:$(r+"_3").show("blind",500),$(r+"_4").show("blind",500)}},"random;color palette;linear gradient"),generateGradientPicker(t,"Color",BGlayers[e].scribbleColor,function(r){BGlayers[e].scribbleColor=r,redrawBGnum(e)}).toggle(2==BGlayers[e].scribbleProps[0]||3==BGlayers[e].scribbleProps[0]),generateInput(t,"Gradient angle",BGlayers[e].scribbleProps[1],function(r){BGlayers[e].scribbleProps[1]=r,redrawBGnum(e)},360,0,1).toggle(3==BGlayers[e].scribbleProps[0]),generateSpacer(t),generateInput(t,"Point count",BGlayers[e].scribbleProps[2],function(r){BGlayers[e].scribbleProps[2]=r,redrawBGnum(e)},1e3,1,1),generateInput(t,"Line thickness",BGlayers[e].scribbleProps[3],function(r){BGlayers[e].scribbleProps[3]=r,redrawBGnum(e)},1e3,1,1),generateInput(t,"Scribble clones",BGlayers[e].scribbleProps[4],function(r){BGlayers[e].scribbleProps[4]=r,redrawBGnum(e)},1e3,1,1),generateInput(t,"Glow amount",BGlayers[e].scribbleProps[5],function(r){BGlayers[e].scribbleProps[5]=r,redrawBGnum(e)},1e3,0,1),generateInput(t,"Clone scattering",BGlayers[e].scribbleProps[6],function(r){BGlayers[e].scribbleProps[6]=r,redrawBGnum(e)},100,0,1),generateDropdown(t,"Edge style",BGlayers[e].scribbleProps[7],function(r){BGlayers[e].scribbleProps[7]=r,redrawBGnum(e)},"miter;round;bevel"),generateDropdown(t,"Random opacity",BGlayers[e].scribbleProps[8]+1,function(r){BGlayers[e].scribbleProps[8]=r-1,redrawBGnum(e)},"off;on"),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1);break;case 6:generateTitle(t,"Waves",!0,BGlayers[e]),generateGradientPicker(t,"Color",BGlayers[e].wavesColor,function(r){BGlayers[e].wavesColor=r,redrawBGnum(e)}),generateDropdown(t,"Color mode",BGlayers[e].wavesProps[0],function(r){BGlayers[e].wavesProps[0]=r,redrawBGnum(e)},"random;color palette;linear gradient"),generateDropdown(t,"Phase shift",BGlayers[e].wavesProps[1],function(r){BGlayers[e].wavesProps[1]=r,redrawBGnum(e)},"zero;alternate;random"),generateDualInput(t,"Amplitude","Min:","Max:",BGlayers[e].wavesProps[2],function(r){BGlayers[e].wavesProps[2]=r,redrawBGnum(e)},BGlayers[e].wavesProps[3],function(r){BGlayers[e].wavesProps[3]=r,redrawBGnum(e)},2500,0,1),generateDualInput(t,"Periods","Min:","Max:",BGlayers[e].wavesProps[4],function(r){BGlayers[e].wavesProps[4]=r,redrawBGnum(e)},BGlayers[e].wavesProps[5],function(r){BGlayers[e].wavesProps[5]=r,redrawBGnum(e)},50,1,1),generateInput(t,"Rows",BGlayers[e].wavesProps[1],function(r){BGlayers[e].wavesProps[6]=r,redrawBGnum(e)},25,1,1),generateInput(t,"Stop height",BGlayers[e].wavesProps[2],function(r){BGlayers[e].wavesProps[7]=r,redrawBGnum(e)},2e3,0,1),generateSpacer(t),generateDropdown(t,"Show border",BGlayers[e].wavesProps[13]+1,function(r){BGlayers[e].wavesProps[13]=r-1,redrawBGnum(e)},"off;on"),generateColorPicker(t,"Color",BGlayers[e].wavesBorderColor,!0,function(r){BGlayers[e].wavesBorderColor=r},function(){redrawBGnum(e)}),generateInput(t,"Thickness",BGlayers[e].wavesProps[8],function(r){BGlayers[e].wavesProps[8]=r,redrawBGnum(e)},500,1,1),generateSpacer(t),generateDropdown(t,"Show shadow",BGlayers[e].wavesProps[12]+1,function(r){BGlayers[e].wavesProps[12]=r-1,redrawBGnum(e)},"off;on"),generateColorPicker(t,"Color",BGlayers[e].wavesShadowColor,!0,function(r){BGlayers[e].wavesShadowColor=r},function(){redrawBGnum(e)}),generateInput(t,"Blur",BGlayers[e].wavesProps[9],function(r){BGlayers[e].wavesProps[9]=r,redrawBGnum(e)},500,0,1),generateDualInput(t,"Offset","X:","Y:",BGlayers[e].wavesProps[10],function(r){BGlayers[e].wavesProps[10]=r,redrawBGnum(e)},BGlayers[e].wavesProps[11],function(r){BGlayers[e].wavesProps[11]=r,redrawBGnum(e)},2500,-2500,1);break;case 7:generateTitle(t,"Text Curtain",!0,BGlayers[e]),generateTextInput(t,BGlayers[e].drapesText,function(r){BGlayers[e].drapesText=r,redrawBGnum(e)}),generateFontPicker(t,BGlayers[e].drapesFont,function(r){BGlayers[e].drapesFont=r,redrawBGnum(e)}),generateSpacer(t),generateGradientPicker(t,"Color",BGlayers[e].drapesColor,function(r){BGlayers[e].drapesColor=r,redrawBGnum(e)}),generateRegenerate(t,e),generateDropdown(t,"Position mode",BGlayers[e].drapesProps[7]+1,function(r){BGlayers[e].drapesProps[7]=r-1,redrawBGnum(e)},"top;left;right;top reverse;left angle;right angle;top vertical"),generateDropdown(t,"Color mode",BGlayers[e].drapesProps[0],function(r){BGlayers[e].drapesProps[0]=r,redrawBGnum(e)},"random;color palette;linear gradient"),generateInput(t,"Gradient angle",BGlayers[e].drapesProps[10],function(r){BGlayers[e].drapesProps[10]=r,redrawBGnum(e)},360,0,1),generateInput(t,"Text count",BGlayers[e].drapesProps[9],function(r){BGlayers[e].drapesProps[9]=r,redrawBGnum(e)},1e3,1,1),generateDualInput(t,"Size","Min:","Max:",BGlayers[e].drapesProps[1],function(r){BGlayers[e].drapesProps[1]=r,redrawBGnum(e)},BGlayers[e].drapesProps[2],function(r){BGlayers[e].drapesProps[2]=r,redrawBGnum(e)},2500,1,1),generateDualInput(t,"Position X","Min:","Max:",BGlayers[e].drapesProps[3],function(r){BGlayers[e].drapesProps[3]=r,redrawBGnum(e)},BGlayers[e].drapesProps[4],function(r){BGlayers[e].drapesProps[4]=r,redrawBGnum(e)},2500,0,1),generateDualInput(t,"Position Y","Min:","Max:",BGlayers[e].drapesProps[5],function(r){BGlayers[e].drapesProps[5]=r,redrawBGnum(e)},BGlayers[e].drapesProps[6],function(r){BGlayers[e].drapesProps[6]=r,redrawBGnum(e)},2500,0,1),generateInput(t,"Glow amount",BGlayers[e].drapesProps[8],function(r){BGlayers[e].drapesProps[8]=r,redrawBGnum(e)},1e3,0,1),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1);break;case 8:generateTitle(t,"Lightning",!0,BGlayers[e]),generateColorPicker(t,"Light color",BGlayers[e].lightningLightColor,!0,function(r){BGlayers[e].lightningLightColor=r},function(){redrawBGnum(e)}),generateColorPicker(t,"Glow color",BGlayers[e].lightningGlowColor,!0,function(r){BGlayers[e].lightningGlowColor=r},function(){redrawBGnum(e)}),generateSpacer(t),generateDropdown(t,"Travel mode",BGlayers[e].lightningProps[0],function(t){switch(BGlayers[e].lightningProps[0]=t,redrawBGnum(e),t){case 1:$(r+"_6").show("blind",500),$(r+"_7").hide("blind",500);break;case 2:$(r+"_6").show("blind",500),$(r+"_7").show("blind",500);break;case 3:case 4:$(r+"_6").hide("blind",500),$(r+"_7").hide("blind",500)}},"point A source;point A to point B;horizontal;vertical"),generateDualInput(t,"Point A","X:","Y:",BGlayers[e].lightningProps[1],function(r){BGlayers[e].lightningProps[1]=r,redrawBGnum(e)},BGlayers[e].lightningProps[2],function(r){BGlayers[e].lightningProps[2]=r,redrawBGnum(e)},2500,0,1,null,null,!0).toggle(1==BGlayers[e].lightningProps[0]||2==BGlayers[e].lightningProps[0]),generateDualInput(t,"Point B","X:","Y:",BGlayers[e].lightningProps[3],function(r){BGlayers[e].lightningProps[3]=r,redrawBGnum(e)},BGlayers[e].lightningProps[4],function(r){BGlayers[e].lightningProps[4]=r,redrawBGnum(e)},2500,0,1,null,null,!0).toggle(2==BGlayers[e].lightningProps[0]),generateSpacer(t),generateDualInput(t,"Size","Min:","Max:",BGlayers[e].lightningProps[5],function(r){BGlayers[e].lightningProps[5]=r,redrawBGnum(e)},BGlayers[e].lightningProps[6],function(r){BGlayers[e].lightningProps[6]=r,redrawBGnum(e)},2500,0,1),generateInput(t,"Beam count",BGlayers[e].lightningProps[7],function(r){BGlayers[e].lightningProps[7]=r,redrawBGnum(e)},200,1,1),generateInput(t,"Displacement",BGlayers[e].lightningProps[8],function(r){BGlayers[e].lightningProps[8]=r,redrawBGnum(e)},1e3,1,1),generateInput(t,"Glow blur",BGlayers[e].lightningProps[9],function(r){BGlayers[e].lightningProps[9]=r,redrawBGnum(e)},1e3,0,1),generateInput(t,"Intensity",BGlayers[e].lightningProps[10],function(r){BGlayers[e].lightningProps[10]=r,redrawBGnum(e)},10,1,1),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1);break;case 10:generateTitle(t,"Noise",!0,BGlayers[e]),generateColorPicker(t,"Background color",BGlayers[e].noiseColor,!0,function(r){BGlayers[e].noiseColor=r},function(){redrawBGnum(e)}),generateInput(t,"Noise opacity",BGlayers[e].noiseProps[0],function(r){BGlayers[e].noiseProps[0]=r,redrawBGnum(e)},1,0,.05),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1);break;case 11:generateTitle(t,"Clouds",!0,BGlayers[e]),generateGradientPicker(t,"Color",BGlayers[e].perlinNoiseColor,function(r){BGlayers[e].perlinNoiseColor=r,redrawBGnum(e)}),generateInput(t,"Layer opacity",BGlayers[e].opacity,function(r){BGlayers[e].opacity=r,redrawBGnum(e)},1,0,.1)}}}function getBase64Image(e){var r,t,a;return e?(r=document.createElement("canvas"),r.width=e.width,r.height=e.height,t=r.getContext("2d"),t.drawImage(e,0,0),a=r.toDataURL("image/png"),a.replace(/^data:image\/(png|jpg);base64,/,"")):null}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r="[\\?&]"+e+"=([^&#]*)",t=new RegExp(r),a=t.exec(window.location.search);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))}function ptInBox(e,r,t,a,s,i,o){var n=.5*s,l=.5*i,p=Math.cos(o/180*Math.PI),d=Math.sin(o/180*Math.PI),g={x:t+(-n*p+l*d),y:a+(n*d+l*p)},c={x:t+(n*p+l*d),y:a+(-n*d+l*p)},h={x:t+(-n*p-l*d),y:a+(n*d-l*p)},u={x:t+(n*p-l*d),y:a+(-n*d-l*p)};if(90==o)return e>=h.x&&e<=g.x&&r<=h.y&&r>=u.y?!0:!1;if(270==o)return e>=g.x&&e<=h.x&&r<=u.y&&r>=h.y?!0:!1;var f=u.x-h.x,y=u.y-h.y,w=u.x-c.x,b=u.y-c.y,m=Math.pow(f,2)+Math.pow(y,2),P=Math.pow(w,2)+Math.pow(b,2),B=f*(e*f+r*y)/m;return B>Math.min(f*(u.x*f+u.y*y)/m,f*(h.x*f+h.y*y)/m,f*(c.x*f+c.y*y)/m,f*(g.x*f+g.y*y)/m)&&B<Math.max(f*(u.x*f+u.y*y)/m,f*(h.x*f+h.y*y)/m,f*(c.x*f+c.y*y)/m,f*(g.x*f+g.y*y)/m)&&(B=b*(e*w+r*b)/P,B>Math.min(b*(u.x*w+u.y*b)/P,b*(h.x*w+h.y*b)/P,b*(c.x*w+c.y*b)/P,b*(g.x*w+g.y*b)/P)&&B<Math.max(b*(u.x*w+u.y*b)/P,b*(h.x*w+h.y*b)/P,b*(c.x*w+c.y*b)/P,b*(g.x*w+g.y*b)/P))?!0:void 0}function loadCode(e){var r,t,a,i,o,n=e?e:presetTemplate,l=JSON.parse(n);for($.extend(!0,layerOverlay,l.overlay),$.extend(!0,layerPreview,l.preview),r=[],layerSprites.sprites=[],$("#spriteList").empty(),t=l.sprites,s=0;s<t.length;s++)layerSprites.sprites.push(t[s]),a=layerSprites.sprites[s].font,a&&"Arial"!=a&&"Impact"!=a&&"Verdana"!=a&&"Consolas"!=a&&r.push(a),layerSprites.sprites[s].image&&(o=layerSprites.sprites[s].image,layerSprites.sprites[s].image=new Image,layerSprites.sprites[s].image.onload=function(){redrawSprites(),refreshPreview()},layerSprites.sprites[s].image.src="data:image/png;base64,"+o),$("#spriteList").append('<li id="sprite_'+(layerSprites.sprites.length-1)+'">Sprite '+layerSprites.sprites.length+'<img title="delete" class="delimg" src="/legacy/img/delete.png" onclick="deleteSprite(this);" /><img title="duplicate" class="delimg" src="/legacy/img/duplicate.png" onclick="duplicateSprite(this);" /></li>'),$("#sprite_"+(layerSprites.sprites.length-1)).click(function(){$(this).toggleClass("sselected").siblings().removeClass("sselected"),setselSprite()});for(i=l.bg,b=0;b<i.length;b++)$.extend(!0,BGlayers[b],i[b]),BGlayers[b].image&&(o=BGlayers[b].image,BGlayers[b].image=new Image,BGlayers[b].image.onload=function(){redrawBG(BGlayers[b]),refreshPreview()},BGlayers[b].image.src="data:image/png;base64,"+o);if(0!=r.length)for(waitForWebfonts(r,function(){redrawBG(BGlayers[0]),redrawBG(BGlayers[1]),redrawOverlay(),redrawSprites(),redrawPreview(),refreshPreview()}),f=0;f<r.length;f++)$.autoLoadWebFont(null,"/legacy/bg/preset_fonts/",r[f]);else redrawBG(BGlayers[0]),redrawBG(BGlayers[1]),redrawOverlay(),redrawSprites(),redrawPreview(),refreshPreview()}function generateCode(){var e,r,t,a,i,o=$.extend({},layerOverlay);for(delete o.buffer,delete o.fadebuffer,e=$.extend({},layerPreview),delete e.watermark,r=[],s=0;s<layerSprites.sprites.length;s++)r.push($.extend({},layerSprites.sprites[s])),layerSprites.sprites[s]?r[s].image=getBase64Image(layerSprites.sprites[s].image):delete r[s].image;for(t=[],b=0;b<BGlayers.length;b++)t.push($.extend({},BGlayers[b])),t[b]?t[b].image=getBase64Image(t[b].image):delete t[b].image,delete t[b].buffer;return a={overlay:o,sprites:r,preview:e,bg:t},i=JSON.stringify(a)}function finishRender(){$("#mask").hide(),$("#renderdialog").hide(),renderCancel=!1,downloadBlob=null,dlCanv=null}function dlRender(){var e,r,t,a=ratio;for(ratio=1,e=document.createElement("canvas"),e.width=fullImgWidth,e.height=fullImgHeight,r=e.getContext("2d"),debuglog+="render_clear* ("+fullImgWidth+", "+fullImgHeight+") | ",r.clearRect(0,0,fullImgWidth,fullImgHeight),bgl=0;bgl<BGlayers.length;++bgl){debuglog+="render_bg"+bgl+" | ";try{r.save(),debuglog+="render_bg"+bgl+"_saved | ",r.globalAlpha=BGlayers[bgl].opacity,debuglog+="render_bg"+bgl+"_opacity | ",t=renderToBuffer(fullImgWidth,fullImgHeight,renderBG,BGlayers[bgl]),debuglog+="render_bg"+bgl+"_rendered | ",r.drawImage(t,0,0,fullImgWidth,fullImgHeight),debuglog+="render_bg"+bgl+"_drawn | ",r.restore(),debuglog+="render_bg"+bgl+"_restored | "}catch(s){debuglog+="render_bg"+bgl+"_err: "+s.message+" | "}}debuglog+="render_overlay | ";try{t=renderToBuffer(fullImgWidth,fullImgHeight,renderOverlay),debuglog+="render_overlay_rendered ("+t.width+", "+t.height+") | ",
r.drawImage(t,0,0,fullImgWidth,fullImgHeight)}catch(s){debuglog+="render_overlay_err: "+s.message+" | "}debuglog+="render_sprites | ";try{t=renderToBuffer(fullImgWidth,fullImgHeight,renderSprites),r.drawImage(t,0,0,fullImgWidth,fullImgHeight)}catch(s){debuglog+="render_sprites_err: "+s.message+" | "}debuglog+="render_fade | ";try{r.save(),r.globalCompositeOperation="destination-out",t=renderToBuffer(fullImgWidth,fullImgHeight,renderFade),r.drawImage(t,0,0,fullImgWidth,fullImgHeight),r.restore()}catch(s){debuglog+="render_fade_err: "+s.message+" | "}debuglog+="render_color | ";try{r.save(),r.globalCompositeOperation="destination-over",r.fillStyle=getHTMLcolor(layerPreview.bgcolor),r.fillRect(0,0,fullImgWidth,fullImgHeight),r.restore()}catch(s){debuglog+="render_color_err: "+s.message+" | "}return ratio=a,debuglog+="render_finished | ",e}function dlSaveBlob(e){var r,t,a,s,i,o,n,l,p;try{for(debuglog+="blob_download_begin | ",n=1.1,l="image/png",downloadBlob=null,a=null,debuglog+="canvas_image_render | ";(!a||a.length>2097152)&&n>.8;).9>=n&&"image/png"==l&&(n=1.1,l="image/jpeg"),n-=.1,debuglog+="try m: "+l+" q: "+n+" | ",r=e.toDataURL(l,n),t=r.indexOf(",")+1,a=window.atob(r.substring(t)),a.length%2&&(a+=String.fromCharCode(0)),debuglog+="result: "+a.length+"/2097152 | ";for(debuglog+="finished_canvas_render | ",s=new ArrayBuffer(a.length),i=new Uint8Array(s),o=0;o<a.length;o++)i[o]=a.charCodeAt(o);downloadBlob=new Blob([s],{type:"image/png"})}catch(d){debuglog+="blob_download_err: "+d.message+" | "}}function downloadBG(){debuglog="",debuglog+="user_agent: "+navigator.userAgent+" | ",debuglog+="start_download | ",$("#renderdialog").css("top",Math.max(0,($(window).height()-$("#renderdialog").outerHeight())/2+$(window).scrollTop())+"px").css("left",Math.max(0,($(window).width()-$("#renderdialog").outerWidth())/2+$(window).scrollLeft())+"px"),$("#renderprogress").progressbar("option","value",10),$("#rendertitle").text("Rendering background..."),$("#cancelrender").show(),$("#downloaddialog").hide(),$("#brokendialog").hide(),$("#closedialog").hide(),$("#mask").show(),$("#renderdialog").show(),debuglog+="ui_init_finished | ",window.setTimeout(function(){return dlCanv=dlRender(),$("#downloaddialog").unbind(),$("#brokendialog").unbind(),$("#renderprogress").progressbar("option","value",50),renderCancel?void finishRender():void window.setTimeout(function(){var e=window.webkitURL?window.webkitURL:window.URL;e&&window.atob?(debuglog+="file_bloburl_supported | ",dlSaveBlob(dlCanv),$("#brokendialog").click(function(){posttoURL("backgrounder3dl.aspx",dlCanv.toDataURL("image/png",1))}),$("#downloaddialog").click(function(){window.open("download.aspx?appid=1","_blank"),window.setTimeout(function(){$("#brokendialog").show()},2e3)})):(debuglog+="file/atob_legacy_fallback | ",$("#downloaddialog").click(function(){posttoURL("backgrounder3dl.aspx",dlCanv.toDataURL("image/png",1))})),$("#renderprogress").progressbar("option","value",100),$("#rendertitle").text("Finished."),$("#cancelrender").hide(),$("#downloaddialog").show(),$("#closedialog").show()},0)},0)}function downloadBGFile(){var e=window.webkitURL?webkitURL:URL;e?(downloadBlob=new Blob([generateCode()]),$("#renderdialog").css("top",Math.max(0,($(window).height()-$("#renderdialog").outerHeight())/2+$(window).scrollTop())+"px").css("left",Math.max(0,($(window).width()-$("#renderdialog").outerWidth())/2+$(window).scrollLeft())+"px"),$("#mask").show(),$("#renderdialog").show(),$("#renderprogress").progressbar("option","value",100),$("#rendertitle").text("Finished."),$("#cancelrender").hide(),$("#downloaddialog").unbind(),$("#downloaddialog").click(function(){window.open("download.aspx?appid=3","_blank")}),$("#downloaddialog").show(),$("#closedialog").show()):alert("Your browser doesn't support this feature. Please upgrade.")}function loadBGFile(){$fileinput.trigger("click")}function posttoURL(e,r){var t,a=document.createElement("form");a.setAttribute("method","post"),a.setAttribute("action",e),a.setAttribute("target","_blank"),t=document.createElement("input"),t.setAttribute("type","hidden"),t.setAttribute("name","bgimg"),t.setAttribute("value",r),a.appendChild(t),document.body.appendChild(a),a.submit(),document.body.removeChild(a)}function resizeViewport(){($("#c_backgrounder").parent().height()-178)*(previewImgWidth/previewImgHeight)>$("#c_backgrounder").parent().width()?(document.getElementById("c_backgrounder").width=$("#c_backgrounder").parent().width(),document.getElementById("c_backgrounder").height=document.getElementById("c_backgrounder").width*(previewImgHeight/previewImgWidth),$("#c_backgrounder").css("top",($("#c_backgrounder").parent().height()-178-$("#c_backgrounder").height())/2),$("#c_backgrounder").css("left","0")):(document.getElementById("c_backgrounder").height=$("#c_backgrounder").parent().height()-178,document.getElementById("c_backgrounder").width=document.getElementById("c_backgrounder").height*(previewImgWidth/previewImgHeight),$("#c_backgrounder").css("left",($("#c_backgrounder").parent().width()-$("#c_backgrounder").width())/2),$("#c_backgrounder").css("top","0")),ratio=$("#c_backgrounder").width()/previewImgWidth}function dragUpdate(){null!==draggingObject&&(dragChanged&&(redrawSelSprites(),dragChanged=!1),requestAnimationFrame(dragUpdate))}var fullImgWidth=1920,fullImgHeight=1440,canvas,previewImgWidth=1920,previewImgHeight=1520,previewOffsetX=0,previewOffsetY=25,presetImgSelector,fontSelector,draggingObject=null,dragOffsetX=0,dragOffsetY=0,dragChanged=!1,positioningCrosshair=!1,positioningFunction,ratio=0,$fileinput,selSprite=0,prevBlobUrl,downloadBlob,renderCancel,BGlayers=[],layerOverlay={buffer:null,fadebuffer:null,toggleshadow:!1,shadowcolor:getBytecolor("rgba(0, 0, 0, 1)"),shadowoffsetx:0,shadowoffsety:0,shadowblur:20,fadeheight:150,fadestop:1,fademode:1,channelblank:1,shadowcutoff:0},layerSprites={buffer:null,sprites:[]},layerPreview={watermark:null,preview:1,bgcolor:getBytecolor("rgba(0, 0, 0, 1)")},renderToBuffer,debuglog,dlCanv;window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),renderToBuffer=function(e,r,t,a){var s=document.createElement("canvas");return s.width=e*ratio,s.height=r*ratio,s.getContext("2d").scale(ratio,ratio),s.getContext("2d").clearRect(0,0,e,r),a?t(s.getContext("2d"),e,r,a):t(s.getContext("2d"),e,r),s},$(document).ready(function(){}),debuglog="",$(function(){$("#accordion").accordion({heightStyle:"fill",beforeActivate:function(e,r){"Layer 1"==r.newHeader[0].textContent?switchBG(0):"Layer 2"==r.newHeader[0].textContent?switchBG(1):"Text + Images"==r.newHeader[0].textContent&&setselSprite()},animate:80}),canvas=document.getElementById("c_backgrounder"),canvas.height=$(canvas).parent().height()-154,canvas.width=canvas.height*(previewImgWidth/previewImgHeight),$(canvas).css("left",($(canvas).parent().width()-$(canvas).width())/2),ratio=canvas.width/previewImgWidth,$(window).resize(function(){$("#accordion").accordion("refresh"),resizeViewport(),refreshPreview()}),$("#c_backgrounder").mousemove(function(e){if(!positioningCrosshair){var r=e.pageX-$("#c_backgrounder").offset().left-previewOffsetX*ratio,t=e.pageY-$("#c_backgrounder").offset().top-previewOffsetY*ratio;if(null===draggingObject){for(s=0;s<layerSprites.sprites.length;s++)if(ptInBox(r,t,layerSprites.sprites[s].posx*ratio,layerSprites.sprites[s].posy*ratio,layerSprites.sprites[s].width*ratio,layerSprites.sprites[s].height*ratio,layerSprites.sprites[s].rot))return void $("#c_backgrounder").css("cursor","move");$("#c_backgrounder").css("cursor","default")}else draggingObject.posx=Math.floor((r-dragOffsetX)/ratio),draggingObject.posy=Math.floor((t-dragOffsetY)/ratio),dragChanged=!0}}),$("#c_backgrounder").mousedown(function(e){if(positioningCrosshair)return void e.preventDefault();null!==draggingObject&&(draggingObject=null);var r=e.pageX-$("#c_backgrounder").offset().left-previewOffsetX*ratio,t=e.pageY-$("#c_backgrounder").offset().top-previewOffsetY*ratio;for(s=0;s<layerSprites.sprites.length;s++)if(ptInBox(r,t,layerSprites.sprites[s].posx*ratio,layerSprites.sprites[s].posy*ratio,layerSprites.sprites[s].width*ratio,layerSprites.sprites[s].height*ratio,layerSprites.sprites[s].rot))return draggingObject=layerSprites.sprites[s],$("#sprite_"+s).hasClass("sselected")||($.each($(".sselected"),function(){$(this).removeClass("sselected")}),$("#sprite_"+s).addClass("sselected"),setselSprite()),requestAnimationFrame(dragUpdate),$("#c_backgrounder").css("cursor","move"),dragOffsetX=r-draggingObject.posx*ratio,dragOffsetY=t-draggingObject.posy*ratio,void e.preventDefault();e.preventDefault()}),$("#c_backgrounder").mouseup(function(e){if(positioningCrosshair){var r=e.pageX-$("#c_backgrounder").offset().left-previewOffsetX*ratio,t=e.pageY-$("#c_backgrounder").offset().top-previewOffsetY*ratio;return void positioningFunction(Math.floor(r/ratio),Math.floor(t/ratio))}draggingObject===layerSprites.sprites[selSprite]&&($("#ssposx").val(draggingObject.posx),$("#ssposy").val(draggingObject.posy)),draggingObject=null}),$("#dlbutton, .icontile").button(),$("div.lazy").lazyload({container:$("#presetImageList")}),$("span.lazy").lazyload({container:$("#fontList")}),presetImgSelector=$("#presetImageList").detach(),fontSelector=$("#fontList").detach(),$("#spriteList").sortable({distance:15,stop:function(){sortSprites($("#spriteList").sortable("toArray"))}}),$("#cancelrender").button(),$("#closedialog").button(),$("#downloaddialog").button(),$("#renderprogress").progressbar(),$fileinput=$("<input>",{type:"file",style:"height:0px;width:0px;overflow:hidden;"}).change(function(){if(this.files&&this.files[0]){var e=new FileReader;e.onload=function(e){var r=e.target.result;loadCode(r)},e.readAsText(this.files[0])}}),$(document).append($fileinput);for(var e=2;e--;)BGlayers.push({randPts1:[],randPts2:[],buffer:null,type:0,generator:1,image:null,opacity:1,imageProps:[0,0,1,1,1],gradientColor:[0,generateRandomColor()],gradientProps:[0,0,1,0],sunburstColor1:[0,generateRandomColor()],sunburstColor2:[0,generateRandomColor()],sunburstProps:[0,0,20],linesColor:[0,generateRandomColor()],linesProps:[5,0,25,1,0,1,0,1],checkersColor:[0,generateRandomColor()],checkersProps:[0,0,1,0,10,0,1],scribbleColor:[0,generateRandomColor()],scribbleProps:[2,0,10,5,5,0,15,1,1],wavesColor:[0,generateRandomColor()],wavesBorderColor:generateRandomColor(),wavesShadowColor:generateRandomColor(),wavesProps:[1,2,50,150,1,1,5,0,5,10,0,0],drapesText:"backgrounder3",drapesFont:"Arial",drapesColor:[0,generateRandomColor()],drapesProps:[1,10,40,0,1920,0,1440,0,0,20,0],lightningLightColor:getBytecolor("rgba(255, 255, 255, 1)"),lightningGlowColor:generateRandomColor(),lightningProps:[1,0,0,500,500,1,5,10,500,20,1],perlinNoiseColor:[0,getBytecolor("rgba(174, 174, 174, 1)"),.3670212765957447,getBytecolor("rgba(255, 255, 255, 1)"),.4308510638297872,getBytecolor("rgba(77, 192, 214, 1)")],noiseColor:generateRandomColor(),noiseProps:[.1]});presetTemplate?loadCode():(redrawBG(BGlayers[0]),redrawBG(BGlayers[1]),redrawOverlay(),redrawSprites(),redrawPreview(),refreshPreview()),generateDropdown($("#basicsproperties"),"Type",layerPreview.preview,function(e){layerPreview.preview=e,redrawPreview()},"YouTube One;YouTube Channel Avatar;YouTube Thumbnail;Twitter;Facebook Cover Photo;Video Frame (1080p);Video Frame (720p)"),generateColorPicker($("#basicsproperties"),"Background color",layerPreview.bgcolor,!0,function(e){layerPreview.bgcolor=e},function(){refreshPreview()}),generateDropdown($("#overlaysproperties"),"Channel shadow",layerOverlay.toggleshadow+1,function(e){switch(layerOverlay.toggleshadow=e-1,redrawOverlay(),refreshPreview(),e){case 1:$("#overlaysproperties_2").hide("blind",500),$("#overlaysproperties_3").hide("blind",500),$("#overlaysproperties_4").hide("blind",500),$("#overlaysproperties_5").hide("blind",500),$("#overlaysproperties_6").hide("blind",500);break;case 2:$("#overlaysproperties_2").show("blind",500),$("#overlaysproperties_3").show("blind",500),$("#overlaysproperties_4").show("blind",500),$("#overlaysproperties_5").show("blind",500),$("#overlaysproperties_6").show("blind",500)}},"off;on"),generateColorPicker($("#overlaysproperties"),"Color",layerOverlay.shadowcolor,!0,function(e){layerOverlay.shadowcolor=e},function(){redrawOverlay(),refreshPreview()}).toggle(1==layerOverlay.toggleshadow),generateDualInput($("#overlaysproperties"),"Offset","X:","Y:",layerOverlay.shadowoffsetx,function(e){layerOverlay.shadowoffsetx=e,redrawOverlay(),refreshPreview()},layerOverlay.shadowoffsety,function(e){layerOverlay.shadowoffsety=e,redrawOverlay(),refreshPreview()},250,0,1).toggle(1==layerOverlay.toggleshadow),generateInput($("#overlaysproperties"),"Blur",layerOverlay.shadowblur,function(e){layerOverlay.shadowblur=e,redrawOverlay(),refreshPreview()},2e3,0,1).toggle(1==layerOverlay.toggleshadow),generateInput($("#overlaysproperties"),"Cutoff height",layerOverlay.shadowcutoff,function(e){layerOverlay.shadowcutoff=e,redrawOverlay(),refreshPreview()},2e3,0,1).toggle(1==layerOverlay.toggleshadow),generateDropdown($("#overlaysproperties"),"Blank behind channel",layerOverlay.channelblank+1,function(e){layerOverlay.channelblank=e-1,redrawOverlay(),refreshPreview()},"off;on").toggle(1==layerOverlay.toggleshadow),generateSpacer($("#overlaysproperties")),generateDropdown($("#overlaysproperties"),"Fade out",layerOverlay.fademode,function(e){switch(layerOverlay.fademode=e,redrawOverlay(),refreshPreview(),e){case 1:$("#overlaysproperties_9").hide("blind",500),$("#overlaysproperties_10").hide("blind",500);break;default:$("#overlaysproperties_9").show("blind",500),$("#overlaysproperties_10").show("blind",500)}},"none;bottom linear;radial from top;radial from center"),generateInput($("#overlaysproperties"),"Gradient stop",layerOverlay.fadestop,function(e){layerOverlay.fadestop=e,redrawOverlay(),refreshPreview()},1,0,.1).toggle(1!=layerOverlay.fademode),generateInput($("#overlaysproperties"),"Fade distance",layerOverlay.fadeheight,function(e){layerOverlay.fadeheight=e,redrawOverlay(),refreshPreview()},2e3,0,1).toggle(1!=layerOverlay.fademode)});