/* copyright 2017 panzoid */
"use strict";!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery")):e(jQuery)}(function(e,t){function r(t,r,a,n){for(var i=[],s=0;s<t.length;s++){var o=t[s];if(o){var l=tinycolor(o),p=l.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";p+=tinycolor.equals(r,o)?" sp-thumb-active":"";var c=l.toString(n.preferredFormat||"rgb"),u=g?"background-color:"+l.toRgbString():"filter:"+l.toFilter();i.push('<span title="'+c+'" data-color="'+l.toRgbString()+'" class="'+p+'"><span class="sp-thumb-inner" style="'+u+';" /></span>')}else{var d="sp-clear-display";i.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="'+d+'"></span>').attr("title",n.noColorSelectedText)).html())}}return"<div class='sp-cf "+a+"'>"+i.join("")+"</div>"}function a(){for(var e=0;e<f.length;e++)f[e]&&f[e].hide()}function n(t,r){var a=e.extend({},h,t);return a.callbacks={move:p(a.move,r),change:p(a.change,r),show:p(a.show,r),hide:p(a.hide,r),beforeShow:p(a.beforeShow,r)},a}function i(i,o){function p(){if(V.showPaletteOnly&&(V.showPalette=!0),$e.text(V.showPaletteOnly?V.togglePaletteMoreText:V.togglePaletteLessText),V.palette){he=V.palette.slice(0),fe=e.isArray(he[0])?he:[he],me={};for(var t=0;t<fe.length;t++)for(var r=0;r<fe[t].length;r++){var a=tinycolor(fe[t][r]).toRgbString();me[a]=!0}}we.toggleClass("sp-flat",W),we.toggleClass("sp-input-disabled",!V.showInput),we.toggleClass("sp-alpha-enabled",V.showAlpha),we.toggleClass("sp-clear-enabled",Ye),we.toggleClass("sp-buttons-disabled",!V.showButtons),we.toggleClass("sp-palette-buttons-disabled",!V.togglePaletteOnly),we.toggleClass("sp-palette-disabled",!V.showPalette),we.toggleClass("sp-palette-only",V.showPaletteOnly),we.toggleClass("sp-initial-disabled",!V.showInitial),we.addClass(V.className).addClass(V.containerClassName),D()}function h(){function t(t){return t.data&&t.data.ignore?(H(e(t.target).closest(".sp-thumb-el").data("color")),I()):(H(e(t.target).closest(".sp-thumb-el").data("color")),I(),V.hideAfterPaletteSelect?(A(!0),j()):A()),!1}m&&we.find("*:not(input)").attr("unselectable","on"),p(),Ne&&Me.after(Be).hide(),Ye||Ie.hide(),W&&Me.after(we).hide(),b(),ze.on("click.spectrum touchstart.spectrum",function(t){Ce||k(),t.stopPropagation(),e(t.target).is("input")||t.preventDefault()}),(Me.is(":disabled")||V.disabled===!0)&&_(),we.click(l),Ze.change(E),Ze.on("paste",function(){setTimeout(E,1)}),Ze.keydown(function(e){13==e.keyCode&&E()}),Ue.text(V.cancelText),Ue.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Z(),j()}),Ie.attr("title",V.clearText),Ie.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Xe=!0,I(),W&&A(!0)}),Le.text(V.chooseText),Le.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),m&&Ze.is(":focus")&&Ze.trigger("change"),U()&&(A(!0),j())}),$e.text(V.showPaletteOnly?V.togglePaletteMoreText:V.togglePaletteLessText),$e.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),V.showPaletteOnly=!V.showPaletteOnly,V.showPaletteOnly||W||we.css("left","-="+(xe.outerWidth(!0)+5)),p()}),c(Re,function(e,t,r){de=e/se,Xe=!1,r.shiftKey&&(de=Math.round(10*de)/10),I()},x,T),c(ke,function(e,t){pe=parseFloat(t/ne),Xe=!1,V.showAlpha||(de=1),I()},x,T),c(Te,function(e,t,r){if(r.shiftKey){if(!be){var a=ce*te,n=re-ue*re,i=Math.abs(e-a)>Math.abs(t-n);be=i?"x":"y"}}else be=null;var s=!be||"x"===be,o=!be||"y"===be;s&&(ce=parseFloat(e/te)),o&&(ue=parseFloat((re-t)/re)),Xe=!1,V.showAlpha||(de=1),I()},x,T),Ge?(H(Ge),L(),We=V.preferredFormat||tinycolor(Ge).format,P(Ge)):L(),W&&S();var r=m?"mousedown.spectrum":"click.spectrum touchstart.spectrum";He.on(r,".sp-thumb-el",t),Fe.on(r,".sp-thumb-el:nth-child(1)",{ignore:!0},t)}function b(){if(X&&window.localStorage){try{var t=window.localStorage[X].split(",#");t.length>1&&(delete window.localStorage[X],e.each(t,function(e,t){P(t)}))}catch(e){}try{ge=window.localStorage[X].split(";")}catch(e){}}}function P(t){if(q){var r=tinycolor(t).toRgbString();if(!me[r]&&e.inArray(r,ge)===-1)for(ge.push(r);ge.length>ve;)ge.shift();if(X&&window.localStorage)try{window.localStorage[X]=ge.join(";")}catch(e){}}}function M(){var e=[];if(V.showPalette)for(var t=0;t<ge.length;t++){var r=tinycolor(ge[t]).toRgbString();me[r]||e.push(ge[t])}return e.reverse().slice(0,V.maxSelectionSize)}function C(){var t=F(),a=e.map(fe,function(e,a){return r(e,t,"sp-palette-row sp-palette-row-"+a,V)});b(),ge&&a.push(r(M(),t,"sp-palette-row sp-palette-row-selection",V)),He.html(a.join(""))}function w(){if(V.showInitial){var e=Ve,t=F();Fe.html(r([e,t],t,"sp-palette-row-initial",V))}}function x(){(re<=0||te<=0||ne<=0)&&D(),ee=!0,we.addClass(ye),be=null,Me.trigger("dragstart.spectrum",[F()])}function T(){ee=!1,we.removeClass(ye),Me.trigger("dragstop.spectrum",[F()])}function E(){var e=Ze.val();if(null!==e&&""!==e||!Ye){var t=tinycolor(e);t.isValid()?(H(t),I(),A()):Ze.addClass("sp-validation-error")}else H(null),I(),A()}function k(){K?j():S()}function S(){var t=e.Event("beforeShow.spectrum");return K?void D():(Me.trigger(t,[F()]),void(Q.beforeShow(F())===!1||t.isDefaultPrevented()||(a(),K=!0,e(Pe).on("keydown.spectrum",O),e(Pe).on("click.spectrum",R),e(window).on("resize.spectrum",J),Be.addClass("sp-active"),we.appendTo(e("body")),D(),L(),Ve=F(),w(),Q.show(Ve),Me.trigger("show.spectrum",[Ve]))))}function O(e){27===e.keyCode&&j()}function R(e){2!=e.button&&(ee||(qe?A(!0):Z(),j()))}function j(){K&&!W&&(K=!1,e(Pe).off("keydown.spectrum",O),e(Pe).off("click.spectrum",R),e(window).off("resize.spectrum",J),Be.removeClass("sp-active"),we.detach(),Q.hide(F()),Me.trigger("hide.spectrum",[F()]))}function Z(){H(Ve,!0),A(!0)}function H(e,t){if(tinycolor.equals(e,F()))return void L();var r,a;!e&&Ye?Xe=!0:(Xe=!1,r=tinycolor(e),a=r.toHsv(),pe=a.h%360/360,ce=a.s,ue=a.v,de=a.a),L(),r&&r.isValid()&&!t&&(We=V.preferredFormat||r.getFormat())}function F(e){return e=e||{},Ye&&Xe?null:tinycolor.fromRatio({h:pe,s:ce,v:ue,a:Math.round(1e3*de)/1e3},{format:e.format||We})}function U(){return!Ze.hasClass("sp-validation-error")}function I(){L(),Q.move(F()),Me.trigger("move.spectrum",[F()])}function L(){Ze.removeClass("sp-validation-error"),$();var e=tinycolor.fromRatio({h:pe,s:1,v:1});Te.css("background-color",e.toHexString());var t=We;de<1&&(0!==de||"name"!==t)&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var r=F({format:t}),a="";if(_e.removeClass("sp-clear-display"),_e.css("background-color","transparent"),!r&&Ye)_e.addClass("sp-clear-display");else{var n=r.toHexString(),i=r.toRgbString();if(g||1===r.alpha?_e.css("background-color",i):(_e.css("background-color","transparent"),_e.css("filter",r.toFilter())),V.showAlpha){var s=r.toRgb();s.a=0;var o=tinycolor(s).toRgbString(),l="linear-gradient(left, "+o+", "+n+")";m?Oe.css("filter",tinycolor(o).toFilter({gradientType:1},n)):(Oe.css("background","-webkit-"+l),Oe.css("background","-moz-"+l),Oe.css("background","-ms-"+l),Oe.css("background","linear-gradient(to right, "+o+", "+n+")"))}a=r.toString(t)}V.showInput&&Ze.val(a),V.showPalette&&C(),w()}function $(){var e=ce,t=ue;if(Ye&&Xe)je.hide(),Se.hide(),Ee.hide();else{je.show(),Se.show(),Ee.show();var r=e*te,a=re-t*re;r=Math.max(-ae,Math.min(te-ae,r-ae)),a=Math.max(-ae,Math.min(re-ae,a-ae)),Ee.css({top:a+"px",left:r+"px"});var n=de*se;je.css({left:n-oe/2+"px"});var i=pe*ne;Se.css({top:i-le+"px"})}}function A(e){var t=F(),r="",a=!tinycolor.equals(t,Ve);t&&(r=t.toString(We),P(t)),Ae&&Me.val(r),e&&a&&(Q.change(t),Me.trigger("change",[t]))}function D(){K&&(te=Te.width(),re=Te.height(),ae=Ee.height(),ie=ke.width(),ne=ke.height(),le=Se.height(),se=Re.width(),oe=je.width(),W||(we.css("position","absolute"),V.offset?we.offset(V.offset):we.offset(s(we,ze))),$(),V.showPalette&&C(),Me.trigger("reflow.spectrum"))}function N(){Me.show(),ze.off("click.spectrum touchstart.spectrum"),we.remove(),Be.remove(),f[Qe.id]=null}function B(r,a){return r===t?e.extend({},V):a===t?V[r]:(V[r]=a,"preferredFormat"===r&&(We=V.preferredFormat),void p())}function z(){Ce=!1,Me.attr("disabled",!1),ze.removeClass("sp-disabled")}function _(){j(),Ce=!0,Me.attr("disabled",!0),ze.addClass("sp-disabled")}function G(e){V.offset=e,D()}var V=n(o,i),W=V.flat,q=V.showSelectionPalette,X=V.localStorageKey,Y=V.theme,Q=V.callbacks,J=u(D,10),K=!1,ee=!1,te=0,re=0,ae=0,ne=0,ie=0,se=0,oe=0,le=0,pe=0,ce=0,ue=0,de=1,he=[],fe=[],me={},ge=V.selectionPalette.slice(0),ve=V.maxSelectionSize,ye="sp-dragging",be=null,Pe=i.ownerDocument,Me=(Pe.body,e(i)),Ce=!1,we=e(y,Pe).addClass(Y),xe=we.find(".sp-picker-container"),Te=we.find(".sp-color"),Ee=we.find(".sp-dragger"),ke=we.find(".sp-hue"),Se=we.find(".sp-slider"),Oe=we.find(".sp-alpha-inner"),Re=we.find(".sp-alpha"),je=we.find(".sp-alpha-handle"),Ze=we.find(".sp-input"),He=we.find(".sp-palette"),Fe=we.find(".sp-initial"),Ue=we.find(".sp-cancel"),Ie=we.find(".sp-clear"),Le=we.find(".sp-choose"),$e=we.find(".sp-palette-toggle"),Ae=Me.is("input"),De=Ae&&"color"===Me.attr("type")&&d(),Ne=Ae&&!W,Be=Ne?e(v).addClass(Y).addClass(V.className).addClass(V.replacerClassName):e([]),ze=Ne?Be:Me,_e=Be.find(".sp-preview-inner"),Ge=V.color||Ae&&Me.val(),Ve=!1,We=V.preferredFormat,qe=!V.showButtons||V.clickoutFiresChange,Xe=!Ge,Ye=V.allowEmpty&&!De;h();var Qe={show:S,hide:j,toggle:k,reflow:D,option:B,enable:z,disable:_,offset:G,set:function(e){H(e),A()},get:F,destroy:N,container:we};return Qe.id=f.push(Qe)-1,Qe}function s(t,r){var a=0,n=t.outerWidth(),i=t.outerHeight(),s=r.outerHeight(),o=t[0].ownerDocument,l=o.documentElement,p=l.clientWidth+e(o).scrollLeft(),c=l.clientHeight+e(o).scrollTop(),u=r.offset(),d=u.left,h=u.top;return h+=s,d-=Math.min(d,d+n>p&&p>n?Math.abs(d+n-p):0),h-=Math.min(h,h+i>c&&c>i?Math.abs(i+s-a):a),{top:h,bottom:u.bottom,left:d,right:u.right,width:u.width,height:u.height}}function o(){}function l(e){e.stopPropagation()}function p(e,t){var r=Array.prototype.slice,a=r.call(arguments,2);return function(){return e.apply(t,a.concat(r.call(arguments)))}}function c(t,r,a,n){function i(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function s(e){if(c){if(m&&p.documentMode<9&&!e.button)return l();var a=e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0],n=a&&a.pageX||e.pageX,s=a&&a.pageY||e.pageY,o=Math.max(0,Math.min(n-u.left,h)),g=Math.max(0,Math.min(s-u.top,d));f&&i(e),r.apply(t,[o,g,e])}}function o(r){var n=r.which?3==r.which:2==r.button;n||c||a.apply(t,arguments)!==!1&&(c=!0,d=e(t).height(),h=e(t).width(),u=e(t).offset(),e(p).on(g),e(p.body).addClass("sp-dragging"),s(r),i(r))}function l(){c&&(e(p).off(g),e(p.body).removeClass("sp-dragging"),setTimeout(function(){n.apply(t,arguments)},0)),c=!1}r=r||function(){},a=a||function(){},n=n||function(){};var p=document,c=!1,u={},d=0,h=0,f="ontouchstart"in window,g={};g.selectstart=i,g.dragstart=i,g["touchmove mousemove"]=s,g["touchend mouseup"]=l,e(t).on("touchstart mousedown",o)}function u(e,t,r){var a;return function(){var n=this,i=arguments,s=function(){a=null,e.apply(n,i)};r&&clearTimeout(a),!r&&a||(a=setTimeout(s,t))}}function d(){return e.fn.spectrum.inputTypeColorSupport()}var h={beforeShow:o,move:o,change:o,show:o,hide:o,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},f=[],m=!!/msie/i.exec(window.navigator.userAgent),g=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),r=t.style;return r.cssText="background-color:rgba(0,0,0,.5)",e(r.backgroundColor,"rgba")||e(r.backgroundColor,"hsla")}(),v=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),y=function(){var e="";if(m)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),b="spectrum.id";e.fn.spectrum=function(t,r){if("string"==typeof t){var a=this,n=Array.prototype.slice.call(arguments,1);return this.each(function(){var r=f[e(this).data(b)];if(r){var i=r[t];if(!i)throw new Error("Spectrum: no such method: '"+t+"'");"get"==t?a=r.get():"container"==t?a=r.container:"option"==t?a=r.option.apply(r,n):"destroy"==t?(r.destroy(),e(this).removeData(b)):i.apply(r,n)}}),a}return this.spectrum("destroy").each(function(){var r=e.extend({},e(this).data(),t),a=i(this,r);e(this).data(b,a.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=c,e.fn.spectrum.defaults=h,e.fn.spectrum.inputTypeColorSupport=function t(){if("undefined"==typeof t._cachedResult){var r=e("<input type='color'/>")[0];t._cachedResult="color"===r.type&&""!==r.value}return t._cachedResult},e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){var t=e("input[type=color]");t.length&&!d()&&t.spectrum({preferredFormat:"hex6"})},function(){function e(e){var r={r:0,g:0,b:0},n=1,s=!1,o=!1;return"string"==typeof e&&(e=Z(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(r=t(e.r,e.g,e.b),s=!0,o="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=O(e.s),e.v=O(e.v),r=i(e.h,e.s,e.v),s=!0,o="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=O(e.s),e.l=O(e.l),r=a(e.h,e.s,e.l),s=!0,o="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=C(n),{ok:s,format:e.format||o,r:$(255,A(r.r,0)),g:$(255,A(r.g,0)),b:$(255,A(r.b,0)),a:n}}function t(e,t,r){return{r:255*w(e,255),g:255*w(t,255),b:255*w(r,255)}}function r(e,t,r){e=w(e,255),t=w(t,255),r=w(r,255);var a,n,i=A(e,t,r),s=$(e,t,r),o=(i+s)/2;if(i==s)a=n=0;else{var l=i-s;switch(n=o>.5?l/(2-i-s):l/(i+s),i){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4}a/=6}return{h:a,s:n,l:o}}function a(e,t,r){function a(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}var n,i,s;if(e=w(e,360),t=w(t,100),r=w(r,100),0===t)n=i=s=r;else{var o=r<.5?r*(1+t):r+t-r*t,l=2*r-o;n=a(l,o,e+1/3),i=a(l,o,e),s=a(l,o,e-1/3)}return{r:255*n,g:255*i,b:255*s}}function n(e,t,r){e=w(e,255),t=w(t,255),r=w(r,255);var a,n,i=A(e,t,r),s=$(e,t,r),o=i,l=i-s;if(n=0===i?0:l/i,i==s)a=0;else{switch(i){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4}a/=6}return{h:a,s:n,v:o}}function i(e,t,r){e=6*w(e,360),t=w(t,100),r=w(r,100);var a=I.floor(e),n=e-a,i=r*(1-t),s=r*(1-n*t),o=r*(1-(1-n)*t),l=a%6,p=[r,s,i,i,o,r][l],c=[o,r,r,s,i,i][l],u=[i,i,o,r,r,s][l];return{r:255*p,g:255*c,b:255*u}}function s(e,t,r,a){var n=[S(L(e).toString(16)),S(L(t).toString(16)),S(L(r).toString(16))];return a&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function o(e,t,r,a){var n=[S(R(a)),S(L(e).toString(16)),S(L(t).toString(16)),S(L(r).toString(16))];return n.join("")}function l(e,t){t=0===t?0:t||10;var r=N(e).toHsl();return r.s-=t/100,r.s=x(r.s),N(r)}function p(e,t){t=0===t?0:t||10;var r=N(e).toHsl();return r.s+=t/100,r.s=x(r.s),N(r)}function c(e){return N(e).desaturate(100)}function u(e,t){t=0===t?0:t||10;var r=N(e).toHsl();return r.l+=t/100,r.l=x(r.l),N(r)}function d(e,t){t=0===t?0:t||10;var r=N(e).toRgb();return r.r=A(0,$(255,r.r-L(255*-(t/100)))),r.g=A(0,$(255,r.g-L(255*-(t/100)))),r.b=A(0,$(255,r.b-L(255*-(t/100)))),N(r)}function h(e,t){t=0===t?0:t||10;var r=N(e).toHsl();return r.l-=t/100,r.l=x(r.l),N(r)}function f(e,t){var r=N(e).toHsl(),a=(L(r.h)+t)%360;return r.h=a<0?360+a:a,N(r)}function m(e){var t=N(e).toHsl();return t.h=(t.h+180)%360,N(t)}function g(e){var t=N(e).toHsl(),r=t.h;return[N(e),N({h:(r+120)%360,s:t.s,l:t.l}),N({h:(r+240)%360,s:t.s,l:t.l})]}function v(e){var t=N(e).toHsl(),r=t.h;return[N(e),N({h:(r+90)%360,s:t.s,l:t.l}),N({h:(r+180)%360,s:t.s,l:t.l}),N({h:(r+270)%360,s:t.s,l:t.l})]}function y(e){var t=N(e).toHsl(),r=t.h;return[N(e),N({h:(r+72)%360,s:t.s,l:t.l}),N({h:(r+216)%360,s:t.s,l:t.l})]}function b(e,t,r){t=t||6,r=r||30;var a=N(e).toHsl(),n=360/r,i=[N(e)];for(a.h=(a.h-(n*t>>1)+720)%360;--t;)a.h=(a.h+n)%360,i.push(N(a));return i}function P(e,t){t=t||6;for(var r=N(e).toHsv(),a=r.h,n=r.s,i=r.v,s=[],o=1/t;t--;)s.push(N({h:a,s:n,v:i})),i=(i+o)%1;return s}function M(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}function C(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function w(e,t){E(e)&&(e="100%");var r=k(e);return e=$(t,A(0,parseFloat(e))),r&&(e=parseInt(e*t,10)/100),I.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function x(e){return $(1,A(0,e))}function T(e){return parseInt(e,16)}function E(e){return"string"==typeof e&&e.indexOf(".")!=-1&&1===parseFloat(e)}function k(e){return"string"==typeof e&&e.indexOf("%")!=-1}function S(e){return 1==e.length?"0"+e:""+e}function O(e){return e<=1&&(e=100*e+"%"),e}function R(e){return Math.round(255*parseFloat(e)).toString(16)}function j(e){return T(e)/255}function Z(e){e=e.replace(H,"").replace(F,"").toLowerCase();var t=!1;if(B[e])e=B[e],t=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};var r;return(r=_.rgb.exec(e))?{r:r[1],g:r[2],b:r[3]}:(r=_.rgba.exec(e))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=_.hsl.exec(e))?{h:r[1],s:r[2],l:r[3]}:(r=_.hsla.exec(e))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=_.hsv.exec(e))?{h:r[1],s:r[2],v:r[3]}:(r=_.hsva.exec(e))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=_.hex8.exec(e))?{a:j(r[1]),r:T(r[2]),g:T(r[3]),b:T(r[4]),format:t?"name":"hex8"}:(r=_.hex6.exec(e))?{r:T(r[1]),g:T(r[2]),b:T(r[3]),format:t?"name":"hex"}:!!(r=_.hex3.exec(e))&&{r:T(r[1]+""+r[1]),g:T(r[2]+""+r[2]),b:T(r[3]+""+r[3]),format:t?"name":"hex"}}var H=/^[\s,#]+/,F=/\s+$/,U=0,I=Math,L=I.round,$=I.min,A=I.max,D=I.random,N=function(t,r){if(t=t?t:"",r=r||{},t instanceof N)return t;if(!(this instanceof N))return new N(t,r);var a=e(t);this._originalInput=t,this._r=a.r,this._g=a.g,this._b=a.b,this._a=a.a,this._roundA=L(1e3*this._a)/1e3,this._format=r.format||a.format,this._gradientType=r.gradientType,this._r<1&&(this._r=L(this._r)),this._g<1&&(this._g=L(this._g)),this._b<1&&(this._b=L(this._b)),this._ok=a.ok,this._tc_id=U++};N.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=C(e),this._roundA=L(1e3*this._a)/1e3,this},toHsv:function(){var e=n(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=n(this._r,this._g,this._b),t=L(360*e.h),r=L(100*e.s),a=L(100*e.v);return 1==this._a?"hsv("+t+", "+r+"%, "+a+"%)":"hsva("+t+", "+r+"%, "+a+"%, "+this._roundA+")"},toHsl:function(){var e=r(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=r(this._r,this._g,this._b),t=L(360*e.h),a=L(100*e.s),n=L(100*e.l);return 1==this._a?"hsl("+t+", "+a+"%, "+n+"%)":"hsla("+t+", "+a+"%, "+n+"%, "+this._roundA+")"},toHex:function(e){return s(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return o(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:L(this._r),g:L(this._g),b:L(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+L(this._r)+", "+L(this._g)+", "+L(this._b)+")":"rgba("+L(this._r)+", "+L(this._g)+", "+L(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:L(100*w(this._r,255))+"%",g:L(100*w(this._g,255))+"%",b:L(100*w(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+L(100*w(this._r,255))+"%, "+L(100*w(this._g,255))+"%, "+L(100*w(this._b,255))+"%)":"rgba("+L(100*w(this._r,255))+"%, "+L(100*w(this._g,255))+"%, "+L(100*w(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(z[s(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+o(this._r,this._g,this._b,this._a),r=t,a=this._gradientType?"GradientType = 1, ":"";if(e){var n=N(e);r=n.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+t+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,a=this._a<1&&this._a>=0,n=!t&&a&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return n?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(r=this.toRgbString()),"prgb"===e&&(r=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(r=this.toHexString()),"hex3"===e&&(r=this.toHexString(!0)),"hex8"===e&&(r=this.toHex8String()),"name"===e&&(r=this.toName()),"hsl"===e&&(r=this.toHslString()),"hsv"===e&&(r=this.toHsvString()),r||this.toHexString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(u,arguments)},brighten:function(){return this._applyModification(d,arguments)},darken:function(){return this._applyModification(h,arguments)},desaturate:function(){return this._applyModification(l,arguments)},saturate:function(){return this._applyModification(p,arguments)},greyscale:function(){return this._applyModification(c,arguments)},spin:function(){return this._applyModification(f,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(b,arguments)},complement:function(){return this._applyCombination(m,arguments)},monochromatic:function(){return this._applyCombination(P,arguments)},splitcomplement:function(){return this._applyCombination(y,arguments)},triad:function(){return this._applyCombination(g,arguments)},tetrad:function(){return this._applyCombination(v,arguments)}},N.fromRatio=function(e,t){if("object"==typeof e){var r={};for(var a in e)e.hasOwnProperty(a)&&("a"===a?r[a]=e[a]:r[a]=O(e[a]));e=r}return N(e,t)},N.equals=function(e,t){return!(!e||!t)&&N(e).toRgbString()==N(t).toRgbString()},N.random=function(){return N.fromRatio({r:D(),g:D(),b:D()})},N.mix=function(e,t,r){r=0===r?0:r||50;var a,n=N(e).toRgb(),i=N(t).toRgb(),s=r/100,o=2*s-1,l=i.a-n.a;a=o*l==-1?o:(o+l)/(1+o*l),a=(a+1)/2;var p=1-a,c={r:i.r*a+n.r*p,g:i.g*a+n.g*p,b:i.b*a+n.b*p,a:i.a*s+n.a*(1-s)};return N(c)},N.readability=function(e,t){var r=N(e),a=N(t),n=r.toRgb(),i=a.toRgb(),s=r.getBrightness(),o=a.getBrightness(),l=Math.max(n.r,i.r)-Math.min(n.r,i.r)+Math.max(n.g,i.g)-Math.min(n.g,i.g)+Math.max(n.b,i.b)-Math.min(n.b,i.b);return{brightness:Math.abs(s-o),color:l}},N.isReadable=function(e,t){var r=N.readability(e,t);return r.brightness>125&&r.color>500},N.mostReadable=function(e,t){for(var r=null,a=0,n=!1,i=0;i<t.length;i++){var s=N.readability(e,t[i]),o=s.brightness>125&&s.color>500,l=3*(s.brightness/125)+s.color/500;(o&&!n||o&&n&&l>a||!o&&!n&&l>a)&&(n=o,a=l,r=N(t[i]))}return r};var B=N.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},z=N.hexNames=M(B),_=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",r="(?:"+t+")|(?:"+e+")",a="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?",n="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?";return{rgb:new RegExp("rgb"+a),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+a),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+a),hsva:new RegExp("hsva"+n),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=N}(),e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})}),function(e){function t(e,t){return e.position-t.position}function r(e,t){return"function"==typeof e.bind?e.bind(t):function(){e.apply(t,arguments)}}function a(t,a){this.$el=t,this.$el.css("position","relative"),this.opts=a;var n=e("<div class='gradientPicker-preview'></div>");this.$el.append(n),this.$disp=n;var s=e("<div class='gradientPicker-ctrlPts'></div>");this.$el.append(s),this.$ctrlPtContainer=s,this.updatePreview=r(this.updatePreview,this),this.controlPoints=[],this.ctrlPtConfig=new i(this.$el,a);for(var o=0;o<a.controlPoints.length;++o){var l=this.createCtrlPt(a.controlPoints[o]);this.controlPoints.push(l)}this.destroyed=r(this.destroyed,this),this.$el.on("destroyed",this.destroyed),this.previewClicked=r(this.previewClicked,this),n.click(this.previewClicked),this.updatePreview()}function n(t,a,n,i){this.$el=e("<div class='gradientPicker-ctrlPt'></div>"),t.append(this.$el),this.$parentEl=t,this.configView=i,"string"==typeof a?(a=a.split(" "),this.position=parseFloat(a[1])/100,this.color=a[0]):(this.position=a.position,this.color=a.color),this.listener=n,this.outerWidth=this.$el.outerWidth(),this.$el.css("background-color",this.color);var s=234*this.position;this.$el.css("left",s),this.drag=r(this.drag,this),this.stop=r(this.stop,this),this.start=r(this.start,this),this.clicked=r(this.clicked,this),this.colorChanged=r(this.colorChanged,this),this.$el[0].onclick=this.clicked,this.$el.drag("start",this.start).drag("end",this.stop).drag(this.drag)}function i(t,a){this.$el=e('<div class="gradientPicker-ptConfig" style="visibility: hidden"></div>'),t.append(this.$el);var n=e('<input type="text" id="cp_colorsel" />');this.$el.append(n);var i=e("<div class='gradientPicker-close'></div>").text("delete");this.$el.append(i),this.colorChanged=r(this.colorChanged,this),this.closed=r(this.closed,this),this.removeClicked=r(this.removeClicked,this),this.hide=r(this.hide,this),n.spectrum({flat:!1,showInput:!0,showInitial:!0,allowEmpty:!1,showAlpha:!0,disabled:!1,showPalette:!0,clickoutFiresChange:!0,preferredFormat:"RGBA",hide:this.closed,change:this.colorChanged}),this.$cpicker=n,this.opts=a,this.visible=!1,i.click(this.removeClicked)}new Image;e.event.special.destroyed||(e.event.special.destroyed={remove:function(e){e.handler&&e.handler()}}),a.prototype={createCtrlPt:function(e){return new n(this.$ctrlPtContainer,e,this,this.ctrlPtConfig)},destroyed:function(){e(document).unbind("click",this.docClicked)},updateOptions:function(t){e.extend(this.opts,t);for(var r=0;r<this.controlPoints.length;++r)this.controlPoints[r].$el.remove();this.controlPoints=[];for(var r=0;r<t.controlPoints.length;++r){var a=this.createCtrlPt(t.controlPoints[r]);this.controlPoints.push(a)}this.updatePreview(!1)},updatePreview:function(e){var r=[];this.controlPoints.sort(t);for(var a=0;a<this.controlPoints.length;++a){var n=this.controlPoints[a];r.push({position:n.position,color:n.color})}var i=this._generatePreviewStyles();this.$disp.css("background",i),e&&this.opts.change(r,i)},removeControlPoint:function(e){var t=this.controlPoints.indexOf(e);t!=-1&&(this.controlPoints.splice(t,1),e.$el.remove())},previewClicked:function(r){for(var a,n=r.offsetX/e(r.target).outerWidth(),i=0;i<this.controlPoints.length;i++){if(0===i&&this.controlPoints[i].position>n){a=this.controlPoints[i].color;break}if(this.controlPoints[i].position<=n)if(i===this.controlPoints.length-1)a=this.controlPoints[i].color;else{var s=tinycolor(this.controlPoints[i].color),o=tinycolor(this.controlPoints[i+1].color),l=(n-this.controlPoints[i].position)/(this.controlPoints[i+1].position-this.controlPoints[i].position),p=tinycolor({r:s._r+l*(o._r-s._r),g:s._g+l*(o._g-s._g),b:s._b+l*(o._b-s._b),a:s._a+l*(o._a-s._a)});a=p.toRgbString()}}"undefined"==typeof a&&(a="rgba(0,0,0,1.0)");var c=this.createCtrlPt({position:n,color:a});this.controlPoints.push(c),this.controlPoints.sort(t);
},_generatePreviewStyles:function(){if(1===this.controlPoints.length)return this.controlPoints[0].color;for(var e="linear-gradient(to right, ",t=!0,r=0;r<this.controlPoints.length;++r){var a=this.controlPoints[r];t?t=!1:e+=", ",e+=a.color+" "+(100*a.position|0)+"%"}return e+=")"}},n.prototype={drag:function(e,t){var r=Math.min(t.limit.right,Math.max(t.limit.left,t.offsetX))-t.limit.left;this.$el.css("left",r),this.position=r/(this.$parentEl.width()-this.$el.outerWidth()),this.listener.updatePreview(!1)},start:function(e,t){t.limit=this.$parentEl.offset(),t.limit.right=t.limit.left+this.$parentEl.outerWidth()-this.$el.outerWidth()},stop:function(e,t){this.listener.updatePreview(!0)},clicked:function(e){return this.configView.show(this.$el.position(),this.color,this),e.stopPropagation(),!1},colorChanged:function(e,t){this.color=e,this.$el.css("background-color",this.color),t&&this.listener.updatePreview(!0)},removeClicked:function(){this.listener.removeControlPoint(this),this.listener.updatePreview(!0)}},i.prototype={show:function(t,r,a){this.visible=!0,this.listener=a,this.$el.css("visibility","visible"),this.$cpicker.spectrum("set",r),this.$el.css("left",Math.min(t.left,a.$parentEl.width()-this.$el.outerWidth())),e(document).on("click",this.hide)},hide:function(){this.visible&&(this.$el.css("visibility","hidden"),this.visible=!1,e(document).off("click",this.hide))},closed:function(e){this.listener.colorChanged(e.toRgbString(),!0)},colorChanged:function(e){this.listener.colorChanged(e.toRgbString())},removeClicked:function(){this.listener.removeClicked(),this.hide()}};var s={init:function(t){t=e.extend({controlPoints:["#FFF 0%","#000 100%"],type:"linear",fillDirection:"left",generateStyles:!1,change:function(){}},t),this.each(function(){var r=e(this),n=new a(r,t);r.data("gradientPicker-sel",n)})},update:function(t){this.each(function(){var r=e(this),a=r.data("gradientPicker-sel");null!=a&&a.updateOptions(t)})}};e.fn.gradientPicker=function(e,t){"string"==typeof e&&"init"!==e?s[e].call(this,t):(t=e,s.init.call(this,t))}}(jQuery),function(e){var t,r,a,n=!1,i=!1,s=!1,o=3,l=function(e,t){e>t.data("max")?e=t.data("max"):e<t.data("min")&&(e=t.data("min")),e=e.toFixed(t.data("decimals")),t.val(e),t.data("change")&&t.data("change")(e)},p={i_mousedown:function(n){var i=this;t=n.screenX,r=n.screenY,a=Number(i.val()),e(window).on("mousemove",i.data("w_mousemove")),i.on("mouseup",i.data("i_mouseup"))},i_focus:function(t){if(s!==!1){var r=this;i=!0,e(window).off("mousemove",r.data("w_mousemove")),r.prop("readonly",!1),r.removeClass("pzinput-normal"),r.addClass("pzinput-edit"),r.select(),r.on("blur",r.data("i_blur")),r.on("keydown",r.data("i_keydown")),s=!1}},i_mouseup:function(){var t=this;i=!0,e(window).off("mousemove",t.data("w_mousemove")),t.off("mouseup",t.data("i_mousemove")),t.prop("readonly",!1),t.removeClass("pzinput-normal"),t.addClass("pzinput-edit"),t.select(),t.on("blur",t.data("i_blur")),t.on("keydown",t.data("i_keydown"))},w_mousemove:function(i){var s=this;if(n===!1){if(Math.abs(i.screenX-t-i.screenY+r)<o)return;s.off("mouseup",s.data("i_mouseup")),e(window).on("mouseup",s.data("w_mouseup")),e("body").css("cursor","move"),n=!0}l(a+(i.screenX-t-i.screenY+r)*s.data("dragstep")*(i.shiftKey?2.5:1)*(i.ctrlKey?.25:1),s)},i_blur:function(){var e=this;isNaN(Number(e.val()))?l(e.data("min"),e):l(Number(e.val()),e),e.off("blur",e.data("i_blur")),e.off("keydown",e.data("i_keydown")),i=!1,e.prop("readonly",!0),e.removeClass("pzinput-edit"),e.addClass("pzinput-normal")},w_mouseup:function(){var t=this;e(window).off("mousemove",t.data("w_mousemove")),e(window).off("mouseup",t.data("w_mouseup")),e("body").css("cursor","auto"),n=!1,t.blur()},i_keydown:function(e){var t=this;if(13==e.which)t.blur();else if(38===e.which)l(Number(t.val())+t.data("step"),t);else if(40===e.which)l(Number(t.val())-t.data("step"),t);else if(33===e.which)l(Number(t.val())+t.data("bigstep"),t);else{if(34!==e.which)return 9!==e.which||(s=!0,!0);l(Number(t.val())-t.data("bigstep"),t)}return!1},i_wheel:function(e){var t=this;l(Number(t.val())+e.originalEvent.wheelDelta*t.data("dragstep"),t)}};e.fn.pzinput=function(e){var t=this;return t.data("i_mousedown",p.i_mousedown.bind(this)),t.data("i_focus",p.i_focus.bind(this)),t.data("i_mouseup",p.i_mouseup.bind(this)),t.data("w_mousemove",p.w_mousemove.bind(this)),t.data("i_blur",p.i_blur.bind(this)),t.data("w_mouseup",p.w_mouseup.bind(this)),t.data("i_keydown",p.i_keydown.bind(this)),t.on("mousedown",t.data("i_mousedown")),t.on("focus",t.data("i_focus")),t.prop("readonly",!0),t.addClass("pzinput-normal"),t.data("max",e&&e.max?e.max:10),t.data("min",e&&e.min?e.min:0),t.data("decimals",e&&e.decimals?e.decimals:0),t.data("step",e&&e.step?e.step:(t.data("max")-t.data("min"))/50),t.data("bigstep",e&&e.bigstep?e.bigstep:e&&e.step?10*e.step:(t.data("max")-t.data("min"))/10),t.data("dragstep",e&&e.dragstep?e.dragstep:e&&e.step?e.step/10:(t.data("max")-t.data("min"))/(1.5*Math.min(window.screen.availHeight,window.screen.availWidth))),l(Number(t.val()),t),t.data("change",e&&e.change?e.change:null),t}}(jQuery),function(e){e.fn.drag=function(t,r,a){var n="string"==typeof t?t:"",i=e.isFunction(t)?t:e.isFunction(r)?r:null;return 0!==n.indexOf("drag")&&(n="drag"+n),a=(t==i?r:a)||{},i?this.bind(n,a,i):this.trigger(n)};var t=e.event,r=t.special,a=r.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var r=e.data(this,a.datakey),n=t.data||{};r.related+=1,e.each(a.defaults,function(e,t){void 0!==n[e]&&(r[e]=n[e])})},remove:function(){e.data(this,a.datakey).related-=1},setup:function(){if(!e.data(this,a.datakey)){var r=e.extend({related:0},a.defaults);e.data(this,a.datakey,r),t.add(this,"touchstart mousedown",a.init,r),this.attachEvent&&this.attachEvent("ondragstart",a.dontstart)}},teardown:function(){var r=e.data(this,a.datakey)||{};r.related||(e.removeData(this,a.datakey),t.remove(this,"touchstart mousedown",a.init),a.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",a.dontstart))},init:function(n){if(!a.touched){var i,s=n.data;if(!(0!=n.which&&s.which>0&&n.which!=s.which)&&!e(n.target).is(s.not)&&(!s.handle||e(n.target).closest(s.handle,n.currentTarget).length)&&(a.touched="touchstart"==n.type?this:null,s.propagates=1,s.mousedown=this,s.interactions=[a.interaction(this,s)],s.target=n.target,s.pageX=n.pageX,s.pageY=n.pageY,s.dragging=null,i=a.hijack(n,"draginit",s),s.propagates))return i=a.flatten(i),i&&i.length&&(s.interactions=[],e.each(i,function(){s.interactions.push(a.interaction(this,s))})),s.propagates=s.interactions.length,s.drop!==!1&&r.drop&&r.drop.handler(n,s),a.textselect(!1),a.touched?t.add(a.touched,"touchmove touchend",a.handler,s):t.add(document,"mousemove mouseup",a.handler,s),!(!a.touched||s.live)&&void 0}},interaction:function(t,r){var n=e(t)[r.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new a.callback,droppable:[],offset:n}},handler:function(n){var i=n.data;switch(n.type){case!i.dragging&&"touchmove":n.preventDefault();case!i.dragging&&"mousemove":if(Math.pow(n.pageX-i.pageX,2)+Math.pow(n.pageY-i.pageY,2)<Math.pow(i.distance,2))break;n.target=i.target,a.hijack(n,"dragstart",i),i.propagates&&(i.dragging=!0);case"touchmove":n.preventDefault();case"mousemove":if(i.dragging){if(a.hijack(n,"drag",i),i.propagates){i.drop!==!1&&r.drop&&r.drop.handler(n,i);break}n.type="mouseup"}case"touchend":case"mouseup":default:a.touched?t.remove(a.touched,"touchmove touchend",a.handler):t.remove(document,"mousemove mouseup",a.handler),i.dragging&&(i.drop!==!1&&r.drop&&r.drop.handler(n,i),a.hijack(n,"dragend",i)),a.textselect(!0),i.click===!1&&i.dragging&&e.data(i.mousedown,"suppress.click",(new Date).getTime()+5),i.dragging=a.touched=!1}},hijack:function(r,n,i,s,o){if(i){var l,p,c,u={event:r.originalEvent,type:r.type},d=n.indexOf("drop")?"drag":"drop",h=s||0,f=isNaN(s)?i.interactions.length:s;r.type=n,r.originalEvent=null,i.results=[];do if(p=i.interactions[h]){if("dragend"!==n&&p.cancelled)continue;c=a.properties(r,i,p),p.results=[],e(o||p[d]||i.droppable).each(function(s,o){if(c.target=o,r.isPropagationStopped=function(){return!1},l=o?t.dispatch.call(o,r,c):null,l===!1?("drag"==d&&(p.cancelled=!0,i.propagates-=1),"drop"==n&&(p[d][s]=null)):"dropinit"==n&&p.droppable.push(a.element(l)||o),"dragstart"==n&&(p.proxy=e(a.element(l)||p.drag)[0]),p.results.push(l),delete r.result,"dropinit"!==n)return l}),i.results[h]=a.flatten(p.results),"dropinit"==n&&(p.droppable=a.flatten(p.droppable)),"dragstart"!=n||p.cancelled||c.update()}while(++h<f);return r.type=u.type,r.originalEvent=u.event,a.flatten(i.results)}},properties:function(e,t,r){var n=r.callback;return n.drag=r.drag,n.proxy=r.proxy||r.drag,n.startX=t.pageX,n.startY=t.pageY,n.deltaX=e.pageX-t.pageX,n.deltaY=e.pageY-t.pageY,n.originalX=r.offset.left,n.originalY=r.offset.top,n.offsetX=n.originalX+n.deltaX,n.offsetY=n.originalY+n.deltaY,n.drop=a.flatten((r.drop||[]).slice()),n.available=a.flatten((r.droppable||[]).slice()),n},element:function(e){if(e&&(e.jquery||1==e.nodeType))return e},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?a.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",a.dontstart).css("MozUserSelect",t?"":"none"),document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};a.callback.prototype={update:function(){r.drop&&this.available.length&&e.each(this.available,function(e){r.drop.locate(this,e)})}};var n=t.dispatch;t.dispatch=function(t){return e.data(this,"suppress."+t.type)-(new Date).getTime()>0?void e.removeData(this,"suppress."+t.type):n.apply(this,arguments)};var i=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,r){if(r){var a=r.touches&&r.touches[0]||r.changedTouches&&r.changedTouches[0]||null;a&&e.each(i.props,function(e,r){t[r]=a[r]})}return t}};r.draginit=r.dragstart=r.dragend=a}(jQuery),THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,r,a){var n=this,i=new THREE.XHRLoader(n.manager);i.setPath(this.path),i.load(e,function(e){t(n.parse(e))},r,a)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);this.object&&"function"==typeof this.object._finalize&&this.object._finalize();var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){return{index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:this.groupEnd,groupEnd:-1,groupCount:-1,inherited:!1}}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();return t&&t.groupEnd===-1&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e!==!1&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var a=r.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize()},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var a=this.vertices,n=this.object.geometry.vertices;n.push(a[e+0]),n.push(a[e+1]),n.push(a[e+2]),n.push(a[t+0]),n.push(a[t+1]),n.push(a[t+2]),n.push(a[r+0]),n.push(a[r+1]),n.push(a[r+2])},addVertexLine:function(e){var t=this.vertices,r=this.object.geometry.vertices;r.push(t[e+0]),r.push(t[e+1]),r.push(t[e+2])},addNormal:function(e,t,r){var a=this.normals,n=this.object.geometry.normals;n.push(a[e+0]),n.push(a[e+1]),n.push(a[e+2]),n.push(a[t+0]),n.push(a[t+1]),n.push(a[t+2]),n.push(a[r+0]),n.push(a[r+1]),n.push(a[r+2])},addUV:function(e,t,r){var a=this.uvs,n=this.object.geometry.uvs;n.push(a[e+0]),n.push(a[e+1]),n.push(a[t+0]),n.push(a[t+1]),n.push(a[r+0]),n.push(a[r+1])},addUVLine:function(e){var t=this.uvs,r=this.object.geometry.uvs;r.push(t[e+0]),r.push(t[e+1])},addFace:function(e,t,r,a,n,i,s,o,l,p,c,u){var d,h=this.vertices.length,f=this.parseVertexIndex(e,h),m=this.parseVertexIndex(t,h),g=this.parseVertexIndex(r,h);if(void 0===a?this.addVertex(f,m,g):(d=this.parseVertexIndex(a,h),this.addVertex(f,m,d),this.addVertex(m,g,d)),void 0!==n){var v=this.uvs.length;f=this.parseUVIndex(n,v),m=this.parseUVIndex(i,v),g=this.parseUVIndex(s,v),void 0===a?this.addUV(f,m,g):(d=this.parseUVIndex(o,v),this.addUV(f,m,d),this.addUV(m,g,d))}if(void 0!==l){var y=this.normals.length;f=this.parseNormalIndex(l,y),m=l===p?f:this.parseNormalIndex(p,y),g=l===c?f:this.parseNormalIndex(c,y),void 0===a?this.addNormal(f,m,g):(d=this.parseNormalIndex(u,y),this.addNormal(f,m,d),this.addNormal(m,g,d))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,a=this.uvs.length,n=0,i=e.length;n<i;n++)this.addVertexLine(this.parseVertexIndex(e[n],r));for(var s=0,i=t.length;s<i;s++)this.addUVLine(this.parseUVIndex(t[s],a))}};return e.startObject("",!1),e},parse:function(e){console.time("OBJLoader");var t=this._createParserState();e.indexOf("\r\n")!==-1&&(e=e.replace("\r\n","\n"));for(var r=e.split("\n"),a="",n="",i="",s=0,o=[],l="function"==typeof"".trimLeft,p=0,c=r.length;p<c;p++)if(a=r[p],a=l?a.trimLeft():a.trim(),s=a.length,0!==s&&(n=a.charAt(0),"#"!==n))if("v"===n)if(i=a.charAt(1)," "===i&&null!==(o=this.regexp.vertex_pattern.exec(a)))t.vertices.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else if("n"===i&&null!==(o=this.regexp.normal_pattern.exec(a)))t.normals.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));else{if("t"!==i||null===(o=this.regexp.uv_pattern.exec(a)))throw new Error("Unexpected vertex/normal/uv line: '"+a+"'");t.uvs.push(parseFloat(o[1]),parseFloat(o[2]))}else if("f"===n)if(null!==(o=this.regexp.face_vertex_uv_normal.exec(a)))t.addFace(o[1],o[4],o[7],o[10],o[2],o[5],o[8],o[11],o[3],o[6],o[9],o[12]);else if(null!==(o=this.regexp.face_vertex_uv.exec(a)))t.addFace(o[1],o[3],o[5],o[7],o[2],o[4],o[6],o[8]);else if(null!==(o=this.regexp.face_vertex_normal.exec(a)))t.addFace(o[1],o[3],o[5],o[7],void 0,void 0,void 0,void 0,o[2],o[4],o[6],o[8]);else{if(null===(o=this.regexp.face_vertex.exec(a)))throw new Error("Unexpected face line: '"+a+"'");t.addFace(o[1],o[2],o[3],o[4])}else if("l"===n){var u=a.substring(1).trim().split(" "),d=[],h=[];if(a.indexOf("/")===-1)d=u;else for(var f=0,m=u.length;f<m;f++){var g=u[f].split("/");""!==g[0]&&d.push(g[0]),""!==g[1]&&h.push(g[1])}t.addLineGeometry(d,h)}else if(null!==(o=this.regexp.object_pattern.exec(a))){var v=o[0].substr(1).trim();t.startObject(v)}else if(this.regexp.material_use_pattern.test(a))t.object.startMaterial(a.substring(7).trim(),t.materialLibraries);else if(this.regexp.material_library_pattern.test(a))t.materialLibraries.push(a.substring(7).trim());else{if(null===(o=this.regexp.smoothing_pattern.exec(a))){if("\0"===a)continue;throw new Error("Unexpected line: '"+a+"'")}var y=o[1].trim().toLowerCase();t.object.smooth="1"===y||"on"===y;var b=t.object.currentMaterial();b&&(b.smooth=t.object.smooth)}t.finalize();var P=new THREE.Group;P.materialLibraries=[].concat(t.materialLibraries);for(var p=0,c=t.objects.length;p<c;p++){var M=t.objects[p],C=M.geometry,w=M.materials,x="Line"===C.type;if(0!==C.vertices.length){var T=new THREE.BufferGeometry;T.addAttribute("position",new THREE.BufferAttribute(new Float32Array(C.vertices),3)),C.normals.length>0?T.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(C.normals),3)):T.computeVertexNormals(),C.uvs.length>0&&T.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(C.uvs),2));for(var E=[],k=0,S=w.length;k<S;k++){var O=w[k],b=void 0;if(null!==this.materials&&(b=this.materials.create(O.name),x&&b&&!(b instanceof THREE.LineBasicMaterial))){var R=new THREE.LineBasicMaterial;R.copy(b),b=R}b||(b=x?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,b.name=O.name),b.shading=O.smooth?THREE.SmoothShading:THREE.FlatShading,E.push(b)}var j;if(E.length>1){for(var k=0,S=w.length;k<S;k++){var O=w[k];T.addGroup(O.groupStart,O.groupCount,k)}var Z=new THREE.MultiMaterial(E);j=x?new THREE.Line(T,Z):new THREE.Mesh(T,Z)}else j=x?new THREE.Line(T,E[0]):new THREE.Mesh(T,E[0]);j.name=M.name,P.add(j)}}return console.timeEnd("OBJLoader"),P}},THREE.EditorControls=function(e,t){function r(e){l.enabled!==!1&&(e.preventDefault(),0===e.button?u=c.ROTATE:1===e.button?u=c.ZOOM:2===e.button&&(u=c.PAN),m.set(e.clientX,e.clientY),t.addEventListener("mousemove",a,!1),t.addEventListener("mouseup",n,!1),t.addEventListener("mouseout",n,!1),t.addEventListener("dblclick",n,!1))}function a(e){if(l.enabled!==!1){e.preventDefault(),f.set(e.clientX,e.clientY);var t=f.x-m.x,r=f.y-m.y;u===c.ROTATE?l.rotate(new THREE.Vector3(.005*-t,.005*-r,0)):u===c.ZOOM?l.zoom(new THREE.Vector3(0,0,r)):u===c.PAN&&l.pan(new THREE.Vector3((-t),r,0)),m.set(e.clientX,e.clientY)}}function n(e){t.removeEventListener("mousemove",a,!1),t.removeEventListener("mouseup",n,!1),t.removeEventListener("mouseout",n,!1),t.removeEventListener("dblclick",n,!1),u=c.NONE}function i(e){var t=0;e.wheelDelta?t=-e.wheelDelta:e.detail&&(t=10*e.detail),l.zoom(new THREE.Vector3(0,0,t))}function s(e){if(l.enabled!==!1){switch(e.touches.length){case 1:v[0].set(e.touches[0].pageX,e.touches[0].pageY,0),v[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:v[0].set(e.touches[0].pageX,e.touches[0].pageY,0),v[1].set(e.touches[1].pageX,e.touches[1].pageY,0),b=v[0].distanceTo(v[1])}y[0].copy(v[0]),y[1].copy(v[1])}}function o(e){if(l.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=function(e,t){var r=t[0];for(var a in t)r.distanceTo(e)>t[a].distanceTo(e)&&(r=t[a]);return r};switch(e.touches.length){case 1:v[0].set(e.touches[0].pageX,e.touches[0].pageY,0),v[1].set(e.touches[0].pageX,e.touches[0].pageY,0),l.rotate(v[0].sub(t(v[0],y)).multiplyScalar(-.005));break;case 2:v[0].set(e.touches[0].pageX,e.touches[0].pageY,0),v[1].set(e.touches[1].pageX,e.touches[1].pageY,0),distance=v[0].distanceTo(v[1]),l.zoom(new THREE.Vector3(0,0,b-distance)),b=distance;var r=v[0].clone().sub(t(v[0],y)),a=v[1].clone().sub(t(v[1],y));r.x=-r.x,a.x=-a.x,l.pan(r.add(a).multiplyScalar(.5))}y[0].copy(v[0]),y[1].copy(v[1])}}t=void 0!==t?t:document,this.enabled=!0,this.center=new THREE.Vector3;var l=this,p=new THREE.Vector3,c={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},u=c.NONE,d=this.center,h=new THREE.Matrix3,f=new THREE.Vector2,m=new THREE.Vector2,g={type:"change"};this.focus=function(t,r){var a=new THREE.Vector3;if(t.matrixWorld.decompose(d,new THREE.Quaternion,a),r&&t.geometry){a=(a.x+a.y+a.z)/3,d.add(t.geometry.boundingSphere.center.clone().multiplyScalar(a));var n=t.geometry.boundingSphere.radius*a,i=e.position.clone().sub(d).normalize().multiplyScalar(2*n);e.position.copy(d).add(i)}e.lookAt(d),l.dispatchEvent(g)},this.pan=function(t){h.getNormalMatrix(e.matrix),t.applyMatrix3(h),t.multiplyScalar(.001*p.copy(d).sub(e.position).length()),e.position.add(t),d.add(t),l.dispatchEvent(g)},this.zoom=function(t){h.getNormalMatrix(e.matrix),t.applyMatrix3(h),t.multiplyScalar(.001*p.copy(d).sub(e.position).length()),e.position.add(t),l.dispatchEvent(g)},this.rotate=function(t){p.copy(e.position).sub(d);var r=Math.atan2(p.x,p.z),a=Math.atan2(Math.sqrt(p.x*p.x+p.z*p.z),p.y);r+=t.x,a+=t.y;var n=1e-6;a=Math.max(n,Math.min(Math.PI-n,a));var i=p.length();p.x=i*Math.sin(a)*Math.sin(r),p.y=i*Math.cos(a),p.z=i*Math.sin(a)*Math.cos(r),e.position.copy(d).add(p),e.lookAt(d),l.dispatchEvent(g)},t.addEventListener("contextmenu",function(e){e.preventDefault()},!1),t.addEventListener("mousedown",r,!1),t.addEventListener("mousewheel",i,!1),t.addEventListener("DOMMouseScroll",i,!1);var v=(new THREE.Vector3,[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]),y=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],b=null;t.addEventListener("touchstart",s,!1),t.addEventListener("touchmove",o,!1)},THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EffectComposer=function(e,t,r){this.renderer=e;var a={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},n=new THREE.WebGLRenderTarget(t,r,a);this.renderTarget1=n,this.renderTarget2=n.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],this.bgPass=null,this.renderPass=null,this.copyPass=null},THREE.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var e,t,r=CM.fx.objects.length;for(this.bgPass&&(this.bgPass.render(this.renderer,this.writeBuffer,this.readBuffer,!0),this.renderer.clearTarget(this.writeBuffer,!1,!0,!0),this.swapBuffers()),this.renderPass.render(this.renderer,this.writeBuffer,this.readBuffer,null===this.bgPass),t=0;t<r;t++)e=CM.fx.objects[t].pass,e.enabled&&(e.render(this.renderer,this.writeBuffer,this.readBuffer,!1),e.needsSwap&&this.swapBuffers());this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer.texture,!1)},reset:function(e){void 0===e&&(e=this.renderTarget1.clone(),e.setSize(window.innerWidth,window.innerHeight)),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){var r=this.renderTarget1.clone();r.setSize(e,t),this.reset(r)}},THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(e,t){},render:function(e,t,r,a,n){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},THREE.RenderPass=function(e,t,r,a,n){this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=a,this.clearAlpha=void 0!==n?n:1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},THREE.RenderPass.prototype={render:function(e,t,r,a){this.scene.overrideMaterial=this.overrideMaterial,e.render(this.scene,this.camera,r,a),this.scene.overrideMaterial=null}},THREE.ShaderPass=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.material=e,this.uniforms=e.uniforms,this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.camera=new THREE.OrthographicCamera((-1),1,1,(-1),0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad)},THREE.ShaderPass.prototype={render:function(e,t,r,a){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,a)}},function(){var e=function(e){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(THREE.MeshBasicMaterial.prototype),e.prototype.constructor=e;var t=function(e){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(THREE.LineBasicMaterial.prototype),t.prototype.constructor=t;var r=new e({visible:!1,transparent:!1});THREE.TransformGizmo=function(){this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var e=new THREE.PlaneBufferGeometry(50,50,2,2),t=new THREE.MeshBasicMaterial({visible:!1,side:THREE.DoubleSide}),r={XY:new THREE.Mesh(e,t),YZ:new THREE.Mesh(e,t),XZ:new THREE.Mesh(e,t),XYZE:new THREE.Mesh(e,t)};this.activePlane=r.XYZE,r.YZ.rotation.set(0,Math.PI/2,0),r.XZ.rotation.set(-Math.PI/2,0,0);for(var a in r)r[a].name=a,this.planes.add(r[a]),this.planes[a]=r[a];var n=function(e,t){for(var r in e)for(a=e[r].length;a--;){var n=e[r][a][0],i=e[r][a][1],s=e[r][a][2];n.name=r,i&&n.position.set(i[0],i[1],i[2]),s&&n.rotation.set(s[0],s[1],s[2]),t.add(n)}};n(this.handleGizmos,this.handles),n(this.pickerGizmos,this.pickers),this.traverse(function(e){if(e instanceof THREE.Mesh){e.updateMatrix();var t=e.geometry.clone();t.applyMatrix(e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name===e?t.material.highlight(!0):t.material.highlight(!1))})}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo,THREE.TransformGizmo.prototype.update=function(e,t){var r=new THREE.Vector3(0,0,0),a=new THREE.Vector3(0,1,0),n=new THREE.Matrix4;this.traverse(function(i){i.name.search("E")!==-1?i.quaternion.setFromRotationMatrix(n.lookAt(t,r,a)):i.name.search("X")===-1&&i.name.search("Y")===-1&&i.name.search("Z")===-1||i.quaternion.setFromEuler(e)})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);var a=new THREE.Geometry,n=new THREE.Mesh(new THREE.CylinderGeometry(0,.05,.2,12,1,(!1)));n.position.y=.5,n.updateMatrix(),a.merge(n.geometry,n.matrix);var i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var s=new THREE.BufferGeometry;s.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var o=new THREE.BufferGeometry;o.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new THREE.Mesh(a,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new t({color:16711680}))]],Y:[[new THREE.Mesh(a,new e({color:65280})),[0,.5,0]],[new THREE.Line(s,new t({color:65280}))]],Z:[[new THREE.Mesh(a,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(o,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new e({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),r),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),r)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(e,t){var r=new THREE.Matrix4;t.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE),"XY"===e&&(this.activePlane=this.planes.XY),"YZ"===e&&(this.activePlane=this.planes.YZ),"XZ"===e&&(this.activePlane=this.planes.XZ)},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslate.prototype.constructor=THREE.TransformGizmoTranslate,THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);var e=function(e,t,r){var a=new THREE.BufferGeometry,n=[];r=r?r:1;for(var i=0;i<=64*r;++i)"x"===t&&n.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e),"y"===t&&n.push(Math.cos(i/32*Math.PI)*e,0,Math.sin(i/32*Math.PI)*e),"z"===t&&n.push(Math.sin(i/32*Math.PI)*e,Math.cos(i/32*Math.PI)*e,0);return a.addAttribute("position",new THREE.Float32Attribute(n,3)),a};this.handleGizmos={X:[[new THREE.Line(new e(1,"x",.5),new t({color:16711680}))]],Y:[[new THREE.Line(new e(1,"y",.5),new t({color:65280}))]],Z:[[new THREE.Line(new e(1,"z",.5),new t({color:255}))]],E:[[new THREE.Line(new e(1.25,"z",1),new t({color:13421568}))]],XYZE:[[new THREE.Line(new e(1,"z",1),new t({color:7895160}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.12,2,24),r)]],XYZE:[[new THREE.Mesh(new THREE.Geometry)]]},this.setActivePlane=function(e){"E"===e&&(this.activePlane=this.planes.XYZE),"X"===e&&(this.activePlane=this.planes.YZ),"Y"===e&&(this.activePlane=this.planes.XZ),"Z"===e&&(this.activePlane=this.planes.XY)},this.update=function(e,t){THREE.TransformGizmo.prototype.update.apply(this,arguments);
var r=({handles:this.handles,pickers:this.pickers},new THREE.Matrix4),a=new THREE.Euler(0,0,1),n=new THREE.Quaternion,i=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),o=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,p=new THREE.Quaternion,c=new THREE.Quaternion,u=t.clone();a.copy(this.planes.XY.rotation),n.setFromEuler(a),r.makeRotationFromQuaternion(n).getInverse(r),u.applyMatrix4(r),this.traverse(function(e){n.setFromEuler(a),"X"===e.name&&(l.setFromAxisAngle(i,Math.atan2(-u.y,u.z)),n.multiplyQuaternions(n,l),e.quaternion.copy(n)),"Y"===e.name&&(p.setFromAxisAngle(s,Math.atan2(u.x,u.z)),n.multiplyQuaternions(n,p),e.quaternion.copy(n)),"Z"===e.name&&(c.setFromAxisAngle(o,Math.atan2(u.y,u.x)),n.multiplyQuaternions(n,c),e.quaternion.copy(n))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate,THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);var a=new THREE.Geometry,n=new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125));n.position.y=.5,n.updateMatrix(),a.merge(n.geometry,n.matrix);var i=new THREE.BufferGeometry;i.addAttribute("position",new THREE.Float32Attribute([0,0,0,1,0,0],3));var s=new THREE.BufferGeometry;s.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,1,0],3));var o=new THREE.BufferGeometry;o.addAttribute("position",new THREE.Float32Attribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new THREE.Mesh(a,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new t({color:16711680}))]],Y:[[new THREE.Mesh(a,new e({color:65280})),[0,.5,0]],[new THREE.Line(s,new t({color:65280}))]],Z:[[new THREE.Mesh(a,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(o,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),r),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,(!1)),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.4,.4,.4),r)]]},this.setActivePlane=function(e,t){var r=new THREE.Matrix4;t.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE)},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale.prototype.constructor=THREE.TransformGizmoScale,THREE.TransformControls=function(e,t){function r(e){if(void 0!==o.object&&p!==!0&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e,r=s(t,c[l].pickers.children),a=null;r&&(a=r.object.name,e.preventDefault()),o.axis!==a&&(o.axis=a,o.update(),o.dispatchEvent(h))}}function a(e){if(void 0!==o.object&&p!==!0&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e;if(0===t.button||void 0===t.button){var r=s(t,c[l].pickers.children);if(r){e.preventDefault(),e.stopPropagation(),o.dispatchEvent(f),o.axis=r.object.name,o.update(),T.copy(G).sub(B).normalize(),c[l].setActivePlane(o.axis,T);var a=s(t,[c[l].activePlane]);a&&(L.copy(o.object.position),$.copy(o.object.scale),A.extractRotation(o.object.matrix),_.extractRotation(o.object.matrixWorld),D.extractRotation(o.object.parent.matrixWorld),N.setFromMatrixScale(E.getInverse(o.object.parent.matrixWorld)),P.copy(a.point))}}p=!0}}function n(e){if(void 0!==o.object&&null!==o.axis&&p!==!1&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e,r=s(t,[c[l].activePlane]);r!==!1&&(e.preventDefault(),e.stopPropagation(),b.copy(r.point),"translate"===l?(b.sub(P),b.multiply(N),"local"===o.space&&(b.applyMatrix4(E.getInverse(_)),o.axis.search("X")===-1&&(b.x=0),o.axis.search("Y")===-1&&(b.y=0),o.axis.search("Z")===-1&&(b.z=0),b.applyMatrix4(A),o.object.position.copy(L),o.object.position.add(b)),"world"!==o.space&&o.axis.search("XYZ")===-1||(o.axis.search("X")===-1&&(b.x=0),o.axis.search("Y")===-1&&(b.y=0),o.axis.search("Z")===-1&&(b.z=0),b.applyMatrix4(E.getInverse(D)),o.object.position.copy(L),o.object.position.add(b)),null!==o.translationSnap&&("local"===o.space&&o.object.position.applyMatrix4(E.getInverse(_)),o.axis.search("X")!==-1&&(o.object.position.x=Math.round(o.object.position.x/o.translationSnap)*o.translationSnap),o.axis.search("Y")!==-1&&(o.object.position.y=Math.round(o.object.position.y/o.translationSnap)*o.translationSnap),o.axis.search("Z")!==-1&&(o.object.position.z=Math.round(o.object.position.z/o.translationSnap)*o.translationSnap),"local"===o.space&&o.object.position.applyMatrix4(_))):"scale"===l?(b.sub(P),b.multiply(N),"local"===o.space&&("XYZ"===o.axis?(w=1+b.y/Math.max($.x,$.y,$.z),o.object.scale.x=$.x*w,o.object.scale.y=$.y*w,o.object.scale.z=$.z*w):(b.applyMatrix4(E.getInverse(_)),"X"===o.axis&&(o.object.scale.x=$.x*(1+b.x/$.x)),"Y"===o.axis&&(o.object.scale.y=$.y*(1+b.y/$.y)),"Z"===o.axis&&(o.object.scale.z=$.z*(1+b.z/$.z))))):"rotate"===l&&(b.sub(B),b.multiply(N),k.copy(P).sub(B),k.multiply(N),"E"===o.axis?(b.applyMatrix4(E.getInverse(x)),k.applyMatrix4(E.getInverse(x)),M.set(Math.atan2(b.z,b.y),Math.atan2(b.x,b.z),Math.atan2(b.y,b.x)),C.set(Math.atan2(k.z,k.y),Math.atan2(k.x,k.z),Math.atan2(k.y,k.x)),S.setFromRotationMatrix(E.getInverse(D)),I.setFromAxisAngle(T,M.z-C.z),Z.setFromRotationMatrix(_),S.multiplyQuaternions(S,I),S.multiplyQuaternions(S,Z),o.object.quaternion.copy(S)):"XYZE"===o.axis?(I.setFromEuler(b.clone().cross(k).normalize()),S.setFromRotationMatrix(E.getInverse(D)),H.setFromAxisAngle(I,-b.clone().angleTo(k)),Z.setFromRotationMatrix(_),S.multiplyQuaternions(S,H),S.multiplyQuaternions(S,Z),o.object.quaternion.copy(S)):"local"===o.space?(b.applyMatrix4(E.getInverse(_)),k.applyMatrix4(E.getInverse(_)),M.set(Math.atan2(b.z,b.y),Math.atan2(b.x,b.z),Math.atan2(b.y,b.x)),C.set(Math.atan2(k.z,k.y),Math.atan2(k.x,k.z),Math.atan2(k.y,k.x)),Z.setFromRotationMatrix(A),null!==o.rotationSnap?(H.setFromAxisAngle(O,Math.round((M.x-C.x)/o.rotationSnap)*o.rotationSnap),F.setFromAxisAngle(R,Math.round((M.y-C.y)/o.rotationSnap)*o.rotationSnap),U.setFromAxisAngle(j,Math.round((M.z-C.z)/o.rotationSnap)*o.rotationSnap)):(H.setFromAxisAngle(O,M.x-C.x),F.setFromAxisAngle(R,M.y-C.y),U.setFromAxisAngle(j,M.z-C.z)),"X"===o.axis&&Z.multiplyQuaternions(Z,H),"Y"===o.axis&&Z.multiplyQuaternions(Z,F),"Z"===o.axis&&Z.multiplyQuaternions(Z,U),o.object.quaternion.copy(Z)):"world"===o.space&&(M.set(Math.atan2(b.z,b.y),Math.atan2(b.x,b.z),Math.atan2(b.y,b.x)),C.set(Math.atan2(k.z,k.y),Math.atan2(k.x,k.z),Math.atan2(k.y,k.x)),S.setFromRotationMatrix(E.getInverse(D)),null!==o.rotationSnap?(H.setFromAxisAngle(O,Math.round((M.x-C.x)/o.rotationSnap)*o.rotationSnap),F.setFromAxisAngle(R,Math.round((M.y-C.y)/o.rotationSnap)*o.rotationSnap),U.setFromAxisAngle(j,Math.round((M.z-C.z)/o.rotationSnap)*o.rotationSnap)):(H.setFromAxisAngle(O,M.x-C.x),F.setFromAxisAngle(R,M.y-C.y),U.setFromAxisAngle(j,M.z-C.z)),Z.setFromRotationMatrix(_),"X"===o.axis&&S.multiplyQuaternions(S,H),"Y"===o.axis&&S.multiplyQuaternions(S,F),"Z"===o.axis&&S.multiplyQuaternions(S,U),S.multiplyQuaternions(S,Z),o.object.quaternion.copy(S))),o.update(),o.dispatchEvent(h),o.dispatchEvent(g))}}function i(e){e.preventDefault(),void 0!==e.button&&0!==e.button||(p&&null!==o.axis&&(m.mode=l,o.dispatchEvent(m)),p=!1,"TouchEvent"in window&&e instanceof TouchEvent?(o.axis=null,o.update(),o.dispatchEvent(h)):r(e))}function s(r,a){var n=t.getBoundingClientRect(),i=(r.clientX-n.left)/n.width,s=(r.clientY-n.top)/n.height;y.set(2*i-1,-(2*s)+1),v.setFromCamera(y,e);var o=v.intersectObjects(a,!0);return!!o[0]&&o[0]}THREE.Object3D.call(this),t=void 0!==t?t:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var o=this,l="translate",p=!1,c={translate:new THREE.TransformGizmoTranslate,rotate:new THREE.TransformGizmoRotate,scale:new THREE.TransformGizmoScale};for(var u in c){var d=c[u];d.visible=u===l,this.add(d)}var h={type:"change"},f={type:"mouseDown"},m={type:"mouseUp",mode:l},g={type:"objectChange"},v=new THREE.Raycaster,y=new THREE.Vector2,b=new THREE.Vector3,P=new THREE.Vector3,M=new THREE.Vector3,C=new THREE.Vector3,w=1,x=new THREE.Matrix4,T=new THREE.Vector3,E=new THREE.Matrix4,k=new THREE.Vector3,S=new THREE.Quaternion,O=new THREE.Vector3(1,0,0),R=new THREE.Vector3(0,1,0),j=new THREE.Vector3(0,0,1),Z=new THREE.Quaternion,H=new THREE.Quaternion,F=new THREE.Quaternion,U=new THREE.Quaternion,I=new THREE.Quaternion,L=new THREE.Vector3,$=new THREE.Vector3,A=new THREE.Matrix4,D=new THREE.Matrix4,N=new THREE.Vector3,B=new THREE.Vector3,z=new THREE.Euler,_=new THREE.Matrix4,G=new THREE.Vector3,V=new THREE.Euler;t.addEventListener("mousedown",a,!1),t.addEventListener("touchstart",a,!1),t.addEventListener("mousemove",r,!1),t.addEventListener("touchmove",r,!1),t.addEventListener("mousemove",n,!1),t.addEventListener("touchmove",n,!1),t.addEventListener("mouseup",i,!1),t.addEventListener("mouseout",i,!1),t.addEventListener("touchend",i,!1),t.addEventListener("touchcancel",i,!1),t.addEventListener("touchleave",i,!1),this.dispose=function(){t.removeEventListener("mousedown",a),t.removeEventListener("touchstart",a),t.removeEventListener("mousemove",r),t.removeEventListener("touchmove",r),t.removeEventListener("mousemove",n),t.removeEventListener("touchmove",n),t.removeEventListener("mouseup",i),t.removeEventListener("mouseout",i),t.removeEventListener("touchend",i),t.removeEventListener("touchcancel",i),t.removeEventListener("touchleave",i)},this.attach=function(e){this.object=e,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return l},this.setMode=function(e){l=e?e:l,"scale"===l&&(o.space="local");for(var t in c)c[t].visible=t===l;this.update(),o.dispatchEvent(h)},this.setTranslationSnap=function(e){o.translationSnap=e},this.setRotationSnap=function(e){o.rotationSnap=e},this.setSize=function(e){o.size=e,this.update(),o.dispatchEvent(h)},this.setSpace=function(e){o.space=e,this.update(),o.dispatchEvent(h)},this.update=function(){void 0!==o.object&&(o.object.updateMatrixWorld(),B.setFromMatrixPosition(o.object.matrixWorld),z.setFromRotationMatrix(E.extractRotation(o.object.matrixWorld)),e.updateMatrixWorld(),G.setFromMatrixPosition(e.matrixWorld),V.setFromRotationMatrix(E.extractRotation(e.matrixWorld)),w=B.distanceTo(G)/6*o.size,this.position.copy(B),this.scale.set(w,w,w),T.copy(G).sub(B).normalize(),"local"===o.space?c[l].update(z,T):"world"===o.space&&c[l].update(new THREE.Euler,T),c[l].highlight(o.axis))}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformControls.prototype.constructor=THREE.TransformControls}(),THREE.TTFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.reversed=!1},THREE.TTFLoader.prototype.load=function(e,t,r,a){var n=this,i=new THREE.XHRLoader(this.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){void 0!==t&&t(n.parse(e))},r,a)},THREE.TTFLoader.prototype.parse=function(e){function t(e,t){for(var a=Math.round,n={},i=1e5/(72*(e.unitsPerEm||2048)),s=0;s<e.glyphs.length;s++){var o=e.glyphs.glyphs[s];if(void 0!==o.unicode){var l={ha:a(o.advanceWidth*i),x_min:a(o.xMin*i),x_max:a(o.xMax*i),o:""};t&&(o.path.commands=r(o.path.commands)),o.path.commands.forEach(function(e,t){"c"===e.type.toLowerCase()&&(e.type="b"),l.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(l.o+=a(e.x*i)+" "+a(e.y*i)+" "),void 0!==e.x1&&void 0!==e.y1&&(l.o+=a(e.x1*i)+" "+a(e.y1*i)+" "),void 0!==e.x2&&void 0!==e.y2&&(l.o+=a(e.x2*i)+" "+a(e.y2*i)+" ")}),n[String.fromCharCode(o.unicode)]=l}}return{glyphs:n,familyName:e.familyName||e.tables.name.fontFamily.en,ascender:a(e.ascender*i),descender:a(e.descender*i),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}function r(e){var t,r=[];e.forEach(function(e){"m"===e.type.toLowerCase()?(t=[e],r.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)});var a=[];return r.forEach(function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};a.push(t);for(var r=e.length-1;r>0;r--){var n=e[r],t={type:n.type};void 0!==n.x2&&void 0!==n.y2?(t.x1=n.x2,t.y1=n.y2,t.x2=n.x1,t.y2=n.y1):void 0!==n.x1&&void 0!==n.y1&&(t.x1=n.x1,t.y1=n.y1),t.x=e[r-1].x,t.y=e[r-1].y,a.push(t)}}),a}return"undefined"==typeof opentype?(console.warn("TTFLoader requires opentype.js Make sure it's included before using the loader"),null):t(opentype.parse(e),this.reversed)};var PZ={downloadBlob:null};PZ.imageToArray=function(e,t,r){var a=document.createElement("canvas");a.width=e.width,a.height=e.height;var n=a.getContext("2d");if(n.drawImage(e,0,0),r){for(var i=n.getImageData(0,0,a.width,a.height),s=0;s<i.length&&!(i.data[s+3]<255);s+=4);s>=i.length&&(r=!1)}PZ.canvasToArray(a,t,r)},PZ.canvasToArray=function(e,t,r){PZ.canvasToBlob(e,function(e){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsArrayBuffer(e)},r)},PZ.canvasToBlob=function(e,t,r){var a=r?"image/png":"image/jpeg";if("undefined"!=typeof e.toBlob)e.toBlob(t,a,.85);else if("undefined"!=typeof e.msToBlob){var n=e.msToBlob();t(n)}else{for(var i=e.toDataURL(a,.85),s=atob(i.substring(22)),o=new Uint8Array(s.length),l=0,p=s.length;l<p;++l)o[l]=s.charCodeAt(l);t(new Blob([o]))}},PZ.extend=function(e,t){for(var r in t)if("object"==typeof e[r]&&Array.isArray(e[r])===!1)for(var a in t[r])t[r].hasOwnProperty(a)!==!1&&(e[r][a]=t[r][a]);else e[r]=t[r]},PZ.getParameterByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=t.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},PZ.editor={},PZ.editor.generateSpacer=function(){return $("<div>",{class:"proprow spacer"})},PZ.editor.generatePlaceholder=function(){return $("<div>")},PZ.editor.generateTitle=function(e){var t=$("<div>",{class:"proprow proptitle"});if(t.append($("<span>",{class:"proplabel"}).append(e.title).css("font-size","18px").css("font-weight","bold")),e.randomize){var r=$("<div>",{class:"propcol"}),a=$("<a>",{style:"cursor:pointer;margin:0;",title:"randomize"}).on("click",e.randomize);PZ.editor.generateIcon("random").attr("style","width:30px;height:30px;fill:#ccc;pointer-events:none").appendTo(a);r.append(a),t.append(r)}return t},PZ.editor.generateDescription=function(e,t){var r=$("<div>",{class:"proprow",style:"padding: 10px 10px;cursor:default;"}),a=$("<span>").appendTo(r);return r.on("update",function(){var r=e.get?e.get.call(t):e.content;a.html(r)}),r.triggerHandler("update"),r},PZ.editor.showEaseDropDown=function(e){var t=PZ.editor.easeDropDown;if("undefined"==typeof PZ.editor.easeDropDown){t=PZ.editor.easeDropDown=$("<ul>",{class:"pz-dropdown",tabindex:"-1"}).keydown(function(e){if(27===e.which)$(this).blur(),e.preventDefault();else if(13===e.which)$(this).data("input").set($(this).children(".pz-active").first().index()),$(this).blur(),e.preventDefault();else if(38===e.which){var r=$(this).children(".pz-active"),a=r.prev();if(!a.length)return;r.removeClass("pz-active"),a.addClass("pz-active"),t.scrollTo(a.index()),e.preventDefault()}else if(40===e.which){var r=$(this).children(".pz-active"),n=r.next();if(!n.length)return;r.removeClass("pz-active"),n.addClass("pz-active"),t.scrollTo(n.index()),e.preventDefault()}}),$.extend(PZ.editor.easeDropDown,{scrollTo:function(e){var t=this.children().first().outerHeight(),r=this.scrollTop();(t*e<r||t*(e+1)>r+this.innerHeight())&&this.scrollTop(t*e)}});for(var r=0;r<TWEEN.EasingList.length;r++)PZ.editor.easeDropDown.append($("<li>").append(PZ.editor.generateIcon("ease_"+r)).append($("<span>").append(TWEEN.EasingList[r].name)).mouseenter(function(){$(this).addClass("pz-active").siblings().removeClass("pz-active")}).click(function(){$(this).parent().data("input").set($(this).index()),$(this).parent().blur()}));PZ.editor.easeDropDown.on("blur",function(){$(this).hide()}),$("body").append(PZ.editor.easeDropDown)}PZ.editor.easeDropDown.show();var a=0,n=PZ.editor.easeDropDown.outerWidth(),i=PZ.editor.easeDropDown.outerHeight(),s=e.outerHeight(),o=PZ.editor.easeDropDown[0].ownerDocument,l=o.documentElement,p=l.clientWidth+$(o).scrollLeft(),c=l.clientHeight+$(o).scrollTop(),u=e.offset();u.top+=s,u.left-=Math.min(u.left,u.left+n>p&&p>n?Math.abs(u.left+n-p):0),u.top-=Math.min(u.top,u.top+i>c&&c>i?Math.abs(i+s-a):a),PZ.editor.easeDropDown.offset(u),PZ.editor.easeDropDown.children(".pz-active").removeClass("pz-active"),PZ.editor.easeDropDown.children().eq(e.value).addClass("pz-active"),t.scrollTo(e.value),PZ.editor.easeDropDown.data("input",e),PZ.editor.easeDropDown.focus()},PZ.editor.generateKeyframeToolbar=function(e,t){var r=$("<div>",{class:"editbox",style:"height:32px"}),a=$("<a>",{class:"pz-tweens",title:"interpolation"}).click(function(){var e=a;e.set(0===e.value?1:0)});PZ.editor.generateIcon("interp_0").attr("style","width:35px;height:23px;pointer-events:none").appendTo(a);var n=$("<a>",{class:"pz-tweens",title:"easing"}).click(function(){PZ.editor.showEaseDropDown(n)});$.extend(a,{set:function(r){this.update(r<<8,!0),e.set.call(t,a.value<<8|n.value,-1)},update:function(e,t){var r=this;t===!1?r.css("visibility","hidden"):(r.value=e>>8,r.css("visibility","visible"),PZ.editor.switchIcon(r.children().first(),"interp_"+r.value))},value:0}),$.extend(n,{set:function(r){this.update(r,!0),e.set.call(t,a.value<<8|n.value,-1)},update:function(e,t){var r=this;t===!1?r.css("visibility","hidden"):(r.value=255&e,r.css("visibility","visible"),PZ.editor.switchIcon(r.children().first(),"ease_"+r.value))},value:0}),PZ.editor.generateIcon("ease_1").attr("style","width:35px;height:23px;pointer-events:none").appendTo(n),e.tweens&&(r.append(a),r.append(n));var i=$("<a>",{style:"display: inline-block;margin-top:5px;margin-left:10px;vertical-align:top;cursor: pointer;",title:"add keyframe"}).click(function(){e.set.call(t),r.parent().parent().triggerHandler("update")}).appendTo(r),s=PZ.editor.generateIcon("add").attr("style","width:17px;height:17px;fill:#ccc;pointer-events:none").appendTo(i);return r.on("update",function(e,t){var r="undefined"!=typeof t;PZ.editor.switchIcon(s,r?"remove":"add"),r?t===-1?(i.css("visibility","hidden"),a.update(0,!1),n.update(0,!1)):(i.css("visibility","visible"),i.attr("title","delete keyframe"),a.update(t,!0),n.update(t,!0)):(i.css("visibility","visible"),i.attr("title","add keyframe"),a.update(0,!1),n.update(0,!1))}),r},PZ.editor.generateInput=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<div>",{class:"propcol"});if(r.append($("<span>",{class:"proplabel"}).append(e.title)),"undefined"!=typeof e.keyframed){r.attr("kf","1");var n=PZ.editor.generateKeyframeToolbar(e,t);n.appendTo(a)}var i=$("<input>",{class:"pzinput"});return a.append(i),r.append(a),i.pzinput({change:function(r){e.set.call(t,parseFloat(r),0)},max:e.vmax,min:e.vmin,step:e.vstep,decimals:e.decimals,dragstep:e.dragstep}),r.on("update",function(){var r=e.get.call(t);if("undefined"==typeof r)i.css("visibility","hidden"),"undefined"!=typeof n&&n.triggerHandler("update");else{if(e.keyframed){var a=r.frame===PZ.keyframes.getFrame()?r.tweenfn:void 0;n.triggerHandler("update",a),r=r.value}i.val(r.toFixed(e.decimals)),i.css("visibility","visible")}}),r.triggerHandler("update"),r},PZ.editor.generateGradientPicker=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<div>",{class:"propcol"});r.append($("<span>",{class:"proplabel"}).append(e.title));var n=$("<div>");return a.append(n),r.append(a),n.gradientPicker({change:function(r,a){e.set.call(t,r.slice())},generateStyles:"false"}),r.on("update",function(){n.gradientPicker("update",{controlPoints:e.get.call(t).slice()})}),r.triggerHandler("update"),r},PZ.editor.generateFileUpload=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<div>",{class:"propcol"});r.append($("<span>",{class:"proplabel"}).append(e.title));var n=$("<a>",{style:"margin: 3px 0;display: inline-block;cursor: pointer;"}).append("select").on("click",function(){i.trigger("click")}),i=$("<input>",{type:"file",style:"height:0px;width:0px;overflow:hidden;"}).change(function(r){e.set.call(t,this)});return e.accept&&i.attr("accept",e.accept),e.multiple&&i.attr("multiple","true"),r.append(i),a.append(n),r.append(a),r},PZ.editor.generateDualInput=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<div>",{class:"propcol"});if(r.append($("<span>",{class:"proplabel"}).append(e.title)),"undefined"!=typeof e.keyframed){r.attr("kf","1");var n=PZ.editor.generateKeyframeToolbar(e,t);n.appendTo(a)}var i=$("<input>",{class:"pzinput"}),s=$("<input>",{class:"pzinput"}),o=$("<div>",{style:"text-align:right"});return o.append($("<div>").append(e.subtitle1+" ").append(i)),o.append($("<div>").append(e.subtitle2+" ").append(s)),a.append(o),r.append(a),e.positionButtons&&(r.append($("<a>",{class:"positionButton pointerButton",title:"position with cursor"}).click(function(){null!==draggingObject&&(draggingObject=null),$("#c_backgrounder").css("cursor","crosshair"),positioningCrosshair=!0,positioningFunction=function(e,t){$input.val(e),s.val(t),updatefn1(e),updatefn2(t),positioningCrosshair=!1,$("#c_backgrounder").css("cursor","default")}})),r.append($("<a>",{class:"positionButton centerButton",title:"move to center"}).click(function(){null!==draggingObject&&(draggingObject=null),positioningCrosshair=!1,$input.val(Math.floor(.5*fullImgWidth)),s.val(Math.floor(.5*fullImgHeight)),updatefn1(Math.floor(.5*fullImgWidth)),updatefn2(Math.floor(.5*fullImgHeight))}))),i.pzinput({change:function(r){e.set.call(t,parseFloat(r),0)},max:e.vmax,min:e.vmin,step:e.vstep,decimals:e.decimals,dragstep:e.dragstep}),s.pzinput({change:function(r){e.set.call(t,parseFloat(r),1)},max:e.vmax,min:e.vmin,step:e.vstep,decimals:e.decimals,dragstep:e.dragstep}),r.on("update",function(){var r=e.get.call(t);if("undefined"==typeof r)o.css("visibility","hidden"),"undefined"!=typeof n&&n.triggerHandler("update");else{if(e.keyframed){var a=r.frame===PZ.keyframes.getFrame()?r.tweenfn:void 0;n.triggerHandler("update",a),r=r.value}i.val(r.x.toFixed(e.decimals)),s.val(r.y.toFixed(e.decimals)),o.css("visibility","visible")}}),r.triggerHandler("update"),r},PZ.editor.generateTriInput=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<div>",{class:"propcol"});if(r.append($("<span>",{class:"proplabel"}).append(e.title)),"undefined"!=typeof e.keyframed){r.attr("kf","1");var n=PZ.editor.generateKeyframeToolbar(e,t);n.appendTo(a)}var i=$("<div>",{class:"editbox"}),s=$("<input>",{class:"pzinput"}).appendTo(i),o=$("<input>",{class:"pzinput"}).appendTo(i),l=$("<input>",{class:"pzinput"}).appendTo(i);return a.append(i),r.append(a),s.pzinput({change:function(r){e.set.call(t,parseFloat(r),0)},max:e.vmax,min:e.vmin,step:e.vstep,decimals:e.decimals,dragstep:e.dragstep}),o.pzinput({change:function(r){e.set.call(t,parseFloat(r),1)},max:e.vmax,min:e.vmin,step:e.vstep,decimals:e.decimals,dragstep:e.dragstep}),l.pzinput({change:function(r){e.set.call(t,parseFloat(r),2)},max:e.vmax,min:e.vmin,step:e.vstep,decimals:e.decimals,dragstep:e.dragstep}),r.on("update",function(){var r=e.get.call(t);if("undefined"==typeof r)i.css("visibility","hidden"),"undefined"!=typeof n&&n.triggerHandler("update");else{if(e.keyframed){var a=r.frame===PZ.keyframes.getFrame()?r.tweenfn:void 0;n.triggerHandler("update",a),r=r.value}s.val(r.x.toFixed(e.decimals)),o.val(r.y.toFixed(e.decimals)),l.val(r.z.toFixed(e.decimals)),i.css("visibility","visible")}}),r.triggerHandler("update"),r},PZ.editor.generateDropdownAdd=function(e,t){function r(r){var i=$(this).index(),s=e.items[i];if(!s.list||s.hidelist&&!r.ctrlKey)e.addfn.call(t,i,0),a.detach();else{n.hide();for(var o=$("<ul>",{class:"pz-options"}).insertAfter(n),l=0;l<s.list.length;l++)o.append($("<li>").append(s.list[l].name).click(function(){e.addfn.call(t,i,$(this).index()),a.detach(),n.siblings("ul").remove(),n.show()}))}}var a=$("<div>").attr("style","position:absolute;left: 0;right: 0;top: 0;bottom: 0;background-color:#1d1d1d;"),n=$("<ul>",{class:"pz-options",style:"overflow-y:auto;left:0;right:0;bottom:0;position:absolute;top:35px;"});a.append($("<a>",{class:"proprow propbutton"}).append("Cancel").click(function(){a.detach(),n.siblings("ul").remove(),n.show()})),a.append(n);for(var i=0;i<e.items.length;i++)e.items[i].category===!0?n.append($("<span>").append(e.items[i].name)):n.append($("<li>").append(e.items[i].name).append($("<span>").text(e.items[i].desc)).click(r));var s=$("<a>",{class:"proprow propbutton"}).append(PZ.editor.generateIcon("add").attr("style","display:inline-block;margin-right:10px;position:relative;top:2px;fill:#ccc;width:15px;height:15px;pointer-events:none")).append($("<span>").append(e.title)).click(function(){s.parent().append(a)});return s},PZ.editor.generateDropdown=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<div>",{class:"propcol"});r.append($("<span>",{class:"proplabel"}).append(e.title));var n=$("<select>",{class:"pz-inputbox"}).change(function(){e.set.call(t,parseInt(this.value)-1,0)});if("undefined"!=typeof e.keyframed){r.attr("kf","1");var i=PZ.editor.generateKeyframeToolbar(e,t);i.appendTo(a)}a.append(n),r.append(a);for(var s=e.items.split(";"),o=0;o<s.length;++o)n.append($("<option>",{value:o+1}).append(s[o]));return r.on("update",function(){var r=e.get.call(t);if("undefined"==typeof r)n.css("visibility","hidden"),"undefined"!=typeof i&&i.triggerHandler("update");else{if(e.keyframed){var a=r.frame===PZ.keyframes.getFrame()?r.tweenfn:void 0;i.triggerHandler("update",a),r=r.value}n.prop("selectedIndex",r),n.css("visibility","visible")}}),r.triggerHandler("update"),r},PZ.editor.generateButton=function(e,t){var r=$("<a>",{class:"proprow propbutton"}).append($("<span>").append(e.title)).on("click",e.clickfn.bind(t));return r},PZ.editor.generateFontPicker=function(e,t){for(var r,a=$("<div>",{class:"proprow"}),n=$("<ul>",{class:"selectorList"}),i=0;i<e.fonts.length;i++){var s=$("<li>",{class:"presetfonts"});s.append($("<span>",{style:"font-family: "+e.fonts[i],font:e.fonts[i]}).append(e.fonts[i]).lazyload({container:n})),s.click(function(){$(this).addClass("selected").siblings().removeClass("selected"),e.updatefn($(this).children().attr("font"))}),n.append(s),e.fonts[i]==e.property&&(s.addClass("selected"),r=s)}return a.append(n),n.scrollTop(r.position().top-55),a},PZ.editor.generateListPicker=function(e,t){for(var r,a=$("<div>",{class:"proprow"}),n=$("<ul>",{class:"selectorList"}),i=0;i<e.items.length;i++){var s=$("<li>",{class:"presetfonts"});s.append($("<span>",{item:e.items[i]}).append(e.items[i])),s.click(function(){$(this).addClass("selected").siblings().removeClass("selected"),e.updatefn($(this).children().attr("item"))}),n.append(s),e.items[i]==e.property&&(s.addClass("selected"),r=s)}return a.append(n),n.scrollTop(r.position().top-55),a},PZ.editor.generateTextInput=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<input>",{style:"box-sizing:border-box;width:100%;display:block;margin:auto;margin: 5px 0;padding:5px;",class:"pz-inputbox"}).on("change",function(){e.set.call(t,this.value)}).on("keydown",function(e){return 13!=e.which||(this.blur(),!1)});return r.on("update",function(){a.val(e.get.call(t))}),r.triggerHandler("update"),r.append(a),r},PZ.editor.generateTextArea=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<textarea>",{rows:"9",class:"pz-textarea"}).on("change",function(){e.set.call(t,this.value)}).appendTo(r);return r.on("update",function(){a.val(e.get.call(t))}),r.triggerHandler("update"),r},PZ.editor.generateColorPicker=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<div>",{class:"propcol"});r.append($("<span>",{class:"proplabel"}).append(e.title));var n=$("<input>",{type:"text"});if("undefined"!=typeof e.keyframed){r.attr("kf","1");var i=PZ.editor.generateKeyframeToolbar(e,t);i.appendTo(a)}var s=$("<div>").append(n);return a.append(s),r.append(a),n.spectrum({flat:!1,showInput:!0,showInitial:!0,allowEmpty:!1,showAlpha:e.hasalpha,disabled:!1,showPalette:!0,clickoutFiresChange:!0,preferredFormat:"RGBA",change:function(r){e.set.call(t,r)}}),r.on("update",function(){n.spectrum("set",e.get.call(t))}),r.on("update",function(){var r=e.get.call(t);if("undefined"==typeof r)s.css("visibility","hidden"),"undefined"!=typeof i&&i.triggerHandler("update");else{if(e.keyframed){var a=r.frame===PZ.keyframes.getFrame()?r.tweenfn:void 0;i.triggerHandler("update",a),r=r.value.getHexString()}n.spectrum("set",r),s.css("visibility","visible")}}),r.triggerHandler("update"),r},PZ.editor.generateList=function(e){return $("<ul>",{class:"pz-listbox"})},PZ.editor.generateListItem=function(e){var t=$("<li>");return e.isgroup&&t.attr("group","1"),t.click(e.selectfn),t.append($("<span>").text("unnamed object")),t.append($("<a>",{title:"delete"}).append(PZ.editor.generateIcon("remove").attr("style","width:15px;height:15px;fill:#ccc;pointer-events:none;")).click(e.deletefn)),t.append($("<a>",{title:"duplicate"}).append(PZ.editor.generateIcon("duplicate").attr("style","width:15px;height:15px;fill:#ccc;pointer-events:none;")).click(e.clonefn)),t},PZ.editor.generateProgressbar=function(e,t){var r=$("<div>",{class:"proprow"}),a=$("<span>");return r.append($("<div>",{class:"pz-progress"}).append(a)),r.on("update",function(){a.css("width",e.get.call(t)+"%")}),r.triggerHandler("update"),r},PZ.editor.generateIcon=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","use");return r.setAttributeNS("http://www.w3.org/1999/xlink","href","/img/pz.icons8.svg#"+e),t.appendChild(r),$(t)},PZ.editor.switchIcon=function(e,t){e.children().first().attr("href","/img/pz.icons8.svg#"+t)},PZ.editor.elevator_init=function(e,t,r){$("<a>",{title:"Menu"}).append(PZ.editor.generateIcon("menu")).click(!0,PZ.editor.elevator_button).prependTo("#elevator");for(var a=0;a<e.length;a++)$("<a>",{title:e[a].title}).append(PZ.editor.generateIcon(e[a].sprite)).append($("<span>").text(e[a].title)).appendTo("#elevatortabs"),$("#controls").append($("<div>").hide());$("#elevatortabs a").click(!1,PZ.editor.elevator_button),PZ.editor.elevator_changetab(0)},PZ.editor.elevator_open=function(){$("#elevator").animate({width:"300px"},200,"swing"),$("#elevatortabs").css("overflow-y","auto")},PZ.editor.elevator_close=function(){$("#elevator").animate({width:"60px"},100,"swing"),$("#elevatortabs").css("overflow-y","hidden")},PZ.editor.elevator_button=function(e){if(this.disabled!==!0){var t=$(e.delegateTarget),r=t.index();e.data===!0?$("#elevator").width()<100?PZ.editor.elevator_open():PZ.editor.elevator_close():(PZ.editor.elevator_changetab(r),PZ.editor.elevator_close())}},PZ.editor.elevator_changetab=function(e){var t=$("#elevatortabs a.el-selected");t.index()!==e&&(t.removeClass("el-selected"),$("#elevator a").eq(e+1).addClass("el-selected"),$("#controls").children().hide(),$("#controls").children().eq(e).show(),$("#elevatortabs").animate({scrollTop:50*(e-1)+"px"},100,"swing"),void 0===$("#controls").children().eq(e).data("loaded")&&($("#elevator").trigger("tabload",[e,$("#controls").children().eq(e)]),$("#controls").children().eq(e).data("loaded",!0)),$("#elevator").trigger("tabchanged",e))},PZ.editor.elevator_tablock=function(e,t){$("#elevator a").eq(e+1).siblings().css("visibility",t===!0?"collapse":"visible")},PZ.editor.elevator_unloadtab=function(e){
$("#controls").children().eq(e).children().remove(),$("#controls").children().eq(e).removeData("loaded")},PZ.random={},PZ.random.number=function(e,t,r){var a=Math.random()*(t-e+(r?1:0))+e;return r&&(a=Math.floor(a)),a},PZ.random.normal=function(e,t){for(var r=5,a=0,n=0;n<r;n++)a+=Math.random();return t*(a-r/2)/(r/2)+e},PZ.random.color=function(e){var t="rgba(";return t+=this.number(0,255,!0)+", "+this.number(0,255,!0)+", "+this.number(0,255,!0)+", "+(e?this.number(0,1):1),t+=")"},PZ.random.grayColor=function(e){var t="rgba(",r=this.number(0,255,!0);return t+=r+", "+r+", "+r+", "+(e?this.number(0,1):1),t+=")"},PZ.feedback={type:0,message:"",lastSent:null},PZ.feedback.select=function(e){var t=this;PZ.editor.generateTitle({title:"What do you think?"}).appendTo(e),PZ.editor.generateDescription({content:"Your feedback is always appreciated and is used to improve the site."}).appendTo(e),PZ.editor.generateSpacer().appendTo(e);var r,a,n,i,s;r=PZ.editor.generateDropdown({title:"Type",items:"Suggestion;Problem;Comment;Question",get:function(){return t.type},set:function(e){t.type=e,3===e?(a.hide(),n.show()):(a.show(),n.hide())}}).appendTo(e),a=PZ.editor.generatePlaceholder().appendTo(e),PZ.editor.generateTextArea({get:function(){return t.message},set:function(e){t.message=e}}).appendTo(a),PZ.editor.generateSpacer().appendTo(a),PZ.editor.generateButton({title:"Send your feedback",clickfn:function(){if(!(t.message.length<10||t.message.length>1500||null!==t.lastSent&&Date.now()-t.lastSent<1e4)){t.lastSent=Date.now(),r.hide(),a.hide();var e=0;"undefined"==typeof BG&&(e="undefined"==typeof CM?2:1),$.ajax({type:"POST",url:"/sendfeedback",data:{feedbackSource:e,feedbackType:t.type,feedbackCategory:0,toolVersion:"2.0.157",message:t.message},success:function(){i.show()},error:function(){s.show()}})}}}).appendTo(a),n=PZ.editor.generateDescription({content:'Please <a target="_blank" href="/forum">visit the forum</a> to ask your questions as we cannot respond directly to feedback.'}).hide().appendTo(e),i=PZ.editor.generatePlaceholder().hide().appendTo(e),PZ.editor.generateDescription({content:'Thanks! Your feedback was sent.<br /><br />Still need help? <a target="_blank" href="/forum">Visit the forum</a> if you have questions or need assistance.'}).appendTo(i),PZ.editor.generateSpacer().appendTo(i),PZ.editor.generateButton({title:"Send more feedback",clickfn:function(){t.type=0,t.message="",r.trigger("update"),a.children().trigger("update"),r.show(),a.show(),i.hide()}}).appendTo(i),s=PZ.editor.generateDescription({content:"Sorry, your feedback could not be sent. Please try again later."}).hide().appendTo(s)},PZ.shaders={materials:{},vertexShader:THREE.CopyShader.vertexShader},PZ.shaders.load=function(e,t,r,a,n){var i="/assets/shaders/fragment/"+e+".glsl";return PZ.shaders.materials[e]?PZ.shaders.materials[e].ref+=1:void 0!==n?(PZ.shaders.materials[e]={},PZ.shaders.materials[e].shader=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(t),vertexShader:PZ.shaders.vertexShader,fragmentShader:n,transparent:void 0===r,lights:void 0!==a}),PZ.shaders.materials[e].ref=1):$.ajax({url:i+"?v=2.0.157",dataType:"text",async:!1,cache:!0,success:function(n){PZ.shaders.materials[e]={},PZ.shaders.materials[e].shader=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(t),vertexShader:PZ.shaders.vertexShader,fragmentShader:n,transparent:void 0!==r,lights:void 0!==a}),PZ.shaders.materials[e].ref=1}}),PZ.shaders.materials[e].shader.clone()},PZ.shaders.unload=function(e){PZ.shaders.materials[e].ref-=1,PZ.shaders.materials[e].ref<=0&&(PZ.shaders.materials[e].shader.dispose(),delete PZ.shaders.materials[e])},PZ.keyframes={},PZ.keyframes.update=null,PZ.keyframes.getFrame=null,PZ.keyframes.get=function(e,t){"undefined"==typeof t&&(t=this.getFrame());for(var r=0;r<e.length;r++){if(e[r].frame==Math.floor(t))return e[r];if(e[r].frame>t)break}},PZ.keyframes.get2=function(e,t){return 1===e.length?e[0]:this.get(e,t)},PZ.keyframes.getValue=function(e,t){var r=this.get(e,t);if("undefined"!=typeof r)return r.value},PZ.keyframes.delete=function(e,t){if("undefined"==typeof t&&(t=this.getFrame()),1!==e.length){for(var r=0;r<e.length;r++)e[r].frame==Math.floor(t)&&e.splice(r,1);PZ.keyframes.update()}},PZ.keyframes.add=function(e,t,r){"undefined"==typeof t&&(t=this.getFrame()),t=Math.floor(t);for(var a=TWEEN.getValue(e,t),n={frame:t,value:a,tweenfn:r?0:e[0].tweenfn||1},i=0;i<e.length;i++)if(e[i].frame>t)return e.splice(i,0,n),void PZ.keyframes.update();e.push(n),PZ.keyframes.update()},PZ.keyframes.clone=function(e){var t={};return t.frame=e.frame,t.tweenfn=e.tweenfn,"object"==typeof e.value?t.value=e.value.clone():t.value=e.value,t},PZ.keyframes.cloneAll=function(e){for(var t=[],r=0;r<e.length;r++)t.push(this.clone(e[r]));return t},PZ.keyframes.cloneProps=function(e){var t={};for(var r in e)t[r]=this.cloneAll(e[r]);return t},PZ.keyframes.sort=function(e,t){return e.frame<t.frame?-1:e.frame>t.frame?1:0},PZ.keyframes.translate=function(e,t){for(var r=0;r<e.length;r++)e[r].frame+=t},PZ.keyframes.translateAll=function(e,t){for(var r in e)this.translate(e[r],t)},PZ.keyframes.toVector3=function(e,t){for(var r=new THREE.Vector3(.001,.001,.001),a=0;a<e.length;a++)e[a].value=(new THREE.Vector3).copy(e[a].value),t===!0&&e[a].value.max(r)},PZ.keyframes.toVector2=function(e){for(var t=0;t<e.length;t++)e[t].value=(new THREE.Vector2).copy(e[t].value)},PZ.keyframes.toColor=function(e){for(var t=0;t<e.length;t++){var r=e[t].value;"number"==typeof r?e[t].value=new THREE.Color(r):e[t].value=(new THREE.Color).copy(r)}},PZ.keyframes.genericValueGet=function(e,t){if(1===t.length){var r=PZ.keyframes.clone(t[0]);return r.tweenfn=-1,r}return PZ.keyframes.get(t)},PZ.keyframes.genericValueSet=function(e,t,r){var a=PZ.keyframes.get(r);if("undefined"==typeof e)"undefined"==typeof a?PZ.keyframes.add(r):PZ.keyframes.delete(r);else switch(a=a||r[0],t){case 0:a.value=e;break;default:a.tweenfn=e}},PZ.keyframes.genericDropDownSet=function(e,t,r){var a=PZ.keyframes.get(r);if("undefined"==typeof e)"undefined"==typeof a?PZ.keyframes.add(r,void 0,!0):PZ.keyframes.delete(r);else switch(a=a||r[0],t){case 0:a.value=e;break;default:a.tweenfn=e}},PZ.keyframes.genericColorGet=PZ.keyframes.genericValueGet,PZ.keyframes.genericColorSet=function(e,t,r){var a=PZ.keyframes.get(r);"undefined"==typeof e?"undefined"==typeof a?PZ.keyframes.add(r):PZ.keyframes.delete(r):(a=a||r[0],"undefined"==typeof t?a.value.setStyle(e):a.tweenfn=e)},PZ.keyframes.genericVector2Get=PZ.keyframes.genericValueGet,PZ.keyframes.genericVector3Get=PZ.keyframes.genericValueGet,PZ.keyframes.genericVector2Set=function(e,t,r){var a=PZ.keyframes.get(r);if("undefined"==typeof e)"undefined"==typeof a?PZ.keyframes.add(r):PZ.keyframes.delete(r);else switch(a=a||r[0],t){case 0:a.value.x=e;break;case 1:a.value.y=e;break;default:a.tweenfn=e}},PZ.keyframes.genericVector3Set=function(e,t,r){var a=PZ.keyframes.get(r);if("undefined"==typeof e)"undefined"==typeof a?PZ.keyframes.add(r):PZ.keyframes.delete(r);else switch(a=a||r[0],t){case 0:a.value.x=e;break;case 1:a.value.y=e;break;case 2:a.value.z=e;break;default:a.tweenfn=e}},PZ.keyframes.genericRotationGet=function(e,t){var r;return 1===t.length?(r=PZ.keyframes.clone(t[0]),r.tweenfn=-1):(r=PZ.keyframes.get(t),"undefined"!=typeof r&&(r=PZ.keyframes.clone(r))),"undefined"!=typeof r&&(r.value=r.value/Math.PI*180),r},PZ.keyframes.genericRotationSet=function(e,t,r){var a=PZ.keyframes.get(r);if("undefined"==typeof e)"undefined"==typeof a?PZ.keyframes.add(r):PZ.keyframes.delete(r);else switch(a=a||r[0],t){case 0:a.value=e*Math.PI/180;break;default:a.tweenfn=e}},PZ.keyframes.genericRotation3Get=function(e,t){var r;return 1===t.length?(r=PZ.keyframes.clone(t[0]),r.tweenfn=-1):(r=PZ.keyframes.get(t),"undefined"!=typeof r&&(r=PZ.keyframes.clone(r))),"undefined"!=typeof r&&r.value.set(r.value.x/Math.PI*180,r.value.y/Math.PI*180,r.value.z/Math.PI*180),r},PZ.keyframes.genericRotation3Set=function(e,t,r){var a=PZ.keyframes.get(r);if("undefined"==typeof e)"undefined"==typeof a?PZ.keyframes.add(r):PZ.keyframes.delete(r);else switch(a=a||r[0],t){case 0:a.value.x=e*Math.PI/180;break;case 1:a.value.y=e*Math.PI/180;break;case 2:a.value.z=e*Math.PI/180;break;default:a.tweenfn=e}};var TWEEN=TWEEN||function(){return{getValue:function(e,t){for(var r,a,n=0;n<e.length;n++){if(e[n].frame===t)return"object"==typeof e[n].value?e[n].value.clone():e[n].value;if(e[n].frame<t)r=n;else if(e[n].frame>t){"undefined"==typeof r?r=n:a=n;break}}if("undefined"==typeof a||null===TWEEN.EasingList[255&e[a].tweenfn].fn)return"object"==typeof e[r].value?e[r].value.clone():e[r].value;var i=e[a].frame-e[r].frame,s=TWEEN.EasingList[255&e[a].tweenfn].fn((t-e[r].frame)/i);if(e[a].tweenfn>>8===1){var o,l;return o=r?r-1:0,l=a<e.length-1?a+1:a,TWEEN.Interpolation.Utils.CatmullRom(e[o].value,e[r].value,e[a].value,e[l].value,s)}return TWEEN.Interpolation.Utils.Linear(e[r].value,e[a].value,s)}}}();TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,r=.1,a=.4;return 0===e?0:1===e?1:(!r||r<1?(r=1,t=a/4):t=a*Math.asin(1/r)/(2*Math.PI),-(r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/a)))},Out:function(e){var t,r=.1,a=.4;return 0===e?0:1===e?1:(!r||r<1?(r=1,t=a/4):t=a*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/a)+1)},InOut:function(e){var t,r=.1,a=.4;return 0===e?0:1===e?1:(!r||r<1?(r=1,t=a/4):t=a*Math.asin(1/r)/(2*Math.PI),(e*=2)<1?-.5*(r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/a)):r*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/a)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.EasingList=[{name:"none",fn:null},{name:"linear",fn:TWEEN.Easing.Linear.None},{name:"quadratic in",fn:TWEEN.Easing.Quadratic.In},{name:"quadratic out",fn:TWEEN.Easing.Quadratic.Out},{name:"quadratic in-out",fn:TWEEN.Easing.Quadratic.InOut},{name:"cubic in",fn:TWEEN.Easing.Cubic.In},{name:"cubic out",fn:TWEEN.Easing.Cubic.Out},{name:"cubic in-out",fn:TWEEN.Easing.Cubic.InOut},{name:"quartic in",fn:TWEEN.Easing.Quartic.In},{name:"quartic out",fn:TWEEN.Easing.Quartic.Out},{name:"quartic in-out",fn:TWEEN.Easing.Quartic.InOut},{name:"quintic in",fn:TWEEN.Easing.Quintic.In},{name:"quintic out",fn:TWEEN.Easing.Quintic.Out},{name:"quintic in-out",fn:TWEEN.Easing.Quintic.InOut},{name:"sinusoidal in",fn:TWEEN.Easing.Sinusoidal.In},{name:"sinusoidal out",fn:TWEEN.Easing.Sinusoidal.Out},{name:"sinusoidal in-out",fn:TWEEN.Easing.Sinusoidal.InOut},{name:"exponential in",fn:TWEEN.Easing.Exponential.In},{name:"exponential out",fn:TWEEN.Easing.Exponential.Out},{name:"exponential in-out",fn:TWEEN.Easing.Exponential.InOut},{name:"circular in",fn:TWEEN.Easing.Circular.In},{name:"circular out",fn:TWEEN.Easing.Circular.Out},{name:"circular in-out",fn:TWEEN.Easing.Circular.InOut},{name:"elastic in",fn:TWEEN.Easing.Elastic.In},{name:"elastic out",fn:TWEEN.Easing.Elastic.Out},{name:"elastic in-out",fn:TWEEN.Easing.Elastic.InOut},{name:"back in",fn:TWEEN.Easing.Back.In},{name:"back out",fn:TWEEN.Easing.Back.Out},{name:"back in-out",fn:TWEEN.Easing.Back.InOut},{name:"bounce in",fn:TWEEN.Easing.Bounce.In},{name:"bounce out",fn:TWEEN.Easing.Bounce.Out},{name:"bounce in-out",fn:TWEEN.Easing.Bounce.InOut}],TWEEN.Interpolation={Utils:{Linear:function(e,t,r){return"object"==typeof e?e.clone().lerp(t,r):(t-e)*r+e},CatmullRom:function(e,t,r,a,n){var i=n*n,s=n*i;if("object"==typeof e){for(var o=new e.constructor,l=Object.keys(e),p=0;p<l.length;p++){var c=l[p],u=.5*(r[c]-e[c]),d=.5*(a[c]-t[c]);o[c]=(2*t[c]-2*r[c]+u+d)*s+(-3*t[c]+3*r[c]-2*u-d)*i+u*n+t[c]}return o}var u=.5*(r-e),d=.5*(a-t);return(2*t-2*r+u+d)*s+(-3*t+3*r-2*u-d)*i+u*n+t}}},PZ.archive={files:[],worker:null},PZ.archive.tar=function(e){var t=["-cvzf","output/out","pz"];this.callWorker(!1,t,e)},PZ.archive.untar=function(e,t){var r=["-xvzf","/blob/"+(e.name||"blob.pz"),"-C","/"];this.callWorker(e,r,t)},PZ.archive.callWorker=function(e,t,r){this.worker=new Worker("/js/bsdtar/worker4.js"),this.worker.onerror=function(e){PZ.archive.worker.terminate(),PZ.archive.worker=null,r()},this.worker.onmessage=function(a){var n=a.data;if("ready"===n.type)PZ.archive.worker.postMessage({type:"command",arguments:t,files:PZ.archive.files,wfiles:e?[e]:[],useDevFile:e===!1,inputDirectory:e?"input":"pz",outputDirectory:e?"pz":"output"});else if("stdout"===n.type);else if("done"===n.type)if(PZ.archive.worker.terminate(),PZ.archive.worker=null,e!==!1)PZ.archive.files=n.data,r();else{var i;n.file?i=n.file:n.data.length>0&&(i=n.data[0].data,i&&(i=new Blob([i],{type:"application/octet-stream"}))),r(i)}}},PZ.archive.fileExists=function(e){for(var t=0;t<this.files.length;t++)if(this.files[t].name===e)return!0;return!1},PZ.archive.getFile=function(e){for(var t=0;t<this.files.length;t++)if(this.files[t].name===e)return this.files.splice(t,1)[0]},PZ.archive.getFileBlob=function(e,t){var r=this.getFile(e);if("undefined"!=typeof r)return"undefined"==typeof t&&(t={type:""}),new Blob([r.data],t)},PZ.archive.getFileString=function(e){var t=this.getFile(e);if("undefined"!=typeof t){for(var r=new Uint8Array(t.data),a="",n=0,i=r.length;n<i;n++)a+=String.fromCharCode(r[n]);return a}},PZ.archive.getFileStringUTF8=function(e){var t=this.getFile(e);if("undefined"!=typeof t){var r,a,n,i,s,o,l=new Uint8Array(t.data);for(r="",n=l.length,a=0;a<n;)switch(i=l[a++],i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(i);break;case 12:case 13:s=l[a++],r+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=l[a++],o=l[a++],r+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&o)<<0)}return r}},PZ.archive.addFile=function(e,t){this.files.push({name:e,data:t})},PZ.archive.addFileString=function(e,t){for(var r=[],a=0;a<t.length;a++){var n=t.charCodeAt(a);n<128?r.push(n):n<2048?r.push(192|n>>6,128|63&n):n<55296||n>=57344?r.push(224|n>>12,128|n>>6&63,128|63&n):(a++,n=65536+((1023&n)<<10|1023&t.charCodeAt(a)),r.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}var i=Uint8Array.from(r);this.addFile(e,i)},PZ.widget3d={keyObject:null,threeObj:null,property:null,mode:"position",controls:null},PZ.widget3d.init=function(){this.controls=new THREE.TransformControls(CM.camera,CM.renderCanv),this.controls.traverse(function(e){e.layers.set(1),e.material&&(e.material.fog=!1)}),this.controls.setSpace("world"),CM.scene.add(this.controls);var e=this;$(document).keydown(function(t){var r=t.target,a=t.target.tagName;if("INPUT"!==a&&"SELECT"!==a&&"TEXTAREA"!==a&&!r.isContentEditable){if(49===t.which||97===t.which)e.mode="position",e.controls.setMode("translate");else if(50===t.which||98===t.which)e.mode="rotation",e.controls.setMode("rotate");else if(51===t.which||99===t.which)e.mode="scale",e.controls.setMode("scale");else{if(52!==t.which&&100!==t.which)return;e.mode=""}e.update()}}),this.controls.addEventListener("objectChange",this.change.bind(this)),this.controls.addEventListener("mouseDown",function(){CM.controls.enabled=!1}),this.controls.addEventListener("mouseUp",function(){CM.controls.enabled=!0,$("#controls div:visible .proprow[kf='1']").each(function(){$(this).triggerHandler("update")})})},PZ.widget3d.change=function(e){this.property&&("position"===this.mode?this.property.value.copy(this.controls.object.position):"rotation"===this.mode?this.property.value.copy(this.controls.object.rotation):this.property.value.copy(this.controls.object.scale))},PZ.widget3d.update=function(){this.controls.detach(),null!==this.threeObj&&""!==this.mode&&CM.enablePlayFrames!==!0&&CM.renderMode!==!0&&this.controls.attach(this.threeObj)},PZ.widget3d.updateFrame=function(e){null!==this.threeObj&&""!==this.mode&&CM.enablePlayFrames!==!0&&("undefined"==typeof this.keyObject[this.mode]?this.property=void 0:this.property=PZ.keyframes.get2(this.keyObject[this.mode],e),"undefined"!=typeof this.property?this.controls.attach(this.threeObj):this.controls.detach())},PZ.av={hasThreads:!1,sharedHeap:null,syncBuffer:null,syncArray:null,currentFrame:0,audioBuffer:null,bufferStartSample:0,currentSample:0,totalFrames:0,totalSamples:0,worker:null,timerStart:0,timeLoading:0,timeRendering:0,timeTotal:0},PZ.av.decode=function(e,t){var r=new Worker("/js/av/worker6.js");r.onerror=function(e){r.terminate(),t()},r.onmessage=function(a){var n=a.data;if("ready"===n.type){var i=[];i.push(),this.postMessage({type:"command",options:{decode:!0},files:[{name:"input",data:e}]},[e])}else if("stdout"===n.type);else if("done"===n.type){r.terminate();var s,o;n.data.length>0&&(s=n.data[0].data,o=n.data[1].data),t(s,o)}}},PZ.av.encode=function(e,t,r,a){function n(e,t,r){if(PZ.av.timeRendering+=performance.now()-PZ.av.timerStart,e){r=Math.min(PZ.av.totalSamples-PZ.av.currentSample,t.num);var a=[];PZ.av.hasThreads?(a[0]=new Float32Array(PZ.av.sharedHeap,t.xfer_ptrs[0],r),a[1]=new Float32Array(PZ.av.sharedHeap,t.xfer_ptrs[1],r)):(a[0]=new Float32Array(t.xfer_buffer,t.xfer_ptrs[0],r),a[1]=new Float32Array(t.xfer_buffer,t.xfer_ptrs[1],r));for(var n=0;n<2;n++)PZ.av.audioBuffer.copyFromChannel(a[n],n,PZ.av.currentSample-PZ.av.bufferStartSample);PZ.av.currentSample+=r}return PZ.av.hasThreads?(PZ.av.syncArray[0]=r,void Atomics.wake(PZ.av.syncArray,0,1)):void PZ.av.worker.postMessage({type:"callback",ret:r,xfer_buffer:t.xfer_buffer},[t.xfer_buffer])}console.log("Video: "+e.frameWidth+"x"+e.frameHeight+" "+e.frameRate+"fps "+e.videoBitrate+"b/s"),console.log("Encoder: cpu_used: "+e.cpu_used+" deadline: "+e.deadline+" lag_in_frames: "+e.lag_in_frames),PZ.av.timeTotal=performance.now();var i=e.frameWidth*e.frameHeight*4;PZ.av.hasThreads&&(PZ.av.syncBuffer=new SharedArrayBuffer(4),PZ.av.syncArray=new Int32Array(PZ.av.syncBuffer,0,1)),PZ.av.totalFrames=e.totalFrames,PZ.av.currentFrame=0,PZ.av.startFrame=e.startFrame,PZ.av.totalSamples=Math.floor(e.totalFrames/e.frameRate*48e3),PZ.av.currentSample=0,PZ.av.audioBuffer=null,PZ.av.bufferStartSample=0,PZ.av.timeLoading=performance.now(),PZ.av.worker=new Worker("/js/av/worker6.js"),PZ.av.worker.onerror=function(e){a(),PZ.av.stop()},PZ.av.worker.onmessage=function(s){function o(e){PZ.av.audioBuffer=e,PZ.av.bufferStartSample=PZ.av.currentSample,n(!0,l)}var l=s.data;if("video"===l.type){if(PZ.av.timerStart=performance.now(),PZ.av.currentFrame>=PZ.av.totalFrames)return void n(!1,l,0);var p=PZ.av.currentFrame+PZ.av.startFrame;if(PZ.av.hasThreads){var c=new Uint8Array(PZ.av.sharedHeap,l.xfer_ptrs[0],i);t(c,p,n.bind(this,!1,null,1))}else{var c=new Uint8Array(l.xfer_buffer,l.xfer_ptrs[0],i);t(c,p,n.bind(this,!1,l,1))}PZ.av.currentFrame+=1}else if("audio"===l.type){if(PZ.av.timerStart=performance.now(),PZ.av.currentSample>=PZ.av.totalSamples)return void n(!1,l,0);null===PZ.av.audioBuffer||PZ.av.bufferStartSample+PZ.av.audioBuffer.length<=PZ.av.currentSample?r(PZ.av.currentSample,l.num,o):n(!0,l)}else if("read"===l.type)PZ.av.readOutput(l);else if("write"===l.type)PZ.av.writeOutput(l);else if("buffer"===l.type)PZ.av.sharedHeap=l.buffer;else if("remux"===l.type){var u;l.data.length>0&&(u=l.data[0].data),PZ.av.remuxCallback(u,l.offset)}else if("ready"===l.type)PZ.av.timeLoading=performance.now()-PZ.av.timeLoading,PZ.av.hasThreads?this.postMessage({type:"command",syncBuffer:PZ.av.syncBuffer,options:e},[PZ.av.syncBuffer]):this.postMessage({type:"command",options:e});else if("stdout"===l.type);else if("done"===l.type){PZ.av.stop();var d;l.file?(d=l.file,console.log("Output size: "+d.size/1024/1024+" MB")):l.data.length>0&&(d=l.data[0].data,1===e.haveVideo&&d&&(console.log("Output size: "+d.byteLength/1024/1024+" MB"),d=new Blob([d],{type:"video/webm"}))),a(d)}}},PZ.av.remux=function(e,t){PZ.av.remuxCallback=t,PZ.av.worker.postMessage({type:"remux",options:e})},PZ.av.stop=function(){PZ.av.timeTotal=performance.now()-this.timeTotal,console.log("Time loading: "+this.timeLoading),console.log("Time rendering: "+this.timeRendering),console.log("Time total: "+this.timeTotal),null!==this.worker&&(this.worker.terminate(),this.worker.onmessage=null,this.worker.onerror=null,this.worker=null),this.audioBuffer=null,this.sharedHeap=null,this.syncBuffer=null,this.syncArray=null},PZ.av.getProgress=function(){return null===this.worker?0:(this.currentFrame-1)/this.totalFrames*100},PZ.av.getTimeRemaining=function(){var e=this.currentFrame-1,t="calculating...";if(e>1){var r=(performance.now()-this.timeTotal)/1e3,a=r/e,n=this.totalFrames-e,i=n*a;t="";var s=Math.floor(i/60/60),o=Math.floor(i/60)%60,l=Math.floor(i)%60;t+=s>0?s+" hour"+(s>1?"s":""):o>0?o+" minute"+(o>1?"s":""):l>5?l+" seconds":"a few seconds"}return t},PZ.av.readOutput=function(e){var t=new Uint8Array(PZ.av.sharedHeap,e.offset,e.length);PZ.file.read(t,e.position,function(){PZ.av.syncArray[0]=e.length,Atomics.wake(PZ.av.syncArray,0,1)})},PZ.av.writeOutput=function(e){var t=new Uint8Array(PZ.av.sharedHeap,e.offset,e.length);PZ.file.write(t,e.position,function(){PZ.av.syncArray[0]=e.length,Atomics.wake(PZ.av.syncArray,0,1)})},PZ.file={},PZ.file.getQuota=function(e,t){"undefined"==typeof t&&(t=104857600);try{navigator.webkitPersistentStorage.requestQuota(t,function(t){e()},function(t){e()})}catch(t){e()}},PZ.file.cleanUp=function(){try{webkitRequestFileSystem(PERSISTENT,0,function(e){e.root.getFile("out",null,function(e){e.remove(function(){})})})}catch(e){}},PZ.file.start=function(e){window.webkitRequestFileSystem?(PZ.file.fileWriter_init(e),PZ.file.read=PZ.file.fileWriter_read,PZ.file.write=PZ.file.fileWriter_write):window.IDBMutableFile&&(PZ.file.mutableFile_init(e),PZ.file.read=PZ.file.mutableFile_read,PZ.file.write=PZ.file.mutableFile_write)},PZ.file.write=null,PZ.file.finish=function(){this.fileEntry&&this.fileEntry.remove(function(){},function(){})},PZ.file.fileWriter_init=function(e){webkitRequestFileSystem(TEMPORARY,1073741824,function(t){t.root.getFile("video.mp4",{create:!0},function(t){PZ.file.fileEntry=t,e()},function(e){})},function(e){})},PZ.file.fileWriter_read=function(e,t,r){this.fileEntry.file(function(a){var n=new FileReader;n.onload=function(t){e.set(new Uint8Array(t.target.result)),r()},n.readAsArrayBuffer(a.slice(t,t+e.length))})},PZ.file.fileWriter_write=function(e,t,r){this.fileEntry.createWriter(function(a){a.seek(t),a.onwriteend=function(e){r()};var n=new Blob([e]);a.write(n)})},PZ.file.mutableFile_init=function(e){var t=indexedDB.open("renderstorage");t.onsuccess=function(){var t=this.result,r=t.mozCreateFileHandle("video.mp4","video/mp4");r.onsuccess=function(){PZ.file.fileHandle=this.result,e()}}},PZ.file.mutableFile_read=function(e,t,r){var a=this.fileHandle.open("readonly");a.location=t;var n=a.readAsArrayBuffer(e.length);n.onsuccess=function(){e.set(new Uint8Array(this.result)),r()}},PZ.file.mutableFile_write=function(e,t,r){var a=this.fileHandle.open("readwrite"),n=new ArrayBuffer(e.length),i=new Uint8Array(n);i.set(e),a.location=t;var s=a.write(n);s.onsuccess=function(){r()}},PZ.file.blob_init=function(){},PZ.file.blob_read=function(e,t,r){},PZ.file.blob_write=function(e,t,r){},PZ.textures={list:[]},PZ.textures.checkMagic=function(e){for(var t=new Uint8Array(e,0,6),r="",a=0,n=t.length;a<n;a++)r+=String.fromCharCode(t[a]);return"MaGiC0"===r},PZ.textures.getHashString=function(e){for(var t=new Uint8Array(e,6),r="",a=0,n=t.length;a<n;a++)r+=String.fromCharCode(t[a]);return r},PZ.textures.find=function(e){for(var t=0;t<this.list.length;t++)if(this.list[t].hash===e)return this.list[t]},PZ.textures.hashAndAdd=function(e,t){crypto.subtle.digest("SHA-256",new Uint8Array(e)).then(function(r){for(var a=[],n=new Uint32Array(r),i=0;i<n.length;i++){var s=("00000000"+n[i].toString(16)).slice(-8);a.push(s)}var o=a.join(""),l=new Blob([e]);PZ.textures.add(l,o,t)})},PZ.textures.add=function(e,t,r){var a=this.find(t);if(a)return a.ref++,void r(a.image);var n=URL.createObjectURL(e),i=new Image;PZ.textures.list.push({hash:t,image:i,url:n,ref:1}),i.onload=function(e){r(i)},i.src=n},PZ.textures.clone=function(e){for(var t=0;t<this.list.length;t++){var r=this.list[t];if(r.image===e)return r.ref++,e}},PZ.textures.load=function(e,t){if("string"==typeof e)if(e.startsWith("data:image/")){var r=";base64,",a=e.indexOf(r)+r.length;e=window.atob(e.substring(a));for(var n=new Uint8Array(new ArrayBuffer(e.length)),i=0;i<n.length;i++)n[i]=e.charCodeAt(i);this.hashAndAdd(n.buffer,t)}else{if(e=PZ.archive.getFile(e),"undefined"==typeof e)return;if(this.checkMagic(e.data)===!0){var s=this.getHashString(e.data),o=PZ.archive.getFileBlob(s);this.add(o,s,t)}else this.hashAndAdd(e.data,t)}else{var l=new FileReader,p=this;l.onload=function(e){p.hashAndAdd(e.target.result,t)},l.readAsArrayBuffer(e)}},PZ.textures.unload=function(e){for(var t=0;t<this.list.length;t++){var r=this.list[t];r.image===e&&--r.ref<=0&&(URL.revokeObjectURL(r.url),this.list.splice(t,1))}},PZ.textures.save=function(e,t,r,a){for(var n=0;n<this.list.length;n++){var i=this.list[n];if(i.image===e){if(PZ.archive.addFileString(t,"MaGiC0"+i.hash),PZ.archive.fileExists(i.hash)===!1){PZ.archive.addFile(i.hash,null);var s=PZ.archive.files[PZ.archive.files.length-1];PZ.imageToArray(i.image,function(e){s.data=new Uint8Array(e),r()},a)}else r();return}}r()},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.opentype=e()}}(function(){return function e(t,r,a){function n(s,o){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(i)return i(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return n(r?r:e)},c,c.exports,e,t,r,a)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<a.length;s++)n(a[s]);return n}({1:[function(e,t,r){function a(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function n(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new a,this.dtree=new a}function i(e,t,r,a){var n,i;for(n=0;n<r;++n)e[n]=0;for(n=0;n<30-r;++n)e[n+r]=n/r|0;for(i=a,n=0;n<30;++n)t[n]=i,i+=1<<e[n]}function s(e,t){var r;for(r=0;r<7;++r)e.table[r]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,r=0;r<24;++r)e.trans[r]=256+r;for(r=0;r<144;++r)e.trans[24+r]=r;for(r=0;r<8;++r)e.trans[168+r]=280+r;for(r=0;r<112;++r)e.trans[176+r]=144+r;for(r=0;r<5;++r)t.table[r]=0;for(t.table[5]=32,r=0;r<32;++r)t.trans[r]=r}function o(e,t,r,a){var n,i;for(n=0;n<16;++n)e.table[n]=0;for(n=0;n<a;++n)e.table[t[r+n]]++;for(e.table[0]=0,i=0,n=0;n<16;++n)E[n]=i,i+=e.table[n];for(n=0;n<a;++n)t[r+n]&&(e.trans[E[t[r+n]]++]=n)}function l(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function p(e,t,r){if(!t)return r;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var a=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,a+r}function c(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=0,a=0,n=0,i=e.tag;do a=2*a+(1&i),i>>>=1,++n,r+=t.table[n],a-=t.table[n];while(a>=0);return e.tag=i,e.bitcount-=n,t.trans[r+a]}function u(e,t,r){var a,n,i,s,l,u;for(a=p(e,5,257),n=p(e,5,1),i=p(e,4,4),s=0;s<19;++s)T[s]=0;for(s=0;s<i;++s){var d=p(e,3,0);T[w[s]]=d}for(o(x,T,0,19),l=0;l<a+n;){var h=c(e,x);switch(h){case 16:var f=T[l-1];for(u=p(e,2,3);u;--u)T[l++]=f;break;case 17:for(u=p(e,3,3);u;--u)T[l++]=0;break;case 18:for(u=p(e,7,11);u;--u)T[l++]=0;break;default:T[l++]=h}}o(t,T,0,a),o(r,T,a,n)}function d(e,t,r){for(;;){var a=c(e,t);if(256===a)return m;if(a<256)e.dest[e.destLen++]=a;else{var n,i,s,o;for(a-=257,n=p(e,b[a],P[a]),i=c(e,r),s=e.destLen-p(e,M[i],C[i]),o=s;o<s+n;++o)e.dest[e.destLen++]=e.dest[o]}}}function h(e){for(var t,r,a;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if(t=e.source[e.sourceIndex+1],t=256*t+e.source[e.sourceIndex],r=e.source[e.sourceIndex+3],r=256*r+e.source[e.sourceIndex+2],t!==(65535&~r))return g;for(e.sourceIndex+=4,a=t;a;--a)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,m}function f(e,t){var r,a,i,s=new n(e,t);do{switch(r=l(s),a=p(s,2,0)){case 0:i=h(s);break;case 1:i=d(s,v,y);break;case 2:u(s,s.ltree,s.dtree),i=d(s,s.ltree,s.dtree);break;default:i=g}if(i!==m)throw new Error("Data error")}while(!r);return s.destLen<s.dest.length?"function"==typeof s.dest.slice?s.dest.slice(0,s.destLen):s.dest.subarray(0,s.destLen):s.dest}var m=0,g=-3,v=new a,y=new a,b=new Uint8Array(30),P=new Uint16Array(30),M=new Uint8Array(30),C=new Uint16Array(30),w=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),x=new a,T=new Uint8Array(320),E=new Uint16Array(16);s(v,y),i(b,P,4,3),i(M,C,2,1),b[28]=0,P[28]=258,t.exports=f},{}],2:[function(e,t,r){function a(e,t,r,a,n){return Math.pow(1-n,3)*e+3*Math.pow(1-n,2)*n*t+3*(1-n)*Math.pow(n,2)*r+Math.pow(n,3)*a}function n(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}n.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},n.prototype.addPoint=function(e,t){"number"==typeof e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),"number"==typeof t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},n.prototype.addX=function(e){this.addPoint(e,null)},n.prototype.addY=function(e){this.addPoint(null,e)},n.prototype.addBezier=function(e,t,r,n,i,s,o,l){var p=[e,t],c=[r,n],u=[i,s],d=[o,l];this.addPoint(e,t),this.addPoint(o,l);for(var h=0;h<=1;h++){var f=6*p[h]-12*c[h]+6*u[h],m=-3*p[h]+9*c[h]-9*u[h]+3*d[h],g=3*c[h]-3*p[h];if(0!==m){var v=Math.pow(f,2)-4*g*m;if(!(v<0)){var y=(-f+Math.sqrt(v))/(2*m);0<y&&y<1&&(0===h&&this.addX(a(p[h],c[h],u[h],d[h],y)),1===h&&this.addY(a(p[h],c[h],u[h],d[h],y)));var b=(-f-Math.sqrt(v))/(2*m);0<b&&b<1&&(0===h&&this.addX(a(p[h],c[h],u[h],d[h],b)),1===h&&this.addY(a(p[h],c[h],u[h],d[h],b)))}}else{if(0===f)continue;var P=-g/f;0<P&&P<1&&(0===h&&this.addX(a(p[h],c[h],u[h],d[h],P)),1===h&&this.addY(a(p[h],c[h],u[h],d[h],P)))}}},n.prototype.addQuad=function(e,t,r,a,n,i){var s=e+2/3*(r-e),o=t+2/3*(a-t),l=s+1/3*(n-e),p=o+1/3*(i-t);this.addBezier(e,t,s,o,l,p,n,i)},r.BoundingBox=n},{}],3:[function(e,t,r){r.fail=function(e){throw new Error(e)},r.argument=function(e,t){e||r.fail(t)},r.assert=r.argument},{}],4:[function(e,t,r){function a(e,t,r,a,n){e.beginPath(),e.moveTo(t,r),e.lineTo(a,n),e.stroke()}r.line=a;
},{}],5:[function(e,t,r){function a(e){this.font=e}function n(e){this.cmap=e}function i(e,t){this.encoding=e,this.charset=t}function s(e){var t;switch(e.version){case 1:this.names=r.standardNames.slice();break;case 2:for(this.names=new Array(e.numberOfGlyphs),t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<r.standardNames.length?this.names[t]=r.standardNames[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-r.standardNames.length];break;case 2.5:for(this.names=new Array(e.numberOfGlyphs),t=0;t<e.numberOfGlyphs;t++)this.names[t]=r.standardNames[t+e.glyphNameIndex[t]];break;case 3:this.names=[]}}function o(e){for(var t,r=e.tables.cmap.glyphIndexMap,a=Object.keys(r),n=0;n<a.length;n+=1){var i=a[n],s=r[i];t=e.glyphs.get(s),t.addUnicode(parseInt(i))}for(n=0;n<e.glyphs.length;n+=1)t=e.glyphs.get(n),e.cffEncoding?t.name=e.cffEncoding.charset[n]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(n))}var l=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],p=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],c=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],u=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];a.prototype.charToGlyphIndex=function(e){var t=e.charCodeAt(0),r=this.font.glyphs;if(!r)return null;for(var a=0;a<r.length;a+=1)for(var n=r.get(a),i=0;i<n.unicodes.length;i+=1)if(n.unicodes[i]===t)return a},n.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.charCodeAt(0)]||0},i.prototype.charToGlyphIndex=function(e){var t=e.charCodeAt(0),r=this.encoding[t];return this.charset.indexOf(r)},s.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},s.prototype.glyphIndexToName=function(e){return this.names[e]},r.cffStandardStrings=l,r.cffStandardEncoding=p,r.cffExpertEncoding=c,r.standardNames=u,r.DefaultEncoding=a,r.CmapEncoding=n,r.CffEncoding=i,r.GlyphNames=s,r.addGlyphNames=o},{}],6:[function(e,t,r){function a(e){e=e||{},e.empty||(p.checkArgument(e.familyName,"When creating a new Font object, familyName is required."),p.checkArgument(e.styleName,"When creating a new Font object, styleName is required."),p.checkArgument(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),p.checkArgument(e.ascender,"When creating a new Font object, ascender is required."),p.checkArgument(e.descender,"When creating a new Font object, descender is required."),p.checkArgument(e.descender<0,"Descender should be negative (e.g. -512)."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||e.familyName+e.styleName},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables={os2:{usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR}}),this.supported=!0,this.glyphs=new o.GlyphSet(this,e.glyphs||[]),this.encoding=new s.DefaultEncoding(this),this.substitution=new l(this),this.tables=this.tables||{}}var n=e("./path"),i=e("./tables/sfnt"),s=e("./encoding"),o=e("./glyphset"),l=e("./substitution"),p=e("./util");a.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},a.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},a.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},a.prototype.stringToGlyphs=function(e){for(var t=[],r=0;r<e.length;r+=1){var a=e[r];t.push(this.charToGlyph(a))}return t},a.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},a.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},a.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},a.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var r=this.getGposKerningValue;return r?r(e,t):this.kerningPairs[e+","+t]||0},a.prototype.forEachGlyph=function(e,t,r,a,n,i){t=void 0!==t?t:0,r=void 0!==r?r:0,a=void 0!==a?a:72,n=n||{};for(var s=void 0===n.kerning||n.kerning,o=1/this.unitsPerEm*a,l=this.stringToGlyphs(e),p=0;p<l.length;p+=1){var c=l[p];if(i(c,t,r,a,n),c.advanceWidth&&(t+=c.advanceWidth*o),s&&p<l.length-1){var u=this.getKerningValue(c,l[p+1]);t+=u*o}n.letterSpacing?t+=n.letterSpacing*a:n.tracking&&(t+=n.tracking/1e3*a)}},a.prototype.getPath=function(e,t,r,a,i){var s=new n.Path;return this.forEachGlyph(e,t,r,a,i,function(e,t,r,a){var n=e.getPath(t,r,a);s.extend(n)}),s},a.prototype.getPaths=function(e,t,r,a,n){var i=[];return this.forEachGlyph(e,t,r,a,n,function(e,t,r,a){var n=e.getPath(t,r,a);i.push(n)}),i},a.prototype.draw=function(e,t,r,a,n,i){this.getPath(t,r,a,n,i).draw(e)},a.prototype.drawPoints=function(e,t,r,a,n,i){this.forEachGlyph(t,r,a,n,i,function(t,r,a,n){t.drawPoints(e,r,a,n)})},a.prototype.drawMetrics=function(e,t,r,a,n,i){this.forEachGlyph(t,r,a,n,i,function(t,r,a,n){t.drawMetrics(e,r,a,n)})},a.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},a.prototype.validate=function(){function e(e,t){e||r.push(t)}function t(t){var r=a.getEnglishName(t);e(r&&r.trim().length>0,"No English "+t+" specified.")}var r=[],a=this;t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),e(this.unitsPerEm>0,"No unitsPerEm specified.")},a.prototype.toTables=function(){return i.fontToTable(this)},a.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},a.prototype.toArrayBuffer=function(){for(var e=this.toTables(),t=e.encode(),r=new ArrayBuffer(t.length),a=new Uint8Array(r),n=0;n<t.length;n++)a[n]=t[n];return r},a.prototype.download=function(t){var r=this.getEnglishName("fontFamily"),a=this.getEnglishName("fontSubfamily");t=t||r.replace(/\s/g,"")+"-"+a+".otf";var n=this.toArrayBuffer();if(p.isBrowser())window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,n.byteLength,function(e){e.root.getFile(t,{create:!0},function(e){e.createWriter(function(t){var r=new DataView(n),a=new Blob([r],{type:"font/opentype"});t.write(a),t.addEventListener("writeend",function(){location.href=e.toURL()},!1)})})},function(e){throw new Error(e.name+": "+e.message)});else{var i=e("fs"),s=p.arrayBufferToNodeBuffer(n);i.writeFileSync(t,s)}},a.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},a.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},a.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900},r.Font=a},{"./encoding":5,"./glyphset":8,"./path":12,"./substitution":13,"./tables/sfnt":32,"./util":34,fs:void 0}],7:[function(e,t,r){function a(e,t){var r=t||{commands:[]};return{configurable:!0,get:function(){return"function"==typeof r&&(r=r()),r},set:function(e){r=e}}}function n(e){this.bindConstructorValues(e)}var i=e("./check"),s=e("./draw"),o=e("./path");n.prototype.bindConstructorValues=function(e){this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],e.xMin&&(this.xMin=e.xMin),e.yMin&&(this.yMin=e.yMin),e.xMax&&(this.xMax=e.xMax),e.yMax&&(this.yMax=e.yMax),e.advanceWidth&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",a(this,e.path))},n.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},n.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},n.prototype.getPath=function(e,t,r,a){e=void 0!==e?e:0,t=void 0!==t?t:0,a=void 0!==a?a:{xScale:1,yScale:1},r=void 0!==r?r:72;for(var n=1/this.path.unitsPerEm*r,i=a.xScale*n,s=a.yScale*n,l=new o.Path,p=this.path.commands,c=0;c<p.length;c+=1){var u=p[c];"M"===u.type?l.moveTo(e+u.x*i,t+-u.y*s):"L"===u.type?l.lineTo(e+u.x*i,t+-u.y*s):"Q"===u.type?l.quadraticCurveTo(e+u.x1*i,t+-u.y1*s,e+u.x*i,t+-u.y*s):"C"===u.type?l.curveTo(e+u.x1*i,t+-u.y1*s,e+u.x2*i,t+-u.y2*s,e+u.x*i,t+-u.y*s):"Z"===u.type&&l.closePath()}return l},n.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],r=0;r<this.points.length;r+=1){var a=this.points[r];t.push(a),a.lastPointOfContour&&(e.push(t),t=[])}return i.argument(0===t.length,"There are still points left in the current contour."),e},n.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],r=[],a=0;a<e.length;a+=1){var n=e[a];"Z"!==n.type&&(t.push(n.x),r.push(n.y)),"Q"!==n.type&&"C"!==n.type||(t.push(n.x1),r.push(n.y1)),"C"===n.type&&(t.push(n.x2),r.push(n.y2))}var i={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(i.xMin)||(i.xMin=0),isFinite(i.xMax)||(i.xMax=this.advanceWidth),isFinite(i.yMin)||(i.yMin=0),isFinite(i.yMax)||(i.yMax=0),i.rightSideBearing=this.advanceWidth-i.leftSideBearing-(i.xMax-i.xMin),i},n.prototype.draw=function(e,t,r,a,n){this.getPath(t,r,a,n).draw(e)},n.prototype.drawPoints=function(e,t,r,a){function n(t,r,a,n){var i=2*Math.PI;e.beginPath();for(var s=0;s<t.length;s+=1)e.moveTo(r+t[s].x*n,a+t[s].y*n),e.arc(r+t[s].x*n,a+t[s].y*n,2,0,i,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,r=void 0!==r?r:0,a=void 0!==a?a:24;for(var i=1/this.path.unitsPerEm*a,s=[],o=[],l=this.path,p=0;p<l.commands.length;p+=1){var c=l.commands[p];void 0!==c.x&&s.push({x:c.x,y:-c.y}),void 0!==c.x1&&o.push({x:c.x1,y:-c.y1}),void 0!==c.x2&&o.push({x:c.x2,y:-c.y2})}e.fillStyle="blue",n(s,t,r,i),e.fillStyle="red",n(o,t,r,i)},n.prototype.drawMetrics=function(e,t,r,a){var n;t=void 0!==t?t:0,r=void 0!==r?r:0,a=void 0!==a?a:24,n=1/this.path.unitsPerEm*a,e.lineWidth=1,e.strokeStyle="black",s.line(e,t,-1e4,t,1e4),s.line(e,-1e4,r,1e4,r);var i=this.xMin||0,o=this.yMin||0,l=this.xMax||0,p=this.yMax||0,c=this.advanceWidth||0;e.strokeStyle="blue",s.line(e,t+i*n,-1e4,t+i*n,1e4),s.line(e,t+l*n,-1e4,t+l*n,1e4),s.line(e,-1e4,r+-o*n,1e4,r+-o*n),s.line(e,-1e4,r+-p*n,1e4,r+-p*n),e.strokeStyle="green",s.line(e,t+c*n,-1e4,t+c*n,1e4)},r.Glyph=n},{"./check":3,"./draw":4,"./path":12}],8:[function(e,t,r){function a(e,t,r){Object.defineProperty(e,t,{get:function(){return e.path,e[r]},set:function(t){e[r]=t},enumerable:!0,configurable:!0})}function n(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var r=0;r<t.length;r++)this.glyphs[r]=t[r];this.length=t&&t.length||0}function i(e,t){return new l.Glyph({index:t,font:e})}function s(e,t,r,n,i,s){return function(){var o=new l.Glyph({index:t,font:e});return o.path=function(){r(o,n,i);var t=s(e.glyphs,o);return t.unitsPerEm=e.unitsPerEm,t},a(o,"xMin","_xMin"),a(o,"xMax","_xMax"),a(o,"yMin","_yMin"),a(o,"yMax","_yMax"),o}}function o(e,t,r,a){return function(){var n=new l.Glyph({index:t,font:e});return n.path=function(){var t=r(e,n,a);return t.unitsPerEm=e.unitsPerEm,t},n}}var l=e("./glyph");n.prototype.get=function(e){return"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]()),this.glyphs[e]},n.prototype.push=function(e,t){this.glyphs[e]=t,this.length++},r.GlyphSet=n,r.glyphLoader=i,r.ttfGlyphLoader=s,r.cffGlyphLoader=o},{"./glyph":7}],9:[function(e,t,r){function a(e,t){for(var r=0,a=e.length-1;r<=a;){var n=r+a>>>1,i=e[n].tag;if(i===t)return n;i<t?r=n+1:a=n-1}return-r-1}function n(e,t){for(var r=0,a=e.length-1;r<=a;){var n=r+a>>>1,i=e[n];if(i===t)return n;i<t?r=n+1:a=n-1}return-r-1}var i=e("./check"),s={searchTag:a,binSearch:n,getScriptNames:function(){var e=this.getGsubTable();return e?e.scripts.map(function(e){return e.tag}):[]},getScriptTable:function(e,t){var r=this.getGsubTable(t);if(r){var n=r.scripts,i=a(r.scripts,e);if(i>=0)return n[i].script;var s={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-i,0,s.script),s}},getLangSysTable:function(e,t,r){var n=this.getScriptTable(e,r);if(n){if("DFLT"===t)return n.defaultLangSys;var i=a(n.langSysRecords,t);if(i>=0)return n.langSysRecords[i].langSys;if(r){var s={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-i,0,s),s.langSys}}},getFeatureTable:function(e,t,r,a){var n=this.getLangSysTable(e,t,a);if(n){for(var s,o=n.featureIndexes,l=this.font.tables.gsub.features,p=0;p<o.length;p++)if(s=l[o[p]],s.tag===r)return s.feature;if(a){var c=l.length;return i.assert(0===c||r>=l[c-1].tag,"Features must be added in alphabetical order."),s={tag:r,feature:{params:0,lookupListIndexes:[]}},l.push(s),o.push(c),s.feature}}},getLookupTable:function(e,t,r,a,n){var i=this.getFeatureTable(e,t,r,n);if(i){for(var s,o=i.lookupListIndexes,l=this.font.tables.gsub.lookups,p=0;p<o.length;p++)if(s=l[o[p]],s.lookupType===a)return s;if(n){s={lookupType:a,lookupFlag:0,subtables:[],markFilteringSet:void 0};var c=l.length;return l.push(s),o.push(c),s}}},expandCoverage:function(e){if(1===e.format)return e.glyphs;for(var t=[],r=e.ranges,a=0;a<r;a++)for(var n=r[a],i=n.start,s=n.end,o=i;o<=s;o++)t.push(o);return t}};t.exports=s},{"./check":3}],10:[function(e,t,r){function a(t,r){var a=e("fs");a.readFile(t,function(e,t){return e?r(e.message):void r(null,y.nodeBufferToArrayBuffer(t))})}function n(e,t){var r=new XMLHttpRequest;r.open("get",e,!0),r.responseType="arraybuffer",r.onload=function(){return 200!==r.status?t("Font could not be loaded: "+r.statusText):t(null,r.response)},r.send()}function i(e,t){for(var r=[],a=12,n=0;n<t;n+=1){var i=m.getTag(e,a),s=m.getULong(e,a+4),o=m.getULong(e,a+8),l=m.getULong(e,a+12);r.push({tag:i,checksum:s,offset:o,length:l,compression:!1}),a+=16}return r}function s(e,t){for(var r=[],a=44,n=0;n<t;n+=1){var i,s=m.getTag(e,a),o=m.getULong(e,a+4),l=m.getULong(e,a+8),p=m.getULong(e,a+12);i=l<p&&"WOFF",r.push({tag:s,offset:o,compression:i,compressedLength:l,originalLength:p}),a+=20}return r}function o(e,t){if("WOFF"===t.compression){var r=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),a=new Uint8Array(t.originalLength);if(u(r,a),a.byteLength!==t.originalLength)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");var n=new DataView(a.buffer,0);return{data:n,offset:0}}return{data:e,offset:t.offset}}function l(e){var t,r,a,n=new h.Font({empty:!0}),l=new DataView(e,0),p=[],c=m.getTag(l,0);if(c===String.fromCharCode(0,1,0,0))n.outlinesFormat="truetype",a=m.getUShort(l,4),p=i(l,a);else if("OTTO"===c)n.outlinesFormat="cff",a=m.getUShort(l,4),p=i(l,a);else{if("wOFF"!==c)throw new Error("Unsupported OpenType signature "+c);var u=m.getTag(l,4);if(u===String.fromCharCode(0,1,0,0))n.outlinesFormat="truetype";else{if("OTTO"!==u)throw new Error("Unsupported OpenType flavor "+c);n.outlinesFormat="cff"}a=m.getUShort(l,12),p=s(l,a)}for(var f,g,v,y,I,L,$,A,D,N,B=0;B<a;B+=1){var z,_=p[B];switch(_.tag){case"cmap":z=o(l,_),n.tables.cmap=b.parse(z.data,z.offset),n.encoding=new d.CmapEncoding(n.tables.cmap);break;case"fvar":g=_;break;case"head":z=o(l,_),n.tables.head=T.parse(z.data,z.offset),n.unitsPerEm=n.tables.head.unitsPerEm,t=n.tables.head.indexToLocFormat;break;case"hhea":z=o(l,_),n.tables.hhea=E.parse(z.data,z.offset),n.ascender=n.tables.hhea.ascender,n.descender=n.tables.hhea.descender,n.numberOfHMetrics=n.tables.hhea.numberOfHMetrics;break;case"hmtx":L=_;break;case"ltag":z=o(l,_),r=O.parse(z.data,z.offset);break;case"maxp":z=o(l,_),n.tables.maxp=j.parse(z.data,z.offset),n.numGlyphs=n.tables.maxp.numGlyphs;break;case"name":D=_;break;case"OS/2":z=o(l,_),n.tables.os2=H.parse(z.data,z.offset);break;case"post":z=o(l,_),n.tables.post=F.parse(z.data,z.offset),n.glyphNames=new d.GlyphNames(n.tables.post);break;case"glyf":v=_;break;case"loca":A=_;break;case"CFF ":f=_;break;case"kern":$=_;break;case"GPOS":y=_;break;case"GSUB":I=_;break;case"meta":N=_}}var G=o(l,D);if(n.tables.name=Z.parse(G.data,G.offset,r),n.names=n.tables.name,v&&A){var V=0===t,W=o(l,A),q=R.parse(W.data,W.offset,n.numGlyphs,V),X=o(l,v);n.glyphs=C.parse(X.data,X.offset,q,n)}else{if(!f)throw new Error("Font doesn't contain TrueType or CFF outlines.");var Y=o(l,f);P.parse(Y.data,Y.offset,n)}var Q=o(l,L);if(k.parse(Q.data,Q.offset,n.numberOfHMetrics,n.numGlyphs,n.glyphs),d.addGlyphNames(n),$){var J=o(l,$);n.kerningPairs=S.parse(J.data,J.offset)}else n.kerningPairs={};if(y){var K=o(l,y);w.parse(K.data,K.offset,n)}if(I){var ee=o(l,I);n.tables.gsub=x.parse(ee.data,ee.offset)}if(g){var te=o(l,g);n.tables.fvar=M.parse(te.data,te.offset,n.names)}if(N){var re=o(l,N);n.tables.meta=U.parse(re.data,re.offset),n.metas=n.tables.meta}return n}function p(e,t){var r="undefined"==typeof window,i=r?a:n;i(e,function(e,r){if(e)return t(e);var a;try{a=l(r)}catch(e){return t(e,null)}return t(null,a)})}function c(t){var r=e("fs"),a=r.readFileSync(t);return l(y.nodeBufferToArrayBuffer(a))}var u=e("tiny-inflate"),d=e("./encoding"),h=e("./font"),f=e("./glyph"),m=e("./parse"),g=e("./bbox"),v=e("./path"),y=e("./util"),b=e("./tables/cmap"),P=e("./tables/cff"),M=e("./tables/fvar"),C=e("./tables/glyf"),w=e("./tables/gpos"),x=e("./tables/gsub"),T=e("./tables/head"),E=e("./tables/hhea"),k=e("./tables/hmtx"),S=e("./tables/kern"),O=e("./tables/ltag"),R=e("./tables/loca"),j=e("./tables/maxp"),Z=e("./tables/name"),H=e("./tables/os2"),F=e("./tables/post"),U=e("./tables/meta");r._parse=m,r.Font=h.Font,r.Glyph=f.Glyph,r.Path=v.Path,r.BoundingBox=g.BoundingBox,r.parse=l,r.load=p,r.loadSync=c},{"./bbox":2,"./encoding":5,"./font":6,"./glyph":7,"./parse":11,"./path":12,"./tables/cff":15,"./tables/cmap":16,"./tables/fvar":17,"./tables/glyf":18,"./tables/gpos":19,"./tables/gsub":20,"./tables/head":21,"./tables/hhea":22,"./tables/hmtx":23,"./tables/kern":24,"./tables/loca":25,"./tables/ltag":26,"./tables/maxp":27,"./tables/meta":28,"./tables/name":29,"./tables/os2":30,"./tables/post":31,"./util":34,fs:void 0,"tiny-inflate":1}],11:[function(e,t,r){function a(e,t){return e.getUint16(t,!1)}function n(e,t){this.data=e,this.offset=t,this.relativeOffset=0}var i=e("./check");r.getByte=function(e,t){return e.getUint8(t)},r.getCard8=r.getByte,r.getUShort=r.getCard16=a,r.getShort=function(e,t){return e.getInt16(t,!1)},r.getULong=function(e,t){return e.getUint32(t,!1)},r.getFixed=function(e,t){var r=e.getInt16(t,!1),a=e.getUint16(t+2,!1);return r+a/65535},r.getTag=function(e,t){for(var r="",a=t;a<t+4;a+=1)r+=String.fromCharCode(e.getInt8(a));return r},r.getOffset=function(e,t,r){for(var a=0,n=0;n<r;n+=1)a<<=8,a+=e.getUint8(t+n);return a},r.getBytes=function(e,t,r){for(var a=[],n=t;n<r;n+=1)a.push(e.getUint8(n));return a},r.bytesToString=function(e){for(var t="",r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return t};var s={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};n.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},n.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},n.prototype.parseCard8=n.prototype.parseByte,n.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},n.prototype.parseCard16=n.prototype.parseUShort,n.prototype.parseSID=n.prototype.parseUShort,n.prototype.parseOffset16=n.prototype.parseUShort,n.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},n.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},n.prototype.parseULong=function(){var e=r.getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},n.prototype.parseFixed=function(){var e=r.getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},n.prototype.parseString=function(e){var t=this.data,r=this.offset+this.relativeOffset,a="";this.relativeOffset+=e;for(var n=0;n<e;n++)a+=String.fromCharCode(t.getUint8(r+n));return a},n.prototype.parseTag=function(){return this.parseString(4)},n.prototype.parseLongDateTime=function(){var e=r.getULong(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},n.prototype.parseVersion=function(){var e=a(this.data,this.offset+this.relativeOffset),t=a(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,e+t/4096/10},n.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=s[e]*t},n.prototype.parseOffset16List=n.prototype.parseUShortList=function(e){void 0===e&&(e=this.parseUShort());for(var t=new Array(e),r=this.data,a=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=r.getUint16(a),a+=2;return this.relativeOffset+=2*e,t},n.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),a=0;a<e;a++)r[a]=t.call(this);return r},n.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),a=Object.keys(t),n=0;n<e;n++){for(var i={},s=0;s<a.length;s++){
var o=a[s],l=t[o];i[o]=l.call(this)}r[n]=i}return r},n.prototype.parseStruct=function(e){if("function"==typeof e)return e.call(this);for(var t=Object.keys(e),r={},a=0;a<t.length;a++){var n=t[a],i=e[n];r[n]=i.call(this)}return r},n.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new n(this.data,this.offset+t).parseStruct(e)},n.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),r=t.length,a=this.relativeOffset,n=new Array(r),i=0;i<r;i++){var s=t[i];if(0!==s)if(this.relativeOffset=s,e){for(var o=this.parseOffset16List(),l=new Array(o.length),p=0;p<o.length;p++)this.relativeOffset=s+o[p],l[p]=e.call(this);n[i]=l}else n[i]=this.parseUShortList();else n[i]=void 0}return this.relativeOffset=a,n},n.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),r=this.parseUShort();if(1===t)return{format:1,glyphs:this.parseUShortList(r)};if(2===t){for(var a=new Array(r),n=0;n<r;n++)a[n]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:a}}i.assert(!1,"0x"+e.toString(16)+": Coverage format must be 1 or 2.")},n.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()}:2===t?{format:2,ranges:this.parseRecordList({start:n.uShort,end:n.uShort,classId:n.uShort})}:void i.assert(!1,"0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},n.list=function(e,t){return function(){return this.parseList(e,t)}},n.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},n.pointer=function(e){return function(){return this.parsePointer(e)}},n.tag=n.prototype.parseTag,n.byte=n.prototype.parseByte,n.uShort=n.offset16=n.prototype.parseUShort,n.uShortList=n.prototype.parseUShortList,n.struct=n.prototype.parseStruct,n.coverage=n.prototype.parseCoverage,n.classDef=n.prototype.parseClassDef;var o={reserved:n.uShort,reqFeatureIndex:n.uShort,featureIndexes:n.uShortList};n.prototype.parseScriptList=function(){return this.parsePointer(n.recordList({tag:n.tag,script:n.pointer({defaultLangSys:n.pointer(o),langSysRecords:n.recordList({tag:n.tag,langSys:n.pointer(o)})})}))},n.prototype.parseFeatureList=function(){return this.parsePointer(n.recordList({tag:n.tag,feature:n.pointer({featureParams:n.offset16,lookupListIndexes:n.uShortList})}))},n.prototype.parseLookupList=function(e){return this.parsePointer(n.list(n.pointer(function(){var t=this.parseUShort();i.argument(1<=t&&t<=8,"GSUB lookup type "+t+" unknown.");var r=this.parseUShort(),a=16&r;return{lookupType:t,lookupFlag:r,subtables:this.parseList(n.pointer(e[t])),markFilteringSet:a?this.parseUShort():void 0}})))},r.Parser=n},{"./check":3}],12:[function(e,t,r){function a(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}var n=e("./bbox");a.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},a.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},a.prototype.curveTo=a.prototype.bezierCurveTo=function(e,t,r,a,n,i){this.commands.push({type:"C",x1:e,y1:t,x2:r,y2:a,x:n,y:i})},a.prototype.quadTo=a.prototype.quadraticCurveTo=function(e,t,r,a){this.commands.push({type:"Q",x1:e,y1:t,x:r,y:a})},a.prototype.close=a.prototype.closePath=function(){this.commands.push({type:"Z"})},a.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof n.BoundingBox){var t=e;return this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),void this.close()}Array.prototype.push.apply(this.commands,e)},a.prototype.getBoundingBox=function(){for(var e=new n.BoundingBox,t=0,r=0,a=0,i=0,s=0;s<this.commands.length;s++){var o=this.commands[s];switch(o.type){case"M":e.addPoint(o.x,o.y),t=a=o.x,r=i=o.y;break;case"L":e.addPoint(o.x,o.y),a=o.x,i=o.y;break;case"Q":e.addQuad(a,i,o.x1,o.y1,o.x,o.y),a=o.x,i=o.y;break;case"C":e.addBezier(a,i,o.x1,o.y1,o.x2,o.y2,o.x,o.y),a=o.x,i=o.y;break;case"Z":a=t,i=r;break;default:throw new Error("Unexpected path commmand "+o.type)}}return e.isEmpty()&&e.addPoint(0,0),e},a.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var r=this.commands[t];"M"===r.type?e.moveTo(r.x,r.y):"L"===r.type?e.lineTo(r.x,r.y):"C"===r.type?e.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):"Q"===r.type?e.quadraticCurveTo(r.x1,r.y1,r.x,r.y):"Z"===r.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},a.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function r(){for(var e="",r=0;r<arguments.length;r+=1){var a=arguments[r];a>=0&&r>0&&(e+=" "),e+=t(a)}return e}e=void 0!==e?e:2;for(var a="",n=0;n<this.commands.length;n+=1){var i=this.commands[n];"M"===i.type?a+="M"+r(i.x,i.y):"L"===i.type?a+="L"+r(i.x,i.y):"C"===i.type?a+="C"+r(i.x1,i.y1,i.x2,i.y2,i.x,i.y):"Q"===i.type?a+="Q"+r(i.x1,i.y1,i.x,i.y):"Z"===i.type&&(a+="Z")}return a},a.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&"black"!==this.fill&&(t+=null===this.fill?' fill="none"':' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},a.prototype.toDOMElement=function(e){var t=this.toPathData(e),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",t),r},r.Path=a},{"./bbox":2}],13:[function(e,t,r){function a(e,t){var r=e.length;if(r!==t.length)return!1;for(var a=0;a<r;a++)if(e[a]!==t[a])return!1;return!0}function n(e,t,r){for(var a=e.subtables,n=0;n<a.length;n++){var i=a[n];if(i.substFormat===t)return i}if(r)return a.push(r),r}var i=e("./check"),s=e("./layout"),o=function(e){this.font=e};o.prototype=s,o.prototype.getGsubTable=function(e){var t=this.font.tables.gsub;return!t&&e&&(this.font.tables.gsub=t={version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}),t},o.prototype.getSingle=function(e,t,r){var a=[],n=this.getLookupTable(t,r,e,1);if(!n)return a;for(var i=n.subtables,s=0;s<i.length;s++){var o,l=i[s],p=this.expandCoverage(l.coverage);if(1===l.substFormat){var c=l.deltaGlyphId;for(o=0;o<p.length;o++){var u=p[o];a.push({sub:u,by:u+c})}}else{var d=l.substitute;for(o=0;o<p.length;o++)a.push({sub:p[o],by:d[o]})}}return a},o.prototype.getAlternates=function(e,t,r){var a=[],n=this.getLookupTable(t,r,e,3);if(!n)return a;for(var i=n.subtables,s=0;s<i.length;s++)for(var o=i[s],l=this.expandCoverage(o.coverage),p=o.alternateSets,c=0;c<l.length;c++)a.push({sub:l[c],by:p[c]});return a},o.prototype.getLigatures=function(e,t,r){var a=[],n=this.getLookupTable(t,r,e,4);if(!n)return[];for(var i=n.subtables,s=0;s<i.length;s++)for(var o=i[s],l=this.expandCoverage(o.coverage),p=o.ligatureSets,c=0;c<l.length;c++)for(var u=l[c],d=p[c],h=0;h<d.length;h++){var f=d[h];a.push({sub:[u].concat(f.components),by:f.ligGlyph})}return a},o.prototype.addSingle=function(e,t,r,a){var s=this.getLookupTable(r,a,e,1,!0),o=n(s,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});i.assert(1===o.coverage.format,"Ligature: unable to modify coverage table format "+o.coverage.format);var l=t.sub,p=this.binSearch(o.coverage.glyphs,l);p<0&&(p=-1-p,o.coverage.glyphs.splice(p,0,l),o.substitute.splice(p,0,0)),o.substitute[p]=t.by},o.prototype.addAlternate=function(e,t,r,a){var s=this.getLookupTable(r,a,e,3,!0),o=n(s,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});i.assert(1===o.coverage.format,"Ligature: unable to modify coverage table format "+o.coverage.format);var l=t.sub,p=this.binSearch(o.coverage.glyphs,l);p<0&&(p=-1-p,o.coverage.glyphs.splice(p,0,l),o.alternateSets.splice(p,0,0)),o.alternateSets[p]=t.by},o.prototype.addLigature=function(e,t,r,n){r=r||"DFLT",n=n||"DFLT";var s=this.getLookupTable(r,n,e,4,!0),o=s.subtables[0];o||(o={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},s.subtables[0]=o),i.assert(1===o.coverage.format,"Ligature: unable to modify coverage table format "+o.coverage.format);var l=t.sub[0],p=t.sub.slice(1),c={ligGlyph:t.by,components:p},u=this.binSearch(o.coverage.glyphs,l);if(u>=0){for(var d=o.ligatureSets[u],h=0;h<d.length;h++)if(a(d[h].components,p))return;d.push(c)}else u=-1-u,o.coverage.glyphs.splice(u,0,l),o.ligatureSets.splice(u,0,[c])},o.prototype.getFeature=function(e,t,r){if(t=t||"DFLT",r=r||"DFLT",/ss\d\d/.test(e))return this.getSingle(e,t,r);switch(e){case"aalt":case"salt":return this.getSingle(e,t,r).concat(this.getAlternates(e,t,r));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,r)}},o.prototype.add=function(e,t,r,a){if(r=r||"DFLT",a=a||"DFLT",/ss\d\d/.test(e))return this.addSingle(e,t,r,a);switch(e){case"aalt":case"salt":return"number"==typeof t.by?this.addSingle(e,t,r,a):this.addAlternate(e,t,r,a);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,r,a)}},t.exports=o},{"./check":3,"./layout":9}],14:[function(e,t,r){function a(e,t,r){var a;for(a=0;a<t.length;a+=1){var n=t[a];this[n.name]=n.value}if(this.tableName=e,this.fields=t,r){var i=Object.keys(r);for(a=0;a<i.length;a+=1){var s=i[a],o=r[s];void 0!==this[s]&&(this[s]=o)}}}function n(e,t,r){void 0===r&&(r=t.length);var a=new Array(t.length+1);a[0]={name:e+"Count",type:"USHORT",value:r};for(var n=0;n<t.length;n++)a[n+1]={name:e+n,type:"USHORT",value:t[n]};return a}function i(e,t,r){var a=t.length,n=new Array(a+1);n[0]={name:e+"Count",type:"USHORT",value:a};for(var i=0;i<a;i++)n[i+1]={name:e+i,type:"TABLE",value:r(t[i],i)};return n}function s(e,t,r){var a=t.length,n=[];n[0]={name:e+"Count",type:"USHORT",value:a};for(var i=0;i<a;i++)n=n.concat(r(t[i],i));return n}function o(e){1===e.format?a.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(n("glyph",e.glyphs))):u.assert(!1,"Can't create coverage table format 2 yet.")}function l(e){a.call(this,"scriptListTable",s("scriptRecord",e,function(e,t){var r=e.script,i=r.defaultLangSys;return u.assert(!!i,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new a("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new a("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(n("featureIndex",i.featureIndexes)))}].concat(s("langSys",r.langSysRecords,function(e,t){var r=e.langSys;return[{name:"langSysTag"+t,type:"TAG",value:e.tag},{name:"langSys"+t,type:"TABLE",value:new a("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(n("featureIndex",r.featureIndexes)))}]})))}]}))}function p(e){a.call(this,"featureListTable",s("featureRecord",e,function(e,t){var r=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new a("featureTable",[{name:"featureParams",type:"USHORT",value:r.featureParams}].concat(n("lookupListIndex",r.lookupListIndexes)))}]}))}function c(e,t){a.call(this,"lookupListTable",i("lookup",e,function(e){var r=t[e.lookupType];return u.assert(!!r,"Unable to write GSUB lookup type "+e.lookupType+" tables."),new a("lookupTable",[{name:"lookupType",type:"USHORT",value:e.lookupType},{name:"lookupFlag",type:"USHORT",value:e.lookupFlag}].concat(i("subtable",e.subtables,r)))}))}var u=e("./check"),d=e("./types").encode,h=e("./types").sizeOf;a.prototype.encode=function(){return d.TABLE(this)},a.prototype.sizeOf=function(){return h.TABLE(this)},o.prototype=Object.create(a.prototype),o.prototype.constructor=o,l.prototype=Object.create(a.prototype),l.prototype.constructor=l,p.prototype=Object.create(a.prototype),p.prototype.constructor=p,c.prototype=Object.create(a.prototype),c.prototype.constructor=c,r.Record=r.Table=a,r.Coverage=o,r.ScriptList=l,r.FeatureList=p,r.LookupList=c,r.ushortList=n,r.tableList=i,r.recordList=s},{"./check":3,"./types":33}],15:[function(e,t,r){function a(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r+=1)if(!a(e[r],t[r]))return!1;return!0}return!1}function n(e,t,r){var a,n,i,s=[],o=[],l=F.getCard16(e,t);if(0!==l){var p=F.getByte(e,t+2);n=t+(l+1)*p+2;var c=t+3;for(a=0;a<l+1;a+=1)s.push(F.getOffset(e,c,p)),c+=p;i=n+s[l]}else i=t+2;for(a=0;a<s.length-1;a+=1){var u=F.getBytes(e,n+s[a],n+s[a+1]);r&&(u=r(u)),o.push(u)}return{objects:o,startOffset:t,endOffset:i}}function i(e){for(var t="",r=15,a=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var n=e.parseByte(),i=n>>4,s=15&n;if(i===r)break;if(t+=a[i],s===r)break;t+=a[s]}return parseFloat(t)}function s(e,t){var r,a,n,s;if(28===t)return r=e.parseByte(),a=e.parseByte(),r<<8|a;if(29===t)return r=e.parseByte(),a=e.parseByte(),n=e.parseByte(),s=e.parseByte(),r<<24|a<<16|n<<8|s;if(30===t)return i(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return r=e.parseByte(),256*(t-247)+r+108;if(t>=251&&t<=254)return r=e.parseByte(),256*-(t-251)-r-108;throw new Error("Invalid b0 "+t)}function o(e){for(var t={},r=0;r<e.length;r+=1){var a,n=e[r][0],i=e[r][1];if(a=1===i.length?i[0]:i,t.hasOwnProperty(n))throw new Error("Object "+t+" already has key "+n);t[n]=a}return t}function l(e,t,r){t=void 0!==t?t:0;var a=new F.Parser(e,t),n=[],i=[];for(r=void 0!==r?r:e.length;a.relativeOffset<r;){var l=a.parseByte();l<=21?(12===l&&(l=1200+a.parseByte()),n.push([l,i]),i=[]):i.push(s(a,l))}return o(n)}function p(e,t){return t=t<=390?Z.cffStandardStrings[t]:e[t-391]}function c(e,t,r){for(var a={},n=0;n<t.length;n+=1){var i=t[n],s=e[i.op];void 0===s&&(s=void 0!==i.value?i.value:null),"SID"===i.type&&(s=p(r,s)),a[i.name]=s}return a}function u(e,t){var r={};return r.formatMajor=F.getCard8(e,t),r.formatMinor=F.getCard8(e,t+1),r.size=F.getCard8(e,t+2),r.offsetSize=F.getCard8(e,t+3),r.startOffset=t,r.endOffset=t+4,r}function d(e,t){var r=l(e,0,e.byteLength);return c(r,L,t)}function h(e,t,r,a){var n=l(e,t,r);return c(n,$,a)}function f(e,t,r,a){var n,i,s,o=new F.Parser(e,t);r-=1;var l=[".notdef"],c=o.parseCard8();if(0===c)for(n=0;n<r;n+=1)i=o.parseSID(),l.push(p(a,i));else if(1===c)for(;l.length<=r;)for(i=o.parseSID(),s=o.parseCard8(),n=0;n<=s;n+=1)l.push(p(a,i)),i+=1;else{if(2!==c)throw new Error("Unknown charset format "+c);for(;l.length<=r;)for(i=o.parseSID(),s=o.parseCard16(),n=0;n<=s;n+=1)l.push(p(a,i)),i+=1}return l}function m(e,t,r){var a,n,i={},s=new F.Parser(e,t),o=s.parseCard8();if(0===o){var l=s.parseCard8();for(a=0;a<l;a+=1)n=s.parseCard8(),i[n]=a}else{if(1!==o)throw new Error("Unknown encoding format "+o);var p=s.parseCard8();for(n=1,a=0;a<p;a+=1)for(var c=s.parseCard8(),u=s.parseCard8(),d=c;d<=c+u;d+=1)i[d]=n,n+=1}return new Z.CffEncoding(i,r)}function g(e,t,r){function a(e,t){m&&c.closePath(),c.moveTo(e,t),m=!0}function n(){var t;t=u.length%2!==0,t&&!h&&(f=u.shift()+e.nominalWidthX),d+=u.length>>1,u.length=0,h=!0}function i(r){for(var y,b,P,M,C,w,x,T,E,k,S,O,R=0;R<r.length;){var j=r[R];switch(R+=1,j){case 1:n();break;case 3:n();break;case 4:u.length>1&&!h&&(f=u.shift()+e.nominalWidthX,h=!0),v+=u.pop(),a(g,v);break;case 5:for(;u.length>0;)g+=u.shift(),v+=u.shift(),c.lineTo(g,v);break;case 6:for(;u.length>0&&(g+=u.shift(),c.lineTo(g,v),0!==u.length);)v+=u.shift(),c.lineTo(g,v);break;case 7:for(;u.length>0&&(v+=u.shift(),c.lineTo(g,v),0!==u.length);)g+=u.shift(),c.lineTo(g,v);break;case 8:for(;u.length>0;)s=g+u.shift(),o=v+u.shift(),l=s+u.shift(),p=o+u.shift(),g=l+u.shift(),v=p+u.shift(),c.curveTo(s,o,l,p,g,v);break;case 10:C=u.pop()+e.subrsBias,w=e.subrs[C],w&&i(w);break;case 11:return;case 12:switch(j=r[R],R+=1,j){case 35:s=g+u.shift(),o=v+u.shift(),l=s+u.shift(),p=o+u.shift(),x=l+u.shift(),T=p+u.shift(),E=x+u.shift(),k=T+u.shift(),S=E+u.shift(),O=k+u.shift(),g=S+u.shift(),v=O+u.shift(),u.shift(),c.curveTo(s,o,l,p,x,T),c.curveTo(E,k,S,O,g,v);break;case 34:s=g+u.shift(),o=v,l=s+u.shift(),p=o+u.shift(),x=l+u.shift(),T=p,E=x+u.shift(),k=p,S=E+u.shift(),O=v,g=S+u.shift(),c.curveTo(s,o,l,p,x,T),c.curveTo(E,k,S,O,g,v);break;case 36:s=g+u.shift(),o=v+u.shift(),l=s+u.shift(),p=o+u.shift(),x=l+u.shift(),T=p,E=x+u.shift(),k=p,S=E+u.shift(),O=k+u.shift(),g=S+u.shift(),c.curveTo(s,o,l,p,x,T),c.curveTo(E,k,S,O,g,v);break;case 37:s=g+u.shift(),o=v+u.shift(),l=s+u.shift(),p=o+u.shift(),x=l+u.shift(),T=p+u.shift(),E=x+u.shift(),k=T+u.shift(),S=E+u.shift(),O=k+u.shift(),Math.abs(S-g)>Math.abs(O-v)?g=S+u.shift():v=O+u.shift(),c.curveTo(s,o,l,p,x,T),c.curveTo(E,k,S,O,g,v);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+j),u.length=0}break;case 14:u.length>0&&!h&&(f=u.shift()+e.nominalWidthX,h=!0),m&&(c.closePath(),m=!1);break;case 18:n();break;case 19:case 20:n(),R+=d+7>>3;break;case 21:u.length>2&&!h&&(f=u.shift()+e.nominalWidthX,h=!0),v+=u.pop(),g+=u.pop(),a(g,v);break;case 22:u.length>1&&!h&&(f=u.shift()+e.nominalWidthX,h=!0),g+=u.pop(),a(g,v);break;case 23:n();break;case 24:for(;u.length>2;)s=g+u.shift(),o=v+u.shift(),l=s+u.shift(),p=o+u.shift(),g=l+u.shift(),v=p+u.shift(),c.curveTo(s,o,l,p,g,v);g+=u.shift(),v+=u.shift(),c.lineTo(g,v);break;case 25:for(;u.length>6;)g+=u.shift(),v+=u.shift(),c.lineTo(g,v);s=g+u.shift(),o=v+u.shift(),l=s+u.shift(),p=o+u.shift(),g=l+u.shift(),v=p+u.shift(),c.curveTo(s,o,l,p,g,v);break;case 26:for(u.length%2&&(g+=u.shift());u.length>0;)s=g,o=v+u.shift(),l=s+u.shift(),p=o+u.shift(),g=l,v=p+u.shift(),c.curveTo(s,o,l,p,g,v);break;case 27:for(u.length%2&&(v+=u.shift());u.length>0;)s=g+u.shift(),o=v,l=s+u.shift(),p=o+u.shift(),g=l+u.shift(),v=p,c.curveTo(s,o,l,p,g,v);break;case 28:y=r[R],b=r[R+1],u.push((y<<24|b<<16)>>16),R+=2;break;case 29:C=u.pop()+e.gsubrsBias,w=e.gsubrs[C],w&&i(w);break;case 30:for(;u.length>0&&(s=g,o=v+u.shift(),l=s+u.shift(),p=o+u.shift(),g=l+u.shift(),v=p+(1===u.length?u.shift():0),c.curveTo(s,o,l,p,g,v),0!==u.length);)s=g+u.shift(),o=v,l=s+u.shift(),p=o+u.shift(),v=p+u.shift(),g=l+(1===u.length?u.shift():0),c.curveTo(s,o,l,p,g,v);break;case 31:for(;u.length>0&&(s=g+u.shift(),o=v,l=s+u.shift(),p=o+u.shift(),v=p+u.shift(),g=l+(1===u.length?u.shift():0),c.curveTo(s,o,l,p,g,v),0!==u.length);)s=g,o=v+u.shift(),l=s+u.shift(),p=o+u.shift(),g=l+u.shift(),v=p+(1===u.length?u.shift():0),c.curveTo(s,o,l,p,g,v);break;default:j<32?console.log("Glyph "+t.index+": unknown operator "+j):j<247?u.push(j-139):j<251?(y=r[R],R+=1,u.push(256*(j-247)+y+108)):j<255?(y=r[R],R+=1,u.push(256*-(j-251)-y-108)):(y=r[R],b=r[R+1],P=r[R+2],M=r[R+3],R+=4,u.push((y<<24|b<<16|P<<8|M)/65536))}}}var s,o,l,p,c=new U.Path,u=[],d=0,h=!1,f=e.defaultWidthX,m=!1,g=0,v=0;return i(r),t.advanceWidth=f,c}function v(e){var t;return t=e.length<1240?107:e.length<33900?1131:32768}function y(e,t,r){r.tables.cff={};var a=u(e,t),i=n(e,a.endOffset,F.bytesToString),s=n(e,i.endOffset),o=n(e,s.endOffset,F.bytesToString),l=n(e,o.endOffset);r.gsubrs=l.objects,r.gsubrsBias=v(r.gsubrs);var p=new DataView(new Uint8Array(s.objects[0]).buffer),c=d(p,o.objects);r.tables.cff.topDict=c;var y=t+c.private[1],b=h(e,y,c.private[0],o.objects);if(r.defaultWidthX=b.defaultWidthX,r.nominalWidthX=b.nominalWidthX,0!==b.subrs){var P=y+b.subrs,M=n(e,P);r.subrs=M.objects,r.subrsBias=v(r.subrs)}else r.subrs=[],r.subrsBias=0;var C=n(e,t+c.charStrings);r.nGlyphs=C.objects.length;var w=f(e,t+c.charset,r.nGlyphs,o.objects);0===c.encoding?r.cffEncoding=new Z.CffEncoding(Z.cffStandardEncoding,w):1===c.encoding?r.cffEncoding=new Z.CffEncoding(Z.cffExpertEncoding,w):r.cffEncoding=m(e,t+c.encoding,w),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new H.GlyphSet(r);for(var x=0;x<r.nGlyphs;x+=1){var T=C.objects[x];r.glyphs.push(x,H.cffGlyphLoader(r,x,g,T))}}function b(e,t){var r,a=Z.cffStandardStrings.indexOf(e);return a>=0&&(r=a),a=t.indexOf(e),a>=0?r=a+Z.cffStandardStrings.length:(r=Z.cffStandardStrings.length+t.length,t.push(e)),r}function P(){return new I.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function M(e){var t=new I.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var r=0;r<e.length;r+=1)t.names.push({name:"name_"+r,type:"NAME",value:e[r]});return t}function C(e,t,r){for(var n={},i=0;i<e.length;i+=1){var s=e[i],o=t[s.name];void 0===o||a(o,s.value)||("SID"===s.type&&(o=b(o,r)),n[s.op]={name:s.name,type:s.type,value:o})}return n}function w(e,t){var r=new I.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=C(L,e,t),r}function x(e){var t=new I.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function T(e){var t=new I.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var r=0;r<e.length;r+=1)t.strings.push({name:"string_"+r,type:"STRING",value:e[r]});return t}function E(){return new I.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function k(e,t){for(var r=new I.Record("Charsets",[{name:"format",type:"Card8",value:0}]),a=0;a<e.length;a+=1){var n=e[a],i=b(n,t);r.fields.push({name:"glyph_"+a,type:"SID",value:i})}return r}function S(e){var t=[],r=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var a=0,n=0,i=0;i<r.commands.length;i+=1){var s,o,l=r.commands[i];if("Q"===l.type){var p=1/3,c=2/3;l={type:"C",x:l.x,y:l.y,x1:p*a+c*l.x1,y1:p*n+c*l.y1,x2:p*l.x+c*l.x1,y2:p*l.y+c*l.y1}}if("M"===l.type)s=Math.round(l.x-a),o=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rmoveto",type:"OP",value:21}),a=Math.round(l.x),n=Math.round(l.y);else if("L"===l.type)s=Math.round(l.x-a),o=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rlineto",type:"OP",value:5}),a=Math.round(l.x),n=Math.round(l.y);else if("C"===l.type){var u=Math.round(l.x1-a),d=Math.round(l.y1-n),h=Math.round(l.x2-l.x1),f=Math.round(l.y2-l.y1);s=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),t.push({name:"dx1",type:"NUMBER",value:u}),t.push({name:"dy1",type:"NUMBER",value:d}),t.push({name:"dx2",type:"NUMBER",value:h}),t.push({name:"dy2",type:"NUMBER",value:f}),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rrcurveto",type:"OP",value:8}),a=Math.round(l.x),n=Math.round(l.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}function O(e){for(var t=new I.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<e.length;r+=1){var a=e.get(r),n=S(a);t.charStrings.push({name:a.name,type:"CHARSTRING",value:n})}return t}function R(e,t){var r=new I.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=C($,e,t),r}function j(e,t){for(var r,a=new I.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/t.unitsPerEm,i={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s={},o=[],l=1;l<e.length;l+=1)r=e.get(l),o.push(r.name);var p=[];a.header=P(),a.nameIndex=M([t.postScriptName]);var c=w(i,p);a.topDictIndex=x(c),a.globalSubrIndex=E(),a.charsets=k(o,p),a.charStringsIndex=O(e),a.privateDict=R(s,p),a.stringIndex=T(p);var u=a.header.sizeOf()+a.nameIndex.sizeOf()+a.topDictIndex.sizeOf()+a.stringIndex.sizeOf()+a.globalSubrIndex.sizeOf();return i.charset=u,i.encoding=0,i.charStrings=i.charset+a.charsets.sizeOf(),i.private[1]=i.charStrings+a.charStringsIndex.sizeOf(),c=w(i,p),a.topDictIndex=x(c),a}var Z=e("../encoding"),H=e("../glyphset"),F=e("../parse"),U=e("../path"),I=e("../table"),L=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}],$=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];r.parse=y,r.make=j},{"../encoding":5,"../glyphset":8,"../parse":11,"../path":12,"../table":14}],16:[function(e,t,r){function a(e,t){var r;t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong();var a;for(e.groupCount=a=t.parseULong(),e.glyphIndexMap={},r=0;r<a;r+=1)for(var n=t.parseULong(),i=t.parseULong(),s=t.parseULong(),o=n;o<=i;o+=1)e.glyphIndexMap[o]=s,s++}function n(e,t,r,a,n){var i;e.length=t.parseUShort(),e.language=t.parseUShort();var s;e.segCount=s=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};var o=new c.Parser(r,a+n+14),l=new c.Parser(r,a+n+16+2*s),p=new c.Parser(r,a+n+16+4*s),u=new c.Parser(r,a+n+16+6*s),d=a+n+16+8*s;for(i=0;i<s-1;i+=1)for(var h,f=o.parseUShort(),m=l.parseUShort(),g=p.parseShort(),v=u.parseUShort(),y=m;y<=f;y+=1)0!==v?(d=u.offset+u.relativeOffset-2,d+=v,d+=2*(y-m),h=c.getUShort(r,d),0!==h&&(h=h+g&65535)):h=y+g&65535,e.glyphIndexMap[y]=h}function i(e,t){var r,i={};i.version=c.getUShort(e,t),p.argument(0===i.version,"cmap table version should be 0."),i.numTables=c.getUShort(e,t+2);var s=-1;for(r=i.numTables-1;r>=0;r-=1){var o=c.getUShort(e,t+4+8*r),l=c.getUShort(e,t+4+8*r+2);if(3===o&&(0===l||1===l||10===l)){s=c.getULong(e,t+4+8*r+4);break}}if(s===-1)return null;var u=new c.Parser(e,t+s);if(i.format=u.parseUShort(),12===i.format)a(i,u);else{if(4!==i.format)throw new Error("Only format 4 and 12 cmap tables are supported.");n(i,u,e,t,s)}return i}function s(e,t,r){e.segments.push({end:t,start:t,delta:-(t-r),offset:0})}function o(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}function l(e){var t,r=new u.Table("cmap",[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:1},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:12},{name:"format",type:"USHORT",value:4},{name:"length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);for(r.segments=[],t=0;t<e.length;t+=1){for(var a=e.get(t),n=0;n<a.unicodes.length;n+=1)s(r,a.unicodes[n],t);r.segments=r.segments.sort(function(e,t){return e.start-t.start})}o(r);var i;i=r.segments.length,r.segCountX2=2*i,r.searchRange=2*Math.pow(2,Math.floor(Math.log(i)/Math.log(2))),r.entrySelector=Math.log(r.searchRange/2)/Math.log(2),r.rangeShift=r.segCountX2-r.searchRange;var l=[],p=[],c=[],d=[],h=[];for(t=0;t<i;t+=1){var f=r.segments[t];l=l.concat({name:"end_"+t,type:"USHORT",value:f.end}),p=p.concat({name:"start_"+t,type:"USHORT",value:f.start}),c=c.concat({name:"idDelta_"+t,type:"SHORT",value:f.delta}),d=d.concat({name:"idRangeOffset_"+t,type:"USHORT",value:f.offset}),void 0!==f.glyphId&&(h=h.concat({name:"glyph_"+t,type:"USHORT",value:f.glyphId}))}return r.fields=r.fields.concat(l),r.fields.push({name:"reservedPad",type:"USHORT",value:0}),r.fields=r.fields.concat(p),r.fields=r.fields.concat(c),r.fields=r.fields.concat(d),r.fields=r.fields.concat(h),r.length=14+2*l.length+2+2*p.length+2*c.length+2*d.length+2*h.length,r}var p=e("../check"),c=e("../parse"),u=e("../table");r.parse=i,r.make=l},{"../check":3,"../parse":11,"../table":14}],17:[function(e,t,r){function a(e,t){var r=JSON.stringify(e),a=256;for(var n in t){var i=parseInt(n);if(i&&!(i<256)){if(JSON.stringify(t[n])===r)return i;a<=i&&(a=i+1)}}return t[a]=e,a}function n(e,t,r){var n=a(t.name,r);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:n}]}function i(e,t,r){var a={},n=new u.Parser(e,t);return a.tag=n.parseTag(),a.minValue=n.parseFixed(),a.defaultValue=n.parseFixed(),a.maxValue=n.parseFixed(),n.skip("uShort",1),a.name=r[n.parseUShort()]||{},a}function s(e,t,r,n){for(var i=a(t.name,n),s=[{name:"nameID_"+e,type:"USHORT",value:i},{name:"flags_"+e,type:"USHORT",value:0}],o=0;o<r.length;++o){var l=r[o].tag;s.push({name:"axis_"+e+" "+l,type:"FIXED",value:t.coordinates[l]<<16})}return s}function o(e,t,r,a){var n={},i=new u.Parser(e,t);n.name=a[i.parseUShort()]||{},i.skip("uShort",1),n.coordinates={};for(var s=0;s<r.length;++s)n.coordinates[r[s].tag]=i.parseFixed();return n}function l(e,t){var r=new d.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);r.offsetToData=r.sizeOf();for(var a=0;a<e.axes.length;a++)r.fields=r.fields.concat(n(a,e.axes[a],t));for(var i=0;i<e.instances.length;i++)r.fields=r.fields.concat(s(i,e.instances[i],e.axes,t));return r}function p(e,t,r){var a=new u.Parser(e,t),n=a.parseULong();c.argument(65536===n,"Unsupported fvar table version.");var s=a.parseOffset16();a.skip("uShort",1);for(var l=a.parseUShort(),p=a.parseUShort(),d=a.parseUShort(),h=a.parseUShort(),f=[],m=0;m<l;m++)f.push(i(e,t+s+m*p,r));for(var g=[],v=t+s+l*p,y=0;y<d;y++)g.push(o(e,v+y*h,f,r));return{axes:f,instances:g}}var c=e("../check"),u=e("../parse"),d=e("../table");r.make=l,r.parse=p},{"../check":3,"../parse":11,"../table":14}],18:[function(e,t,r){function a(e,t,r,a,n){var i;return(t&a)>0?(i=e.parseByte(),0===(t&n)&&(i=-i),i=r+i):i=(t&n)>0?r:r+e.parseShort(),i}function n(e,t,r){var n=new d.Parser(t,r);e.numberOfContours=n.parseShort(),e._xMin=n.parseShort(),e._yMin=n.parseShort(),e._xMax=n.parseShort(),e._yMax=n.parseShort();var i,s;if(e.numberOfContours>0){var o,l=e.endPointIndices=[];for(o=0;o<e.numberOfContours;o+=1)l.push(n.parseUShort());for(e.instructionLength=n.parseUShort(),e.instructions=[],o=0;o<e.instructionLength;o+=1)e.instructions.push(n.parseByte());var p=l[l.length-1]+1;for(i=[],o=0;o<p;o+=1)if(s=n.parseByte(),i.push(s),(8&s)>0)for(var u=n.parseByte(),h=0;h<u;h+=1)i.push(s),o+=1;if(c.argument(i.length===p,"Bad flags."),l.length>0){var f,m=[];if(p>0){for(o=0;o<p;o+=1)s=i[o],f={},f.onCurve=!!(1&s),f.lastPointOfContour=l.indexOf(o)>=0,m.push(f);var g=0;for(o=0;o<p;o+=1)s=i[o],f=m[o],f.x=a(n,s,g,2,16),g=f.x;var v=0;for(o=0;o<p;o+=1)s=i[o],f=m[o],f.y=a(n,s,v,4,32),v=f.y}e.points=m}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var y=!0;y;){i=n.parseUShort();var b={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&i)>0?(2&i)>0?(b.dx=n.parseShort(),b.dy=n.parseShort()):b.matchedPoints=[n.parseUShort(),n.parseUShort()]:(2&i)>0?(b.dx=n.parseChar(),b.dy=n.parseChar()):b.matchedPoints=[n.parseByte(),n.parseByte()],
(8&i)>0?b.xScale=b.yScale=n.parseF2Dot14():(64&i)>0?(b.xScale=n.parseF2Dot14(),b.yScale=n.parseF2Dot14()):(128&i)>0&&(b.xScale=n.parseF2Dot14(),b.scale01=n.parseF2Dot14(),b.scale10=n.parseF2Dot14(),b.yScale=n.parseF2Dot14()),e.components.push(b),y=!!(32&i)}}}function i(e,t){for(var r=[],a=0;a<e.length;a+=1){var n=e[a],i={x:t.xScale*n.x+t.scale01*n.y+t.dx,y:t.scale10*n.x+t.yScale*n.y+t.dy,onCurve:n.onCurve,lastPointOfContour:n.lastPointOfContour};r.push(i)}return r}function s(e){for(var t=[],r=[],a=0;a<e.length;a+=1){var n=e[a];r.push(n),n.lastPointOfContour&&(t.push(r),r=[])}return c.argument(0===r.length,"There are still points left in the current contour."),t}function o(e){var t=new h.Path;if(!e)return t;for(var r=s(e),a=0;a<r.length;a+=1){var n,i,o=r[a],l=o[0],p=o[o.length-1];l.onCurve?(n=null,i=!0):(l=p.onCurve?p:{x:(l.x+p.x)/2,y:(l.y+p.y)/2},n=l,i=!1),t.moveTo(l.x,l.y);for(var c=i?1:0;c<o.length;c+=1){var u=o[c],d=0===c?l:o[c-1];if(d.onCurve&&u.onCurve)t.lineTo(u.x,u.y);else if(d.onCurve&&!u.onCurve)n=u;else if(d.onCurve||u.onCurve){if(d.onCurve||!u.onCurve)throw new Error("Invalid state.");t.quadraticCurveTo(n.x,n.y,u.x,u.y),n=null}else{var f={x:(d.x+u.x)/2,y:(d.y+u.y)/2};t.quadraticCurveTo(d.x,d.y,f.x,f.y),n=u}}l!==p&&(n?t.quadraticCurveTo(n.x,n.y,l.x,l.y):t.lineTo(l.x,l.y))}return t.closePath(),t}function l(e,t){if(t.isComposite)for(var r=0;r<t.components.length;r+=1){var a=t.components[r],n=e.get(a.glyphIndex);if(n.getPath(),n.points){var s;if(void 0===a.matchedPoints)s=i(n.points,a);else{if(a.matchedPoints[0]>t.points.length-1||a.matchedPoints[1]>n.points.length-1)throw Error("Matched points out of range in "+t.name);var l=t.points[a.matchedPoints[0]],p=n.points[a.matchedPoints[1]],c={xScale:a.xScale,scale01:a.scale01,scale10:a.scale10,yScale:a.yScale,dx:0,dy:0};p=i([p],c)[0],c.dx=l.x-p.x,c.dy=l.y-p.y,s=i(n.points,c)}t.points=t.points.concat(s)}}return o(t.points)}function p(e,t,r,a){var i,s=new u.GlyphSet(a);for(i=0;i<r.length-1;i+=1){var o=r[i],p=r[i+1];o!==p?s.push(i,u.ttfGlyphLoader(a,i,n,e,t+o,l)):s.push(i,u.glyphLoader(a,i))}return s}var c=e("../check"),u=e("../glyphset"),d=e("../parse"),h=e("../path");r.parse=p},{"../check":3,"../glyphset":8,"../parse":11,"../path":12}],19:[function(e,t,r){function a(e,t){for(var r=new c.Parser(e,t),a=r.parseUShort(),n=[],i=0;i<a;i++)n[r.parseTag()]={offset:r.parseUShort()};return n}function n(e,t){var r=new c.Parser(e,t),a=r.parseUShort(),n=r.parseUShort();if(1===a)return r.parseUShortList(n);if(2===a){for(var i=[];n--;)for(var s=r.parseUShort(),o=r.parseUShort(),l=r.parseUShort(),p=s;p<=o;p++)i[l++]=p;return i}}function i(e,t){var r=new c.Parser(e,t),a=r.parseUShort();if(1===a){var n=r.parseUShort(),i=r.parseUShort(),s=r.parseUShortList(i);return function(e){return s[e-n]||0}}if(2===a){for(var o=r.parseUShort(),l=[],p=[],u=[],d=0;d<o;d++)l[d]=r.parseUShort(),p[d]=r.parseUShort(),u[d]=r.parseUShort();return function(e){for(var t=0,r=l.length-1;t<r;){var a=t+r+1>>1;e<l[a]?r=a-1:t=a}return l[t]<=e&&e<=p[t]?u[t]||0:0}}}function s(e,t){var r,a,s=new c.Parser(e,t),o=s.parseUShort(),l=s.parseUShort(),p=n(e,t+l),u=s.parseUShort(),d=s.parseUShort();if(4===u&&0===d){var h={};if(1===o){for(var f=s.parseUShort(),m=[],g=s.parseOffset16List(f),v=0;v<f;v++){var y=g[v],b=h[y];if(!b){b={},s.relativeOffset=y;for(var P=s.parseUShort();P--;){var M=s.parseUShort();u&&(r=s.parseShort()),d&&(a=s.parseShort()),b[M]=r}}m[p[v]]=b}return function(e,t){var r=m[e];if(r)return r[t]}}if(2===o){for(var C=s.parseUShort(),w=s.parseUShort(),x=s.parseUShort(),T=s.parseUShort(),E=i(e,t+C),k=i(e,t+w),S=[],O=0;O<x;O++)for(var R=S[O]=[],j=0;j<T;j++)u&&(r=s.parseShort()),d&&(a=s.parseShort()),R[j]=r;var Z={};for(O=0;O<p.length;O++)Z[p[O]]=1;return function(e,t){if(Z[e]){var r=E(e),a=k(t),n=S[r];return n?n[a]:void 0}}}}}function o(e,t){var r=new c.Parser(e,t),a=r.parseUShort(),n=r.parseUShort(),i=16&n,o=r.parseUShort(),l=r.parseOffset16List(o),p={lookupType:a,lookupFlag:n,markFilteringSet:i?r.parseUShort():-1};if(2===a){for(var u=[],d=0;d<o;d++)u.push(s(e,t+l[d]));p.getKerningValue=function(e,t){for(var r=u.length;r--;){var a=u[r](e,t);if(void 0!==a)return a}return 0}}return p}function l(e,t,r){var n=new c.Parser(e,t),i=n.parseFixed();p.argument(1===i,"Unsupported GPOS table version."),a(e,t+n.parseUShort()),a(e,t+n.parseUShort());var s=n.parseUShort();n.relativeOffset=s;for(var l=n.parseUShort(),u=n.parseOffset16List(l),d=t+s,h=0;h<l;h++){var f=o(e,d+u[h]);2!==f.lookupType||r.getGposKerningValue||(r.getGposKerningValue=f.getKerningValue)}}var p=e("../check"),c=e("../parse");r.parse=l},{"../check":3,"../parse":11}],20:[function(e,t,r){function a(e,t){t=t||0;var r=new s(e,t),a=r.parseVersion();return i.argument(1===a,"Unsupported GSUB table version."),{version:a,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(o)}}function n(e){return new l.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new l.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new l.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new l.LookupList(e.lookups,c)}])}var i=e("../check"),s=e("../parse").Parser,o=new Array(9),l=e("../table");o[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(s.coverage),deltaGlyphId:this.parseUShort()}:2===t?{substFormat:2,coverage:this.parsePointer(s.coverage),substitute:this.parseOffset16List()}:void i.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},o[2]=function(){var e=this.parseUShort();return i.argument(1===e,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(s.coverage),sequences:this.parseListOfLists()}},o[3]=function(){var e=this.parseUShort();return i.argument(1===e,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(s.coverage),alternateSets:this.parseListOfLists()}},o[4]=function(){var e=this.parseUShort();return i.argument(1===e,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(s.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var p={sequenceIndex:s.uShort,lookupListIndex:s.uShort};o[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{substFormat:t,coverage:this.parsePointer(s.coverage),ruleSets:this.parseListOfLists(function(){var e=this.parseUShort(),t=this.parseUShort();return{input:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,p)}})};if(2===t)return{substFormat:t,coverage:this.parsePointer(s.coverage),classDef:this.parsePointer(s.classDef),classSets:this.parseListOfLists(function(){var e=this.parseUShort(),t=this.parseUShort();return{classes:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,p)}})};if(3===t){var r=this.parseUShort(),a=this.parseUShort();return{substFormat:t,coverages:this.parseList(r,s.pointer(s.coverage)),lookupRecords:this.parseRecordList(a,p)}}i.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},o[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(s.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(p)}})}:2===t?{substFormat:2,coverage:this.parsePointer(s.coverage),backtrackClassDef:this.parsePointer(s.classDef),inputClassDef:this.parsePointer(s.classDef),lookaheadClassDef:this.parsePointer(s.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(p)}})}:3===t?{substFormat:3,backtrackCoverage:this.parseList(s.pointer(s.coverage)),inputCoverage:this.parseList(s.pointer(s.coverage)),lookaheadCoverage:this.parseList(s.pointer(s.coverage)),lookupRecords:this.parseRecordList(p)}:void i.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},o[7]=function(){var e=this.parseUShort();i.argument(1===e,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),r=new s(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:o[t].call(r)}},o[8]=function(){var e=this.parseUShort();return i.argument(1===e,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(s.coverage),backtrackCoverage:this.parseList(s.pointer(s.coverage)),lookaheadCoverage:this.parseList(s.pointer(s.coverage)),substitutes:this.parseUShortList()}};var c=new Array(9);c[1]=function(e){return 1===e.substFormat?new l.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new l.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new l.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new l.Coverage(e.coverage)}].concat(l.ushortList("substitute",e.substitute)))},c[3]=function(e){return i.assert(1===e.substFormat,"Lookup type 3 substFormat must be 1."),new l.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new l.Coverage(e.coverage)}].concat(l.tableList("altSet",e.alternateSets,function(e){return new l.Table("alternateSetTable",l.ushortList("alternate",e))})))},c[4]=function(e){return i.assert(1===e.substFormat,"Lookup type 4 substFormat must be 1."),new l.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new l.Coverage(e.coverage)}].concat(l.tableList("ligSet",e.ligatureSets,function(e){return new l.Table("ligatureSetTable",l.tableList("ligature",e,function(e){return new l.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:e.ligGlyph}].concat(l.ushortList("component",e.components,e.components.length+1)))}))})))},r.parse=a,r.make=n},{"../check":3,"../parse":11,"../table":14}],21:[function(e,t,r){function a(e,t){var r={},a=new s.Parser(e,t);return r.version=a.parseVersion(),r.fontRevision=Math.round(1e3*a.parseFixed())/1e3,r.checkSumAdjustment=a.parseULong(),r.magicNumber=a.parseULong(),i.argument(1594834165===r.magicNumber,"Font header has wrong magic number."),r.flags=a.parseUShort(),r.unitsPerEm=a.parseUShort(),r.created=a.parseLongDateTime(),r.modified=a.parseLongDateTime(),r.xMin=a.parseShort(),r.yMin=a.parseShort(),r.xMax=a.parseShort(),r.yMax=a.parseShort(),r.macStyle=a.parseUShort(),r.lowestRecPPEM=a.parseUShort(),r.fontDirectionHint=a.parseShort(),r.indexToLocFormat=a.parseShort(),r.glyphDataFormat=a.parseShort(),r}function n(e){var t=Math.round((new Date).getTime()/1e3)+2082844800,r=t;return e.createdTimestamp&&(r=e.createdTimestamp+2082844800),new o.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}var i=e("../check"),s=e("../parse"),o=e("../table");r.parse=a,r.make=n},{"../check":3,"../parse":11,"../table":14}],22:[function(e,t,r){function a(e,t){var r={},a=new i.Parser(e,t);return r.version=a.parseVersion(),r.ascender=a.parseShort(),r.descender=a.parseShort(),r.lineGap=a.parseShort(),r.advanceWidthMax=a.parseUShort(),r.minLeftSideBearing=a.parseShort(),r.minRightSideBearing=a.parseShort(),r.xMaxExtent=a.parseShort(),r.caretSlopeRise=a.parseShort(),r.caretSlopeRun=a.parseShort(),r.caretOffset=a.parseShort(),a.relativeOffset+=8,r.metricDataFormat=a.parseShort(),r.numberOfHMetrics=a.parseUShort(),r}function n(e){return new s.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}var i=e("../parse"),s=e("../table");r.parse=a,r.make=n},{"../parse":11,"../table":14}],23:[function(e,t,r){function a(e,t,r,a,n){for(var s,o,l=new i.Parser(e,t),p=0;p<a;p+=1){p<r&&(s=l.parseUShort(),o=l.parseShort());var c=n.get(p);c.advanceWidth=s,c.leftSideBearing=o}}function n(e){for(var t=new s.Table("hmtx",[]),r=0;r<e.length;r+=1){var a=e.get(r),n=a.advanceWidth||0,i=a.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:n}),t.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:i})}return t}var i=e("../parse"),s=e("../table");r.parse=a,r.make=n},{"../parse":11,"../table":14}],24:[function(e,t,r){function a(e){var t={};e.skip("uShort");var r=e.parseUShort();s.argument(0===r,"Unsupported kern sub-table version."),e.skip("uShort",2);var a=e.parseUShort();e.skip("uShort",3);for(var n=0;n<a;n+=1){var i=e.parseUShort(),o=e.parseUShort(),l=e.parseShort();t[i+","+o]=l}return t}function n(e){var t={};e.skip("uShort");var r=e.parseULong();r>1&&console.warn("Only the first kern subtable is supported."),e.skip("uLong");var a=e.parseUShort(),n=255&a;if(e.skip("uShort"),0===n){var i=e.parseUShort();e.skip("uShort",3);for(var s=0;s<i;s+=1){var o=e.parseUShort(),l=e.parseUShort(),p=e.parseShort();t[o+","+l]=p}}return t}function i(e,t){var r=new o.Parser(e,t),i=r.parseUShort();if(0===i)return a(r);if(1===i)return n(r);throw new Error("Unsupported kern table version ("+i+").")}var s=e("../check"),o=e("../parse");r.parse=i},{"../check":3,"../parse":11}],25:[function(e,t,r){function a(e,t,r,a){for(var i=new n.Parser(e,t),s=a?i.parseUShort:i.parseULong,o=[],l=0;l<r+1;l+=1){var p=s.call(i);a&&(p*=2),o.push(p)}return o}var n=e("../parse");r.parse=a},{"../parse":11}],26:[function(e,t,r){function a(e){for(var t=new o.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),r="",a=12+4*e.length,n=0;n<e.length;++n){var i=r.indexOf(e[n]);i<0&&(i=r.length,r+=e[n]),t.fields.push({name:"offset "+n,type:"USHORT",value:a+i}),t.fields.push({name:"length "+n,type:"USHORT",value:e[n].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),t}function n(e,t){var r=new s.Parser(e,t),a=r.parseULong();i.argument(1===a,"Unsupported ltag table version."),r.skip("uLong",1);for(var n=r.parseULong(),o=[],l=0;l<n;l++){for(var p="",c=t+r.parseUShort(),u=r.parseUShort(),d=c;d<c+u;++d)p+=String.fromCharCode(e.getInt8(d));o.push(p)}return o}var i=e("../check"),s=e("../parse"),o=e("../table");r.make=a,r.parse=n},{"../check":3,"../parse":11,"../table":14}],27:[function(e,t,r){function a(e,t){var r={},a=new i.Parser(e,t);return r.version=a.parseVersion(),r.numGlyphs=a.parseUShort(),1===r.version&&(r.maxPoints=a.parseUShort(),r.maxContours=a.parseUShort(),r.maxCompositePoints=a.parseUShort(),r.maxCompositeContours=a.parseUShort(),r.maxZones=a.parseUShort(),r.maxTwilightPoints=a.parseUShort(),r.maxStorage=a.parseUShort(),r.maxFunctionDefs=a.parseUShort(),r.maxInstructionDefs=a.parseUShort(),r.maxStackElements=a.parseUShort(),r.maxSizeOfInstructions=a.parseUShort(),r.maxComponentElements=a.parseUShort(),r.maxComponentDepth=a.parseUShort()),r}function n(e){return new s.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}var i=e("../parse"),s=e("../table");r.parse=a,r.make=n},{"../parse":11,"../table":14}],28:[function(e,t,r){function a(e,t){var r=new l.Parser(e,t),a=r.parseULong();o.argument(1===a,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var n=r.parseULong(),i={},p=0;p<n;p++){var c=r.parseTag(),u=r.parseULong(),d=r.parseULong(),h=s.UTF8(e,t+u,d);i[c]=h}return i}function n(e){var t=Object.keys(e).length,r="",a=16+12*t,n=new p.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:a},{name:"numTags",type:"ULONG",value:t}]);for(var i in e){var s=r.length;r+=e[i],n.fields.push({name:"tag "+i,type:"TAG",value:i}),n.fields.push({name:"offset "+i,type:"ULONG",value:a+s}),n.fields.push({name:"length "+i,type:"ULONG",value:e[i].length})}return n.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),n}var i=e("../types"),s=i.decode,o=e("../check"),l=e("../parse"),p=e("../table");r.parse=a,r.make=n},{"../check":3,"../parse":11,"../table":14,"../types":33}],29:[function(e,t,r){function a(e,t,r){switch(e){case 0:if(65535===t)return"und";if(r)return r[t];break;case 1:return v[t];case 3:return b[t]}}function n(e,t,r){switch(e){case 0:return P;case 1:return C[r]||M[t];case 3:if(1===t||10===t)return P}}function i(e,t,r){for(var i={},s=new f.Parser(e,t),o=s.parseUShort(),l=s.parseUShort(),p=s.offset+s.parseUShort(),c=0;c<l;c++){var u=s.parseUShort(),h=s.parseUShort(),m=s.parseUShort(),v=s.parseUShort(),y=g[v]||v,b=s.parseUShort(),M=s.parseUShort(),C=a(u,m,r),w=n(u,h,m);if(void 0!==w&&void 0!==C){var x;if(x=w===P?d.UTF16(e,p+M,b):d.MACSTRING(e,p+M,b,w)){var T=i[y];void 0===T&&(T=i[y]={}),T[C]=x}}}var E=0;return 1===o&&(E=s.parseUShort()),i}function s(e){var t={};for(var r in e)t[e[r]]=parseInt(r);return t}function o(e,t,r,a,n,i){return new m.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:a},{name:"length",type:"USHORT",value:n},{name:"offset",type:"USHORT",value:i}])}function l(e,t){var r=e.length,a=t.length-r+1;e:for(var n=0;n<a;n++)for(;n<a;n++){for(var i=0;i<r;i++)if(t[n+i]!==e[i])continue e;return n}return-1}function p(e,t){var r=l(e,t);if(r<0){r=t.length;for(var a=0,n=e.length;a<n;++a)t.push(e[a])}return r}function c(e,t){var r,a=[],i={},l=s(g);for(var c in e){var u=l[c];if(void 0===u&&(u=c),r=parseInt(u),isNaN(r))throw new Error('Name table entry "'+c+'" does not exist, see nameTableNames for complete list.');i[r]=e[c],a.push(r)}for(var d=s(v),f=s(b),P=[],M=[],C=0;C<a.length;C++){r=a[C];var w=i[r];for(var x in w){var T=w[x],E=1,k=d[x],S=y[k],O=n(E,S,k),R=h.MACSTRING(T,O);void 0===R&&(E=0,k=t.indexOf(x),k<0&&(k=t.length,t.push(x)),S=4,R=h.UTF16(T));var j=p(R,M);P.push(o(E,S,k,r,R.length,j));var Z=f[x];if(void 0!==Z){var H=h.UTF16(T),F=p(H,M);P.push(o(3,1,Z,r,H.length,F))}}}P.sort(function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID});for(var U=new m.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:P.length},{name:"stringOffset",type:"USHORT",value:6+12*P.length}]),I=0;I<P.length;I++)U.fields.push({name:"record_"+I,type:"RECORD",value:P[I]});return U.fields.push({name:"strings",type:"LITERAL",value:M}),U}var u=e("../types"),d=u.decode,h=u.encode,f=e("../parse"),m=e("../table"),g=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],v={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},y={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},b={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"},P="utf-16",M={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},C={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};r.parse=i,r.make=c},{"../parse":11,"../table":14,"../types":33}],30:[function(e,t,r){function a(e){for(var t=0;t<l.length;t+=1){var r=l[t];if(e>=r.begin&&e<r.end)return t}return-1}function n(e,t){var r={},a=new s.Parser(e,t);r.version=a.parseUShort(),r.xAvgCharWidth=a.parseShort(),r.usWeightClass=a.parseUShort(),r.usWidthClass=a.parseUShort(),r.fsType=a.parseUShort(),r.ySubscriptXSize=a.parseShort(),r.ySubscriptYSize=a.parseShort(),r.ySubscriptXOffset=a.parseShort(),r.ySubscriptYOffset=a.parseShort(),r.ySuperscriptXSize=a.parseShort(),r.ySuperscriptYSize=a.parseShort(),r.ySuperscriptXOffset=a.parseShort(),r.ySuperscriptYOffset=a.parseShort(),r.yStrikeoutSize=a.parseShort(),r.yStrikeoutPosition=a.parseShort(),r.sFamilyClass=a.parseShort(),r.panose=[];for(var n=0;n<10;n++)r.panose[n]=a.parseByte();return r.ulUnicodeRange1=a.parseULong(),r.ulUnicodeRange2=a.parseULong(),r.ulUnicodeRange3=a.parseULong(),r.ulUnicodeRange4=a.parseULong(),r.achVendID=String.fromCharCode(a.parseByte(),a.parseByte(),a.parseByte(),a.parseByte()),r.fsSelection=a.parseUShort(),r.usFirstCharIndex=a.parseUShort(),r.usLastCharIndex=a.parseUShort(),r.sTypoAscender=a.parseShort(),r.sTypoDescender=a.parseShort(),r.sTypoLineGap=a.parseShort(),r.usWinAscent=a.parseUShort(),r.usWinDescent=a.parseUShort(),r.version>=1&&(r.ulCodePageRange1=a.parseULong(),r.ulCodePageRange2=a.parseULong()),r.version>=2&&(r.sxHeight=a.parseShort(),r.sCapHeight=a.parseShort(),r.usDefaultChar=a.parseUShort(),r.usBreakChar=a.parseUShort(),r.usMaxContent=a.parseUShort()),r}function i(e){return new o.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)}var s=e("../parse"),o=e("../table"),l=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];r.unicodeRanges=l,r.getUnicodeRange=a,r.parse=n,r.make=i},{"../parse":11,"../table":14}],31:[function(e,t,r){function a(e,t){var r,a={},n=new s.Parser(e,t);switch(a.version=n.parseVersion(),a.italicAngle=n.parseFixed(),a.underlinePosition=n.parseShort(),a.underlineThickness=n.parseShort(),a.isFixedPitch=n.parseULong(),a.minMemType42=n.parseULong(),a.maxMemType42=n.parseULong(),
a.minMemType1=n.parseULong(),a.maxMemType1=n.parseULong(),a.version){case 1:a.names=i.standardNames.slice();break;case 2:for(a.numberOfGlyphs=n.parseUShort(),a.glyphNameIndex=new Array(a.numberOfGlyphs),r=0;r<a.numberOfGlyphs;r++)a.glyphNameIndex[r]=n.parseUShort();for(a.names=[],r=0;r<a.numberOfGlyphs;r++)if(a.glyphNameIndex[r]>=i.standardNames.length){var o=n.parseChar();a.names.push(n.parseString(o))}break;case 2.5:for(a.numberOfGlyphs=n.parseUShort(),a.offset=new Array(a.numberOfGlyphs),r=0;r<a.numberOfGlyphs;r++)a.offset[r]=n.parseChar()}return a}function n(){return new o.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var i=e("../encoding"),s=e("../parse"),o=e("../table");r.parse=a,r.make=n},{"../encoding":5,"../parse":11,"../table":14}],32:[function(e,t,r){function a(e){return Math.log(e)/Math.log(2)|0}function n(e){for(;e.length%4!==0;)e.push(0);for(var t=0,r=0;r<e.length;r+=4)t+=(e[r]<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3];return t%=Math.pow(2,32)}function i(e,t,r,a){return new u.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==r?r:0},{name:"length",type:"ULONG",value:void 0!==a?a:0}])}function s(e){var t=new u.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var r=Math.pow(2,a(t.numTables));t.searchRange=16*r,t.entrySelector=a(r),t.rangeShift=16*t.numTables-t.searchRange;for(var s=[],o=[],l=t.sizeOf()+i().sizeOf()*t.numTables;l%4!==0;)l+=1,o.push({name:"padding",type:"BYTE",value:0});for(var p=0;p<e.length;p+=1){var d=e[p];c.argument(4===d.tableName.length,"Table name"+d.tableName+" is invalid.");var h=d.sizeOf(),f=i(d.tableName,n(d.encode()),l,h);for(s.push({name:f.tag+" Table Record",type:"RECORD",value:f}),o.push({name:d.tableName+" table",type:"RECORD",value:d}),l+=h,c.argument(!isNaN(l),"Something went wrong calculating the offset.");l%4!==0;)l+=1,o.push({name:"padding",type:"BYTE",value:0})}return s.sort(function(e,t){return e.value.tag>t.value.tag?1:-1}),t.fields=t.fields.concat(s),t.fields=t.fields.concat(o),t}function o(e,t,r){for(var a=0;a<t.length;a+=1){var n=e.charToGlyphIndex(t[a]);if(n>0){var i=e.glyphs.get(n);return i.getMetrics()}}return r}function l(e){for(var t=0,r=0;r<e.length;r+=1)t+=e[r];return t/e.length}function p(e){for(var t,r=[],a=[],i=[],p=[],c=[],u=[],x=[],T=0,E=0,k=0,S=0,O=0,R=0;R<e.glyphs.length;R+=1){var j=e.glyphs.get(R),Z=0|j.unicode;if(isNaN(j.advanceWidth))throw new Error("Glyph "+j.name+" ("+R+"): advanceWidth is not a number.");(t>Z||void 0===t)&&Z>0&&(t=Z),T<Z&&(T=Z);var H=P.getUnicodeRange(Z);if(H<32)E|=1<<H;else if(H<64)k|=1<<H-32;else if(H<96)S|=1<<H-64;else{if(!(H<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");O|=1<<H-96}if(".notdef"!==j.name){var F=j.getMetrics();r.push(F.xMin),a.push(F.yMin),i.push(F.xMax),p.push(F.yMax),u.push(F.leftSideBearing),x.push(F.rightSideBearing),c.push(j.advanceWidth)}}var U={xMin:Math.min.apply(null,r),yMin:Math.min.apply(null,a),xMax:Math.max.apply(null,i),yMax:Math.max.apply(null,p),advanceWidthMax:Math.max.apply(null,c),advanceWidthAvg:l(c),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,x)};U.ascender=e.ascender,U.descender=e.descender;var I=f.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:U.xMin,yMin:U.yMin,xMax:U.xMax,yMax:U.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),L=m.make({ascender:U.ascender,descender:U.descender,advanceWidthMax:U.advanceWidthMax,minLeftSideBearing:U.minLeftSideBearing,minRightSideBearing:U.minRightSideBearing,xMaxExtent:U.maxLeftSideBearing+(U.xMax-U.xMin),numberOfHMetrics:e.glyphs.length}),$=y.make(e.glyphs.length),A=P.make({xAvgCharWidth:Math.round(U.advanceWidthAvg),usWeightClass:e.tables.os2.usWeightClass,usWidthClass:e.tables.os2.usWidthClass,usFirstCharIndex:t,usLastCharIndex:T,ulUnicodeRange1:E,ulUnicodeRange2:k,ulUnicodeRange3:S,ulUnicodeRange4:O,fsSelection:e.tables.os2.fsSelection,sTypoAscender:U.ascender,sTypoDescender:U.descender,sTypoLineGap:0,usWinAscent:U.yMax,usWinDescent:Math.abs(U.yMin),ulCodePageRange1:1,sxHeight:o(e,"xyvw",{yMax:Math.round(U.ascender/2)}).yMax,sCapHeight:o(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",U).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0}),D=g.make(e.glyphs),N=d.make(e.glyphs),B=e.getEnglishName("fontFamily"),z=e.getEnglishName("fontSubfamily"),_=B+" "+z,G=e.getEnglishName("postScriptName");G||(G=B.replace(/\s/g,"")+"-"+z);var V={};for(var W in e.names)V[W]=e.names[W];V.uniqueID||(V.uniqueID={en:e.getEnglishName("manufacturer")+":"+_}),V.postScriptName||(V.postScriptName={en:G}),V.preferredFamily||(V.preferredFamily=e.names.fontFamily),V.preferredSubfamily||(V.preferredSubfamily=e.names.fontSubfamily);var q=[],X=b.make(V,q),Y=q.length>0?v.make(q):void 0,Q=M.make(),J=h.make(e.glyphs,{version:e.getEnglishName("version"),fullName:_,familyName:B,weightName:z,postScriptName:G,unitsPerEm:e.unitsPerEm,fontBBox:[0,U.yMin,U.ascender,U.advanceWidthMax]}),K=e.metas&&Object.keys(e.metas).length>0?w.make(e.metas):void 0,ee=[I,L,$,A,X,N,Q,J,D];Y&&ee.push(Y),e.tables.gsub&&ee.push(C.make(e.tables.gsub)),K&&ee.push(K);var te=s(ee),re=te.encode(),ae=n(re),ne=te.fields,ie=!1;for(R=0;R<ne.length;R+=1)if("head table"===ne[R].name){ne[R].value.checkSumAdjustment=2981146554-ae,ie=!0;break}if(!ie)throw new Error("Could not find head table with checkSum to adjust.");return te}var c=e("../check"),u=e("../table"),d=e("./cmap"),h=e("./cff"),f=e("./head"),m=e("./hhea"),g=e("./hmtx"),v=e("./ltag"),y=e("./maxp"),b=e("./name"),P=e("./os2"),M=e("./post"),C=e("./gsub"),w=e("./meta");r.computeCheckSum=n,r.make=s,r.fontToTable=p},{"../check":3,"../table":14,"./cff":15,"./cmap":16,"./gsub":20,"./head":21,"./hhea":22,"./hmtx":23,"./ltag":26,"./maxp":27,"./meta":28,"./name":29,"./os2":30,"./post":31}],33:[function(e,t,r){function a(e){return function(){return e}}var n=e("./check"),i=32768,s=2147483648,o={},l={},p={};l.BYTE=function(e){return n.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},p.BYTE=a(1),l.CHAR=function(e){return[e.charCodeAt(0)]},p.CHAR=a(1),l.CHARARRAY=function(e){for(var t=[],r=0;r<e.length;r+=1)t[r]=e.charCodeAt(r);return t},p.CHARARRAY=function(e){return e.length},l.USHORT=function(e){return[e>>8&255,255&e]},p.USHORT=a(2),l.SHORT=function(e){return e>=i&&(e=-(2*i-e)),[e>>8&255,255&e]},p.SHORT=a(2),l.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},p.UINT24=a(3),l.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},p.ULONG=a(4),l.LONG=function(e){return e>=s&&(e=-(2*s-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},p.LONG=a(4),l.FIXED=l.ULONG,p.FIXED=p.ULONG,l.FWORD=l.SHORT,p.FWORD=p.SHORT,l.UFWORD=l.USHORT,p.UFWORD=p.USHORT,l.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e]},p.LONGDATETIME=a(8),l.TAG=function(e){return n.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},p.TAG=a(4),l.Card8=l.BYTE,p.Card8=p.BYTE,l.Card16=l.USHORT,p.Card16=p.USHORT,l.OffSize=l.BYTE,p.OffSize=p.BYTE,l.SID=l.USHORT,p.SID=p.USHORT,l.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?(e-=108,[(e>>8)+247,255&e]):e>=-1131&&e<=-108?(e=-e-108,[(e>>8)+251,255&e]):e>=-32768&&e<=32767?l.NUMBER16(e):l.NUMBER32(e)},p.NUMBER=function(e){return l.NUMBER(e).length},l.NUMBER16=function(e){return[28,e>>8&255,255&e]},p.NUMBER16=a(3),l.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},p.NUMBER32=a(5),l.REAL=function(e){var t=e.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(r){var a=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));t=(Math.round(e*a)/a).toString()}var n,i,s="";for(n=0,i=t.length;n<i;n+=1){var o=t[n];s+="e"===o?"-"===t[++n]?"c":"b":"."===o?"a":"-"===o?"e":o}s+=1&s.length?"f":"ff";var l=[30];for(n=0,i=s.length;n<i;n+=2)l.push(parseInt(s.substr(n,2),16));return l},p.REAL=function(e){return l.REAL(e).length},l.NAME=l.CHARARRAY,p.NAME=p.CHARARRAY,l.STRING=l.CHARARRAY,p.STRING=p.CHARARRAY,o.UTF8=function(e,t,r){for(var a=[],n=r,i=0;i<n;i++,t+=1)a[i]=e.getUint8(t);return String.fromCharCode.apply(null,a)},o.UTF16=function(e,t,r){for(var a=[],n=r/2,i=0;i<n;i++,t+=2)a[i]=e.getUint16(t);return String.fromCharCode.apply(null,a)},l.UTF16=function(e){for(var t=[],r=0;r<e.length;r+=1){var a=e.charCodeAt(r);t[t.length]=a>>8&255,t[t.length]=255&a}return t},p.UTF16=function(e){return 2*e.length};var c={"x-mac-croatian":" ","x-mac-cyrillic":" ","x-mac-gaelic":" ","x-mac-greek":" ","x-mac-icelandic":" ","x-mac-inuit":" ","x-mac-ce":" ",macintosh:" ","x-mac-romanian":" ","x-mac-turkish":" "};o.MACSTRING=function(e,t,r,a){var n=c[a];if(void 0!==n){for(var i="",s=0;s<r;s++){var o=e.getUint8(t+s);i+=o<=127?String.fromCharCode(o):n[127&o]}return i}};var u,d="function"==typeof WeakMap&&new WeakMap,h=function(e){if(!u){u={};for(var t in c)u[t]=new String(t)}var r=u[e];if(void 0!==r){if(d){var a=d.get(r);if(void 0!==a)return a}var n=c[e];if(void 0!==n){for(var i={},s=0;s<n.length;s++)i[n.charCodeAt(s)]=s+128;return d&&d.set(r,i),i}}};l.MACSTRING=function(e,t){var r=h(t);if(void 0!==r){for(var a=[],n=0;n<e.length;n++){var i=e.charCodeAt(n);if(i>=128&&(i=r[i],void 0===i))return;a[n]=i}return a}},p.MACSTRING=function(e,t){var r=l.MACSTRING(e,t);return void 0!==r?r.length:0},l.INDEX=function(e){var t,r=1,a=[r],n=[];for(t=0;t<e.length;t+=1){var i=l.OBJECT(e[t]);Array.prototype.push.apply(n,i),r+=i.length,a.push(r)}if(0===n.length)return[0,0];var s=[],o=1+Math.floor(Math.log(r)/Math.log(2))/8|0,p=[void 0,l.BYTE,l.USHORT,l.UINT24,l.ULONG][o];for(t=0;t<a.length;t+=1){var c=p(a[t]);Array.prototype.push.apply(s,c)}return Array.prototype.concat(l.Card16(e.length),l.OffSize(o),s,n)},p.INDEX=function(e){return l.INDEX(e).length},l.DICT=function(e){for(var t=[],r=Object.keys(e),a=r.length,n=0;n<a;n+=1){var i=parseInt(r[n],0),s=e[i];t=t.concat(l.OPERAND(s.value,s.type)),t=t.concat(l.OPERATOR(i))}return t},p.DICT=function(e){return l.DICT(e).length},l.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},l.OPERAND=function(e,t){var r=[];if(Array.isArray(t))for(var a=0;a<t.length;a+=1)n.argument(e.length===t.length,"Not enough arguments given for type"+t),r=r.concat(l.OPERAND(e[a],t[a]));else if("SID"===t)r=r.concat(l.NUMBER(e));else if("offset"===t)r=r.concat(l.NUMBER32(e));else if("number"===t)r=r.concat(l.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);r=r.concat(l.REAL(e))}return r},l.OP=l.BYTE,p.OP=p.BYTE;var f="function"==typeof WeakMap&&new WeakMap;l.CHARSTRING=function(e){if(f){var t=f.get(e);if(void 0!==t)return t}for(var r=[],a=e.length,n=0;n<a;n+=1){var i=e[n];r=r.concat(l[i.type](i.value))}return f&&f.set(e,r),r},p.CHARSTRING=function(e){return l.CHARSTRING(e).length},l.OBJECT=function(e){var t=l[e.type];return n.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},p.OBJECT=function(e){var t=p[e.type];return n.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},l.TABLE=function(e){var t,r=[],a=e.fields.length,i=[],s=[];for(t=0;t<a;t+=1){var o=e.fields[t],p=l[o.type];n.argument(void 0!==p,"No encoding function for field type "+o.type+" ("+o.name+")");var c=e[o.name];void 0===c&&(c=o.value);var u=p(c);"TABLE"===o.type?(s.push(r.length),r=r.concat([0,0]),i.push(u)):r=r.concat(u)}for(t=0;t<i.length;t+=1){var d=s[t],h=r.length;n.argument(h<65536,"Table "+e.tableName+" too big."),r[d]=h>>8,r[d+1]=255&h,r=r.concat(i[t])}return r},p.TABLE=function(e){for(var t=0,r=e.fields.length,a=0;a<r;a+=1){var i=e.fields[a],s=p[i.type];n.argument(void 0!==s,"No sizeOf function for field type "+i.type+" ("+i.name+")");var o=e[i.name];void 0===o&&(o=i.value),t+=s(o),"TABLE"===i.type&&(t+=2)}return t},l.RECORD=l.TABLE,p.RECORD=p.TABLE,l.LITERAL=function(e){return e},p.LITERAL=function(e){return e.length},r.decode=o,r.encode=l,r.sizeOf=p},{"./check":3}],34:[function(e,t,r){r.isBrowser=function(){return"undefined"!=typeof window},r.isNode=function(){return"undefined"==typeof window},r.nodeBufferToArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;++a)r[a]=e[a];return t},r.arrayBufferToNodeBuffer=function(e){for(var t=new Buffer(e.byteLength),r=new Uint8Array(e),a=0;a<t.length;++a)t[a]=r[a];return t},r.checkArgument=function(e,t){if(!e)throw t}},{}]},{},[10])(10)}),PZ.fonts={list:[],parse:null},PZ.fonts.preset=["absender","adolphus","aero matics","another typewriter","arual","asenine","bebas","bloody","boston traffic","carton six","clemente pd","hamburger heaven","old newspaper types","smudgestick","the bold font","timeless"],PZ.fonts.oldPreset=["army rangers","astro 867","bebas","blackout","cheri","chinese takeaway","corpulent caps brk","deanna","duality","ethnocentric rg","fff forward","fightthis","hydrogen whiskey","jandles","kindergarten","magic school one","medabots","minercraftory","nasalization rg","olivers barney","pricedown bl","ptf nordic rnd","quadrangle","radio stars","reconstruct","rexlia rg","sf archery black","sui generis rg","squealer","steelfish rg","subatomic tsoonami","teen","vipnagorgialla","world of water","youre gone","zekton rg"],PZ.fonts.get=function(e){for(var t=0;t<this.list.length;t++)if(this.list[t].name===e)return this.list[t];return null},PZ.fonts.parseComplete=function(e){for(var t=0;t<e.callbacks.length;t++)e.callbacks[t](e.name,e.parsed),e.references++;delete e.callbacks,e.loaded=!0},PZ.fonts.load=function(e,t){var r=this;if("string"==typeof e){var a=r.get(e);if(null!==a)return void(a.loaded===!0?(a.references++,setTimeout(t,0,a.name,a.parsed)):a.callbacks.push(t));for(var n=0;n<r.preset.length;n++)if(r.preset[n]===e){var a={};a.loaded=!1,a.references=0,a.name=e,a.callbacks=[t],r.list.push(a);var i=new XMLHttpRequest;return i.onload=function(t){200===this.status?(a.file=t.target.response,r.parse(a,PZ.fonts.parseComplete.bind(r,a))):r.unload(e)},i.onerror=function(t){r.unload(e)},i.open("GET","/assets/fonts/2d/"+e+".ttf"),i.responseType="blob",void i.send()}var s=PZ.archive.getFile("font_"+e);if("undefined"!=typeof s){var a={};a.loaded=!1,a.references=0,a.name=e,a.callbacks=[t],a.file=new Blob([s.data]),r.list.push(a),r.parse(a,PZ.fonts.parseComplete.bind(r,a))}else for(var n=0;n<this.oldPreset.length;n++)if(this.oldPreset[n]===e){var a={};a.loaded=!1,a.references=0,a.name=e,a.callbacks=[t],r.list.push(a);var i=new XMLHttpRequest;i.onload=function(e){200===this.status&&(a.file=e.target.response,r.parse(a,PZ.fonts.parseComplete.bind(r,a)))},i.open("GET","/assets/fonts/3d/"+e+".json"),i.responseType="blob",i.send()}}else{var a={};a.loaded=!1,a.references=0,a.callbacks=[t],a.file=e,r.list.push(a),r.parse(a,PZ.fonts.parseComplete.bind(r,a))}},PZ.fonts.save=function(e,t){for(var r=0;r<this.preset.length;r++)if(this.preset[r]===e)return void t();if(PZ.archive.fileExists("font_"+e)===!1){var a=this.get(e);if(null===a)return void t();PZ.archive.addFile("font_"+e,null);var n=PZ.archive.files[PZ.archive.files.length-1],i=new FileReader;i.onload=function(e){n.data=new Uint8Array(e.target.result),t()},i.readAsArrayBuffer(a.file)}else t()},PZ.fonts.unload=function(e){for(var t=0;t<this.list.length;t++)if(this.list[t].name===e){--this.list[t].references<=0&&this.list.splice(t,1);break}};var CM={frameWidth:1920,frameHeight:1080,frameRate:30,ratio:1,aspect:1920/1080,currentFrame:1,totalFrames:180,get currentTime(){return(CM.currentFrame-1)/CM.frameRate},get totalTime(){return CM.totalFrames/CM.frameRate},playSpeed:1,resolution:new THREE.Vector2(1,1),enableRenderLoop:!0,enablePlayFrames:!1,timeelapsed:0,renderMode:!1,timelineObjects:{scene:null,objects:null,fx:null,camera:null},tabActive:0,preRender:[]};$(function(){$(window).resize(function(){clearTimeout(CM.resizeTimeout),CM.resizeTimeout=setTimeout(function(){CM.enableRenderLoop&&CM.resizeViewport()},500)}),window.setTimeout(function(){$(window).on("beforeunload",function(){return"If you leave this page, unsaved changes will be lost."})},6e4),CM.setUpEditor(),CM.init()}),CM.setUpEditor=function(){CM.timeline.init(),CM.timeline.update(),$("#elevator").on("tabload",function(e,t,r){switch(t){case 0:CM.templates.select($(r));break;case 1:CM.basics.select($(r));break;case 2:CM.scenes.select($(r));break;case 3:CM.objects.select($(r));break;case 4:CM.fx.select($(r));break;case 5:CM.camsequence.select($(r));break;case 6:CM.audio.select($(r));break;case 7:CM.download.select($(r));break;case 8:CM.about($(r));break;case 9:PZ.feedback.select($(r))}}),PZ.editor.elevator_init([{title:"Project",sprite:"templates"},{title:"Basics",sprite:"basics"},{title:"Scene",sprite:"scene"},{title:"Objects",sprite:"objects"},{title:"FX",sprite:"fx"},{title:"Camera",sprite:"camera"},{title:"Audio + Music",sprite:"music"},{title:"Download",sprite:"download"},{title:"About",sprite:"about"},{title:"Feedback",sprite:"feedback"}]),$("#elevator").on("tabchanged",function(e,t){switch(CM.camera.layers.set(0),CM.camera.layers.enable(1),PZ.widget3d.threeObj=null,CM.timeline.keyObject=null,t){case 2:CM.timeline.keyObject=CM.scenes.object&&CM.scenes.object.keyframeProps?CM.scenes.object.keyframeProps:null;break;case 3:CM.objects.selected&&(CM.timeline.keyObject=CM.objects.selected.keyObject,PZ.widget3d.threeObj=CM.objects.selected.threeObj,PZ.widget3d.keyObject=CM.objects.selected.keyObject),CM.camera.layers.enable(2);break;case 4:CM.timeline.keyObject=null===CM.fx.selected?null:CM.fx.selected.keyframeProps;break;case 5:PZ.widget3d.threeObj=CM.renderCamera,PZ.widget3d.keyObject=CM.camsequence.keyframeProps,CM.timeline.keyObject=CM.camsequence.keyframeProps,CM.camera.layers.enable(3);break;case 6:CM.timeline.keyObject=CM.audio.keyframeProps}CM.timeline.update(),PZ.widget3d.update()})},CM.init=function(){CM.renderCanv=document.getElementById("c_main"),PZ.keyframes.getFrame=function(){return CM.currentFrame};try{CM.renderer=new THREE.WebGLRenderer({alpha:!0,preserveDrawingBuffer:!0,canvas:CM.renderCanv})}catch(e){return $(window).unbind("beforeunload"),void $("<div>",{class:"disabled"}).append($("<span>").attr("style","padding:2%;top:35%;width:96%;").append('<h3>There was a problem starting WebGL.</h3><br>Refresh to try again or find out how to get WebGL <a style="color:inherit;" target="_blank" href="https://get.webgl.org">here</a>.')).appendTo($("#panecontainer"))}CM.scene=new THREE.Scene,CM.camera=new THREE.PerspectiveCamera(60,CM.aspect,.1,5e3),CM.camera.position.set(50,30,50),CM.camera.lookAt(new THREE.Vector3(0,0,0)),CM.camera.layers.enable(1),CM.renderCamera=new THREE.PerspectiveCamera(60,CM.aspect,.1,5e3),CM.scene.add(CM.renderCamera),CM.camsequence.helper=new THREE.CameraHelper(CM.renderCamera),CM.camsequence.helper.layers.set(3),CM.scene.add(CM.camsequence.helper),CM.objects.boxHelper=new THREE.BoxHelper,CM.objects.boxHelper.layers.set(2),CM.scene.add(CM.objects.boxHelper),CM.objects.emptyObject=new THREE.Object3D,CM.objects.emptyObject.geometry=new THREE.BufferGeometry,CM.objects.emptyObject.geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array([0,0,0]),3)),CM.hemiLight=new THREE.HemisphereLight(16777215,16777215,1),CM.scene.add(CM.hemiLight),CM.renderer.setClearColor(0,1),CM.renderer.shadowMap.enabled=!0,CM.renderer.shadowMap.type=THREE.PCFSoftShadowMap,CM.composer=new THREE.EffectComposer(CM.renderer,CM.renderCanv.width,CM.renderCanv.height),CM.composer.renderPass=new THREE.RenderPass(CM.scene,CM.renderCamera),CM.composer.copyPass=new THREE.ShaderPass(new THREE.ShaderMaterial(THREE.CopyShader)),CM.composer.copyPass.renderToScreen=!0,$(CM.renderCanv).css("position","absolute"),CM.resizeViewport(),CM.controls=new THREE.EditorControls(CM.camera,CM.renderer.domElement),PZ.widget3d.init(CM.controls),CM.gridHelper=new THREE.GridHelper(100,10,new THREE.Color(13421772),new THREE.Color(3355443)),CM.gridHelper.layers.set(1),CM.scene.add(CM.gridHelper),CM.audio.init(),CM.objects.createUI(),CM.fx.createUI(),CM.templates.init(),CM.render()},CM.render=function(e,t){CM.enableRenderLoop&&(CM.enablePlayFrames&&(CM.timeline.updateFrame(),CM.currentFrame+=(CM.audio.ctx.currentTime-CM.timeelapsed)*CM.frameRate*CM.playSpeed,CM.timeelapsed=CM.audio.ctx.currentTime,CM.currentFrame>CM.totalFrames&&(CM.currentFrame=1,CM.audio.stop(),CM.audio.play())),CM.animFrameReq=requestAnimationFrame(CM.render)),t||CM.updateScene(),CM.reflection&&(CM.reflection.mirrorCubeCamera.updateCubeMap(CM.renderer,CM.scene),CM.reflection.mirrorCubeCamera.renderTarget.texture.needsUpdate=!0),CM.renderMode||t?CM.composer.render():CM.renderer.render(CM.scene,CM.camera)},CM.updateScene=function(e){null!==CM.scenes.object&&CM.scenes.object.update();for(var t=0;t<CM.objects.objects.length;t++)CM.objects.objects[t].updateFrame(e);if(CM.audio.updateFrame(),CM.camsequence.updateFrame(),CM.renderMode||e===!0)for(t=0;t<CM.fx.objects.length;t++)CM.fx.objects[t].update(CM.currentFrame);else CM.renderCamera.updateMatrixWorld(),CM.objects.updateHelpers(),PZ.widget3d.updateFrame(CM.currentFrame)},CM.resizeViewport=function(e,t){if(void 0===e){var r=$("#panecontainer"),a=$("#previewpane"),n=$("#editorpane");r.width()>r.height()?(a.css("bottom","0"),n.css("right","auto"),n.css("width",Math.min(.5*r.width(),447)),n.css("top","0"),n.css("border-right","3px solid #111"),n.css("border-top","0"),a.css("left",n.width()+3)):(a.css("left","0"),a.css("bottom","50%"),n.css("right","0"),n.css("width","auto"),n.css("top","50%"),n.css("border-right","0"),n.css("border-top","3px solid #111"));var i=a.height()-$("#previewtop").outerHeight()-$("#previewbottom").outerHeight();i*CM.aspect>a.width()?(CM.renderCanv.width=a.width(),CM.renderCanv.height=CM.renderCanv.width/CM.aspect):(CM.renderCanv.height=i,CM.renderCanv.width=CM.renderCanv.height*CM.aspect),$(CM.renderCanv).css("top",.5*(i-CM.renderCanv.height)+$("#previewtop").outerHeight()),$(CM.renderCanv).css("left",.5*(a.width()-CM.renderCanv.width)),CM.ratio=CM.renderCanv.width/CM.frameWidth}else CM.renderCanv.width=e,CM.renderCanv.height=t;CM.camsequence.updateCamera(),CM.renderer.setViewport(0,0,CM.renderCanv.width,CM.renderCanv.height),CM.composer.setSize(CM.renderCanv.width,CM.renderCanv.height),CM.resolution.set(CM.renderCanv.width,CM.renderCanv.height);var s;for(s=0;s<CM.fx.objects.length;s++)CM.fx.objects[s].resize(CM.renderCanv.width,CM.renderCanv.height)},CM.rebuildShaders=function(){for(var e=0;e<objectsProps.length;e++)objectsProps[e].type<3&&null!==objectsProps[e].threeObj&&(objectsProps[e].threeObj.material.needsUpdate=!0)},CM.updateMaterials=function(){CM.scene.traverse(function(e){if(e.material&&(e.material.needsUpdate=!0,e.material instanceof THREE.MeshFaceMaterial))for(var t=0;t<e.material.materials.length;t++)e.material.materials[t].needsUpdate=!0})},CM.setRenderMode=function(e){e?(CM.renderer.autoClear=!1,CM.controls.enabled=!1):(CM.renderer.autoClear=!0,CM.controls.enabled=!0),PZ.widget3d.update()},CM.toggleRenderMode=function(){CM.renderMode=!CM.renderMode,CM.setRenderMode(CM.renderMode)},CM.setPlayPause=function(e){e!==CM.enablePlayFrames&&(e===!1?(CM.audio.stop(),CM.enablePlayFrames=!1,CM.currentFrame=Math.floor(CM.currentFrame),CM.timeline.updateFrame(),$("#controls .proprow[kf='1']").each(function(){$(this).triggerHandler("update")}),CM.timeline.$hideeditor.hide()):(CM.timeline.$hideeditor.show(),CM.timeelapsed=CM.audio.ctx.currentTime,CM.audio.play(),CM.enablePlayFrames=!0),PZ.widget3d.update(),PZ.editor.switchIcon(CM.timeline.$playpause,e?"pause":"play"),CM.timeline.$playpause.toggleClass("iconactive",e))},CM.getBase64Image=function(e){if(!e)return null;var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return r.drawImage(e,0,0),t.toDataURL("image/png")},CM.appearance={objects:{},list:[{name:"single color",file:"singlecolor"},{name:"image",file:"texture"},{name:"metal",file:"metal"},{name:"wood",file:"wood"},{name:"brick",file:"brick"},{name:"alien",file:"alien"},{name:"video",file:"video"},{name:"shockwave [alpha]",file:"shockwave"},{name:"custom",file:"custom"}],_string:"",get string(){return""!==this._string?this._string:(this.concatList(),this._string)}},CM.appearance.load=function(e){var t=this;this.objects[e]?t.objects[e].refcount+=1:$.ajax({url:"/js/modules/appearance3d/"+e+".js?v=2.0.157",dataType:"text",cache:!0,async:!1,success:function(r){var a=new Function(r);t.objects[e]=new a,t.objects[e].refcount=1}})},CM.appearance.unload=function(e){"undefined"!=typeof this.objects[e]&&(this.objects[e].refcount-=1,this.objects[e].refcount<=0&&(this.objects[e]=null,delete this.objects[e]))},CM.appearance.getIndex=function(e){for(var t=0;t<this.list.length;t++)if(this.list[t].file===e)return t;return-1},CM.appearance.concatList=function(){for(var e=!1,t=0;t<this.list.length;t++)e&&(this._string+=";"),this._string+=this.list[t].name,e=!0},CM.templates={newid:1,id:0,submit:{tool:1,title:"",description:"",category:0},ctrlState:0,ctrlCancel:!1,xhr:null,thumbnailBlob:null,templateBlob:null,saveWaiting:0,relatedList:null},CM.templates.select=function(e){this.insertlocation=e,this.relatedList=PZ.editor.generatePlaceholder(),this.selectMain(e),this.$hidectrls=$("<div>",{class:"disabled"}).hide().appendTo("#panecontainer"),this.$hidemsg=$("<span>").appendTo(this.$hidectrls)},CM.templates.selectMain=function(){var e=this.insertlocation;this.relatedList.detach(),e.empty(),PZ.editor.elevator_tablock(0,!1),PZ.editor.generateButton({title:"New project",clickfn:function(){location.href="clipmaker"}}).appendTo(e),PZ.editor.generateButton({title:"Load project",clickfn:this.loadButton},this).appendTo(e),PZ.editor.generateButton({title:"Save project",clickfn:this.saveButton},this).appendTo(e),PZ.editor.generateButton({title:"Upload to community creations",clickfn:function(){return window.location.pathname.indexOf("preview")>0?void this.selectResult(-1,"Submitting is disabled in Clipmaker Preview."):(this.submit.title="",this.submit.description="",this.submit.category=0,CM.timeline.setFrame(Math.floor(CM.totalFrames/2)),void CM.templates.selectSubmit())}},this).appendTo(e),e.append(this.relatedList),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateButton({title:"More creations...",clickfn:function(){location.href="/templates"}}).css("cursor","pointer").appendTo(e)},CM.templates.selectResult=function(e,t){var r=this.insertlocation;this.relatedList.detach(),r.empty(),this.$hidectrls.hide(),PZ.editor.elevator_tablock(0,!0),$(CM.renderCanv).detach(),CM.timeline.disable(!0),1===e?(PZ.editor.generateTitle({title:"Save your project"}).appendTo(r),PZ.editor.generateDescription({content:"Your save file is ready! Click below to download."}).appendTo(r),PZ.editor.generateButton({title:"Open creation page",clickfn:function(){open("/templates/"+this.newid,"_blank")}},this).appendTo(r),PZ.editor.generateSpacer().appendTo(r),PZ.editor.generateButton({title:"Return to editing",clickfn:function(){this.finish(),this.selectMain()}},this).appendTo(r)):0===e?(PZ.editor.generateTitle({title:"Save your project"}).appendTo(r),PZ.editor.generateDescription({content:"Your save file is ready! Click below to download."}).appendTo(r),PZ.editor.generateButton({title:"Download project file",clickfn:function(){open("/tools/download","_blank")}},this).appendTo(r),PZ.editor.generateSpacer().appendTo(r),PZ.editor.generateButton({title:"Return to editing",clickfn:function(){this.finish(),this.selectMain()}},this).appendTo(r)):(PZ.editor.generateTitle({title:"Save/load your project"}).appendTo(r),"undefined"==typeof t&&(t="Unfortunately, something went wrong when processing your project. The problem has been reported in order to resolve this issue. Sorry about that."),PZ.editor.generateDescription({content:t}).appendTo(r),PZ.editor.generateSpacer().appendTo(r),e===-1?PZ.editor.generateButton({title:"Return to editing",clickfn:function(){this.finish(),this.selectMain()}},this).appendTo(r):PZ.editor.generateButton({title:"Go back",clickfn:function(){this.finish(),this.selectSubmit()}},this).appendTo(r))},CM.templates.selectSubmit=function(){var e=this.insertlocation;this.relatedList.detach(),e.empty(),PZ.editor.elevator_tablock(0,!0),PZ.editor.generateTitle({title:"Upload to community creations"}).appendTo(e),this.$submit=PZ.editor.generatePlaceholder().appendTo(e),PZ.editor.generateDescription({content:"Enter some information about your creation and set the current frame where you would like your creation's thumbnail to be."}).appendTo(this.$submit),PZ.editor.generateTextInput({get:function(){return this.submit.title||"Your creation title"},set:function(e){this.submit.title=e}},this).appendTo(this.$submit),PZ.editor.generateDropdown({title:"Category",items:"upbeat;insane;chill;outro;transition;title",get:function(){return this.submit.category},set:function(e){this.submit.category=e}},this).appendTo(this.$submit),PZ.editor.generateTextArea({get:function(){return this.submit.description||"Your creation description"},set:function(e){this.submit.description=e}},this).appendTo(this.$submit),PZ.editor.generateButton({title:"Submit creation",clickfn:this.submitButton},this).appendTo(this.$submit),PZ.editor.generateButton({title:"Cancel",clickfn:function(){this.selectMain()}},this).appendTo(this.$submit),this.$working=PZ.editor.generatePlaceholder().hide().appendTo(e),PZ.editor.generateDescription({content:"Your creation is being uploaded. Please stay on this tab to ensure your browser continues to process it."}).appendTo(this.$working),this.$progress=PZ.editor.generateProgressbar({get:function(){return this.percentDone}},this).appendTo(this.$working),PZ.editor.generateButton({title:"Cancel upload",clickfn:function(){this.ctrlCancel=!0,null!==PZ.archive.worker&&(PZ.archive.worker.terminate(),PZ.archive.worker=null),null!==CM.templates.xhr&&(CM.templates.xhr.abort(),CM.templates.xhr=null),this.finish(),this.selectSubmit()}},this).appendTo(this.$working)},CM.templates.selectRelated=function(e){var t=this;e=e||0;var r=new FormData;r.append("id",e),t.xhr=new XMLHttpRequest,t.xhr.onerror=t.xhr.onload=function(e){var r=t.relatedList,a=[];200===e.target.status&&(a=e.target.response.split(","));for(var n=0;n<6;n++){var i=a[n]||22-n;$("<img>",{src:"https://panzoid.com/usertemplates/cm/"+i+".png",
class:"templateitem",width:"330",height:"186",t:i}).click(function(){sessionStorage.setItem("loadTemplate",$(this).attr("t")),location.href="clipmaker"}).appendTo(r)}},t.xhr.open("POST","/relatedtemplates"),t.xhr.send(r)},CM.templates.control=function(e){var t=CM.templates,r=t.ctrlState;if(t.ctrlCancel!==!0)if(0===r)PZ.archive.files.length>0?t.loadObjects(e):t.selectResult(-1);else if(1===r){if("undefined"==typeof e)return void t.selectResult(-1);PZ.downloadBlob=e,PZ.downloadFilename="clipmaker_project.pz",t.selectResult(0)}else if(2===r){if(t.percentDone=40,t.$progress.triggerHandler("update"),"undefined"==typeof e)return void t.selectResult(-2);if(CM.templates.thumbnailBlob=e,CM.templates.thumbnailBlob.size>262144)return void t.selectResult(-2,"Your creation exceeds the size limit. Please remove large items to upload your creation.");t.ctrlState=3,t.save(t.control)}else if(3===r){if(t.percentDone=80,t.$progress.triggerHandler("update"),"undefined"==typeof e)return void t.selectResult(-2);if(CM.templates.templateBlob=e,CM.templates.templateBlob.size>5242880)return void t.selectResult(-2,"Your creation exceeds the size limit. Please remove large items to upload your creation.");t.ctrlState=4,t.submitSend()}else if(4===r)if(200===t.xhr.status)t.newid=parseInt(t.xhr.responseText),t.selectResult(1);else{var a=t.xhr.responseText;a.length>200&&(a="Unfortunately, an error occured. Please try again later."),t.selectResult(-2,a)}},CM.templates.init=function(){var e,t;if(sessionStorage.getItem("loadTemplate"))e=sessionStorage.getItem("loadTemplate"),sessionStorage.removeItem("loadTemplate"),e=parseInt(e);else if(window.opener)try{e=window.opener.PZ.templateId}catch(e){}finally{window.opener=null}if(this.selectRelated(e),e){t="/usertemplates/cm/"+e+".pz",this.$hidemsg.text("loading..."),this.$hidectrls.show();var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",CM.templates.ctrlCancel=!1,CM.templates.ctrlState=0,r.onerror=CM.templates.control,r.onload=function(t){CM.templates.load(this.response,e)},r.send()}},CM.templates.loadButton=function(){CM.templates.$loadinput||(CM.templates.$loadinput=$("<input>",{type:"file"}).change(function(){var e=this;if(e.files&&e.files[0]){if(!e.files[0].name.endsWith(".pz"))return void CM.templates.selectResult(-1,"The selected file is not a Clipmaker project file. Please choose a .pz project file.");CM.templates.$hidemsg.text("loading..."),CM.templates.$hidectrls.show(),CM.templates.ctrlCancel=!1,CM.templates.ctrlState=0,CM.templates.load(e.files[0])}})),CM.templates.$loadinput[0].value=null,CM.templates.$loadinput.trigger("click")},CM.templates.saveButton=function(){this.$hidemsg.text("saving..."),this.$hidectrls.show(),this.ctrlCancel=!1,this.ctrlState=1,this.save()},CM.templates.submitButton=function(){return this.submit.title.length<4?void this.selectResult(-2,"Your creation's title is too short."):(CM.timeline.disable(!0),this.percentDone=10,this.$progress.triggerHandler("update"),this.$submit.hide(),this.$working.show(),this.ctrlCancel=!1,this.ctrlState=2,void this.renderThumbnail())},CM.templates.renderThumbnail=function(){$(CM.renderCanv).detach(),CM.resizeViewport(660,372),CM.enableRenderLoop=!1,cancelAnimationFrame(CM.animFrameReq),CM.setRenderMode(!0),CM.download.finishVideoFrame=function(){if(!(this.waitingPrepare>0)){CM.render(null,!0);var e=document.createElement("canvas");e.width=330,e.height=186;var t=e.getContext("2d");t.drawImage(CM.renderCanv,0,0,330,186),PZ.canvasToBlob(e,CM.templates.control)}},CM.download.waitingPrepare=1,CM.updateScene(!0),CM.download.waitingPrepare--,CM.download.finishVideoFrame()},CM.templates.submitSend=function(){var e=this,t=new FormData;t.append("tool",e.submit.tool),t.append("title",e.submit.title),t.append("description",e.submit.description),t.append("category",e.submit.category),t.append("inspiredid",e.id),t.append("template",e.templateBlob),t.append("thumbnail",e.thumbnailBlob),e.xhr=new XMLHttpRequest,e.xhr.onerror=e.control,e.xhr.onload=e.control,e.xhr.open("POST","/submittemplate"),e.xhr.send(t)},CM.templates.save=function(){PZ.archive.files=[],CM.enableRenderLoop=!1,cancelAnimationFrame(CM.animFrameReq),PZ.archive.addFileString("id",this.id.toString());var e={tool:"CM",version:"2.0.157"};PZ.archive.addFileString("pz",JSON.stringify(e)),this.saveWaiting=1,CM.basics.save(),CM.scenes.save(),CM.objects.save(),CM.fx.save(),CM.camsequence.save(),CM.audio.save(),this.saveWaiting--,CM.templates.saveComplete()},CM.templates.saveComplete=function(){this.saveWaiting>0||PZ.file.getQuota(PZ.archive.tar.bind(PZ.archive,CM.templates.control))},CM.templates.load=function(e,t){PZ.archive.files=[],CM.enableRenderLoop=!1,cancelAnimationFrame(CM.animFrameReq),PZ.archive.untar(e,CM.templates.control.bind(CM.templates,t))},CM.templates.loadObjects=function(e){this.id=e||parseInt(PZ.archive.getFileString("id"))||0,CM.basics.load(),CM.scenes.load(),CM.objects.load(),CM.fx.load(),CM.camsequence.load(),CM.audio.load(),PZ.editor.elevator_unloadtab(1),PZ.editor.elevator_unloadtab(5),PZ.editor.elevator_unloadtab(6),this.$hidectrls.hide(),CM.enableRenderLoop=!0,CM.render()},CM.templates.finish=function(){PZ.downloadBlob=null,PZ.archive.files=[],PZ.file.cleanUp(),CM.templates.templateBlob=null,CM.templates.thumbnailBlob=null,CM.timeline.disable(!1),0===$(CM.renderCanv).parent().length&&($("#previewpane").append(CM.renderCanv),CM.resizeViewport()),CM.setRenderMode(CM.renderMode),CM.enableRenderLoop=!0,CM.render()},CM.basics={},CM.basics.load=function(){var e=PZ.archive.getFileString("basics");if("undefined"!=typeof e){var t=JSON.parse(e);CM.frameWidth=t.frameWidth,CM.frameHeight=t.frameHeight,CM.frameRate=t.frameRate,CM.totalFrames=t.totalFrames,CM.timeline.setFrame(1),CM.timeline.update()}},CM.basics.save=function(){var e={frameWidth:CM.frameWidth,frameHeight:CM.frameHeight,frameRate:CM.frameRate,totalFrames:CM.totalFrames};PZ.archive.addFileString("basics",JSON.stringify(e))},CM.basics.resolutions=[new THREE.Vector2(3840,2160),new THREE.Vector2(2560,1440),new THREE.Vector2(1920,1080),new THREE.Vector2(1280,720),new THREE.Vector2(854,480),new THREE.Vector2(640,360),new THREE.Vector2(426,240)],CM.basics.props={resolution:{title:"Video resolution",get:function(){for(var e=0;e<this.resolutions.length;e++)if(CM.frameWidth===this.resolutions[e].x&&CM.frameHeight===this.resolutions[e].y)return e;return this.resolutions.length},set:function(e){e>=this.resolutions.length?(this.$customres.triggerHandler("update"),this.$customres.show()):(this.$customres.hide(),CM.frameWidth=this.resolutions[e].x,CM.frameHeight=this.resolutions[e].y),CM.aspect!=CM.frameWidth/CM.frameHeight&&(CM.aspect=CM.frameWidth/CM.frameHeight,CM.camera.aspect=CM.aspect,CM.camera.updateProjectionMatrix(),CM.resizeViewport())},items:"3840x2160 (4k);2560x1440 (2k);1920x1080 (1080p);1280x720 (720p);854x480 (480p);640x360 (360p);426x240 (240p);custom"},customres:{title:"Custom resolution",subtitle1:"width",subtitle2:"height",get:function(){return new THREE.Vector2(CM.frameWidth,CM.frameHeight)},set:function(e,t){0===t?CM.frameWidth=e:CM.frameHeight=e,CM.aspect=CM.frameWidth/CM.frameHeight,CM.resizeViewport()},vmax:1e4,vmin:1,vstep:1,decimals:0,dragstep:1},framerate:{title:"Frame rate",get:function(){return 60===CM.frameRate?1:0},set:function(e){var t=CM.totalFrames/CM.frameRate;switch(e){case 0:CM.download.multiplyRate=1;break;case 1:CM.download.multiplyRate=.5}CM.totalFrames=t*CM.frameRate,CM.currentFrame>CM.totalFrames&&(CM.currentFrame=CM.totalFrames),CM.timeline.update(),CM.timeline.scheduleRedraw()},items:"30;60"},videolength:{title:"Length (seconds)",get:function(){return CM.totalFrames/CM.frameRate},set:function(e){CM.totalFrames=Math.floor(e*CM.frameRate),CM.timeline.setFrame(Math.min(CM.currentFrame,CM.totalFrames)),CM.timeline.update(),CM.timeline.scheduleRedraw()},vmax:5e3,vmin:.1,decimals:1,vstep:1,dragstep:.01}},CM.basics.select=function(e){var t=this;PZ.editor.generateTitle({title:"Basic settings"}).appendTo(e),PZ.editor.generateDropdown(t.props.resolution,t).appendTo(e),t.$customres=PZ.editor.generateDualInput(t.props.customres,t).hide().appendTo(e),PZ.editor.generateDropdown(t.props.framerate,t).appendTo(e),PZ.editor.generateInput(t.props.videolength,t).appendTo(e)},CM.scenes={object:null,src:"",insertlocation:null,list2d:[{name:"Upload a Video",src:"video"},{name:"Upload an Image",src:"image"}],list3d:[{name:"Outdoor",desc:"Various outdoor environments.",src:"outdoor"},{name:"Blocks",desc:"Customizable block world.",src:"blocks"},{name:"Darkness",desc:"Disables default scene lighting.",src:"darkness"}]},CM.scenes.load=function(){var e=PZ.archive.getFileString("scenes");if("undefined"!=typeof e){var t=JSON.parse(e);this.src=t.src,this.change(this.src,"sceneobject")}},CM.scenes.save=function(){var e={src:this.src};PZ.archive.addFileString("scenes",JSON.stringify(e)),null!==this.object&&this.object.save("sceneobject")},CM.scenes.select=function(e){var t=this;"object"==typeof e?t.insertlocation=e:e===!0&&(CM.timeline.keyObject=null!==t.object&&"undefined"!=typeof this.object.keyframeProps?this.object.keyframeProps:null,CM.timeline.update());var r=t.insertlocation;if(null!==r)if(r.empty(),null!==t.object)PZ.editor.generateButton({title:"Choose something else",clickfn:function(){t.change()}}).appendTo(r),t.object.select(r);else{PZ.editor.generateTitle({title:"Choose a scene"}).appendTo(r);for(var a=$("<ul>",{class:"pz-options"}),n=0;n<t.list3d.length;n++)a.append($("<li>").append(t.list3d[n].name).append($("<span>").text(t.list3d[n].desc)).click(function(){CM.scenes.change(t.list3d[$(this).index()].src)}));a.appendTo(r)}},CM.scenes.change=function(e,t){if(null!==this.object){try{this.object.unload()}catch(e){}this.object=null,this.src=""}void 0!==e&&""!==e?(null!==this.insertlocation&&this.insertlocation.empty(),$.ajax({url:"/js/modules/scenes/"+e+".js?v=2.0.157",dataType:"text",cache:!0,success:function(r){try{var a=new Function(r);CM.scenes.object=new a,CM.scenes.object.load(t),CM.scenes.src=e,CM.scenes.select("undefined"==typeof t)}catch(e){CM.scenes.change()}},error:function(){CM.scenes.select("undefined"==typeof t)}})):this.select("undefined"==typeof t)},CM.objects={objects:[],selected:null,listObject:null,selectLocation:null,drag:{},list:[{name:"Shape",desc:"Primitive object such as a box or sphere.",list:[{name:"Box"},{name:"Cylinder"},{name:"Rectangle"},{name:"Circle"},{name:"Sphere"},{name:"Donut"},{name:"Wire"}]},{name:"Text",desc:"Custom 3D text."},{name:"Model",desc:"Preset complex object.",list:[{name:"AK47"},{name:"Mystery box"}]},{name:"Light",desc:"Creates light and shadows in a scene.",hidelist:!0,list:[{name:"Spot light"},{name:"Point light"},{name:"Directional light"}]},{name:"Particles",desc:"A system of many animated sprites."},{name:"Group",desc:"Meta-object for combining objects into one."},{name:"Custom Object",desc:"Import an OBJ object file."}]},CM.objects.updateHelpers=function(){this.selected&&this.boxHelper.update(this.selected.threeObj)},CM.objects.createUI=function(){this.listObject=PZ.editor.generateList({}),this.listObject.data("objects",this.objects),this.listObject.data("group",CM.scene),this.listObject.css("height",.25*$("#panecontainer").height())},CM.objects.load=function(){var e=PZ.archive.getFileString("objects");if("undefined"!=typeof e){var t=JSON.parse(e);this.deleteAll();for(var r=0;r<t.length;r++)this.addObject(t[r],"object"+r)}},CM.objects.save=function(){for(var e=[],t=0;t<this.objects.length;t++)this.objects[t]instanceof CM.objects.shape?e.push(0):this.objects[t]instanceof CM.objects.text3d?e.push(1):this.objects[t]instanceof CM.objects.model?e.push(2):this.objects[t]instanceof CM.objects.light?e.push(3):this.objects[t]instanceof CM.objects.particles?e.push(4):this.objects[t]instanceof CM.objects.group&&e.push(5),this.objects[t].save("object"+t);PZ.archive.addFileString("objects",JSON.stringify(e))},CM.objects.select=function(e){e.css({height:"100%",width:"100%"}),PZ.editor.generateDropdownAdd({title:"Add Object",items:this.list,addfn:function(e,t){e>5?this.importOBJ():this.addObject(e,t+1)}},this).appendTo(e),this.listObject.appendTo(e),this.$resizehandle=$("<div>",{style:"width:100%;height:5px;position:absolute;cursor:ns-resize;"}).drag("start",function(e,t){t.startHeight=CM.objects.listObject.height(),t.top=CM.objects.listObject.position().top}).drag(function(e,t){var r=Math.max(Math.min(t.startHeight+t.deltaY,1200),100);CM.objects.listObject.css("height",r),$(this).css("top",t.top+r),CM.objects.selectLocation.css("top",t.top+r+6)}).css("top",this.listObject.position().top+this.listObject.height()).appendTo(e),this.selectLocation=PZ.editor.generatePlaceholder().attr("style","overflow-y:auto;position:absolute;bottom:0;left:0;right:0;").css("top",this.listObject.position().top+this.listObject.height()+6).appendTo(e)},CM.objects.importOBJ=function(){var e=$("<input>",{type:"file",style:"height:0px;width:0px;overflow:hidden;"}).change(function(e){if(this.files&&this.files[0]){var t=new FileReader,r=this.files[0].name;t.onload=function(e){var t=new THREE.OBJLoader;try{var a=t.parse(e.target.result),n=CM.objects.addObject(5);n.props.name.set.call(n,r),n.regroup(!0),n.threeObj=a,n.regroup(),n.listObject.data("group",a);for(var i=0;i<a.children.length;i++)CM.objects.addObject.call(n,0,a.children[i])}catch(e){console.log(e)}},t.readAsText(this.files[0])}});e.trigger("click")},CM.objects.addObject=function(e,t){var r;if("number"==typeof e)switch(e){case 0:r=new CM.objects.shape;break;case 1:r=new CM.objects.text3d;break;case 2:r=new CM.objects.model;break;case 3:r=new CM.objects.light;break;case 4:r=new CM.objects.particles;break;case 5:r=new CM.objects.group}else r=e.clone(),t=e;var a=PZ.editor.generateListItem({selectfn:CM.objects.itemSelect,deletefn:CM.objects.itemDelete,clonefn:CM.objects.itemClone,isgroup:r instanceof CM.objects.group}).drag("start",CM.objects.itemDragStart).drag(CM.objects.itemDrag,{click:!0,distance:2}).drag("end",CM.objects.itemDragEnd);return this.objects.push(r),r.$listitem=a,a.appendTo(this.listObject),r.load(t),r},CM.objects.selectObject=function(e){this.selected!==e&&(this.boxHelper.visible=!1,this.selected&&this.selected.helper&&(this.selected.helper.visible=!1),this.selected=e,this.selectLocation.empty(),CM.timeline.keyObject=null,PZ.widget3d.threeObj=null,PZ.widget3d.keyObject=null,null!==e&&(e.select(this.selectLocation),CM.timeline.keyObject=e.keyObject,PZ.widget3d.threeObj=e.threeObj,PZ.widget3d.keyObject=e.keyObject,this.boxHelper.update(this.emptyObject),this.boxHelper.visible=!0,e.helper&&(e.helper.visible=!0)),CM.timeline.update(),PZ.widget3d.update())},CM.objects.containsSelected=function(e){if(this.selected===e)return!0;if(e instanceof CM.objects.group)for(var t=0;t<e.objects.length;t++)if(this.containsSelected(e.objects[t]))return!0;return!1},CM.objects.deleteObject=function(e){this.containsSelected(e)&&this.selectObject(null),e.unload()},CM.objects.deleteAll=function(){null!==this.selected&&this.selectObject(null),this.listObject.children().remove();for(var e=0;e<this.objects.length;e++)this.objects[e].unload();this.objects.splice(0,this.objects.length)},CM.objects.cloneObject=function(e){this.addObject(e)},CM.objects.itemSelect=function(){var e=$(this);e.hasClass("pz-listitem-selected")?(e.removeClass("pz-listitem-selected"),CM.objects.selectObject(null)):(CM.objects.listObject.find(".pz-listitem-selected").removeClass("pz-listitem-selected"),e.addClass("pz-listitem-selected"),CM.objects.selectObject(e.parent().data("objects")[e.prevAll("li").length]))},CM.objects.itemDelete=function(e){var t=$(this).parent();CM.objects.deleteObject(t.parent().data("objects").splice(t.prevAll("li").length,1)[0]),t.remove(),e.stopPropagation()},CM.objects.itemClone=function(e){var t=$(this).parent();CM.objects.cloneObject(t.parent().data("objects")[t.prevAll("li").length]),e.stopPropagation()},CM.objects.itemDragStart=function(e,t){CM.objects.drag.height=CM.objects.listObject.find("li").first().outerHeight(),CM.objects.drag.drag=t.drag,CM.objects.drag.timer=setInterval(CM.objects.itemDropCheck,20)},CM.objects.itemDrag=function(e,t){CM.objects.drag.pageY=e.pageY},CM.objects.itemDropCheck=function(){var e,t=CM.objects.listObject.find("li"),r=CM.objects.drag.pageY,a=CM.objects.drag.height;return t.attr("style",""),t.each(function(t,n){if(n!==CM.objects.drag.drag){var i=$(n),s=i.offset(),o="undefined"!=typeof i.attr("group"),l=a*(o?.3333:.5);if(r>=s.top&&r<s.top+a){if(r-s.top<l&&i.prevAll("li")[0]!==CM.objects.drag.drag)i.attr("style","border-top: 1px dashed #aaa");else if(r>a+s.top-l&&i.nextAll("li")[0]!==CM.objects.drag.drag)i.attr("style","border-bottom: 1px dashed #aaa");else{if(o!==!0)return!0;i.attr("style","border: 1px dashed #aaa")}return e=i,!1}}}),e},CM.objects.itemDragEnd=function(e,t){CM.objects.drag.timer=clearInterval(CM.objects.drag.timer);var r=CM.objects.itemDropCheck();if("undefined"!=typeof r){var a=r.attr("style");r.attr("style","");var n=$(t.drag);if(r[0]!==n[0]){if("undefined"!=typeof n.attr("group")){if(n.next().find(r).length>0)return;n=n.add(n.next())}var i=n.first().prevAll("li").length,s=n.parent().data("objects").splice(i,1)[0];n.detach();var o=r.prevAll("li").length;a.startsWith("border-top")?(r.parent().data("objects").splice(o,0,s),n.insertBefore(r)):a.startsWith("border-bottom")?(r.parent().data("objects").splice(o+1,0,s),"undefined"!=typeof r.attr("group")&&(r=r.next()),n.insertAfter(r)):(r.next().data("objects").push(s),r.next().append(n)),s.regroup()}}},CM.objects.light=function(){this.threeObj=null,this.helper=null,this.objectType=1,this.keyframeProps={position:[{frame:1,value:new THREE.Vector3(0,10,0),tweenfn:257}],target:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],color:[{frame:1,value:new THREE.Color(1,1,1),tweenfn:1}],intensity:[{frame:1,value:1,tweenfn:1}],angle:[{frame:1,value:60,tweenfn:1}]},this.keyObject=this.keyframeProps},CM.objects.light.prototype.props={position:{title:"Position",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.position)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.position)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},target:{title:"Target",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.target)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.target)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},color:{title:"Color",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericColorGet(e,this.keyframeProps.color)},set:function(e,t){return PZ.keyframes.genericColorSet(e,t,this.keyframeProps.color)},hasalpha:!1},intensity:{title:"Intensity",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericValueGet(e,this.keyframeProps.intensity)},set:function(e,t){return PZ.keyframes.genericValueSet(e,t,this.keyframeProps.intensity)},vmax:100,vmin:0,vstep:1,decimals:1,dragstep:.01},angle:{title:"Angle",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericValueGet(e,this.keyframeProps.angle)},set:function(e,t){return PZ.keyframes.genericValueSet(e,t,this.keyframeProps.angle)},vmax:90,vmin:0,vstep:1}},CM.objects.light.prototype.save=function(e){var t={objectType:this.objectType,keyframeProps:this.keyframeProps};PZ.archive.addFileString(e,JSON.stringify(t))},CM.objects.light.prototype.load=function(e){if("string"==typeof e){var t=PZ.archive.getFileString(e);if("undefined"!=typeof t){var r=JSON.parse(t);this.objectType=r.objectType,$.extend(this.keyframeProps,r.keyframeProps),PZ.keyframes.toVector3(this.keyframeProps.position),PZ.keyframes.toVector3(this.keyframeProps.target),PZ.keyframes.toColor(this.keyframeProps.color)}}else"number"==typeof e&&(this.objectType=e);this.changeObjectType(this.objectType)},CM.objects.light.prototype.clone=function(){var e=new this.constructor;return e.objectType=this.objectType,e.keyframeProps=PZ.keyframes.cloneProps(this.keyframeProps),e.keyObject=e.keyframeProps,e},CM.objects.light.prototype.unload=function(){this.regroup(!0),CM.updateMaterials()},CM.objects.light.prototype.updateFrame=function(){this.threeObj.position.copy(TWEEN.getValue(this.keyframeProps.position,CM.currentFrame)),"undefined"!=typeof this.threeObj.target&&(this.threeObj.target.position.copy(TWEEN.getValue(this.keyframeProps.target,CM.currentFrame)),this.threeObj.target.updateMatrixWorld()),this.threeObj.color.copy(TWEEN.getValue(this.keyframeProps.color,CM.currentFrame)),this.threeObj.intensity=TWEEN.getValue(this.keyframeProps.intensity,CM.currentFrame),"undefined"!=typeof this.threeObj.angle&&(this.threeObj.angle=TWEEN.getValue(this.keyframeProps.angle,CM.currentFrame)*Math.PI/180),this.helper.update()},CM.objects.light.prototype.changeObjectType=function(e){switch(this.objectType=e,this.objectType){case 1:this.$listitem.children("span").text("Light"),this.threeObj=new THREE.SpotLight(16777215,1,0,Math.PI/3,.5,1),this.helper=new THREE.SpotLightHelper(this.threeObj),this.helper.children[0].layers.set(2);break;case 2:this.$listitem.children("span").text("Light: Point"),this.threeObj=new THREE.PointLight(16777215,1,0),this.helper=new THREE.PointLightHelper(this.threeObj,5),this.helper.layers.set(2);break;case 3:this.$listitem.children("span").text("Light: Directional"),this.threeObj=new THREE.DirectionalLight(16777215,1),this.helper=new THREE.DirectionalLightHelper(this.threeObj,5),this.helper.children[0].layers.set(2),this.helper.children[1].layers.set(2)}this.helper.visible=!1,this.threeObj.castShadow=!0,this.threeObj.shadow.mapSize.height=1024,this.threeObj.shadow.mapSize.width=1024,this.threeObj.shadow.camera.near=5,this.threeObj.shadow.camera.far=1500,this.threeObj.shadow.camera.fov=60,this.threeObj.shadow.bias=0,this.regroup(),CM.updateMaterials()},CM.objects.light.prototype.regroup=function(e){this.threeObj&&(this.threeObj.parent&&(this.threeObj.parent.remove(this.threeObj),this.helper.parent.remove(this.helper)),e||(this.$listitem.parent().data("group").add(this.threeObj),this.$listitem.parent().data("group").add(this.helper),this.threeObj.layers.mask=this.threeObj.parent.layers.mask))},CM.objects.light.prototype.select=function(e){var t=this;switch(t.insertlocation=e,t.objectType){case 1:PZ.editor.generateTitle({title:"Light"}).appendTo(e),PZ.editor.generateTriInput(t.props.position,t).appendTo(e),PZ.editor.generateTriInput(t.props.target,t).appendTo(e),PZ.editor.generateColorPicker(t.props.color,t).appendTo(e),PZ.editor.generateInput(t.props.intensity,t).appendTo(e),PZ.editor.generateInput(t.props.angle,t).appendTo(e);break;case 2:PZ.editor.generateTitle({title:"Point light"}).appendTo(e),PZ.editor.generateTriInput(t.props.position,t).appendTo(e),PZ.editor.generateInput(t.props.intensity,t).appendTo(e),PZ.editor.generateColorPicker(t.props.color,t).appendTo(e);break;case 3:PZ.editor.generateTitle({title:"Directional light"}).appendTo(e),PZ.editor.generateTriInput(t.props.position,t).appendTo(e),PZ.editor.generateTriInput(t.props.target,t).appendTo(e),PZ.editor.generateColorPicker(t.props.color,t).appendTo(e),PZ.editor.generateInput(t.props.intensity,t).appendTo(e)}},CM.objects.model=function(){this.threeObj=null,this.objectType=0,this.keyframeProps={},this.keyObject=null,this.normalProps={},this.normalProps.positionMode=0},CM.objects.model.prototype.props={lidrotation:{title:"Lid open",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericValueGet(e,this.keyframeProps.lidrotation)},set:function(e,t){return PZ.keyframes.genericValueSet(e,t,this.keyframeProps.lidrotation)},vmax:100,vmin:0,vstep:5,decimals:1,dragstep:.1},position:{title:"Position",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.position)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.position)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},rotation:{title:"Rotation",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericRotation3Get(e,this.keyframeProps.rotation)},set:function(e,t){return PZ.keyframes.genericRotation3Set(e,t,this.keyframeProps.rotation)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},scale:{title:"Scale",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.scale)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.scale)},vmax:1e3,vmin:.001,vstep:.1,dragstep:.001,decimals:3}},CM.objects.model.prototype.clone=function(){var e=new this.constructor;return e.objectType=this.objectType,PZ.extend(e.normalProps,this.normalProps),e.keyframeProps=PZ.keyframes.cloneProps(this.keyframeProps),e},CM.objects.model.prototype.load=function(e){if("string"==typeof e){var t=PZ.archive.getFileString(e);if("undefined"!=typeof t){var r=JSON.parse(t);this.objectType=r.objectType,$.extend(this.normalProps,r.normalProps),$.extend(this.keyframeProps,r.keyframeProps),PZ.keyframes.toVector3(this.keyframeProps.position),PZ.keyframes.toVector3(this.keyframeProps.rotation),PZ.keyframes.toVector3(this.keyframeProps.scale,!0)}}else if("number"==typeof e)switch(this.objectType=e,this.objectType){case 1:this.keyframeProps={position:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],rotation:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],scale:[{frame:1,value:new THREE.Vector3(1,1,1),tweenfn:257}]};break;case 2:this.keyframeProps={lidrotation:[{frame:1,value:0,tweenfn:1}],position:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],rotation:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],scale:[{frame:1,value:new THREE.Vector3(1,1,1),tweenfn:257}]}}this.keyObject=this.keyframeProps,this.changeObjectType(this.objectType,e)},CM.objects.model.prototype.save=function(e){var t=this,r={objectType:t.objectType,normalProps:t.normalProps,keyframeProps:t.keyframeProps};PZ.archive.addFileString(e,JSON.stringify(r))},CM.objects.model.prototype.unload=function(){this.regroup(!0)},CM.objects.model.prototype.regroup=function(e){this.threeObj&&(this.threeObj.parent&&this.threeObj.parent.remove(this.threeObj),e||(this.$listitem.parent().data("group").add(this.threeObj),this.threeObj.layers.mask=this.threeObj.parent.layers.mask))},CM.objects.model.prototype.updateFrame=function(){this.threeObj&&(this.threeObj.position.copy(TWEEN.getValue(this.keyframeProps.position,CM.currentFrame)),this.threeObj.rotation.setFromVector3(TWEEN.getValue(this.keyframeProps.rotation,CM.currentFrame)),this.threeObj.scale.copy(TWEEN.getValue(this.keyframeProps.scale,CM.currentFrame))),this.lidobj&&this.lidobj.rotation.set(.032*TWEEN.getValue(this.keyframeProps.lidrotation,CM.currentFrame),0,0)},CM.objects.model.prototype.changeObjectType=function(e,t){var r=this;switch(r.objectType=e,this.objectType){case 1:r.objectName="AK47";var a=new THREE.JSONLoader;a.load("/assets/models/ak/ak.json",function(e){var t=new THREE.TextureLoader,a=new THREE.MeshPhongMaterial({map:t.load("/assets/models/ak/ak_m.jpg"),normalMap:t.load("/assets/models/ak/ak_n.jpg"),specularMap:t.load("/assets/models/ak/ak_s.jpg"),specular:16777215}),n=new THREE.Mesh(e,a);n.scale.set(5,5,5),r.threeObj=new THREE.Group,r.threeObj.add(n),r.regroup()});break;case 2:r.objectName="Mystery box";var a=new THREE.TextureLoader,n=new THREE.JSONLoader,i=new THREE.JSONLoader;n.load("/assets/models/mysterybox/base.json",function(e){i.load("/assets/models/mysterybox/lid.json",function(t){var n=new THREE.MeshPhongMaterial({map:a.load("/assets/models/mysterybox/base_m.png"),normalMap:a.load("/assets/models/mysterybox/base_n.jpg"),specularMap:a.load("/assets/models/mysterybox/base_s.png"),specular:16777215,shininess:20}),i=new THREE.MeshPhongMaterial({map:a.load("/assets/models/mysterybox/lid_m.png"),normalMap:a.load("/assets/models/mysterybox/lid_n.jpg"),specularMap:a.load("/assets/models/mysterybox/lid_s.png"),specular:16777215}),s=new THREE.Mesh(e,n),o=new THREE.Mesh(t,i);r.lidobj=o,s.scale.set(5,5,5),s.position.set(0,-4.7,0),o.scale.set(5,5,5),o.position.set(0,13.7,6),r.threeObj=new THREE.Group,r.threeObj.add(s),r.threeObj.add(o),r.$listitem.parent().data("group").add(r.threeObj)})})}r.$listitem.children("span").text("Model: "+r.objectName)},CM.objects.model.prototype.select=function(e){var t=this;t.insertlocation=e,PZ.editor.generateTitle({title:t.objectName}).appendTo(e),2===t.objectType&&(PZ.editor.generateInput(t.props.lidrotation,t).appendTo(e),PZ.editor.generateSpacer().appendTo(e)),PZ.editor.generateTriInput(t.props.position,t).appendTo(e),PZ.editor.generateTriInput(t.props.rotation,t).appendTo(e),PZ.editor.generateTriInput(t.props.scale,t).appendTo(e)},CM.objects.particles=function(){this.threeObj=null,this.colorCanvas=null,this.keyframeProps={time:[]},this.keyObject=this.keyframeProps,this.normalProps={},this.normalProps.number=0,this.normalProps.rate=0,this.normalProps.lifetime=0,this.normalProps.accel=new THREE.Vector3(0,0,0),this.normalProps.pdist=0,this.normalProps.ipos=new THREE.Vector3(0,0,0),this.normalProps.pspread=new THREE.Vector3(0,0,0),this.normalProps.iradius=0,this.normalProps.rspread=0,this.normalProps.vdist=0,this.normalProps.ivel=new THREE.Vector3(0,0,0),this.normalProps.vspread=new THREE.Vector3(0,0,0),this.normalProps.irvel=0,this.normalProps.rvspread=0,this.normalProps.iang=0,this.normalProps.aspread=0,this.normalProps.angvel=0,this.normalProps.avspread=0,this.normalProps.color=[],this.normalProps.size=[],this.normalProps.blending=0,this.normalProps.texture="artsy"},CM.objects.particles.prototype.presetTextures=["artsy","bar_blur","circle_sft2","circle_soft","circle_soft3","circle_soft4","clumpy_blurry","dots","flash1","flash2","flash3","misc","nebula","plume","plume2","plume3","plume4","ring","ring_blur","ring_partial","skull","smokey","splash","splotch1","splotch2","spots","squae_soft_blob","square_soft","squiggles","star1","star2","star3","tentacles","tribal","twisted","waterfall"],CM.objects.particles.prototype.vertexShader=["uniform vec2 resolution;","uniform float time;","uniform float rate;","uniform float lifetime;","uniform vec3 accel;","uniform float vdist;","uniform vec3 ivel;","uniform vec3 vspread;","uniform float pdist;","uniform vec3 ipos;","uniform vec3 pspread;","uniform float iang;","uniform float aspread;","uniform float angvel;","uniform float avspread;","uniform sampler2D color;","uniform sampler2D size;","attribute float pid;","varying vec4 vColor;","varying float vAngle;","float rand(vec2 n) { ","return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);","}","void main()","{","float delay = pid / rate;","float ptime = mod(time - delay, lifetime);","float count = floor((time - delay) / lifetime) + 1.0;","vColor = step(delay, time) * texture2D(color, vec2(ptime / lifetime, 0.0));","float scale = texture2D(size, vec2(ptime / lifetime, 0.0)).r;","float a = iang + (-0.5 + rand(vec2(pid*count, pid)) ) * aspread;","float avel = angvel + avspread * (rand(vec2(pid*count, 10.0)) - 0.5);","vAngle = avel*ptime + a;","#if PDIST==0","vec3 p = ( vec3(-0.5) + ","  vec3(rand(vec2(pid*count, 1.0)), rand(vec2(pid*count, 2.0)), rand(vec2(pid*count, 3.0))) )","  * pspread;","#else","float phi = rand(vec2(pid*count, 1.0)) * 6.28319;","float theta = rand(vec2(pid*count, 2.0)) * 3.14159 * pspread.z;","float rad = (rand(vec2(pid*count, 3.0)) - 0.5) * pspread.y + pspread.x;","vec3 p = rad * vec3(sin(phi)*cos(theta), sin(phi)*sin(theta), cos(phi));","#endif","#if VDIST==0","vec3 v = ivel + ( vec3(-0.5) + ","  vec3(rand(vec2(pid*count, 3.0)), rand(vec2(pid*count, 2.0)), rand(vec2(pid*count, 1.0))) )","  * vspread;","#else","vec3 v = (ivel.x + (rand(vec2(pid*count, 3.0)) - 0.5) * vspread.x) * normalize(p);","#endif","vec3 pos = accel*ptime*ptime*0.5 + v*ptime + p + ipos;","vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0 );","gl_PointSize = scale * resolution.x * 50.0 / length( mvPosition.xyz );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),CM.objects.particles.prototype.fragmentShader=["uniform sampler2D texture;","varying vec4 vColor;","varying float vAngle;","void main()","{","float x = gl_PointCoord.x - 0.5;","float y = 1.0 - gl_PointCoord.y - 0.5;","float c = cos(-vAngle);","float s = sin(-vAngle);","vec2 rotatedUV = vec2(c * x + s * y + 0.5, c * y - s * x + 0.5);","vec4 tcolor = texture2D( texture,  rotatedUV );","gl_FragColor = tcolor * vColor;","}"].join("\n"),
CM.objects.particles.prototype.props={time:{title:"Time",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericValueGet(e,this.keyframeProps.time)},set:function(e,t){return PZ.keyframes.genericValueSet(e,t,this.keyframeProps.time)},vmax:1e4,vmin:-1,vstep:.01,decimals:2,dragstep:.01},color:{title:"Color",get:function(){return this.normalProps.color},set:function(e){this.normalProps.color=e,this.redrawgradient(this.colorCanvas,this.normalProps.color),this.material.uniforms.color.value.needsUpdate=!0}},size:{title:"Size",get:function(){return this.normalProps.size},set:function(e){this.normalProps.size=e,this.redrawgradient(this.sizeCanvas,this.normalProps.size),this.material.uniforms.size.needsUpdate=!0,this.material.uniforms.size.value.needsUpdate=!0}},number:{title:"Number of particles",get:function(){return this.normalProps.number},set:function(e){this.normalProps.number=e,this.updateNumber()},vmax:1e5,vmin:1,vstep:1},rate:{title:"Emitter rate",get:function(){return this.normalProps.rate},set:function(e){this.normalProps.rate=e,this.material.uniforms.rate.value=e},vmax:1e4,vmin:1,vstep:1},lifetime:{title:"Particle lifetime",get:function(){return this.normalProps.lifetime},set:function(e){this.normalProps.lifetime=e,this.material.uniforms.lifetime.value=e},dragstep:.001,decimals:2,vmax:1e3,vmin:.01,vstep:1},pdist:{title:"Position mode",items:"box;sphere;disk",get:function(){return this.normalProps.pdist>0?(this.$pspread.hide(),this.$iradius.attr("style",""),this.$rspread.attr("style","")):(this.$pspread.attr("style",""),this.$iradius.hide(),this.$rspread.hide()),this.normalProps.pdist},set:function(e){this.normalProps.pdist=e,this.material.defines.PDIST=0===e?0:1,this.material.needsUpdate=!0,e>0?(this.material.uniforms.pspread.value.x=this.normalProps.iradius,this.material.uniforms.pspread.value.y=this.normalProps.rspread,this.material.uniforms.pspread.value.z=1===e?1:0,this.$pspread.hide(),this.$iradius.attr("style",""),this.$rspread.attr("style","")):(this.material.uniforms.pspread.value.copy(this.normalProps.pspread),this.$pspread.attr("style",""),this.$iradius.hide(),this.$rspread.hide())}},ipos:{title:"Position",get:function(){return this.normalProps.ipos},set:function(e,t){switch(t){case 0:this.normalProps.ipos.x=e;break;case 1:this.normalProps.ipos.y=e;break;case 2:this.normalProps.ipos.z=e}this.material.uniforms.ipos.value.copy(this.normalProps.ipos)},vmax:1e4,vmin:-1e4,vstep:1},pspread:{title:"Spread",get:function(){return this.normalProps.pspread},set:function(e,t){switch(t){case 0:this.normalProps.pspread.x=e;break;case 1:this.normalProps.pspread.y=e;break;case 2:this.normalProps.pspread.z=e}this.material.uniforms.pspread.value.copy(this.normalProps.pspread)},vmax:1e4,vmin:0,vstep:1},iradius:{title:"Radius",get:function(){return this.normalProps.iradius},set:function(e){this.normalProps.iradius=e,this.material.uniforms.pspread.value.x=e},vmax:1e4,vmin:-1e4,vstep:1},rspread:{title:"Spread",get:function(){return this.normalProps.rspread},set:function(e){this.normalProps.rspread=e,this.material.uniforms.pspread.value.y=e},vmax:1e4,vmin:-1e4,vstep:1},vdist:{title:"Speed mode",items:"box;sphere",get:function(){return this.normalProps.vdist>0?(this.$ivel.hide(),this.$vspread.hide(),this.$irvel.attr("style",""),this.$rvspread.attr("style","")):(this.$ivel.attr("style",""),this.$vspread.attr("style",""),this.$irvel.hide(),this.$rvspread.hide()),this.normalProps.vdist},set:function(e){this.normalProps.vdist=e,this.material.defines.VDIST=e,this.material.needsUpdate=!0,e>0?(this.material.uniforms.ivel.value.x=this.normalProps.irvel,this.material.uniforms.vspread.value.x=this.normalProps.rvspread,this.$ivel.hide(),this.$vspread.hide(),this.$irvel.attr("style",""),this.$rvspread.attr("style","")):(this.material.uniforms.ivel.value.copy(this.normalProps.ivel),this.material.uniforms.vspread.value.copy(this.normalProps.vspread),this.$ivel.attr("style",""),this.$vspread.attr("style",""),this.$irvel.hide(),this.$rvspread.hide())}},ivel:{title:"Speed",get:function(){return this.normalProps.ivel},set:function(e,t){switch(t){case 0:this.normalProps.ivel.x=e;break;case 1:this.normalProps.ivel.y=e;break;case 2:this.normalProps.ivel.z=e}this.material.uniforms.ivel.value.copy(this.normalProps.ivel)},vmax:1e4,vmin:-1e4,vstep:1},vspread:{title:"Spread",get:function(){return this.normalProps.vspread},set:function(e,t){switch(t){case 0:this.normalProps.vspread.x=e;break;case 1:this.normalProps.vspread.y=e;break;case 2:this.normalProps.vspread.z=e}this.material.uniforms.vspread.value.copy(this.normalProps.vspread)},vmax:1e4,vmin:0,vstep:1},irvel:{title:"Speed",get:function(){return this.normalProps.irvel},set:function(e){this.normalProps.irvel=e,this.material.uniforms.ivel.value.x=e},vmax:1e4,vmin:-1e3,vstep:1},rvspread:{title:"Spread",get:function(){return this.normalProps.rvspread},set:function(e){this.normalProps.rvspread=e,this.material.uniforms.vspread.value.x=e},vmax:1e4,vmin:0,vstep:1},accel:{title:"Gravity",get:function(){return this.normalProps.accel},set:function(e,t){switch(t){case 0:this.normalProps.accel.x=e;break;case 1:this.normalProps.accel.y=e;break;case 2:this.normalProps.accel.z=e}this.material.uniforms.accel.value.copy(this.normalProps.accel)},vmax:1e4,vmin:-1e4,vstep:1},iang:{title:"Rotation",get:function(){return this.normalProps.iang},set:function(e){this.normalProps.iang=e,this.material.uniforms.iang.value=e/180*Math.PI},vmax:360,vmin:0,vstep:1},aspread:{title:"Spread",get:function(){return this.normalProps.aspread},set:function(e){this.normalProps.aspread=e,this.material.uniforms.aspread.value=e/180*Math.PI},vmax:360,vmin:0,vstep:1},angvel:{title:"Rotation speed",get:function(){return this.normalProps.angvel},set:function(e){this.normalProps.angvel=e,this.material.uniforms.angvel.value=e/180*Math.PI},vmax:1e3,vmin:-1e3,vstep:1},avspread:{title:"Spread",get:function(){return this.normalProps.avspread},set:function(e){this.normalProps.avspread=e,this.material.uniforms.avspread.value=e/180*Math.PI},vmax:1e3,vmin:-1e3,vstep:1},blending:{title:"Blending mode",items:"normal;add",get:function(){return this.normalProps.blending},set:function(e){this.normalProps.blending=e,this.material.blending=e+1}},texture:{title:"Texture",items:CM.objects.particles.prototype.presetTextures.join(";")+";custom",get:function(){var e=CM.objects.particles.prototype.presetTextures.indexOf(this.normalProps.texture);return e>=0?(this.$customtexture.hide(),e):(this.$customtexture.attr("style",""),CM.objects.particles.prototype.presetTextures.length)},set:function(e){if(e>=CM.objects.particles.prototype.presetTextures.length)this.$customtexture.attr("style","");else{this.$customtexture.hide(),this.normalProps.texture=CM.objects.particles.prototype.presetTextures[e];var t=this.material.uniforms.texture;null!==t.value&&(PZ.textures.unload(t.value.image),t.value.dispose(),t.value=null);var r=new THREE.TextureLoader;t.value=r.load("/assets/textures/particles/"+this.normalProps.texture+".png")}}},customtexture:{title:"Custom texture",accept:"image/*",set:function(e){this.normalProps.texture="";var t=this.material.uniforms.texture;e.files&&e.files[0]&&PZ.textures.load(e.files[0],function(e){null!==t.value&&(PZ.textures.unload(t.value.image),t.value.dispose(),t.value=null),t.value=new THREE.Texture(e),t.value.needsUpdate=!0})}}},CM.objects.particles.prototype.redrawgradient=function(e,t){for(var r=e.getContext("2d"),a=r.createLinearGradient(0,0,e.width,0),n=0;n<t.length;n++)a.addColorStop(t[n].position,t[n].color);r.clearRect(0,0,e.width,e.height),r.fillStyle=a,r.fillRect(0,0,e.width,e.height)},CM.objects.particles.prototype.load=function(e){if(this.$listitem.children("span").text("Particles"),this.colorCanvas=document.createElement("canvas"),this.colorCanvas.width=32,this.colorCanvas.height=1,this.sizeCanvas=document.createElement("canvas"),this.sizeCanvas.width=32,this.sizeCanvas.height=1,this.material=new THREE.ShaderMaterial({uniforms:{resolution:{type:"v2",value:CM.resolution},texture:{type:"t",value:null},color:{type:"t",value:new THREE.Texture(this.colorCanvas)},size:{type:"t",value:new THREE.Texture(this.sizeCanvas)},time:{type:"f",value:0},rate:{type:"f",value:0},lifetime:{type:"f",value:0},accel:{type:"v3",value:new THREE.Vector3},vdist:{type:"f",value:0},ivel:{type:"v3",value:new THREE.Vector3},vspread:{type:"v3",value:new THREE.Vector3},pdist:{type:"f",value:0},ipos:{type:"v3",value:new THREE.Vector3},pspread:{type:"v3",value:new THREE.Vector3},iang:{type:"f",value:0},aspread:{type:"f",value:0},angvel:{type:"f",value:0},avspread:{type:"f",value:0}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,transparent:!0,depthTest:!0,depthWrite:!1}),this.threeObj=new THREE.Points(new THREE.BufferGeometry,this.material),this.threeObj.frustumCulled=!1,"string"==typeof e){var t,r=PZ.archive.getFileString(e);if("undefined"!=typeof r){var a=JSON.parse(r);t=a.image,PZ.extend(this.normalProps,a.normalProps),$.extend(this.keyframeProps,a.keyframeProps)}var n=this.material.uniforms.texture;PZ.textures.load(t||e+"_img",function(e){n.value=new THREE.Texture(e),n.value.needsUpdate=!0})}else if("object"==typeof e){if(null!==e.material.uniforms.texture.value){var n=this.material.uniforms.texture;n.value=new THREE.Texture(PZ.textures.clone(e.material.uniforms.texture.value.image)),n.value.needsUpdate=!0}}else this.randomize();this.updateProps(),this.regroup()},CM.objects.particles.prototype.randomize=function(){var e=this.normalProps,t=PZ.random.number(1,4,!0);e.color=[];for(var r=0;r<t;r++)e.color.push({position:PZ.random.number(0,1),color:PZ.random.color(0===r&&t>1||r===t-1)});var a=PZ.random.number(1,4,!0);e.size=[];for(var r=0;r<a;r++)e.size.push({position:PZ.random.number(0,1),color:PZ.random.grayColor()});e.number=PZ.random.number(1,1e3,!0),e.rate=Math.round(PZ.random.number(.1,3)*e.number),PZ.random.number(0,1)>.5?e.lifetime=e.number/e.rate:e.lifetime=PZ.random.normal(CM.totalTime,.5*CM.totalTime),this.keyframeProps.time.splice(0,this.keyframeProps.time.length);var n=0;PZ.random.number(0,1)>.3&&(n=e.number/e.rate),this.keyframeProps.time.push({frame:1,value:n,tweenfn:1}),this.keyframeProps.time.push({frame:CM.totalFrames,value:n+CM.totalTime*PZ.random.number(.1,3),tweenfn:PZ.random.number(0,1)>.9?PZ.random.number(2,31,!0):1}),e.pdist=PZ.random.number(0,2,!0);var i=500*PZ.random.number(0,2,!0);0===e.pdist?e.pspread.set(PZ.random.normal(i,300),PZ.random.normal(i,300),PZ.random.normal(i,300)):(e.iradius=PZ.random.normal(i,300),e.rspread=PZ.random.number(1,2*e.iradius)),e.vdist=PZ.random.number(0,1,!0),0===e.vdist?(e.ivel.set(PZ.random.normal(0,100),PZ.random.normal(0,100),PZ.random.normal(0,100)),e.vspread.set(Math.abs(PZ.random.normal(0,100)),Math.abs(PZ.random.normal(0,100)),Math.abs(PZ.random.normal(0,100)))):(e.irvel=PZ.random.normal(100,200),e.rvspread=Math.abs(PZ.random.normal(0,100))),PZ.random.number(0,1)>.3?e.accel.set(PZ.random.normal(0,100),PZ.random.normal(0,100),PZ.random.normal(0,100)):e.accel.set(0,0,0),e.iang=PZ.random.number(0,359),PZ.random.number(0,1)>.2?e.aspread=PZ.random.number(0,359):e.aspread=0,PZ.random.number(0,1)>.4?(e.angvel=PZ.random.normal(0,20),e.avspread=Math.abs(PZ.random.normal(0,200))):(e.angvel=0,e.avspread=0),e.blending=PZ.random.number(0,1,!0),e.texture=this.presetTextures[PZ.random.number(0,this.presetTextures.length-1,!0)]},CM.objects.particles.prototype.updateProps=function(){var e=this.material.uniforms,t=this.normalProps;if(this.redrawgradient(this.colorCanvas,t.color),this.redrawgradient(this.sizeCanvas,t.size),e.color.value.needsUpdate=!0,e.size.value.needsUpdate=!0,this.updateNumber(),e.rate.value=t.rate,e.lifetime.value=t.lifetime,e.ipos.value.copy(t.ipos),this.material.defines.PDIST=0===t.pdist?0:1,t.pdist>0?(e.pspread.value.x=t.iradius,e.pspread.value.y=t.rspread,e.pspread.value.z=1===t.pdist?1:0):e.pspread.value.copy(t.pspread),this.material.defines.VDIST=t.vdist,t.vdist>0?(e.ivel.value.x=t.irvel,e.vspread.value.x=t.rvspread):(e.ivel.value.copy(t.ivel),e.vspread.value.copy(t.vspread)),e.accel.value.copy(t.accel),e.iang.value=t.iang/180*Math.PI,e.aspread.value=t.aspread/180*Math.PI,e.angvel.value=t.angvel/180*Math.PI,e.avspread.value=t.avspread/180*Math.PI,this.material.blending=t.blending+1,""!==t.texture){var r=e.texture;null!==r.value&&(PZ.textures.unload(r.value.image),r.value.dispose(),r.value=null);var a=new THREE.TextureLoader;r.value=a.load("/assets/textures/particles/"+t.texture+".png")}this.material.needsUpdate=!0},CM.objects.particles.prototype.clone=function(){var e=new this.constructor;return PZ.extend(e.normalProps,this.normalProps),e.keyframeProps=PZ.keyframes.cloneProps(this.keyframeProps),e.keyObject=e.keyframeProps,e},CM.objects.particles.prototype.updateNumber=function(){null!==this.threeObj.geometry&&this.threeObj.geometry.dispose();for(var e=new Float32Array(3*this.normalProps.number),t=new Float32Array(this.normalProps.number),r=0;r<this.normalProps.number;r++)t[r]=r,e[3*r]=0,e[3*r+1]=0,e[3*r+2]=0;this.threeObj.geometry=new THREE.BufferGeometry,this.threeObj.geometry.addAttribute("position",new THREE.BufferAttribute(e,3)),this.threeObj.geometry.addAttribute("pid",new THREE.BufferAttribute(t,1)),this.threeObj.geometry.buffersNeedUpdate=!0},CM.objects.particles.prototype.save=function(e){var t=this,r={normalProps:t.normalProps,keyframeProps:t.keyframeProps};PZ.archive.addFileString(e,JSON.stringify(r));var a=t.material.uniforms.texture;""===t.normalProps.texture&&null!==a.value&&(CM.templates.saveWaiting++,PZ.textures.save(a.value.image,e+"_img",function(){CM.templates.saveWaiting--,CM.templates.saveComplete()},!0))},CM.objects.particles.prototype.unload=function(){var e=this.material.uniforms.texture;null!==e.value&&PZ.textures.unload(e.value.image),this.regroup(!0)},CM.objects.particles.prototype.regroup=function(e){this.threeObj&&(this.threeObj.parent&&this.threeObj.parent.remove(this.threeObj),e||(this.$listitem.parent().data("group").add(this.threeObj),this.threeObj.layers.mask=this.threeObj.parent.layers.mask))},CM.objects.particles.prototype.updateFrame=function(){this.material.uniforms.time.value=TWEEN.getValue(this.keyframeProps.time,CM.currentFrame)},CM.objects.particles.prototype.select=function(e){var t=this;PZ.editor.generateTitle({title:"Particles",randomize:function(){t.randomize(),t.updateProps(),CM.timeline.update(),e.children(".proprow").trigger("update")}}).appendTo(e),PZ.editor.generateInput(t.props.time,t).appendTo(e),PZ.editor.generateGradientPicker(t.props.color,t).appendTo(e),PZ.editor.generateGradientPicker(t.props.size,t).appendTo(e),PZ.editor.generateInput(t.props.number,t).appendTo(e),PZ.editor.generateInput(t.props.rate,t).appendTo(e),PZ.editor.generateInput(t.props.lifetime,t).appendTo(e),PZ.editor.generateSpacer().appendTo(e),t.$pspread=PZ.editor.generateTriInput(t.props.pspread,t),t.$iradius=PZ.editor.generateInput(t.props.iradius,t).hide(),t.$rspread=PZ.editor.generateInput(t.props.rspread,t).hide(),PZ.editor.generateDropdown(t.props.pdist,t).appendTo(e),PZ.editor.generateTriInput(t.props.ipos,t).appendTo(e),t.$pspread.appendTo(e),t.$iradius.appendTo(e),t.$rspread.appendTo(e),PZ.editor.generateSpacer().appendTo(e),t.$ivel=PZ.editor.generateTriInput(t.props.ivel,t),t.$vspread=PZ.editor.generateTriInput(t.props.vspread,t),t.$irvel=PZ.editor.generateInput(t.props.irvel,t).hide(),t.$rvspread=PZ.editor.generateInput(t.props.rvspread,t).hide(),PZ.editor.generateDropdown(t.props.vdist,t).appendTo(e),t.$ivel.appendTo(e),t.$vspread.appendTo(e),t.$irvel.appendTo(e),t.$rvspread.appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateTriInput(t.props.accel,t).appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateInput(t.props.iang,t).appendTo(e),PZ.editor.generateInput(t.props.aspread,t).appendTo(e),PZ.editor.generateInput(t.props.angvel,t).appendTo(e),PZ.editor.generateInput(t.props.avspread,t).appendTo(e),PZ.editor.generateSpacer().appendTo(e),t.$customtexture=PZ.editor.generateFileUpload(t.props.customtexture,t).hide(),PZ.editor.generateDropdown(t.props.blending,t).appendTo(e),PZ.editor.generateDropdown(t.props.texture,t).appendTo(e),t.$customtexture.appendTo(e)},CM.objects.shape=function(){this.threeObj=null,this.objectType=0,this.keyframeProps={position:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],rotation:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],scale:[{frame:1,value:new THREE.Vector3(1,1,1),tweenfn:257}]},this.keyObject=null,this.normalProps={},this.normalProps.size=new THREE.Vector3(10,10,10),this.normalProps.detail=new THREE.Vector2(10,10),this.normalProps.thetaRange=new THREE.Vector2(0,2*Math.PI),this.normalProps.phiRange=new THREE.Vector2(0,Math.PI),this.normalProps.arc=2*Math.PI,this.normalProps.thickness=2,this.normalProps.loops=5,this.normalProps.openEnded=!1,this.appearanceObj="singlecolor"},CM.objects.shape.prototype.props={box_size:{title:"Size",subtitle1:"width",subtitle2:"height",subtitle3:"depth",vmax:1e4,vmin:0,vstep:1,get:function(){return this.normalProps.size},set:function(e,t){switch(t){case 0:this.normalProps.size.x=e;break;case 1:this.normalProps.size.y=e;break;case 2:this.normalProps.size.z=e}this.updateProps()}},cylinder_size:{title:"Size",subtitle1:"top radius",subtitle2:"bottom radius",subtitle3:"height",vmax:1e4,vmin:0,vstep:1,get:function(){return this.normalProps.size},set:function(e,t){switch(t){case 0:this.normalProps.size.x=e;break;case 1:this.normalProps.size.y=e;break;case 2:this.normalProps.size.z=e}this.updateProps()}},cylinder_detail:{title:"Detail",vmax:1e4,vmin:0,vstep:1,get:function(){return this.normalProps.detail.x},set:function(e){this.normalProps.detail.x=e,this.updateProps()}},cylinder_open:{title:"Open ended",items:"false;true",get:function(){return this.normalProps.openEnded},set:function(e){this.normalProps.openEnded=e,this.updateProps()}},rect_size:{title:"Size",subtitle1:"width",subtitle2:"height",vmax:1e4,vmin:0,vstep:1,get:function(){return this.normalProps.size},set:function(e,t){switch(t){case 0:this.normalProps.size.x=e;break;case 1:this.normalProps.size.y=e}this.updateProps()}},circle_radius:{title:"Radius",vmax:1e4,vmin:0,vstep:1,get:function(){return this.normalProps.size.x},set:function(e){this.normalProps.size.x=e,this.updateProps()}},circle_detail:{title:"Detail",vmax:1e4,vmin:1,vstep:1,get:function(){return this.normalProps.detail.x},set:function(e){this.normalProps.detail.x=e,this.updateProps()}},sphere_radius:{title:"Radius",vmax:1e4,vmin:0,vstep:1,get:function(){return this.normalProps.size.x},set:function(e){this.normalProps.size.x=e,this.updateProps()}},sphere_detail:{title:"Detail",subtitle1:"horizontal",subtitle2:"vertical",vmax:1e4,vmin:1,vstep:1,get:function(){return this.normalProps.detail},set:function(e,t){switch(t){case 0:this.normalProps.detail.x=e;break;case 1:this.normalProps.detail.y=e}this.updateProps()}},donut_size:{title:"Size",subtitle1:"radius",subtitle2:"tube radius",vmax:1e4,vmin:0,vstep:1,get:function(){return this.normalProps.size},set:function(e,t){switch(t){case 0:this.normalProps.size.x=e;break;case 1:this.normalProps.size.y=e}this.updateProps()}},donut_detail:{title:"Detail",subtitle1:"inner",subtitle2:"outer",vmax:1e4,vmin:1,vstep:1,get:function(){return this.normalProps.detail},set:function(e,t){switch(t){case 0:this.normalProps.detail.x=e;break;case 1:this.normalProps.detail.y=e}this.updateProps()}},path_size:{title:"Size",subtitle1:"horizontal",subtitle2:"vertical",vmax:1e4,vmin:0,vstep:1,get:function(){return this.normalProps.size},set:function(e,t){switch(t){case 0:this.normalProps.size.x=e;break;case 1:this.normalProps.size.y=e}this.updateProps()}},path_stretch:{title:"Stetch",vmax:1e4,vmin:1,vstep:1,get:function(){return this.normalProps.size.z},set:function(e){this.normalProps.size.z=e,this.updateProps()}},path_thickness:{title:"Thickness",vmax:1e4,vmin:1,vstep:1,get:function(){return this.normalProps.thickness},set:function(e){this.normalProps.thickness=e,this.updateProps()}},path_loops:{title:"Loops",vmax:1e4,vmin:1,vstep:1,get:function(){return this.normalProps.loops},set:function(e){this.normalProps.loops=e,this.updateProps()}},path_detail:{title:"Detail",subtitle1:"inner",subtitle2:"outer",vmax:1e4,vmin:1,vstep:1,get:function(){return this.normalProps.detail},set:function(e,t){switch(t){case 0:this.normalProps.detail.x=e;break;case 1:this.normalProps.detail.y=e}this.updateProps()}},position:{title:"Position",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.position)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.position)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},rotation:{title:"Rotation",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericRotation3Get(e,this.keyframeProps.rotation)},set:function(e,t){return PZ.keyframes.genericRotation3Set(e,t,this.keyframeProps.rotation)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},scale:{title:"Scale",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.scale)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.scale)},vmax:1e3,vmin:.001,vstep:.1,dragstep:.001,decimals:3},appearance:{title:"Appearance",get:function(){return CM.appearance.getIndex(this.appearanceObj)},items:CM.appearance.string,set:function(e){CM.appearance.objects[this.appearanceObj].unload(this.threeObj),CM.appearance.unload(this.appearanceObj),this.appearanceObj=CM.appearance.list[e].file,this.appearancePlaceholder.empty(),CM.appearance.load(this.appearanceObj),CM.appearance.objects[this.appearanceObj].load(this.threeObj),CM.appearance.objects[this.appearanceObj].select(this.threeObj,this.appearancePlaceholder),this.keyObject=$.extend({},this.keyframeProps,this.threeObj.material.keyframeProps),CM.timeline.keyObject=this.keyObject,CM.timeline.update(),this.appearancePlaceholder.parent().scrollTop(this.appearancePlaceholder.parent().height())}}},CM.objects.shape.prototype.clone=function(){var e=new this.constructor;return e.objectType=this.objectType,PZ.extend(e.normalProps,this.normalProps),e.keyframeProps=PZ.keyframes.cloneProps(this.keyframeProps),e.appearanceObj=this.appearanceObj,e},CM.objects.shape.prototype.load=function(e){if("string"==typeof e){var t=PZ.archive.getFileString(e);if("undefined"!=typeof t){var r=JSON.parse(t);this.objectType=r.objectType,this.appearanceObj=r.appearanceObj,PZ.extend(this.normalProps,r.normalProps),$.extend(this.keyframeProps,r.keyframeProps),PZ.keyframes.toVector3(this.keyframeProps.position),PZ.keyframes.toVector3(this.keyframeProps.rotation),PZ.keyframes.toVector3(this.keyframeProps.scale,!0)}}else if("number"==typeof e)this.objectType=e;else if("object"==typeof e&&e instanceof CM.objects.shape==!1)return this.objectType=99,void this.changeObjectType(this.objectType,0,e);return 0===this.objectType?void this.$listitem.children("[title='delete']").trigger("click"):void this.changeObjectType(this.objectType,e)},CM.objects.shape.prototype.save=function(e){var t=this;t.threeObj&&CM.appearance.objects[t.appearanceObj].save(t.threeObj,e+"_appearance"),99===t.objectType&&PZ.archive.addFileString(e+"_geometry",JSON.stringify(t.threeObj.geometry.toJSON()));var r={objectType:t.objectType,normalProps:t.normalProps,appearanceObj:t.appearanceObj,keyframeProps:t.keyframeProps};PZ.archive.addFileString(e,JSON.stringify(r))},CM.objects.shape.prototype.unload=function(){this.threeObj&&(CM.appearance.objects[this.appearanceObj].unload(this.threeObj),CM.appearance.unload(this.appearanceObj),this.regroup(!0))},CM.objects.shape.prototype.regroup=function(e){this.threeObj&&(this.threeObj.parent&&this.threeObj.parent.remove(this.threeObj),e||(this.$listitem.parent().data("group").add(this.threeObj),this.threeObj.layers.mask=this.threeObj.parent.layers.mask))},CM.objects.shape.prototype.updateFrame=function(e){this.threeObj.position.copy(TWEEN.getValue(this.keyframeProps.position,CM.currentFrame)),this.threeObj.rotation.setFromVector3(TWEEN.getValue(this.keyframeProps.rotation,CM.currentFrame)),this.threeObj.scale.copy(TWEEN.getValue(this.keyframeProps.scale,CM.currentFrame)),CM.appearance.objects[this.appearanceObj].update(this.threeObj,e)},CM.objects.shape.prototype.updateProps=function(){switch(this.threeObj.geometry&&this.threeObj.geometry.dispose(),this.objectType){case 1:this.threeObj.geometry=new THREE.BoxGeometry(this.normalProps.size.x,this.normalProps.size.y,this.normalProps.size.z);break;case 2:this.threeObj.geometry=new THREE.CylinderGeometry(this.normalProps.size.x,this.normalProps.size.y,this.normalProps.size.z,this.normalProps.detail.x,1,this.normalProps.openEnded);break;case 3:this.threeObj.geometry=new THREE.PlaneGeometry(this.normalProps.size.x,this.normalProps.size.y);break;case 4:this.threeObj.geometry=new THREE.CircleGeometry(this.normalProps.size.x,this.normalProps.detail.x,this.normalProps.thetaRange.x,this.normalProps.thetaRange.y);break;case 5:this.threeObj.geometry=new THREE.SphereGeometry(this.normalProps.size.x,this.normalProps.detail.x,this.normalProps.detail.y,this.normalProps.thetaRange.x,this.normalProps.thetaRange.y,this.normalProps.phiRange.x,this.normalProps.phiRange.y);break;case 6:this.threeObj.geometry=new THREE.TorusGeometry(this.normalProps.size.x,this.normalProps.size.y,this.normalProps.detail.x,this.normalProps.detail.y,this.normalProps.arc);break;case 7:for(var e=[],t=0;t<this.normalProps.loops*this.normalProps.detail.y;t++)e.push(new THREE.Vector3(this.normalProps.size.x*Math.cos(2*Math.PI*t/this.normalProps.detail.y),this.normalProps.size.y*Math.sin(2*Math.PI*t/this.normalProps.detail.y),this.normalProps.size.z*t/this.normalProps.detail.y));for(var r=new THREE.CatmullRomCurve3(e),a={steps:10*this.normalProps.detail.y,bevelEnabled:!1,extrudePath:r},n=[],i=this.normalProps.thickness,t=0;t<this.normalProps.detail.x;t++){var s=t/this.normalProps.detail.x*2*Math.PI;n.push(new THREE.Vector2(Math.cos(s)*i,Math.sin(s)*i))}var o=new THREE.Shape(n);this.threeObj.geometry=new THREE.ExtrudeGeometry(o,a),this.threeObj.geometry.computeFaceNormals(),this.threeObj.geometry.computeVertexNormals()}this.threeObj.geometry.center(),this.threeObj.geometry.buffersNeedUpdate=!0},CM.objects.shape.prototype.changeObjectType=function(e,t,r){this.objectType=e;var a=this.$listitem.children("span");switch(this.objectType){case 1:a.text("Shape: Box");break;case 2:a.text("Shape: Cylinder");break;case 3:a.text("Shape: Rectangle");break;case 4:a.text("Shape: Circle");break;case 5:a.text("Shape: Sphere");break;case 6:a.text("Shape: Donut");break;case 7:a.text("Shape: Wire");break;case 99:if("undefined"!=typeof r)this.normalProps.name=r.name||"imported geometry",this.threeObj=r;else if("string"==typeof t){var n=PZ.archive.getFileString(t+"_geometry");if("undefined"!=typeof n){var i=new THREE.BufferGeometryLoader,r=i.parse(JSON.parse(n));this.threeObj=new THREE.Mesh(r,null),this.regroup()}}a.text("Shape: "+this.normalProps.name.substring(0,25))}null===this.threeObj&&(this.threeObj=new THREE.Mesh(new THREE.Geometry,null),this.updateProps(),this.regroup()),this.threeObj.castShadow=!0,this.threeObj.receiveShadow=!0,CM.appearance.load(this.appearanceObj),"string"==typeof t?t+="_appearance":"object"==typeof t&&(t=t.threeObj),CM.appearance.objects[this.appearanceObj].load(this.threeObj,t),this.keyObject=$.extend({},this.keyframeProps,this.threeObj.material.keyframeProps)},CM.objects.shape.prototype.select=function(e){var t=this;switch(t.insertlocation=e,t.objectType){case 1:PZ.editor.generateTitle({title:"Box"}).appendTo(e),PZ.editor.generateTriInput(t.props.box_size,t).appendTo(e);break;case 2:PZ.editor.generateTitle({title:"Cylinder"}).appendTo(e),PZ.editor.generateTriInput(t.props.cylinder_size,t).appendTo(e),PZ.editor.generateInput(t.props.cylinder_detail,t).appendTo(e),PZ.editor.generateDropdown(t.props.cylinder_open,t).appendTo(e);break;case 3:PZ.editor.generateTitle({title:"Rectangle"}).appendTo(e),PZ.editor.generateDualInput(t.props.rect_size,t).appendTo(e);break;case 4:PZ.editor.generateTitle({title:"Circle"}).appendTo(e),PZ.editor.generateInput(t.props.circle_radius,t).appendTo(e),PZ.editor.generateInput(t.props.circle_detail,t).appendTo(e);break;case 5:PZ.editor.generateTitle({title:"Sphere"}).appendTo(e),PZ.editor.generateInput(t.props.sphere_radius,t).appendTo(e),PZ.editor.generateDualInput(t.props.sphere_detail,t).appendTo(e);break;case 6:PZ.editor.generateTitle({title:"Donut"}).appendTo(e),PZ.editor.generateDualInput(t.props.donut_size,t).appendTo(e),PZ.editor.generateDualInput(t.props.donut_detail,t).appendTo(e);break;case 7:PZ.editor.generateTitle({title:"Wire"}).appendTo(e),PZ.editor.generateDualInput(t.props.path_size,t).appendTo(e),PZ.editor.generateInput(t.props.path_stretch,t).appendTo(e),PZ.editor.generateInput(t.props.path_thickness,t).appendTo(e),PZ.editor.generateInput(t.props.path_loops,t).appendTo(e),PZ.editor.generateDualInput(t.props.path_detail,t).appendTo(e);break;case 99:PZ.editor.generateTitle({title:"Custom Object"}).appendTo(e)}99!==t.objectType&&PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateTriInput(t.props.position,t).appendTo(e),PZ.editor.generateTriInput(t.props.rotation,t).appendTo(e),PZ.editor.generateTriInput(t.props.scale,t).appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateDropdown(t.props.appearance,t).appendTo(e),t.appearancePlaceholder=PZ.editor.generatePlaceholder().appendTo(e),CM.appearance.objects[t.appearanceObj].select(t.threeObj,t.appearancePlaceholder)},CM.objects.text3d=function(){this.threeObj=null,this.keyframeProps={position:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],rotation:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],scale:[{frame:1,value:new THREE.Vector3(1,1,1),tweenfn:257}]},this.keyObject=this.keyframeProps,this.normalProps={},this.normalProps.size=new THREE.Vector2(20,3),this.normalProps.detail=5,this.normalProps.bevel=!1,this.normalProps.bevelsize=new THREE.Vector2(.1,.5),this.normalProps.font="bebas",this.normalProps.text="clipmaker",this.normalProps.positionMode=0,this.appearanceObj="singlecolor"},CM.objects.text3d.prototype.props={text:{get:function(){return this.normalProps.text},set:function(e){this.normalProps.text=e,this.$listitem.children("span").text("Text: "+e.substr(0,25)),this.updateProps()}},font:{title:"Font",items:PZ.fonts.preset.join(";")+";custom",get:function(){var e=PZ.fonts.preset.indexOf(this.normalProps.font);return e>=0?(this.$customfont.hide(),e):(this.$customfont.attr("style",""),PZ.fonts.preset.length)},set:function(e){if(e>=PZ.fonts.preset.length)this.$customfont.attr("style","");else{this.$customfont.hide();var t=this;PZ.fonts.load(PZ.fonts.preset[e],function(e,r){PZ.fonts.unload(t.normalProps.font),t.normalProps.font=e,t.updateProps()})}}},fupload:{title:"Custom font",set:function(e){if(e.files&&e.files[0]){var t=this;PZ.fonts.load(e.files[0],function(e,r){PZ.fonts.unload(t.normalProps.font),t.normalProps.font=e,t.updateProps()})}}},size:{title:"Size",subtitle1:"height",subtitle2:"thickness",get:function(){return this.normalProps.size},set:function(e,t){switch(t){case 0:this.normalProps.size.x=e;break;case 1:this.normalProps.size.y=e}this.updateProps()},vmax:200,vmin:1,vstep:1},detail:{title:"Detail",get:function(){return this.normalProps.detail},set:function(e){this.normalProps.detail=e,this.updateProps()},vmax:200,vmin:1,vstep:1},bevel:{title:"Bevel",items:"off;on",get:function(){return Number(this.normalProps.bevel)},set:function(e){1===e?this.normalProps.bevel=!0:this.normalProps.bevel=!1,this.updateProps()}},bevelsize:{title:"Bevel size",subtitle1:"size",subtitle2:"thickness",get:function(){return this.normalProps.bevelsize},set:function(e,t){switch(t){case 0:this.normalProps.bevelsize.x=e;break;case 1:this.normalProps.bevelsize.y=e}this.updateProps()},vmax:200,vmin:.1,vstep:.1,decimals:1},center:{title:"Center point",items:"center;left;right;top;bottom;front;back",get:function(){return Number(this.normalProps.positionMode);
},set:function(e){this.normalProps.positionMode=e,this.updateProps()}},position:{title:"Position",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.position)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.position)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},rotation:{title:"Rotation",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericRotation3Get(e,this.keyframeProps.rotation)},set:function(e,t){return PZ.keyframes.genericRotation3Set(e,t,this.keyframeProps.rotation)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},scale:{title:"Scale",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.scale)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.scale)},vmax:1e3,vmin:.001,vstep:.1,dragstep:.001,decimals:3},appearance:{title:"Appearance",get:function(){return CM.appearance.getIndex(this.appearanceObj)},items:CM.appearance.string,set:function(e){CM.appearance.objects[this.appearanceObj].unload(this.threeObj),CM.appearance.unload(this.appearanceObj),this.appearanceObj=CM.appearance.list[e].file,this.appearancePlaceholder.empty(),CM.appearance.load(this.appearanceObj),CM.appearance.objects[this.appearanceObj].load(this.threeObj,void 0,!0),CM.appearance.objects[this.appearanceObj].select(this.threeObj,this.appearancePlaceholder),this.keyObject=$.extend({},this.keyframeProps,this.threeObj.material.keyframeProps),CM.timeline.keyObject=this.keyObject,CM.timeline.update(),this.appearancePlaceholder.parent().scrollTop(this.appearancePlaceholder.parent().height())}}},CM.objects.text3d.prototype.updateProps=function(){this.threeObj.geometry.dispose(),this.threeObj.geometry=new THREE.TextGeometry(this.normalProps.text,{size:this.normalProps.size.x,height:this.normalProps.size.y,curveSegments:this.normalProps.detail,font:PZ.fonts.get(this.normalProps.font).parsed,bevelEnabled:this.normalProps.bevel,bevelThickness:this.normalProps.bevelsize.x,bevelSize:this.normalProps.bevelsize.y,material:0,extrudeMaterial:1}),this.threeObj.geometry.buffersNeedUpdate=!0,this.center()},CM.objects.text3d.prototype.load=function(e){if("undefined"!=typeof e){var t=PZ.archive.getFileString(e);if("undefined"!=typeof t){var r=JSON.parse(t);this.appearanceObj=r.appearanceObj,PZ.extend(this.normalProps,r.normalProps),$.extend(this.keyframeProps,r.keyframeProps),PZ.keyframes.toVector3(this.keyframeProps.position),PZ.keyframes.toVector3(this.keyframeProps.rotation),PZ.keyframes.toVector3(this.keyframeProps.scale,!0)}}var a=this;PZ.fonts.load(a.normalProps.font,a.updateProps.bind(this)),a.$listitem.children("span").text("Text: "+a.normalProps.text),a.threeObj=new THREE.Mesh(new THREE.Geometry,null),CM.appearance.load(a.appearanceObj),"string"==typeof e?e+="_appearance":"object"==typeof e&&(e=e.threeObj),CM.appearance.objects[a.appearanceObj].load(a.threeObj,e,!0),a.keyObject=$.extend({},a.keyframeProps,a.threeObj.material.keyframeProps),a.center(),a.threeObj.castShadow=!0,a.threeObj.receiveShadow=!0,a.regroup()},CM.objects.text3d.prototype.clone=function(){var e=new this.constructor;return PZ.extend(e.normalProps,this.normalProps),e.keyframeProps=PZ.keyframes.cloneProps(this.keyframeProps),e.appearanceObj=this.appearanceObj,e},CM.objects.text3d.prototype.save=function(e){var t=this;CM.appearance.objects[t.appearanceObj].save(t.threeObj,e+"_appearance");var r={normalProps:t.normalProps,appearanceObj:t.appearanceObj,keyframeProps:t.keyframeProps};PZ.archive.addFileString(e,JSON.stringify(r)),CM.templates.saveWaiting++,PZ.fonts.save(this.normalProps.font,function(){CM.templates.saveWaiting--,CM.templates.saveComplete()})},CM.objects.text3d.prototype.unload=function(){this.threeObj&&(CM.appearance.objects[this.appearanceObj].unload(this.threeObj),CM.appearance.unload(this.appearanceObj),PZ.fonts.unload(this.normalProps.font),this.regroup(!0))},CM.objects.text3d.prototype.regroup=function(e){this.threeObj&&(this.threeObj.parent&&this.threeObj.parent.remove(this.threeObj),e||(this.$listitem.parent().data("group").add(this.threeObj),this.threeObj.layers.mask=this.threeObj.parent.layers.mask))},CM.objects.text3d.prototype.updateFrame=function(e){this.threeObj&&(this.threeObj.position.copy(TWEEN.getValue(this.keyframeProps.position,CM.currentFrame)),this.threeObj.rotation.setFromVector3(TWEEN.getValue(this.keyframeProps.rotation,CM.currentFrame)),this.threeObj.scale.copy(TWEEN.getValue(this.keyframeProps.scale,CM.currentFrame)),CM.appearance.objects[this.appearanceObj].update(this.threeObj,e))},CM.objects.text3d.prototype.center=function(){this.threeObj.geometry.computeBoundingBox();var e=this.threeObj.geometry.boundingBox,t=new THREE.Vector3;switch(t.addVectors(e.min,e.max),t.multiplyScalar(-.5),this.normalProps.positionMode){case 1:t.x-=t.x;break;case 2:t.x+=t.x;break;case 3:t.y+=t.y;break;case 4:t.y-=t.y;break;case 5:t.z+=t.z;break;case 6:t.z-=t.z}this.threeObj.geometry.applyMatrix((new THREE.Matrix4).makeTranslation(t.x,t.y,t.z)),this.threeObj.geometry.computeBoundingBox()},CM.objects.text3d.prototype.select=function(e){var t=this;PZ.editor.generateTitle({title:"3D Text"}).appendTo(e),PZ.editor.generateTextInput(t.props.text,t).appendTo(e),t.$customfont=PZ.editor.generateFileUpload(t.props.fupload,t).hide(),PZ.editor.generateDropdown(t.props.font,t).appendTo(e),t.$customfont.appendTo(e),PZ.editor.generateDualInput(t.props.size,t).appendTo(e),PZ.editor.generateInput(t.props.detail,t).appendTo(e),PZ.editor.generateDropdown(t.props.bevel,t).appendTo(e),PZ.editor.generateDualInput(t.props.bevelsize,t).appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateDropdown(t.props.center,t).appendTo(e),PZ.editor.generateTriInput(t.props.position,t).appendTo(e),PZ.editor.generateTriInput(t.props.rotation,t).appendTo(e),PZ.editor.generateTriInput(t.props.scale,t).appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateDropdown(t.props.appearance,t).appendTo(e),t.appearancePlaceholder=PZ.editor.generatePlaceholder().appendTo(e),CM.appearance.objects[t.appearanceObj].select(t.threeObj,t.appearancePlaceholder)},PZ.fonts.parse=function(e,t){var r=new FileReader;r.onload=function(a){try{var n=new THREE.TTFLoader,i=n.parse(a.target.result);e.parsed=new THREE.Font(i),e.name=i.familyName.toLowerCase()}catch(a){return r.onload=function(r){var a=r.target.result;try{var n=JSON.parse(a);e.parsed=new THREE.Font(n),e.name=n.familyName.toLowerCase()}catch(e){return void console.log("unsupported font")}t()},void r.readAsText(e.file)}t()},r.readAsArrayBuffer(e.file)},CM.objects.group=function(){this.threeObj=new THREE.Object3D,this.keyframeProps={enabled:[{frame:1,value:1,tweenfn:0}],position:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],rotation:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],scale:[{frame:1,value:new THREE.Vector3(1,1,1),tweenfn:257}]},this.keyObject=null,this.normalProps={name:"New Group",reflectionVisibility:0},this.objects=[],this.listObject=$("<ul>"),this.listObject.data("objects",this.objects),this.listObject.data("group",this.threeObj)},CM.objects.group.prototype.props={name:{get:function(){return this.normalProps.name},set:function(e){this.normalProps.name=e,this.$listitem.children("span").text("Group: "+e.substring(0,25))}},enabled:{title:"Enabled",keyframed:!0,tweens:!1,get:function(e){return PZ.keyframes.genericValueGet(e,this.keyframeProps.enabled)},set:function(e,t){return PZ.keyframes.genericValueSet(e,t,this.keyframeProps.enabled)},items:"off;on"},reflectionVisibility:{title:"Visibility",get:function(){return this.normalProps.reflectionVisibility},set:function(e){this.normalProps.reflectionVisibility=e,this.threeObj.traverse(function(t){0===e?t.layers.set(0):1===e?t.layers.set(10):(t.layers.set(0),t.layers.enable(10))})},items:"normal;reflections only;scene + reflections"},position:{title:"Position",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.position)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.position)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},rotation:{title:"Rotation",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericRotation3Get(e,this.keyframeProps.rotation)},set:function(e,t){return PZ.keyframes.genericRotation3Set(e,t,this.keyframeProps.rotation)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},scale:{title:"Scale",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.scale)},set:function(e,t){return PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.scale)},vmax:1e3,vmin:.001,vstep:.1,dragstep:.001,decimals:3}},CM.objects.group.prototype.clone=function(){var e=new this.constructor;PZ.extend(e.normalProps,this.normalProps),e.keyframeProps=PZ.keyframes.cloneProps(this.keyframeProps);for(var t=0;t<this.objects.length;t++)CM.objects.addObject.call(e,this.objects[t]);return e},CM.objects.group.prototype.load=function(e){if("undefined"!=typeof e){var t=PZ.archive.getFileString(e);if("undefined"!=typeof t){var r=JSON.parse(t);$.extend(this.normalProps,r.normalProps),$.extend(this.keyframeProps,r.keyframeProps),PZ.keyframes.toVector3(this.keyframeProps.position),PZ.keyframes.toVector3(this.keyframeProps.rotation),PZ.keyframes.toVector3(this.keyframeProps.scale,!0);for(var a=0;a<r.objects.length;a++)CM.objects.addObject.call(this,r.objects[a],e+"_"+a)}}this.keyObject=this.keyframeProps,this.regroup(),this.listObject.insertAfter(this.$listitem),this.$listitem.children("span").text("Group: "+this.normalProps.name);var n=this.listObject;this.$listitem.children("span").before($("<a>").append(PZ.editor.generateIcon("arrow").attr("style","fill:#ccc;width:15px;height:15px;pointer-events:none")).attr("style","width:15px;height:15px;float:left;margin-left:2px;margin-right:7px;visibility:visible").click(function(e){$(this).toggleClass("rotated"),n.toggle(),e.stopPropagation()}))},CM.objects.group.prototype.save=function(e){for(var t=this,r={normalProps:t.normalProps,keyframeProps:t.keyframeProps,objects:[]},a=0;a<this.objects.length;a++)this.objects[a]instanceof CM.objects.shape?r.objects.push(0):this.objects[a]instanceof CM.objects.text3d?r.objects.push(1):this.objects[a]instanceof CM.objects.model?r.objects.push(2):this.objects[a]instanceof CM.objects.light?r.objects.push(3):this.objects[a]instanceof CM.objects.particles?r.objects.push(4):this.objects[a]instanceof CM.objects.group&&r.objects.push(5),this.objects[a].save(e+"_"+a);PZ.archive.addFileString(e,JSON.stringify(r))},CM.objects.group.prototype.unload=function(){this.listObject.remove();for(var e=0;e<this.objects.length;e++)this.objects[e].unload();this.regroup(!0)},CM.objects.group.prototype.regroup=function(e){if(this.threeObj&&(this.threeObj.parent&&this.threeObj.parent.remove(this.threeObj),!e)){this.$listitem.parent().data("group").add(this.threeObj),this.threeObj.layers.mask=this.threeObj.parent.layers.mask,1===this.normalProps.reflectionVisibility?this.threeObj.layers.set(10):2===this.normalProps.reflectionVisibility&&(this.threeObj.layers.set(0),this.threeObj.layers.enable(10));var t=this.threeObj.layers.mask;this.threeObj.traverse(function(e){e.layers.mask=t})}},CM.objects.group.prototype.updateFrame=function(){this.threeObj&&(this.threeObj.visible=1===TWEEN.getValue(this.keyframeProps.enabled,CM.currentFrame),this.threeObj.position.copy(TWEEN.getValue(this.keyframeProps.position,CM.currentFrame)),this.threeObj.rotation.setFromVector3(TWEEN.getValue(this.keyframeProps.rotation,CM.currentFrame)),this.threeObj.scale.copy(TWEEN.getValue(this.keyframeProps.scale,CM.currentFrame)));for(var e=0;e<this.objects.length;e++)this.objects[e].updateFrame()},CM.objects.group.prototype.select=function(e){var t=this;t.insertlocation=e,PZ.editor.generateTitle({title:"Group"}).appendTo(e),PZ.editor.generateTextInput(t.props.name,t).appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateDropdown(t.props.enabled,t).appendTo(e),PZ.editor.generateDropdown(t.props.reflectionVisibility,t).appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateTriInput(t.props.position,t).appendTo(e),PZ.editor.generateTriInput(t.props.rotation,t).appendTo(e),PZ.editor.generateTriInput(t.props.scale,t).appendTo(e)},CM.fx={objects:[],selected:null,listObject:null,selectLocation:null,drag:{},list:[{name:"COLOR",category:!0},{name:"Negative",desc:"Inverts colors.",src:"negative"},{name:"Grayscale",desc:"Desaturates colors.",src:"grayscale"},{name:"Color Correction",desc:"Add, multiply, and exponentiate colors to adjust appearance.",src:"colorcorrection"},{name:"Colorize",desc:"Changes the hue of the image.",src:"colorize"},{name:"Posterize",desc:"Reduces the number of colors.",src:"posterize"},{name:"ENHANCE",category:!0},{name:"Antialiasing",desc:"Softens jagged, sharp edges.",src:"fxaa"},{name:"Bloom",desc:"Adds a glowing effect to bright areas.",src:"bloom"},{name:"Anamorphic Lens Flare",desc:"Creates horizontal flares from bright areas.",src:"anamorphicflare"},{name:"DISTORT",category:!0},{name:"RGB Shift",desc:"Shifts color channels apart.",src:"rgbshift"},{name:"Fisheye",desc:"Simulates a fisheye lens.",src:"fisheye"},{name:"Radial Blur",desc:"Blurs radially from a specified point.",src:"radialblur"},{name:"Pulse",desc:"Distorts radially outward in a ripple pattern.",src:"pulse"},{name:"Wavy",desc:"Distorts vertically in a wavy pattern.",src:"wavy"},{name:"Pixelated",desc:"Reduces image resolution with large pixels.",src:"pixelated"},{name:"Swirl",desc:"Distorts in a spiral pattern.",src:"swirl"},{name:"Box Blur",desc:"Blurs the image using a fast blur technique.",src:"boxblur"},{name:"Static",desc:"Creates grainy, noisy distortion.",src:"static"},{name:"Glitch",desc:"Simulates glitches by displacing potions of the image.",src:"glitch"},{name:"FRAMING",category:!0},{name:"Shutter",desc:"Simulates a camera shutter for cover and fade effects.",src:"shutter"},{name:"Duplicate",desc:"Creates a grid of image copies.",src:"duplicate"},{name:"Mirror",desc:"Uses reflection to create a symmetrical image.",src:"mirror"},{name:"Overlay",desc:"Adds a full screen image overlay.",src:"overlay"}]},CM.fx.createUI=function(){this.listObject=PZ.editor.generateList({}),this.listObject.css("height",.25*$("#panecontainer").height())},CM.fx.load=function(){var e=PZ.archive.getFileString("fx");if("undefined"!=typeof e){var t=JSON.parse(e);this.deleteAll();for(var r=0;r<t.length;r++)this.addObject(t[r],"fx"+r)}},CM.fx.save=function(){for(var e=[],t=0;t<this.objects.length;t++)e.push(this.objects[t].src),this.objects[t].save("fx"+t);PZ.archive.addFileString("fx",JSON.stringify(e))},CM.fx.select=function(e){e.css({height:"100%",width:"100%"}),PZ.editor.generateDropdownAdd({title:"Add Effect",items:this.list,addfn:function(e){this.addObject(this.list[e].src)}},this).appendTo(e),this.listObject.appendTo(e),this.$resizehandle=$("<div>",{style:"width:100%;height:5px;position:absolute;cursor:ns-resize;"}).drag("start",function(e,t){t.startHeight=CM.fx.listObject.height(),t.top=CM.fx.listObject.position().top}).drag(function(e,t){var r=Math.max(Math.min(t.startHeight+t.deltaY,550),100);CM.fx.listObject.css("height",r),$(this).css("top",t.top+r),CM.fx.selectLocation.css("top",t.top+r+6)}).css("top",this.listObject.position().top+this.listObject.height()).appendTo(e),this.selectLocation=PZ.editor.generatePlaceholder().attr("style","overflow-y:auto;position:absolute;bottom:0;left:0;right:0;").css("top",this.listObject.position().top+this.listObject.height()+6).appendTo(e)},CM.fx.getName=function(e){for(var t=0;t<this.list.length;t++)if(this.list[t].src===e)return this.list[t].name},CM.fx.add=function(e,t,r){var a=PZ.editor.generateListItem({selectfn:CM.fx.itemSelect,deletefn:CM.fx.itemDelete,clonefn:CM.fx.itemClone}).drag("start",CM.fx.itemDragStart).drag(CM.fx.itemDrag,{click:!0,distance:2}).drag("end",CM.fx.itemDragEnd);a.children("span").text(this.getName(t)),e.src=t,e.load(r),e.resize(CM.renderCanv.width,CM.renderCanv.height),this.objects.push(e),a.appendTo(this.listObject)},CM.fx.addObject=function(e,t){"string"==typeof e?$.ajax({url:"/js/modules/fx/"+e+".js?v=2.0.157",dataType:"text",cache:!0,async:"undefined"==typeof t,success:function(r){var a=new Function(r);CM.fx.add(new a,e,t)}}):CM.fx.add(e.clone(),e.src,e)},CM.fx.selectObject=function(e){this.selected!==e&&(this.selected=e,this.selectLocation.empty(),CM.timeline.keyObject=null,null!==e&&(e.select(this.selectLocation),CM.timeline.keyObject=e.keyframeProps),CM.timeline.update())},CM.fx.deleteObject=function(e){this.selected===e&&this.selectObject(null),e.unload()},CM.fx.deleteAll=function(){null!==this.selected&&this.selectObject(null),this.listObject.children().remove();for(var e=0;e<this.objects.length;e++)this.objects[e].unload();this.objects=[]},CM.fx.cloneObject=function(e){this.addObject(e)},CM.fx.itemSelect=function(){var e=$(this);e.hasClass("pz-listitem-selected")?(e.removeClass("pz-listitem-selected"),CM.fx.selectObject(null)):(CM.fx.listObject.find(".pz-listitem-selected").removeClass("pz-listitem-selected"),e.addClass("pz-listitem-selected"),CM.fx.selectObject(CM.fx.objects[e.prevAll("li").length]))},CM.fx.itemDelete=function(e){var t=$(this).parent();CM.fx.deleteObject(CM.fx.objects.splice(t.prevAll("li").length,1)[0]),t.remove(),e.stopPropagation()},CM.fx.itemClone=function(e){var t=$(this).parent();CM.fx.cloneObject(CM.fx.objects[t.prevAll("li").length]),e.stopPropagation()},CM.fx.itemDragStart=function(e,t){CM.fx.drag.height=CM.fx.listObject.find("li").first().outerHeight(),CM.fx.drag.drag=t.drag,CM.fx.drag.timer=setInterval(CM.fx.itemDropCheck,20)},CM.fx.itemDrag=function(e,t){CM.fx.drag.pageY=e.pageY},CM.fx.itemDropCheck=function(){var e,t=CM.fx.listObject.find("li"),r=CM.fx.drag.pageY,a=CM.fx.drag.height;return t.attr("style",""),t.each(function(t,n){if(n!==CM.fx.drag.drag){var i=$(n),s=i.offset();if(r>=s.top&&r<s.top+a){if(r<s.top+.5*a&&i.prev()[0]!==CM.fx.drag.drag)i.attr("style","border-top: 1px dashed #aaa");else{if(!(r>.5*a+s.top&&i.next()[0]!==CM.fx.drag.drag))return!0;i.attr("style","border-bottom: 1px dashed #aaa")}return e=i,!1}}}),e},CM.fx.itemDragEnd=function(e,t){CM.fx.drag.timer=clearInterval(CM.fx.drag.timer);var r=CM.fx.itemDropCheck();if("undefined"!=typeof r){var a=r.attr("style");r.attr("style","");var n=$(t.drag);if(r[0]!==n[0]){var i=n.prevAll("li").length,s=CM.fx.objects.splice(i,1)[0];n.detach();var o=r.prevAll("li").length;a.startsWith("border-top")?(CM.fx.objects.splice(o,0,s),n.insertBefore(r)):a.startsWith("border-bottom")&&(CM.fx.objects.splice(o+1,0,s),n.insertAfter(r))}}},CM.camsequence={projectionMode:0,movementMode:0,rotationMode:0,shakeMode:0,defaultShakeSettings:{x:{amplitude:12,scale:.6,phase:0,noise:.9,smooth:!0},y:{amplitude:12,scale:.8,phase:11,noise:.9,smooth:!0},z:{amplitude:40,scale:.7,phase:20,noise:.9,smooth:!0},tilt:{amplitude:20,scale:.9,phase:31,noise:.55,smooth:!0}},shakeSettings:null,keyframeProps:{position:[{frame:1,value:new THREE.Vector3(0,0,80),tweenfn:257}],rotation:[{frame:1,value:new THREE.Vector3(0,0,0),tweenfn:257}],shake:[{frame:1,value:0,tweenfn:0}],shakespeed:[{frame:1,value:30,tweenfn:0}]}},CM.camsequence.shakeSettings=$.extend({},CM.camsequence.defaultShakeSettings),CM.camsequence.load=function(){var e=PZ.archive.getFileString("camsequence");if("undefined"!=typeof e){var t=JSON.parse(e);this.movementMode=t.movementMode,this.rotationMode=t.rotationMode,this.projectionMode=t.projectionMode||0,this.shakeMode=t.shakeMode||0,$.extend(this.keyframeProps,t.keyframeProps),$.extend(this.shakeSettings,this.defaultShakeSettings),$.extend(this.shakeSettings,t.shakeSettings),PZ.keyframes.toVector3(this.keyframeProps.position),PZ.keyframes.toVector3(this.keyframeProps.rotation),this.updateCamera()}},CM.camsequence.save=function(){var e={movementMode:this.movementMode,rotationMode:this.rotationMode,projectionMode:this.projectionMode,shakeMode:this.shakeMode,shakeSettings:this.shakeSettings,keyframeProps:this.keyframeProps};PZ.archive.addFileString("camsequence",JSON.stringify(e))},CM.camsequence.select=function(e){PZ.editor.generateTitle({title:"Camera animation"}).appendTo(e),PZ.editor.generateDropdown({title:"Projection mode",items:"perspective (3d);orthographic (2d)",get:function(){return this.projectionMode},set:function(e){this.projectionMode=e,this.updateCamera()}},this).appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateButton({title:"Use current",clickfn:function(){var t;t=PZ.keyframes.get(this.keyframeProps.position),"undefined"==typeof t&&(PZ.keyframes.add(this.keyframeProps.position),t=PZ.keyframes.get(this.keyframeProps.position)),t.value.copy(CM.camera.position),t=PZ.keyframes.get(this.keyframeProps.rotation),"undefined"==typeof t&&(PZ.keyframes.add(this.keyframeProps.rotation),t=PZ.keyframes.get(this.keyframeProps.rotation)),t.value.copy(CM.camera.rotation),e.children().each(function(){$(this).triggerHandler("update")})}},this).appendTo(e),PZ.editor.generateTriInput({title:"Position",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericVector3Get(e,this.keyframeProps.position)},set:function(e,t){PZ.keyframes.genericVector3Set(e,t,this.keyframeProps.position)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},this).appendTo(e),PZ.editor.generateTriInput({title:"Rotation",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericRotation3Get(e,this.keyframeProps.rotation)},set:function(e,t){PZ.keyframes.genericRotation3Set(e,t,this.keyframeProps.rotation)},vmax:1e4,vmin:-1e4,vstep:1,dragstep:.1,decimals:2},this).appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateInput({title:"Shake",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericValueGet(e,this.keyframeProps.shake)},set:function(e,t){return PZ.keyframes.genericValueSet(e,t,this.keyframeProps.shake)},vmax:1,vmin:0,vstep:.01,decimals:3,dragstep:1e-4},this).appendTo(e),PZ.editor.generateInput({title:"Shake speed",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericValueGet(e,this.keyframeProps.shakespeed)},set:function(e,t){return PZ.keyframes.genericValueSet(e,t,this.keyframeProps.shakespeed)},vmax:200,vmin:0,vstep:.01,decimals:2,dragstep:.05},this).appendTo(e),PZ.editor.generateSpacer().appendTo(e);var t=PZ.editor.generatePlaceholder().hide();PZ.editor.generateDropdown({title:"Advanced shake settings",items:"hide;show",get:function(){return 0},set:function(e){1===e?t.attr("style",""):t.hide()}},this).appendTo(e),PZ.editor.generateSpacer().appendTo(t),PZ.editor.generateDropdown({title:"Shake mode x/y",items:"rotate;move",get:function(){return this.shakeMode},set:function(e){this.shakeMode=e}},this).appendTo(t);for(var r in this.shakeSettings)PZ.editor.generateSpacer().appendTo(t),PZ.editor.generateInput({title:r.charAt(0).toUpperCase()+r.slice(1)+" amplitude",get:function(){return this.amplitude},set:function(e){this.amplitude=e},vmax:1e4,vmin:0,vstep:1,decimals:1,dragstep:.05},this.shakeSettings[r]).appendTo(t),PZ.editor.generateInput({title:r.charAt(0).toUpperCase()+r.slice(1)+" frequency",get:function(){return this.scale},set:function(e){this.scale=e},vmax:1e4,vmin:0,vstep:.1,decimals:2,dragstep:.005},this.shakeSettings[r]).appendTo(t),PZ.editor.generateInput({title:r.charAt(0).toUpperCase()+r.slice(1)+" phase",get:function(){return this.phase},set:function(e){this.phase=e},vmax:1e4,vmin:0,vstep:1,decimals:1,dragstep:.05},this.shakeSettings[r]).appendTo(t),PZ.editor.generateInput({title:r.charAt(0).toUpperCase()+r.slice(1)+" noise",get:function(){return this.noise},set:function(e){this.noise=e},vmax:4,vmin:0,vstep:.1,decimals:2,dragstep:.01},this.shakeSettings[r]).appendTo(t),PZ.editor.generateDropdown({title:r.charAt(0).toUpperCase()+r.slice(1)+" interpolation",items:"linear;smooth",get:function(){return this.smooth?1:0},set:function(e){this.smooth=1===e}},this.shakeSettings[r]).appendTo(t);t.appendTo(e)},CM.camsequence.updateCamera=function(){CM.renderCamera.parent.remove(CM.renderCamera),CM.camsequence.helper.parent.remove(CM.camsequence.helper),0===this.projectionMode?CM.renderCamera=new THREE.PerspectiveCamera(60,CM.aspect,.1,5e3):CM.renderCamera=new THREE.OrthographicCamera(CM.frameWidth*-.05,.05*CM.frameWidth,.05*CM.frameHeight,CM.frameHeight*-.05,.1,5e3),CM.scene.add(CM.renderCamera),CM.camsequence.helper=new THREE.CameraHelper(CM.renderCamera),CM.camsequence.helper.layers.set(3),CM.scene.add(CM.camsequence.helper),CM.composer.renderPass.camera=CM.renderCamera},CM.camsequence.shake=function(e,t,r){function a(e){return 2*(1&e)-1}function n(e){var t=1e4*Math.sin(e);return t-Math.floor(t)-.5}function i(e,t,r){return e*(1-r)+t*r}var s=CM.currentFrame*t*r.scale+r.phase,o=Math.floor(s),l=o+1,p=s-o;r.smooth&&(p=p*p*(3-2*p));var c=a(o)+r.noise*n(o),u=a(l)+r.noise*n(l);return e*r.amplitude*i(c,u,p)},CM.camsequence.updateFrame=function(){CM.renderCamera.position.copy(TWEEN.getValue(this.keyframeProps.position,CM.currentFrame)),CM.renderCamera.rotation.setFromVector3(TWEEN.getValue(this.keyframeProps.rotation,CM.currentFrame));var e=TWEEN.getValue(this.keyframeProps.shake,CM.currentFrame),t=TWEEN.getValue(this.keyframeProps.shakespeed,CM.currentFrame)/CM.frameRate;0===this.shakeMode?(CM.renderCamera.rotateX(.1*this.shake(e,t,this.shakeSettings.x)),CM.renderCamera.rotateY(.1*this.shake(e,t,this.shakeSettings.y))):(CM.renderCamera.translateX(this.shake(e,t,this.shakeSettings.x)),CM.renderCamera.translateY(this.shake(e,t,this.shakeSettings.y))),CM.renderCamera.translateZ(this.shake(e,t,this.shakeSettings.z)),CM.renderCamera.rotateZ(.1*this.shake(e,t,this.shakeSettings.tilt))},CM.audio={enablePreview:!0,ctx:null,elt:null,buffer:null,source:null,startOffset:0,volumeMode:0,fadeIn:0,fadeOut:3,keyframeProps:{volume:[{frame:1,value:100,tweenfn:1}],pan:[{frame:1,value:0,tweenfn:1}]}},CM.audio.init=function(){window.AudioContext&&(this.ctx=new AudioContext,this.gainNode=this.ctx.createGain(),this.pannerNode=this.ctx.createStereoPanner(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(this.ctx.destination))},CM.audio.updateFrame=function(){this.gainNode.gain.value=CM.audio.getVolume(CM.currentFrame),this.pannerNode.pan.value=TWEEN.getValue(this.keyframeProps.pan,CM.currentFrame)},CM.audio.getVolume=function(e){if(0===this.volumeMode){var t=e/CM.frameRate,r=this.fadeIn>0?t/this.fadeIn:1,a=this.fadeOut>0?(CM.totalTime-t)/this.fadeOut:1;return Math.min(1,r)*Math.min(1,a)}return TWEEN.getValue(this.keyframeProps.volume,e)/100},CM.audio.play=function(){null!==this.buffer&&this.enablePreview!==!1&&(this.source=this.ctx.createBufferSource(),this.source.buffer=this.buffer,this.source.playbackRate.value=CM.playSpeed,this.source.connect(this.gainNode),this.source.start(0,this.startOffset+(CM.currentFrame-1)/CM.frameRate))},CM.audio.stop=function(){null!==this.source&&(this.source.stop(),this.source=null)},CM.audio.toggleMute=function(){this.enablePreview=!this.enablePreview,CM.enablePlayFrames===!0&&this.play(),this.enablePreview===!1&&this.stop()},CM.audio.setPlaybackRate=function(){null!==CM.audio.source&&(CM.audio.source.playbackRate.value=CM.playSpeed,CM.audio.updateFade())},CM.audio.decodeAudio=function(e){var t=new FileReader;t.onload=function(r){CM.audio.ctx.decodeAudioData(r.target.result,function(e){CM.audio.buffer=e,CM.timeline.redraw(),CM.enablePlayFrames&&CM.audio.play()},function(r){t.onload=function(e){PZ.av.decode(e.target.result,function(e,t){if(e&&t){var r=new Float32Array(e),a=new Float32Array(t);CM.audio.buffer=CM.audio.ctx.createBuffer(2,r.length,48e3),CM.audio.buffer.copyToChannel(r,0),CM.audio.buffer.copyToChannel(a,1),CM.timeline.redraw(),CM.enablePlayFrames&&CM.audio.play()}})},t.readAsArrayBuffer(e)})},t.readAsArrayBuffer(e)},CM.audio.load=function(){CM.audio.buffer=null;var e=PZ.archive.getFileStringUTF8("audio");if("undefined"!=typeof e){var t=JSON.parse(e);delete this.trackName,$.extend(this.keyframeProps,t.properties.keyframeProps),delete t.properties.keyframeProps,$.extend(this,t.properties),e=PZ.archive.getFileBlob("audio_file",{type:"audio/*"}),"undefined"==typeof e&&(e=PZ.archive.getFileBlob("audio_mp3",{type:"audio/*"})),"undefined"!=typeof e&&this.decodeAudio(e)}},CM.audio.save=function(){var e={properties:{fadeIn:this.fadeIn,fadeOut:this.fadeOut,startOffset:0,volumeMode:this.volumeMode,keyframeProps:this.keyframeProps}};if(PZ.archive.addFileString("audio",JSON.stringify(e)),null!==this.buffer){CM.templates.saveWaiting++;var t={filename:"ogg",haveVideo:0,haveAudio:1,frameWidth:0,frameHeight:0,audioBitrate:64e3,frameRate:CM.frameRate/CM.download.multiplyRate,totalFrames:CM.totalFrames/CM.download.multiplyRate,startFrame:1},r=function(e,t){t(0)};PZ.av.encode(t,r,CM.download.getAudioSamples.bind(CM.download,!1),this.encodeFinished)}},CM.audio.encodeFinished=function(e){if(e){var t=new Uint8Array(e);PZ.archive.addFile("audio_file",t)}CM.templates.saveWaiting--,CM.templates.saveComplete()},CM.audio.generateWaveform=function(e,t,r){if(null!==this.buffer){var a=document.createElement("canvas");a.width=e,a.height=t;var n=a.getContext("2d"),i=CM.totalFrames/CM.frameRate,s=Math.floor(i*this.buffer.sampleRate),o=Math.min(Math.floor(this.startOffset*this.buffer.sampleRate),this.buffer.length),l=Math.min(o+Math.floor(i*this.buffer.sampleRate),this.buffer.length)-o,p=new ArrayBuffer(4*l),c=new Float32Array(p);l>0&&this.buffer.copyFromChannel(c,0,o);n.fillStyle="rgb(102, 102, 102)",n.fillRect(0,0,e,t),n.strokeStyle="rgb(20, 20, 20)",n.translate(0,t/2);for(var u=0;u<c.length;u+=24){var d=Math.floor(e*u/s),h=c[u]*t/2;n.beginPath(),n.moveTo(d,0),n.lineTo(d+1,h),n.stroke()}PZ.canvasToBlob(a,function(e){r(URL.createObjectURL(e))})}},CM.audio.select=function(e){var t;PZ.editor.generateTitle({title:"Audio track"}).appendTo(e),PZ.editor.generateFileUpload({title:"Audio file",accept:"audio/*",set:function(e){e.files&&e.files[0]&&(t&&(t.remove(),t=null),this.decodeAudio(e.files[0]))},remove:function(){this.audiofile=null,t&&(t.remove(),t=null)}},this).appendTo(e),"undefined"!=typeof this.trackName&&(t=PZ.editor.generateDescription({content:'<a target="_blank" href="'+this.trackURL+'">'+this.trackName+"</a> by "+this.artistName}).css({backgroundColor:"rgb(45, 45, 45)",flexDirection:"row-reverse"}).appendTo(e)),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateInput({title:"Start offset (seconds)",get:function(){return this.startOffset},set:function(e){this.startOffset=e,CM.timeline.scheduleRedraw()},vmax:1e3,vmin:0,vstep:1,decimals:2,dragstep:.01},this).appendTo(e),PZ.editor.generateSpacer().appendTo(e),this.$fadeIn=PZ.editor.generateInput({title:"Fade in (seconds)",get:function(){return this.fadeIn},set:function(e){this.fadeIn=e},vmax:1e3,vmin:0,vstep:1,decimals:2,dragstep:.01},this).hide(),this.$fadeOut=PZ.editor.generateInput({title:"Fade out (seconds)",get:function(){return this.fadeOut},set:function(e){this.fadeOut=e},vmax:1e3,vmin:0,vstep:1,decimals:2,dragstep:.01},this).hide(),this.$customVolume=PZ.editor.generateInput({title:"Volume",keyframed:!0,tweens:!0,get:function(e){return PZ.keyframes.genericValueGet(e,this.keyframeProps.volume)},set:function(e,t){return PZ.keyframes.genericValueSet(e,t,this.keyframeProps.volume)},vmax:5e3,vmin:0,vstep:1},this).hide(),PZ.editor.generateDropdown({title:"Volume mode",items:"fade in/out;custom",get:function(){return this.volumeMode>0?(this.$fadeIn.hide(),this.$fadeOut.hide(),this.$customVolume.attr("style","")):(this.$fadeIn.attr("style",""),this.$fadeOut.attr("style",""),this.$customVolume.hide()),this.volumeMode},set:function(e){this.volumeMode=e,e>0?(this.$fadeIn.hide(),this.$fadeOut.hide(),this.$customVolume.attr("style","")):(this.$fadeIn.attr("style",""),this.$fadeOut.attr("style",""),this.$customVolume.hide())}},this).appendTo(e),this.$fadeIn.appendTo(e),this.$fadeOut.appendTo(e),this.$customVolume.appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateInput({title:"Pan",keyframed:!0,
tweens:!0,get:function(e){return PZ.keyframes.genericValueGet(e,this.keyframeProps.pan)},set:function(e,t){return PZ.keyframes.genericValueSet(e,t,this.keyframeProps.pan)},vmax:1,vmin:-1,decimals:2,vstep:.1,dragstep:.01},this).appendTo(e)},CM.download={mode:{bitrate:1,crf:10,speed:4,deadline:1,lag:0,abr:1},profile:1,profiles:[{bitrate:1,crf:12,speed:8,deadline:2,lag:0,abr:1},{bitrate:1,crf:10,speed:4,deadline:1,lag:0,abr:1},{bitrate:1,crf:8,speed:1,deadline:1,lag:0,abr:1},{bitrate:1,crf:4,speed:0,deadline:0,lag:0,abr:1.5}],format:0,multiplyRate:1,waitingPrepare:0,currentAudioSample:0,endAudioSample:0,$description:null,$progress:null,$start:null,$rendering:null,$finish:null},CM.download.select=function(e){PZ.editor.generateTitle({title:"Download your video"}).appendTo(e),this.$start=PZ.editor.generatePlaceholder().appendTo(e),PZ.editor.generateDropdown({title:"Mode",items:"fastest render;balanced;good quality;extreme quality (slow)",get:function(){return this.profile},set:function(e){this.profile=e,this.mode=this.profiles[this.profile]}},this).appendTo(this.$start),PZ.editor.generateDropdown({title:"Format",items:".mkv (vp8/opus);.webm (vp8/opus)",get:function(){return this.format},set:function(e){this.format=e}},this).appendTo(this.$start),PZ.editor.generateSpacer().appendTo(this.$start),PZ.editor.generateButton({title:"Start video render",clickfn:function(){this.$start.hide(),this.$rendering.show(),PZ.file.getQuota(this.start.bind(this))}},this).appendTo(this.$start),this.$rendering=PZ.editor.generatePlaceholder().appendTo(e).hide(),this.$description=PZ.editor.generateDescription({content:"Your video is being rendered. Please stay on this page to ensure your browser continues to process the video."}).appendTo(this.$rendering),this.$progress=PZ.editor.generateProgressbar({get:PZ.av.getProgress},PZ.av).appendTo(this.$rendering),this.$timeRemaining=PZ.editor.generateDescription({get:PZ.av.getTimeRemaining},PZ.av).css({backgroundColor:"rgb(45, 45, 45)",justifyContent:"space-between"}).prepend($("<span>").text("Time left:")).appendTo(this.$rendering),PZ.editor.generateButton({title:"Cancel render",clickfn:function(){PZ.av.stop(),this.finish(),this.$rendering.hide(),this.$start.show()}},this).appendTo(this.$rendering),this.$finish=PZ.editor.generatePlaceholder().appendTo(e).hide(),PZ.editor.generateDescription({content:"Your render is finished! Click below to download."}).appendTo(this.$finish),PZ.editor.generateButton({title:"Download your video",clickfn:function(){open("/tools/download","_blank")}},this).css("cursor","pointer").appendTo(this.$finish),PZ.editor.generateSpacer().appendTo(this.$finish),PZ.editor.generateButton({title:"Return to editing",clickfn:function(){this.finish(),this.$finish.hide(),this.$start.show()}},this).appendTo(this.$finish),this.$error=PZ.editor.generatePlaceholder().appendTo(e).hide(),PZ.editor.generateDescription({content:"Unfortunately, your download could not be completed. The problem has been reported in order to resolve this issue. Sorry about that."}).appendTo(this.$error),PZ.editor.generateSpacer().appendTo(this.$error),PZ.editor.generateButton({title:"Return to editing",clickfn:function(){this.finish(),this.$error.hide(),this.$start.show()}},this).appendTo(this.$error)},CM.download.start=function(){PZ.editor.elevator_tablock(7,!0),CM.timeline.disable(!0),CM.enableRenderLoop=!1,cancelAnimationFrame(CM.animFrameReq),CM.setRenderMode(!0),$(CM.renderCanv).detach(),CM.resizeViewport(CM.frameWidth,CM.frameHeight);var e=CM.frameWidth/640*(CM.frameHeight/360);e*=CM.frameRate/this.multiplyRate>30?1.5:1,e*=1e6;var t={filename:"matroska",haveVideo:1,haveAudio:1,frameWidth:CM.frameWidth,frameHeight:CM.frameHeight,frameRate:CM.frameRate/this.multiplyRate,videoBitrate:e*this.mode.bitrate,audioBitrate:64e3*this.mode.abr,cpu_used:this.mode.speed,deadline:1,lag_in_frames:12*this.mode.lag,lossless:0,crf:this.mode.crf,video_codec:0,totalFrames:CM.totalFrames/this.multiplyRate,startFrame:1};0===this.mode.deadline?t.deadline=0:2===this.mode.deadline&&(t.deadline=1e6),PZ.av.encode(t,this.getVideoFrame,this.getAudioSamples.bind(this,!0),this.encodeFinished),this.$progress.trigger("update"),this.$timeRemaining.trigger("update")},CM.download.finish=function(){this.waitingPrepare=999,PZ.downloadBlob=null,PZ.file.cleanUp(),CM.currentFrame=1,$("#previewpane").prepend(CM.renderCanv),CM.resizeViewport(),CM.setRenderMode(CM.renderMode),CM.enableRenderLoop=!0,CM.enablePlayFrames=!1,CM.timeline.disable(!1),PZ.editor.elevator_tablock(7,!1),CM.render()},CM.download.encodeFinished=function(e){return"undefined"==typeof e?(CM.download.$rendering.hide(),void CM.download.$error.show()):(PZ.downloadBlob=e,PZ.downloadFilename=0===CM.download.format?"video.mkv":"video.webm",CM.download.$rendering.hide(),void CM.download.$finish.show())},CM.download.getAudioSamples=function(e,t,r,a){var n=Math.floor(48e3*CM.totalTime),i=Math.min(500*r,n-t),s=t/48e3,o=new OfflineAudioContext(2,i,48e3);if(null!==CM.audio.buffer){var l=o.createBufferSource();if(l.buffer=CM.audio.buffer,e){for(var p=o.createGain(),c=o.createStereoPanner(),u=0;u<i/48e3;u+=1/CM.frameRate){var d=(s+u)*CM.frameRate,h=CM.audio.getVolume(d),f=TWEEN.getValue(CM.audio.keyframeProps.pan,d);p.gain.linearRampToValueAtTime(h,u),c.pan.linearRampToValueAtTime(f,u)}l.connect(p),p.connect(c),c.connect(o.destination)}else l.connect(o.destination);l.start(0,s+CM.audio.startOffset)}o.oncomplete=function(e){o.oncomplete=null,a(e.renderedBuffer)},o.startRendering()},CM.download.getVideoFrame=function(e,t,r){CM.download.finishVideoFrame=function(){if(!(this.waitingPrepare>0)){CM.render(null,!0);var t=CM.renderer.context;t.readPixels(0,0,CM.frameWidth,CM.frameHeight,t.RGBA,t.UNSIGNED_BYTE,e),r(1),CM.download.$progress.trigger("update"),CM.download.$timeRemaining.trigger("update")}},CM.currentFrame=t*CM.download.multiplyRate+.5,CM.download.waitingPrepare=1,CM.updateScene(!0),CM.download.waitingPrepare--,CM.download.finishVideoFrame()},CM.about=function(e){PZ.editor.generateTitle({title:"Clipmaker 2.0.157"}).appendTo(e),PZ.editor.generateDescription({content:'Copyright 2017 Panzoid <br><a target="_blank" href="/terms">Terms</a> | <a target="_blank" href="/privacy">Privacy</a> | <a href="/tools/clipmaker1">Legacy Clipmaker</a>'}).appendTo(e),PZ.editor.generateSpacer().appendTo(e),PZ.editor.generateDescription({content:"Recent changes: <br /><ul><li>support for more font formats</li><li>fixed OBJ import</li><li>improved keyframe selection</li><li>delete keyframes with right click or delete key</li><li>improved reflection</li><li>improved camera shake, added new settings</li><li>added camera 2d/3d projection setting</li><li>added audio stereo panning setting</li><li>added new effects</li><li>added group reflection visibility option</li><li>various bug fixes, enhancements</li></ul>"}).appendTo(e)},CM.timeline={keyObject:null,imgURL:"",zoom:.15,mode:0,selectedKeys:[]},CM.timeline.init=function(){$(document).keydown(function(e){var t=e.target,r=e.target.tagName;"INPUT"===r||"SELECT"===r||"TEXTAREA"===r||t.isContentEditable||(37===e.which?CM.timeline.setFrame(CM.currentFrame-1):39===e.which?CM.timeline.setFrame(CM.currentFrame+1):32===e.which&&CM.setPlayPause(!CM.enablePlayFrames))}),this.$hideeditor=$("<div>",{class:"disabled"}).append($("<span>").append("(pause to edit)")).hide().appendTo("#editorpane"),this.$hidetimeline=$("<div>",{class:"disabled"}).hide().appendTo("#previewbottom"),this.$resizehandle=$("<div>",{style:"width:100%;height:3px;position:relative;top:-3px;cursor:ns-resize;"}).drag("start",function(e,t){t.startHeight=$("#previewbottom").height()}).drag(function(e,t){var r=Math.max(Math.min(t.startHeight-t.deltaY,1e3),115);$("#previewbottom").height(r)}).drag("end",function(e){CM.resizeViewport(),CM.timeline.update(),CM.timeline.scheduleRedraw()}).appendTo("#previewbottom");var e=$("#previewbottom");e.height(149),this.$framescroll=$("<div>",{style:"position:absolute;top:0;bottom:0;right:0;left:200px;overflow:hidden;overflow-x:scroll"}).appendTo(e).on("mousewheel DOMMouseScroll",function(e){var t=e.pageX-$(this).offset().left;if(e.ctrlKey===!0)e.originalEvent.wheelDelta>0?CM.timeline.updateZoom(1.125*CM.timeline.zoom,t):CM.timeline.updateZoom(CM.timeline.zoom/1.125,t),e.preventDefault();else{var r=CM.timeline.$framescroll.scrollLeft();e.originalEvent.wheelDelta>0?CM.timeline.$framescroll.scrollLeft(r-50*CM.timeline.zoom):CM.timeline.$framescroll.scrollLeft(r+50*CM.timeline.zoom)}}),this.$framecontainer=$("<div>",{style:"position:absolute;left:0;top:0;bottom:0;transform-origin: left;background-repeat: repeat;cursor: default;"}).drag("init",CM.timeline.timelineDrag).drag(CM.timeline.timelineDrag,{click:!0}).on("contextmenu",function(e){e.preventDefault()}).appendTo(this.$framescroll),this.$framebar=$("<div>",{style:"position:absolute;left:0;top:0;bottom:0;width:50px;margin-left:-25px;background-color:rgba(0,0,0,0.5);z-index:10000;pointer-events: none;"}).appendTo(this.$framecontainer);var t="position:absolute;cursor:pointer;",r="fill:#ccc;width:25px;height:25px;pointer-events:none";this.$playpause=$("<a>",{style:t+"top:5px;left:10px;",title:"toggle playback"}).append(PZ.editor.generateIcon("play").attr("style",r)).click(function(){CM.setPlayPause(!CM.enablePlayFrames)}).appendTo(e).children().first(),$("<a>",{style:t+"top:5px;left:40px;",title:"toggle render preview"}).append(PZ.editor.generateIcon("preview").attr("style",r)).click(function(){$(this).children().first().toggleClass("iconactive",!CM.renderMode),CM.toggleRenderMode()}).appendTo(e),$("<a>",{style:t+"top:5px;left:70px;",title:"toggle audio mute"}).append(PZ.editor.generateIcon("mute").attr("style",r)).click(function(){$(this).children().first().toggleClass("iconactive",CM.audio.enablePreview),CM.audio.toggleMute()}).appendTo(e),$("<a>",{style:t+"top:5px;left:100px;",title:"toggle half speed"}).append(PZ.editor.generateIcon("slow").attr("style",r)).click(function(){CM.playSpeed=1===CM.playSpeed?.5:1,$(this).children().first().toggleClass("iconactive",1!==CM.playSpeed),CM.audio.setPlaybackRate(CM.playSpeed)}).appendTo(e),$("<a>",{style:t+"top:5px;left:130px;",title:"toggle audio waveform"}).append(PZ.editor.generateIcon("wave").attr("style",r)).click(function(){CM.timeline.mode=0===CM.timeline.mode?1:0,$(this).children().first().toggleClass("iconactive",0!==CM.timeline.mode),CM.timeline.redraw()}).appendTo(e),$("<a>",{style:t+"bottom:10px;left:10px;",title:"zoom out"}).append(PZ.editor.generateIcon("zoomout").attr("style",r)).click(function(){var e=CM.timeline.$framebar.offset().left-CM.timeline.$framescroll.offset().left;CM.timeline.updateZoom(CM.timeline.zoom/1.125,e)}).appendTo(e),$("<a>",{style:t+"bottom:10px;left:40px;",title:"zoom in"}).append(PZ.editor.generateIcon("zoomin").attr("style",r)).click(function(){var e=CM.timeline.$framebar.offset().left-CM.timeline.$framescroll.offset().left;CM.timeline.updateZoom(1.125*CM.timeline.zoom,e)}).appendTo(e),this.$framelabel=$("<input>",{class:"pzinput",style:"position:absolute;top:40px;font-size:18px;"}),e.append(this.$framelabel),this.$framelabel.pzinput({change:function(e){CM.timeline.setFrame(parseFloat(e))},max:1e6,min:1,step:1,decimals:0,dragstep:.075}),this.$timelabel=$("<input>",{class:"pzinput",style:"position:absolute;top:40px;left:85px;font-size:18px;"}),e.append(this.$timelabel),this.$timelabel.pzinput({change:function(e){CM.timeline.setFrame(Math.floor(parseFloat(e)*CM.frameRate)+1)},max:5e4,min:0,step:.5,decimals:2,dragstep:1/120}),PZ.keyframes.update=CM.timeline.updateKeys.bind(this),CM.timeline.updateZoom(.15,0),CM.timeline.updateFrame()},CM.timeline.disable=function(e){this.$hidetimeline.toggle(e)},CM.timeline.scheduleRedraw=function(){clearTimeout(this.redrawTimer),0!==this.mode&&(this.redrawTimer=setTimeout(CM.timeline.redraw,1e3))},CM.timeline.redraw=function(){if(0===CM.timeline.mode){var e;if(null!==CM.timeline.keyObject){var t=Object.keys(CM.timeline.keyObject);e=CM.timeline.$framecontainer.innerHeight()/t.length}else e=2*CM.timeline.$framecontainer.innerHeight();CM.timeline.$framecontainer.css("background-image","linear-gradient(rgb(102, 102, 102) 50%, rgb(80, 80, 80) 50%)"),CM.timeline.$framecontainer.css("background-size","10px "+2*e+"px")}else CM.audio.generateWaveform(Math.min(1e4,CM.timeline.$framecontainer.width()/5),CM.timeline.$framecontainer.height(),function(e){""!==CM.timeline.imgURL&&URL.revokeObjectURL(CM.timeline.imgURL),CM.timeline.imgURL=e,CM.timeline.$framecontainer.css("background-size","100% 100%"),CM.timeline.$framecontainer.css("background-image","url("+e+")")})},CM.timeline.update=function(){if(this.$framecontainer.width(50*CM.totalFrames),this.$framebar.siblings().remove(),null===this.keyObject)return void(0===this.mode&&this.redraw());var e=Object.keys(this.keyObject),t=this.$framecontainer.innerHeight()/e.length;0===this.mode&&this.redraw(),$("#controls div:visible div.proprow[kf='1']").each(function(t,r){$(r).children("span").css("border-bottom","3px solid hsl("+t*(360/e.length)+", 50%, 35%)")});for(var r=0;r<e.length;r++)for(var a=this.keyObject[e[r]],n="hsl("+r*(360/e.length)+", 50%, 35%)",i=t*r,s=0;s<a.length&&!(a[s].frame>CM.totalFrames);s++){var o=$("<div>",{style:"position:absolute;width:50px"}).css({height:t,top:i,left:50*(a[s].frame-1),backgroundColor:n});this.setupKeyframe(o,a[s]),o.appendTo(this.$framecontainer)}},CM.timeline.setupKeyframe=function(e,t){e.attr("tabindex","-1"),e.css("cursor","move"),e.data("keyframe",t),e.drag(this.keyframeDrag,{relative:!0,click:!0}).drag("init",this.keyframeDragInit).drag("start",this.keyframeDragStart).drag("end",this.keyframeDragEnd),e.on("click",this.keyframeClick),e.on("contextmenu",this.keyframeContextmenu),e.on("keydown",this.keyframeKeypress)},CM.timeline.keyframeDragInit=function(e,t){$(this).hasClass("keyselected")?CM.timeline.kfOriginalState=!0:(e.shiftKey||$(".keyselected").removeClass("keyselected"),CM.timeline.kfOriginalState=!1,$(this).addClass("keyselected")),this.focus(),CM.timeline.kfDragged=!1},CM.timeline.keyframeDragStart=function(e,t){t.containerStart=CM.timeline.$framescroll.offset().left,t.oldFrame=$(t.drag).data("keyframe").frame},CM.timeline.keyframeDrag=function(e,t){var r=CM.timeline.$framescroll[0].scrollLeft,a=e.pageX-t.containerStart+r,n=Math.floor(a/CM.timeline.zoom/50)+1;n=Math.min(CM.totalFrames,Math.max(1,n));var i=n-t.oldFrame,s=!1;CM.timeline.kfDragged!==!0&&0!==i&&(CM.timeline.kfDragged=!0,e.altKey&&(s=!0)),$(".keyselected").each(function(){var e=$(this).data("keyframe");if(s){var t=$(this).clone();t.removeClass("keyselected"),t.addClass("keyadded"),CM.timeline.setupKeyframe(t,PZ.keyframes.clone(e)),t.appendTo(CM.timeline.$framecontainer)}e.frame=Math.min(CM.totalFrames,Math.max(1,e.frame+i)),$(this).css("left",50*(e.frame-1))}),t.oldFrame=n},CM.timeline.keyframeDragEnd=function(e){$("#controls .proprow[kf='1']").each(function(){$(this).triggerHandler("update")});var t=Object.keys(CM.timeline.keyObject);$(".keyadded").each(function(){var e=Math.round($(this).position().top/$(this).height());CM.timeline.keyObject[t[e]].push($(this).data("keyframe")),$(this).removeClass("keyadded")});for(var r=0;r<t.length;r++)CM.timeline.keyObject[t[r]].sort(PZ.keyframes.sort)},CM.timeline.keyframeClick=function(e){CM.timeline.kfDragged!==!0&&(e.shiftKey?$(this).toggleClass("keyselected",!CM.timeline.kfOriginalState):($(".keyselected").removeClass("keyselected"),$(this).addClass("keyselected")),CM.timeline.setFrame($(this).data("keyframe").frame))},CM.timeline.keyframeContextmenu=function(e){var t=Object.keys(CM.timeline.keyObject),r=Math.round($(this).position().top/$(this).height()),a=$(this).data("keyframe").frame,n=CM.timeline.keyObject[t[r]];if(n.length>1)for(var r=0;r<n.length;r++)if(n[r].frame===a){n.splice(r,1),$(this).remove();break}CM.timeline.setFrame(CM.currentFrame),e.preventDefault()},CM.timeline.keyframeKeypress=function(e){var t=Object.keys(CM.timeline.keyObject);46===e.which&&($(".keyselected").each(function(){var e=Math.round($(this).position().top/$(this).height()),r=$(this).data("keyframe").frame,a=CM.timeline.keyObject[t[e]];if(a.length>1)for(var e=0;e<a.length;e++)if(a[e].frame===r){a.splice(e,1),$(this).remove();break}}),CM.timeline.setFrame(CM.currentFrame))},CM.timeline.timelineDrag=function(e,t){var r=t.deltaX+t.startX-t.originalX,a=Math.floor(r/CM.timeline.zoom/50);CM.currentFrame!==a+1&&CM.timeline.setFrame(a+1)},CM.timeline.setFrame=function(e){CM.currentFrame=Math.min(CM.totalFrames,Math.max(1,e)),CM.setPlayPause(!1),this.updateFrame(),$("#controls .proprow[kf='1']").each(function(){$(this).triggerHandler("update")})},CM.timeline.updateKeys=CM.timeline.update;CM.timeline.updateZoom=function(e,t){var r=this.zoom,a=this.$framescroll.scrollLeft();this.zoom=e,this.$framecontainer.css("transform","scale("+this.zoom+", 1)");var n=(a+t)*(this.zoom/r)-t;this.$framescroll.scrollLeft(n)};CM.timeline.updateFrame=function(){this.$framebar.css({left:50*CM.currentFrame-25}),this.$framelabel.val(Math.floor(CM.currentFrame)),this.$timelabel.val(((CM.currentFrame-1)/CM.frameRate).toFixed(2));var e=(50*CM.currentFrame-25)*this.zoom;(e<this.$framescroll.scrollLeft()||e>this.$framescroll.scrollLeft()+this.$framescroll.width())&&this.$framescroll.scrollLeft(e)};